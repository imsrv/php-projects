<!-- Нажмите Alt+F4 -->
<html><head>
<title>Регулярные выражения. Часть 3. PCRE. -- Техника программирования -- версия для печати -- php в деталях</title>
<meta name="keywords" content="программирование php programming пхп php4 php3 zend html базы данных mysql php+mysql apache апач апаче phpmyadmin скрипт script array массив object объект объектно-ориентированное программирование ООП бесплатно free open source открытый источник код безопасность security">
<meta name="description" content="Детальное описание приёмов программирования PHP, примеры, бесплатные скрипты">

<link rel=stylesheet type=text/css href=/pict/all.css>
</head>
<body link=#0063a5 alink=#0063a5 vlink=#004385 bgcolor=#ffffff>
<h2>Полная версия выпуска: <a href=http://detail.phpclub.net/technique/01-02-16/>http://detail.phpclub.net/technique/01-02-16/</a></h2>
<h1>Регулярные выражения. Часть 3. PCRE.</h1>
<div class="info">DL<br>16.02.2001</div>
<p>И вот, наконец, серия выпусков про регулярные выражения подходит к концу. Поговорим о регулярных выражениях совместимых с Perl (Perl compatible regular expressions&nbsp;&#151; PCRE).<br />
<br />
Самое главное их преимущество перед POSIX, как мне уже подсказывают&nbsp;&#151; возможность "жадного" поиска. Вопросительный знак в PCRE выступает еще и как минимизатор квантификатора:<br />
<br />
.*?<br />
<br />
Найдет минимальную подходящую строку. Вроде бы ничего особенного? Нет, это очень особенная вещь. Например, какой пример я приводил в прошлом выпуске про печатную версию текста?</p>&#36;text = ereg_replace("&lt;a +href=([^&gt;]+)&gt;[^&lt;]+&lt;/a&gt;", "  [1]", &#36;text);<p>То есть, внури ссылки не должно быть тегов (например "&lt;a href=...&gt;&lt;b&gt;...&lt;/b&gt;&lt;/a&gt;"). Если же сделать так:</p>&#36;text = ereg_replace("&lt;a +href=([^&gt;]+)&gt;.*&lt;/a&gt;", "  [1]", &#36;text);<p>Тогда мы получим... Правильно, весь текст между началом первой и концом последней ссылки.<br />
<br />
Все проблемы снимает жадный поиск.</p>&#36;text = preg_replace("/&lt;as+href=(.*?)&gt;.*?&lt;/a&gt;/", "  [1]", &#36;text);<p>Программа подберет для всех ссылок минимальную подходящую строку, т.е. только до тега "&lt;/a&gt;". Описывать значение такой особенности PCRE нет смыла&nbsp;&#151; оно огромное. :) Идем дальше.<br />
<br />
Цифры теперь можно обозначить не как "[0-9]", а просто "d". Не-цифры ("[^0-9]") как "D". Очень удобно. Вот остальные обозначения:</p><table width=100% cellpadding=4 cellspacing=0 border=1><tr><td>w</td><td width=100%>[a-z0-9]</td></tr><tr><td>W</td><td width=100%>[^a-z0-9]</td></tr><tr><td>s</td><td width=100%>[ ]</td></tr><tr><td>S</td><td width=100%>[^ ]</td></tr></table><p>Рекомендую заглянуть в выпуски про поиск&nbsp;&#151; там эти символы используются.<br />
<br />
Строка шаблона, как вы уже заметили, начинается и заканчивается слэшами. Для чего нужен первый слэш, не знаю. Последний нужен для отделения шаблона от параметров. Параметры, которые я понял, таковы:</p><table width=100% cellpadding=4 cellspacing=0 border=1><tr><td>i</td><td width=100%>регистронезависимый поиск</td></tr><tr><td valign=top>m</td><td width=100%><p>многостроковый режим. По умолчанию PCRE ищет сопвадения с шаблоном только внутри одной строки, а символы "^" и "&#36;" совпадают только с началом и концом всего текста. Когда этот параметр установлен, "^" и "&#36;" совпадают с началом и концом отдельных строк.</p></td></tr><tr><td valign=top>s</td><td width=100%>символ "." (точка) совпадает и с переносом строки (по умолчанию&nbsp;&#151; нет)</td></tr><tr><td>A</td><td width=100%>привязка к началу текста</td></tr><tr><td valign=top>E</td><td width=100%>заставляет символ "&#36;" совпадать только с концом текста. Игнорируется, если установлен парамерт m.</td></tr><tr><td valign=top>U</td><td width=100%>Инвертирует "жадность" для каждого квантификатора (если же после квантификатора стоит "?", этот квантификатор перестает быть "жадным").</td></tr></table><p>Естественно, регистр в параметрах имеет значение. Остальное о них можно прочесть в <a href=http://www.php.net/manual/pcre.pattern.modifiers.php>руководстве по php</a> [1].<br />
<br />
Теперь о функциях PCRE.<br />
<br />
Функция <a href=http://www.php.net/manual/function.preg-match.php>preg_match</a> [2] в отличие от ereg ищет только первое совпадение. Если нужно найти все совпадения и как-то обработать их результаты (но не напрямую через <a href=http://www.php.net/manual/function.preg-replace.php>preg_replace</a> [3]), нужно пользоваться <a href=http://www.php.net/manual/function.pref-match-all.php>preg_match_all</a> [4]. Параметры этой функции те же.<br />
<br />
Из полезного отмечу функцию <a href=http://www.php.net/manual/function.preg-quote.php>preg_quote</a> [5], которая вставляет слэши перед всеми служебными символами (например, скобками, квадратными скобками и т.п.), чтобы те воспринимались буквально. Если у вас есть какой-либо ввод информации пользователем, и вы проверяете его через PCRE, лучше перед этим закомментировать служебные символы в пришедшей переменной (мало ли что он там напишет, это ведь по определению злобный хакер).<br />
<br />
Это все, что я могу сказать про регулярные выражения. Дальше&nbsp;&#151; только искусство комбинирования строк и написания алгоритмов.<br />
<br />
Помнится, в одном из пришлых выпусков я описал рассыльщик почты на классах. Теперь я добавил туда хранение адресов в файлах и подтверждение подписки. Разумеется, различные проверки адресов, получение списка активных и тому подобное&nbsp;&#151; все работает на PCRE. К сожалению, времени на тестирование и доводку не было, рассыльщик "сырой".<br><h2>Ссылки, использованные в выпуске:</h2>1) http://www.php.net/manual/pcre.pattern.modifiers.php<br>2) http://www.php.net/manual/function.preg-match.php<br>3) http://www.php.net/manual/function.preg-replace.php<br>4) http://www.php.net/manual/function.pref-match-all.php<br>5) http://www.php.net/manual/function.preg-quote.php</p>

<br><br><h2>Полная версия выпуска: <a href=http://detail.phpclub.net/technique/01-02-16/>http://detail.phpclub.net/technique/01-02-16/</a></h2>
<hr>
&copy; Дмитрий Лебедев &lt;<a href=mailto:dnl@au.ru>dnl@au.ru</a>&gt;<br>
&copy; Клуб PHP-разработчиков &lt;<a href=http://phpclub.net>http://phpclub.net</a>&gt;
</body></html>