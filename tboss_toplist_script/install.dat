1.86 php rerank test
#%Dir: .%#
#%File: ./acc.cgi%#
#--------------------------------------------------------------
#  ##%TL_NAME%## ##%TL_VER%##				      
#--------------------------------------------------------------
#                    DO NOT EDIT THIS FILE                    
#--------------------------------------------------------------

package setup;
$| = 1;

#use strict;
use vars;
#use strict;

BEGIN {
my $FH;
$SIG{'__WARN__'} = sub {
  if (! -e 'error.txt') {
     umask 0;
    open($FH,"> ./logs/error.txt");
  } else { open($FH,">> ./logs/error.txt");}
  if (  (stat($FH))[7] > 1000000 ) {close($FH);    open($FH,"> ./logs/error.txt");}
  print $FH (@_);
};

}



1;

require "./libfile.cgi";
require "./libadmin.cgi";
require "./liblog.cgi";
require "./libparse.cgi";
require "./libaccount.cgi";
require "./lib5.cgi";
require "./data/config.dat";
require "./data/var.dat";
require "./data/infos.dat";


$lib5::header_posted = 0;

my %params;
my ($invalid) = 0;
# done parts : ADD,VALIDATE_ADD

if ($ENV{'REQUEST_METHOD'} eq "GET") {
  %params = lib5::getParams();
  convertHexaToChar(\%params);
  substPlusWithPause(\%params);
  chooseMenu(\%params);

}
elsif ($ENV{'REQUEST_METHOD'} eq "POST") {
# for (my $i=0;$i<$ENV{'CONTENT-LENGTH'})
  read(STDIN,my $data,$ENV{'CONTENT_LENGTH'});
  my @temp;
  @temp = split(/\&/,$data);
   
  foreach my $keyval (@temp) {
    (my $key,my $val)=split(/\=/,$keyval);

    if (defined $params{$key}) {
      $params{$key} = join("\0",$params{$key},$val);
    }
    else {
    $params{$key} = $val;
      #parameters from line in HASH %params
    }


   }
  convertHexaToChar(\%params);
  substPlusWithPause(\%params);     
  chooseMenu(\%params);
#  lib5::error_message($config::lang,1031);
}

else {
  print "\nDon't run from SHELL\n";
}

sub chooseMenu {
my ($params) = shift;
  SWITCH: {
    (%$params == 0) && do{askForType();last SWITCH;};
    
    ($$params{'action'} eq "emailAccs") && do{ 
    libAdmin::emailAccs($$params{'fieldEMAIL'}); 
    print "Content-type: text/html\n\n";
    print <<DIALOG_A;
<html>
<link rel="stylesheet" href="/main.css" type="text/css">
<head><title>Operation DONE</title></head>
<body>
<div>Operation DONE</div>
</body>
</html>
DIALOG_A
    exit 0;
    last SWITCH;
    };
    ($$params{'action'} eq "pwdForgot") && do{ 
    if (libAdmin::pwdForgot($$params{'fieldACC'})) {
    print "Content-type: text/html\n\n";
    print <<DIALOG_B;
<html>
<link rel="stylesheet" href="/main.css" type="text/css">
<head><title>Operation DONE</title></head>
<body>
<div>Operation DONE</div>
</body>
</html>
DIALOG_B
    exit 0;
    }
    else {
    print "Content-type: text/html\n\n";
    print <<DIALOG_C;
<html>
<link rel="stylesheet" href="/main.css" type="text/css">
<head><title>Warning !!!</title></head>
<body>
<div>Account doesn\'t exist</div>
</body>
</html>
DIALOG_C
    exit 0;
    }
    last SWITCH;};    
    
    ($$params{'action'} eq "add") && do{parseAddSetupHTML(0);last SWITCH;};
    ($$params{'action'} eq "verify1") && do{parseAddSetupHTML(1,$params);last SWITCH;};
    ($$params{'action'} eq "filldetail") && do{parseAddSetupHTML(2,$params);last SWITCH;};
    ($$params{'action'} eq "validate") && do{parseAddSetupHTML(3,$params);last SWITCH;};
    ($$params{'action'} eq "validandsave") && do{parseAddSetupHTML(6,$params);last SWITCH;};

    ($$params{'action'} eq "modif") && do{parseAddSetupHTML(4,$params);last SWITCH;};
    ($$params{'action'} eq "modif_auth") && 
        do{
	  if ( !libAccount::isLocked($$params{$var::form{'setup_auth'}{$var::acc}}) && libAccount::checkAccPWD($$params{$var::form{'setup_auth'}{$var::acc}},$$params{$var::form{'setup_auth'}{$var::pwd}})) {
            parseAddSetupHTML(5,$params);
	  } else {lib5::error_message($config::lang,1121);}
	  last SWITCH;
	};    
    lib5::error_message($config::lang,1032);
  } # SWITCH
}




sub listAddedFields {
my ($params) = shift;
my @output;
foreach my $field (@var::valuesInAddForm) {
  if ($field eq $var::pwd) {next;}
  push(@output,"$field: $$params{$var::form{'setup_form'}{$field} }");
}
return @output;
}

sub substPlusWithPause{
my ($param) = shift;
my ($key,$value);

while (($key,$value) =  (each %$param)) {
    $value =~ s/\+/" "/eg;
    $$param{$key} = $value;
  }
}

sub sendAccRegReport {
# ref. to hash
my ($params) =shift;
#libLog::logAction("Before send report");
if ( sendReportToAdmin($params) && sendReportToAcc($params) ) {
 #libLog::logAction("After .. OK send report");
return 1;
}
 #libLog::logAction("After.. error send report");
return 0;
}



#------------------------------
# Registration report to admin
# Input: ref. to filled data
# Output:
#
#------------------------------

sub parseMail {
my @data;
my ($fn) = shift;
my ($params) = shift;
my $FH;
my ($line) = $var::rmtDelAcc;
$line =~ s/%#ACC#%/"$$params{$var::form{'setup_form'}{$var::acc}}"/gise;
my (%funct) = (
'DEL' => $line
);
if (($FH = libFile::openFile_ex($fn,"RDWR"))!= 3) {
  while (<$FH>) {
    libAdmin::parseID(\$_);
    s/#%F_([^%]*)%#/"$funct{$1}"/gise;    
    s/#%([^%]*)%#/$$params{$1}/gise;
    
    push(@data,$_."\n");
  }
  libFile::closeFile($FH);
  return @data;
}

return 0;
}

#------------------------------
# Registration report to admin
# Input: ref. to filled data
# Output:
#
#------------------------------

sub sendReportToAdmin {
#ref. to added data
my ($params) = shift;
#b 0- registr
# 1- modif
my ($type) = shift;
my $FH;
my @body1;
my @body2;

SW:{
if ((!$type && !$var::mailAfterReg) || ($type && !$var::mailAfterEdit) ){last SW;}

if ($type) {
  if (!$config::reportAdminEditType) {
    @body1 = parseMail(libFile::getTemplName($config::reportAccEditAdminText),$params);
  }
  else {
    @body1 = parseMail(libFile::getTemplName($config::reportAccEditAdminHtml),$params);  
  }    
}

else {
  #Plain text
  if (!$config::reportAdminType) {
    @body1 = parseMail(libFile::getTemplName($config::reportAccAdminText),$params);
  }
  # HTML text
  elsif ($config::reportAdminType==1) {
    @body1 = parseMail(libFile::getTemplName($config::reportAccAdminHtml),$params);
  }
  # plain/HTML text
  elsif ($config::reportAdminType==2) {
    @body1 = parseMail(libFile::getTemplName($config::reportAccAdminText),$params);
    @body2 = parseMail(libFile::getTemplName($config::reportAccAdminHtml),$params);
  }
}
if (libAdmin::sendMailEx($config::reportAdminType,$var::email,$var::email,(!$type)?"$var::emailReportSubject{'admin'} ($var::topListID)":"$var::emailReportSubject{'editadmin'} ($var::topListID)",\@body1,\@body2)) {
  return 1; 
}
return 0;
}
return 1; # rep to admin is not set
}


#------------------------------
# Registration report to acc
# Input: ref. to filled data
# Output:
#
#------------------------------

sub genReportToAcc {
my @data;
my ($type) = shift;
my ($fnH) = shift;
my ($fnF) = shift;
my ($params) = shift;
my $FH;

SW: {
  $FH = libFile::openTempl($fnH,0);
  if ($FH != 3) {
    while (<$FH>) { push(@data,$_); }
    libFile::closeFile($FH);
}

foreach my $field (@var::valuesInAddForm) {
  push(@data,"$field: $$params{$var::form{'setup_form'}{$field} }".(($type)?"<BR>":"")."\n");
}
push(@data,"Recip. link: ",($var::usePHP)?"$config::phpInUrl?acc=$$params{$var::form{'setup_form'}{'acc'} }":"$config::in_cgi?acc=$$params{$var::form{'setup_form'}{'acc'} }",(($type)?"<BR>":""),"\n");

$FH = libFile::openTempl($fnF,0);
if ($FH != 3) {
  while (<$FH>) { push(@data,$_); }
  libFile::closeFile($FH);
}
return @data;
}#SW
return 0;
}


#------------------------------
# Registration report to accounter
# Input: ref. to filled data
# Output:
#
#------------------------------

sub sendReportToAcc {
#ref. to added data
my ($params) = shift;
my $FH;
my @body1;
my @body2;
#  Plain text

SW: {

if (!$var::mailAfterRegAcc) {last SW;}


if (!$config::reportAccType) {
  @body1 = genReportToAcc(0,$config::reportAccHeaderText,$config::reportAccFooterText,$params);
}
# HTML text
elsif ($config::reportAccType==1) {
  @body1 = genReportToAcc(1,$config::reportAccHeaderHtml,$config::reportAccFooterHtml,$params);
}
# plain/HTML text
elsif ($config::reportAccType==2) {
  @body1 = genReportToAcc(0,$config::reportAccHeaderText,$config::reportAccFooterText,$params);
  @body2 = genReportToAcc(1,$config::reportAccHeaderHtml,$config::reportAccFooterHtml,$params);
}

if (libAdmin::sendMailEx($config::reportAccType,$var::email,$$params{$var::form{'setup_form'}{'mail'} },$var::emailReportSubject{'acc'},\@body1,\@body2)) {
  return 1; 
}
return 0;
}
return 1;
}


sub convertHexaToChar {
my ($param) = shift;
my ($key,$value);

while (($key,$value) =  (each %$param)) {
    $value =~ s/%([\dA-Fa-f][\dA-Fa-f])/pack ("C",hex ($1))/eg;
    $$param{$key} = $value;
  }
}

sub showSuccessMessage {
my ($par) = shift;
my ($acc)= shift;
my ($params)= shift;
my %parx;
if ($par == 0) {
    $parx{"1"} = $acc;
   lib5::info_message(2,$infos::info{'ACC_ADD'},\%parx);
 }
 elsif($par == 1) {
    $parx{"1"} = $acc;
    foreach (@var::valuesInAddForm) {
      if ($_ eq $var::pwd) {next;}
      $parx{"2"} .= "<tr><td class=\"messageValName\">$var::fName{$_}</td><td class=\"messageValue\">&nbsp;&nbsp;&nbsp;$$params{$var::form{'setup_form'}{$_}}</td></tr>\n";
    }
   lib5::info_message(2,$infos::info{'ACC_MOD'},\%parx); 
 }
 elsif($par == 10) {
    $parx{"1"} = $acc;
    foreach (@var::valuesInAddForm) {
      if ($_ eq $var::pwd) {next;}
      $parx{"2"} .= "<tr><td class=\"messageValName\">$var::fName{$_}</td><td class=\"messageValue\">&nbsp;&nbsp;&nbsp;$$params{$var::form{'setup_form'}{$_}}</td></tr>\n";
    }
   lib5::info_message(2,$infos::info{'ACC_ADD'},\%parx);
 }
}

sub checkMail {
my ($param) = shift;
#print "Content-type: text/html\n\n";
#print $param;
  if ($param =~ /[^\@]*\@[^\.]*\..+/) {return 1;} else {return 0;}
  
}

sub isInChosenWords {
my ($param) = shift;
foreach my $word (libAdmin::getRestrWords()) {
  $word =~ /([A-Za-z0-9]*)/;
  ($1 ne "") && ($param =~ /$1/) && do{  return 1;    };
}
return 0;
}

sub isInChosenUrls {
my ($param) = shift;

foreach my $word (libAdmin::getRestrUrls()) {
  $word =~ /([A-Za-z0-9]*)/;
  ($1 ne "") && ($param =~ /$1/) && do{    return 1;    };
}
return 0;
}


sub genErrorMessage {
my ($field) = shift;
my ($kw) = shift;
my ($val) = shift;

return "Error in field $var::fName{$field}. <BR>$kw<BR><BR>";

}

# ---------------------------------------------
#
# Input:  field name, field value
# Output: Error message /as string/
#
# ---------------------------------------------
sub checkInput {
my ($fName) = shift;
my ($fValue) = shift;
my (@error) = ();
# check MIN
if ( $var::formCheck{$fName}{$var::checkMin} ) {
  if ((length $fValue) < $var::inputRestr{$fName."_min_chars"}) {
    push (@error,genErrorMessage($fName,"Minimum is ".$var::inputRestr{$fName."_min_chars"}." char(s)"));
  }}
# check MAX
if ( $var::formCheck{$fName}{$var::checkMax} ) {
    if ((length $fValue) > $var::inputRestr{$fName."_max_chars"}) {
      push (@error,genErrorMessage($fName,"Maximum is ".$var::inputRestr{$fName."_max_chars"}." char(s)"));
    }}
# check MAX Number
if ( $var::formCheck{$fName}{$var::checkNMax} ) {
    if ($fValue > $var::inputRestr{$fName."_max_num"}) {
      push (@error,genErrorMessage($fName,"Maximum is ".$var::inputRestr{$fName."_max_num"}.""));
    }}
# check MIN Number    
if ( $var::formCheck{$fName}{$var::checkNMin} ) {
    if ($fValue > $var::inputRestr{$fName."_min_num"}) {
      push (@error,genErrorMessage($fName,"Minimum is ".$var::inputRestr{$fName."_min_num"}.""));
    }}
    
#check url
if ( $var::formCheck{$fName}{$var::checkUrl} ) {
  if (isInChosenUrls($fValue)) {
    push (@error,genErrorMessage($fName,"String $fValue is banned."));    
  }}
#check words
if ( $var::formCheck{$fName}{$var::checkWord} ) {

  if (isInChosenWords($fValue)) {

    push (@error,genErrorMessage($fName,"String $fValue is banned."));    
  }}
#check if is number
if ( $var::formCheck{$fName}{$var::checkNum} ) {
  if ($fValue =~ /[^0-9]/) {
    push (@error,genErrorMessage($fName,"$fValue must be a number."));    
  } }
#check syntax
if ( $var::formCheck{$fName}{$var::checkSyntax} ) {
  SWITCH: {
    ($fName eq $var::mail) && do {
      if (!($fValue =~ /[^@]*\@[^.]*\.\w/)) {
	push (@error,genErrorMessage($fName,"Syntax error in value: \"$fValue\".<BR> [Example xxx\@xx.xx]"));
      }	
    last SWITCH;      
    };

    
    ( ($fName eq $var::web2link)||($fName eq $var::weblink)||($fName eq $var::banner)||($fName eq $var::sample)  ) && do {
      if (!($fValue =~ /http:\/\//i)) {
	push (@error,genErrorMessage($fName,"Syntax error in value: \"$fValue\".<BR> [Example http://www.xxx.xx] Check http://"));
      }	
    last SWITCH;  
    };
    
    
    
    
}  }
return @error;
}



# ---------------------------------------------
#
# Generates ADD account dialog 
# Input:  $type 0: 1.process (acc name, email, PWD)
# Output: ---
#
# ---------------------------------------------


sub parseAddSetupHTML {
my ($type) = shift;
my $FH;
 my ($acc) ;
 my $email;
 my ($pwd1);
  my ($pwd);
my ($rpwd)  ;
my ($writeOnce ) = 0;
my (@acc_data) ;
# content of errors
# 
my (@errorWhere) = ();
$FH = libFile::openTempl($config::htmlAccAddFile,0);     
#$FH = libFile::openFile_ex($config::htmlAccAddFile,"RDWR");
my ($params) = shift;
if ($type==1) {
  $writeOnce = 1;
  my($id) = int(rand(100000));
    
  $acc = $$params{$var::form{'setup_form'}{$var::acc}};
  if (libAccount::isAccount($acc)) {
    @errorWhere = ("Account '$acc' already exists ! <BR>");
  }
  $email = $$params{$var::form{'setup_form'}{$var::mail}};
  $pwd = $$params{$var::form{'setup_form'}{$var::pwd}};  
  $rpwd = $$params{$var::form{'setup_form'}{$var::rpwd}};    
  
  push(@errorWhere,checkInput($var::acc,$acc));
  push(@errorWhere,checkInput($var::mail,$email));  
  push(@errorWhere,checkInput($var::pwd,$pwd));    
  if ($pwd ne $rpwd) {
    push(@errorWhere,"Password and Re-Password must be equal ! <BR>");      
  }    
  if ( scalar @errorWhere ) {
    
    $type=100;
  # verif WRONG
  } else {

    my ($FH2) = libFile::openFile_ex("$config::tempDir/$acc.temp","RDWR|CREAT");
    print $FH2 ($id);
    libFile::closeFile($FH2);
    my (@body) = "Registration ID: $id\nType this ID in the registration form\n";
    libAdmin::sendMailEx(0,$var::email,$email,"Registration Verification",\@body);
  }
}

if ($type ==2) {
  $writeOnce = 1;
  $acc = $$params{$var::form{'setup_form'}{$var::acc}};
  $email = $$params{$var::form{'setup_form'}{$var::mail}};
  $pwd = $$params{$var::form{'setup_form'}{$var::pwd}};  
  
  my ($id) = $$params{'fieldID'};
  my ($FH2) = libFile::openFile_ex("$config::tempDir/$acc.temp","RDWR");
  my ($idx) = <$FH2>;
  libFile::closeFile($FH2);
  if ( ($id != $idx)  || ($id eq "") || ($idx eq "") ) {
    $type=100;
    @errorWhere = ("Wrong Account name of ID ! <BR>Account name and ID must match. <BR>You have obtained ID by e-mail from form before.<BR>");
  # verif WRONG
  } else {
  #verif OK
  }
}

if ($type ==3) {
  $acc = $$params{$var::form{'setup_form'}{$var::acc}};
  unlink "$config::tempDir/$acc.temp";
  foreach ($var::title,$var::descr,$var::banner,$var::sample,$var::pwd,$var::mail,$var::weblink,$var::web2link,$var::info) {
    ${$_} = $$params{$var::form{'setup_form'}{${"var::$_"}}};
    push(@errorWhere,checkInput($_,${$_}));
  }
  foreach ($var::sampleh,$var::samplew,$var::bannerh,$var::bannerw) {
    ${$_} = $$params{$var::form{'setup_form'}{$_}};
  }    
    if ( (${$var::banner} ne  "http://")  ) { 
      if (${$var::bannerw} eq ""){ ${$var::bannerw}=$var::maxBannerWidth};
      if (${$var::bannerh} eq ""){ ${$var::bannerh}=$var::maxBannerHeight};      
    }
    if ( (${$var::sample} ne  "http://")  ) { 
      if (${$var::samplew} eq ""){ ${$var::samplew}=$var::maxSampleWidth};
      if (${$var::sampleh} eq ""){ ${$var::sampleh}=$var::maxSampleHeight};      
    }
  foreach ($var::sampleh,$var::samplew,$var::bannerh,$var::bannerw) {
    push(@errorWhere,checkInput($_,${$_}));
  }
  if (! scalar @errorWhere) {
  # no errors
#    libLog::logAction("no error");
    if (libAccount::addRecord($params) && sendAccRegReport($params,0)) {
      #libLog::logAction("Record Added OK + mail");
      # this stops CGI!!!
       libStat::statReg();
       showSuccessMessage(10,$$params{$var::form{'setup_form'}{'acc'}},$params);
    } else {

    $type = 100;    
        @errorWhere = ("Account '$acc' already exists ! <BR>");     
#       lib5::error_message($config::lang,1020);
    }
  } 
  else   {
#    libLog::logAction("error");
    $type = 100;
  }
}


if ($type ==5) {
  $acc = $$params{$var::form{'setup_form'}{$var::acc}};
  @acc_data = libAccount::getAccData($acc);
}

if ($type ==6) {
  $acc = $$params{$var::form{'setup_form'}{$var::acc}};
  my ($ccc) = 0;
  foreach ($var::title,$var::descr,$var::banner,$var::sample,$var::rpwd,$var::pwd,$var::weblink,$var::web2link,$var::info) {
    ${$_} = $$params{$var::form{'setup_form'}{$_}};
    push(@errorWhere,checkInput($_,${$_}));
  }
  foreach ($var::sampleh,$var::samplew,$var::bannerh,$var::bannerw) {
    ${$_} = $$params{$var::form{'setup_form'}{$_}};
  }    

    if ( (${$var::banner} ne  "http://")  ) { 
      if (${$var::bannerw} eq ""){ ${$var::bannerw}=$var::maxBannerWidth};
      if (${$var::bannerh} eq ""){ ${$var::bannerh}=$var::maxBannerHeight};      
    }

    if ( (${$var::sample} ne  "http://")  ) { 
      if (${$var::samplew} eq ""){ ${$var::samplew}=$var::maxSampleWidth};
      if (${$var::sampleh} eq ""){ ${$var::sampleh}=$var::maxSampleHeight};      
    }

  foreach ($var::sampleh,$var::samplew,$var::bannerh,$var::bannerw) {    
    push(@errorWhere,checkInput($_,${$_}));
  }
    

  
  if ($pwd ne $rpwd) {
    push(@errorWhere,genErrorMessage($var::pwd,"1st and 2nd PWD must be the same !!!"));
  }

  
  if (! scalar @errorWhere) {
  # no errors
    if ( libAccount::updateRecord($params,2) && sendReportToAdmin($params,1)) {
      #libLog::logAction("Record Added OK + mail");
      # this stops CGI!!!
       showSuccessMessage(1,$$params{$var::form{'setup_form'}{$var::acc}},$params);
    } else {
       lib5::error_message($config::lang,1020);
    }
    
  } else 
  
  {
#    libLog::logAction("error in 6");
    $type = 100;
  }

  
}





my ($counter) = 0;
if ($FH != 3) {
  print "Content-type: text/html\n\n";
  my $line;
  my ($wait) = 0;
  my ($wait2) = 0;
  my (%button) = (
	    1 => 'process',
	    0 => 'process',
	    2 => 'save',
	    4 => 'process',
	    5 => 'save'	    
   );
  my (%typeLabel) = (
	    1 => 'verify',
	    0 => 'add',
	    2 => 'detail',
	    4 => 'auth',
	    5 => 'modify',	    
	    100=> 'error'
   );
  my (%typeAction) = (
	    0 => 'verify1',
	    1 => 'filldetail',	    
	    2 => 'validate',
	    4 => 'modif',
	    5 => 'save'	    
   );
   
  while (<$FH>) {
    if ($writeOnce && /ENDALLPART/) {
      print "<input type=\"hidden\" name=\"$var::form{'setup_form'}{$var::pwd}\" value=\"$pwd\">\n";
      print "<input type=\"hidden\" name=\"$var::form{'setup_form'}{$var::mail}\" value=\"$email\">\n";
      $writeOnce = 0;
    }      


    if ( ($type==100) && (/ENDALLPART/) ) {$wait2 = 1;next;}
    if ( ($type==100) && (/BEGINALLPART/) ) {$wait2 = 0;next;}
    if ( ($type==100) && (/BEGINERROR/) ) {$wait2 = 0;next;}
    if ( ($type==100) && (/ENDERROR/) ) {$wait2 = 1;next;}    
    if ( ($type==100) && ($wait2) ) {next;}
    if ( ($type==100) && /submit/ ) {next;}
    if ( ($type==100) ) { s/%#ERRORWHERE#%/"@errorWhere"/e;
   }
    if ( ($type==1) && (/ENDALLPART/) ) {$wait2 = 1;next;}
    if ( ($type==1) && (/BEGINALLPART/) ) {$wait2 = 0;next;}
    if ( ($type==1) && (/BEGINVERIFY/) ) {$wait2 = 0;next;}
    if ( ($type==1) && (/ENDVERIFY/) ) {$wait2 = 1;next;}    
    
    if ( ($type==1) && ($wait2) ) {next;}

    if ( ($type==2) && (/ENDALLPART/) ) {$wait2 = 1;next;}
    if ( ($type==2) && (/BEGINALLPART/) ) {$wait2 = 0;next;}
    if ( ($type==2) && (/BEGINDETAILSECTION/) ) {$wait2 = 0;next;}
    if ( ($type==2) && (/ENDDETAILSECTION/) ) {$wait2 = 1;next;}    
    
    if ( ($type==2) && ($wait2) ) {next;}


    if ( ($type==4) && (/ENDALLPART/) ) {$wait2 = 1;next;}
    if ( ($type==4) && (/BEGINALLPART/) ) {$wait2 = 0;next;}
    if ( ($type==4) && (/BEGINAUTH/) ) {$wait2 = 0;next;}
    if ( ($type==4) && (/ENDAUTH/) ) {$wait2 = 1;next;}    
    
    if ( ($type==4) && ($wait2) ) {next;}

    if ( ($type==5) && (/ENDALLPART/) ) {$wait2 = 1;next;}
    if ( ($type==5) && (/BEGINDETAILSECTION/) ) {$wait2 = 0;next;}
    if ( ($type==5) && (/ENDDETAILSECTION/) ) {$wait2 = 1;next;}
    if ( ($type==5) && (/BEGINALLPART/) ) {$wait2 = 0;next;}    
    if ( ($type==5) && (/BEGINPWDCHANGE/) ) {$wait2 = 0;next;}
    if ( ($type==5) && (/ENDPWDCHANGE/) ) {$wait2 = 1;next;}
    
    if ( ($type==5) && ($wait2) ) {next;}

    if ($type == 5 ) {
      if ( /(name\=\"field)([^\"]*)(\".*value=\")/  ) {
        my ($temp2) =  $2;
	my ($part2) = lc $2;
	my ($part1) = $1;	my ($part3) = $3;
	if ($part2 eq "acc") {
	  s/name\=\"field[^\"]*\".*value=\"/"$part1$temp2$part3$acc\""/e;    
	} else {
          s/name\=\"field[^\"]*\".*value=\"/"$part1$temp2$part3$acc_data[$var::record{$part2}]\""/e;    
	}
      }
    }

    if ($type == 2 ) {
      if (  (/fieldBanner/)||(/fieldSample/)||(/fieldWebLink/)||(/fieldWeb2Link/)   )  {
        my ($temp2) =  $2;
	my ($part2) = lc $2;
	my ($part1) = $1;	my ($part3) = $3;
        s/#%VALUE%#/"http:\/\/"/e;    
      }
    }



    if ( (!$type) && (/ENDALLPART/) ) {$wait2 = 1;next;}
    if ( (!$type) && (/BEGINALLPART/) ) {$wait2 = 0;next;}
    if ( (!$type) && (/BEGINVERMAIL/) ) {$wait2 = 0;next;}
    if ( (!$type) && (/ENDVERMAIL/) ) {$wait2 = 1;next;}    
    
    if ( (!$type) && ($wait2) ) {next;}

    if ($type == 2 || $type == 1) {
      s/(name\=\"fieldAcc\".*value=\")/"$1$acc\""/e;    
    }
    
    libAdmin::parseID(\$_);
    libParse::cutComment(\$_);    
    
    s/$var::htmlParamName{'value'}/$var::htmlValue{'empty'}/e;    
    s/$var::htmlParamName{'nextAction'}/$var::htmlValue{ $typeAction{$type} }/e;
    s/$var::htmlSubmit{'save'}/$var::htmlSubmitLabel{$button{$type}}/e;
    s/$var::htmlParamName{'type'}/$var::htmlValueX{$typeLabel{$type}}/e;
    libParse::substParam(\$_,$var::html_param_acc_cgi,$config::acc_cgi);
    print;
  } #while
  
  print "\n";
libFile::closeFile($FH);
} # if $FH OK
}



# ---------------------------------------------
#
# Generates choice dialog
# Input:  ---
# Output: ---
#
# ---------------------------------------------
sub askForType {
my $FH;
my ($wait2)   = 0;
  $FH = libFile::openTempl($config::htmlAskType,0);
  if (!($FH eq "0")) {

  my (%subst)  = (
    "#%ENTER_ADD_ADD%#"=>"$config::tlurl/acc.cgi?action=add",
    "#%ENTER_ADD_MODIF%#"=>"$config::tlurl/acc.cgi?action=modif",
  );

  
    print "Content-type: text/html\n\n";
    while (<$FH>) { 
    
    if (  (/ENDINTROPART/) ) {$wait2 = 1;next;}
    if (  (/BEGINALLPART/) ) {$wait2 = 0;next;}
    if (  (/BEGINCHOOSE/) ) {$wait2 = 0;next;}
    if (  (/ENDCHOOSE/) ) {$wait2 = 1;next;}    
    
    if (  ($wait2) ) {next;}
      s/(#%ENTER_[^%]*%#)/$subst{$1}/e;
      
      libAdmin::parseID(\$_);
#      libLog::logAction("");

      libParse::substParam(\$_,$var::html_param_setup_cgi,$config::acc_cgi);
      libParse::cutComment(\$_);
      s/$var::htmlParamName{'type'}/$var::htmlValueX{'choose'}/e;      
      if ((/type\=\"submit\"/) && (! /name\=\"pwdForgot\"/) && (! /name\=\"emailAccs\"/)) {next;};      

      print;
    }
  }
  libFile::closeFile($FH);
}


#%EOF%#
#%File: ./admin.cgi%#
#--------------------------------------------------------------
#  ##%TL_NAME%## ##%TL_VER%##				      
#--------------------------------------------------------------
#                    DO NOT EDIT THIS FILE                    
#--------------------------------------------------------------

package admin_;

require "./data/config.dat";

1;

($ENV{'QUERY_STRING'} eq "") ?print "Location: $config::admin_path\n\n":
print "Location: $config::admin_path?$ENV{'QUERY_STRING'}\n\n";
exit 0;
#%EOF%#
#%File: ./counter.cgi%#
#--------------------------------------------------------------
#  ##%TL_NAME%## ##%TL_VER%##				      
#--------------------------------------------------------------
#                    DO NOT EDIT THIS FILE                    
#--------------------------------------------------------------

package counter;
$| = 1;

require "./data/config.dat";
require "./liblog.cgi";


exit 0;		#Dont' remove this ANTISTOLLER

if ($ENV{'REQUEST_METHOD'} eq "GET") {
  umask 0;
  if (open(FILE,">> $config::counterLog")) {
    if ($ENV{'QUERY_STRING'} =~ /id=([a-zA-Z0-9]*)_([a-zA-Z0-9]*)/) {print FILE ("$1|$2\n");}
    close (FILE);
  }
} 
exit 0;
#%EOF%#
#%File: ./cronrerank.cgi%#
#--------------------------------------------------------------
#  ##%TL_NAME%## ##%TL_VER%##				      
#--------------------------------------------------------------
#                    DO NOT EDIT THIS FILE                    
#--------------------------------------------------------------

package cronrerank;
require "./liblog.cgi";

libLog::logAction("cron rerank");
#system("./genlist.cgi");#%EOF%#
#%File: ./cronreset.cgi%#
#--------------------------------------------------------------
#  ##%TL_NAME%## ##%TL_VER%##				      
#--------------------------------------------------------------
#                    DO NOT EDIT THIS FILE                    
#--------------------------------------------------------------

package cronReset;
require "./liblog.cgi";

libLog::logAction("cron reset");
system("./reset.cgi");#%EOF%#
#%File: ./error.cgi%#
#--------------------------------------------------------------
#  ##%TL_NAME%## ##%TL_VER%##				      
#--------------------------------------------------------------
#                    DO NOT EDIT THIS FILE                    
#--------------------------------------------------------------

package error;

print "Content-type: text/plain \n\n";

if (open(FH,'error.txt')) {
  while (<FH>){print ;}
}
close(FH);#%EOF%#
#%File: ./genlist.cgi%#
#--------------------------------------------------------------
#  ##%TL_NAME%## ##%TL_VER%##				      
#--------------------------------------------------------------
#                    DO NOT EDIT THIS FILE                    
#--------------------------------------------------------------

package genlist;

BEGIN {
$SIG{'__WARN__'} = sub {
  if (! -e './logs/error.txt') {
     umask 0;
    open(FH,"> ./logs/error.txt");
  } else { open(FH,">> ./logs/error.txt");}
  if (  (stat(FH))[7] > 1000000 ) {close(FH);    open(FH,"> ./logs/error.txt");}
  print FH (@_);
};
  
}

use vars;


$| = 1;
1;

format LIST =
@<<<<<	@<<<<<	@<<<<<	@<<<<<
$key,$hits_in,$hits_out,$rating
.

eval {
  require "./liblog.cgi";
  require "./lib5.cgi";
  require "./liblist.cgi";
  require "./libgenlist.cgi";
  require "./libfile.cgi";
  require "./data/config.dat";
};



my %hash;
my @res;
# Upades account database -> hits in, hits out;
# do update in fields IN/OUT
my ($timeBegin) = time;

libGenList::updateHits();

# add to log file
libLog::logAction("GenList begin");
# CHECK FOR MIN. LIMITS ...
if (libFile::openDBM(\%hash,$config::account_database,1)) {
  my ($diff) =0;
  libGenList::genRank(\@res,\%hash);
  libGenList::cacheTopX(\@res);
  libList::generateTopList(\@res,\%hash);
  libFile::closeDBM(\%hash);    
 # -------------------- timestamp
  my ($FHx) = libFile::openFile("$config::timeStampRerank","RDWR|CREAT");
  print $FHx (time,"\n");
  libFile::closeFile($FHx);
}
else {
  libError::logError("Error open :$config::account_database in genlist.cgi",$0);
# - handle error
#  print "Error opening\n";
}

# lst uptime  moved to libstat::totalstatsum
libStat::setAdminStat($var::statAdmin{'lastRerankDuration'},time - $timeBegin);
libStat::setAdminStat($var::statAdmin{'lastRerankDate'},time);

sub makeRating {
# reting ... IN/OUT * 1000
return ($_[0] / ($_[1]+1.0));
}



sub getOutHits {
# Returns Out hits from file
return $_[$var::record{'out'}];

}
#%EOF%#
#%File: ./genlog.cgi%#
#--------------------------------------------------------------
#  ##%TL_NAME%## ##%TL_VER%##				      
#--------------------------------------------------------------
#                    DO NOT EDIT THIS FILE                    
#--------------------------------------------------------------

package genlog;

$| = 1;

require "./libfile.cgi";
require "./libadmin.cgi";
require "./libstat.cgi";
require "./liblog.cgi";
require "./data/config.dat";

if ($ENV{'REQUEST_METHOD'} eq "GET") {
  my (%params) = lib5::getParams();
  libAdmin::substPlusWithPause(\%params);  
  libAdmin::convertHexaToChar(\%params);
  
  
  
  
SWITCH: {  



  my($FHMain) = libFile::openFile_ex($config::mainLogDetail,"RDWR");
  if (! ($FHMain!=3)) {      libError::logError("Error open file: $config::mainLogDetail",$0);  }
  
  my (%fields);
  foreach (keys %params) { if (/SHOW_(.*)/) {$fields{$1} = 1;    } }






  ($params{'type'} eq "main") && do {  
  my($FHMain) = libFile::openFile_ex($config::mainLogView,"RDWR");
  if ($FHMain != 3) {
    print "Content-type: text/html\n\n";
    while (<$FHMain>) {
      s/#%([^%]*)%#/"${$1}"/e;
      print $_;
    }
  
    libFile::closeFile($FHMain);
  }
  else {
      libError::logError("Error open file: $config::mainLogView",$0);
  }
    last SWITCH;
  };


  ($params{'type'} eq "start") && do {
    print "Content-type: text/html\n\n";
BREAK: {    
    while (<$FHMain>) {
      if (/#%INSERT_DATA%#/) { last BREAK;}
      print;
    }
}    
    last SWITCH;
  };
  
  
  
  # SHOW IN->OUT View
  ($params{'SHOW'} eq "1") && do {
    print "Content-type: text/html\n\n";
    my ($skip) =0;
    my ($dtPosition) = -1;
#    @data = ("1|a|A","2|b|B","3|c|C");
    my ($position) = 0;
    my  (@fieldRank);
    while (<$FHMain>) {
      if (/#%INSERT_DATA%#/) {
        my (@data) = libLog::getLogData($params{'SHOW'},\%fields,$params{'SORT'},$params{'FILTER'},\@fieldRank);
        foreach  (@data) {
	  my(@dtemp) = split(/\|/,$_);
	  if ($dtPosition != -1) {
	    if ($dtemp[$dtPosition] != "") {
	      $dtemp[$dtPosition] = localtime($dtemp[$dtPosition]);
	    }
	  }
	  print "<TR class=\"logDetailItems\">\n";
	  foreach my $item (@dtemp) {
	    print "<TD   class=\"logDetailItems\">$item</TD>";
	  }
	  print "\n</TR>\n";	  
	}
      # enter data
      next;
      }
      if ( /id=([A-Za-z]*)/  && (defined $fields{$1})&&($fieldRank[$position] = $1)  )  {
        if ($1 eq "DT") {$dtPosition = $position;}
	$position++;
      }
      
      if ( /id=([A-Za-z]*)/  &&   (! (defined $fields{$1}))   )  {      
          next;	   
	}

      s/#%([^%]*)%#/"${$1}"/e;      
      print $_;
    }
  

    last SWITCH;
  };


  # SHOW IN View
  ($params{'SHOW'} eq "2"||$params{'SHOW'} eq "3"||$params{'SHOW'} eq "4") && do {
    print "Content-type: text/html\n\n";
    my ($skip) =0;
    my ($dtPosition) = -1;
#    @data = ("1|a|A","2|b|B","3|c|C");
    my ($position) = 0;
    my  (@fieldRank);
    while (<$FHMain>) {
      if (/#%INSERT_DATA%#/) {
        my (@data) = libLog::getLogData($params{'SHOW'},\%fields,$params{'SORT'},$params{'FILTER'},\@fieldRank);
        foreach  (@data) {
	  my(@dtemp) = split(/\|/,$_);
	  if ($dtPosition != -1) {
	    $dtemp[$dtPosition] = localtime($dtemp[$dtPosition]);
	  }
	  print "<TR class=\"logDetailItems\">\n";
	  foreach my $item (@dtemp) {
	    print "<TD  class=\"logDetailItems\">$item</TD>";
	  }
	  print "\n</TR>\n";	  
	}
      # enter data
      next;
      }
      if ( /id=([A-Za-z]*)/  && (defined $fields{$1})&&($fieldRank[$position] = $1)  )  {
        if ($1 eq "DT") {$dtPosition = $position;}
	$position++;
      }
      
      if ( /id=([A-Za-z]*)/  &&   (! (defined $fields{$1}))   )  {      
          next;	   
	}

      s/#%([^%]*)%#/"${$1}"/e;      
      print $_;
    }
  

    last SWITCH;
  };


  # SHOW LOG
  ($params{'SHOW'} eq "5" || $params{'SHOW'} eq "6" || $params{'SHOW'} eq "7") && do {  
    print "Content-type: text/html\n\n";
    while (<$FHMain>) {
      if (/#%INSERT_DATA%#/) {
        my (@data) = libLog::getLogData($params{'SHOW'},\%fields,$params{'SORT'},$params{'FILTER'},\@fieldRank);
        foreach  (@data) {
	  my(@dtemp) = split(/\|/,$_);
	  print "<TR class=\"logDetailItems\">\n";
	  foreach my $item (@dtemp) {
	    print "<TD  class=\"logDetailItems\">$item</TD>";
	  }
	  print "\n</TR>\n";	  
	}
      # enter data
      next;
      }

      if ( /id=([A-Za-z]*)/  &&   (! (defined $fields{$1}))   )  {      
          next;	   
	}
      
      s/#%([^%]*)%#/"${$1}"/e;      
      print $_;
    }
    last SWITCH;
  };


  # SHOW ERROR
  ($params{'SHOW'} eq "6") && do {  
  my($FHMain) = libFile::openFile_ex($config::mainLogView,"RDWR");
  if ($FHMain != 3) {
    print "Content-type: text/html\n\n";
    while (<$FHMain>) {
      s/#%([^%]*)%#/"${$1}"/e;
      print $_;
    }
  
    libFile::closeFile($FHMain);
  }
  else {
      libError::logError("Error open file: $config::mainLogView",$0);
  }
    last SWITCH;
  };



  # SHOW Install
  ($params{'SHOW'} eq "7") && do {  
  my($FHMain) = libFile::openFile_ex($config::mainLogView,"RDWR");
  if ($FHMain != 3) {
    print "Content-type: text/html\n\n";
    while (<$FHMain>) {
      s/#%([^%]*)%#/"${$1}"/e;
      print $_;
    }
  
    libFile::closeFile($FHMain);
  }
  else {
      libError::logError("Error open file: $config::mainLogView",$0);
  }
    last SWITCH;
  };



  
} # SWITCH
  
  
}
#%EOF%#
#%File: ./genmenu.cgi%#
#--------------------------------------------------------------
#  ##%TL_NAME%## ##%TL_VER%##				      
#--------------------------------------------------------------
#                    DO NOT EDIT THIS FILE                    
#--------------------------------------------------------------

package genmenu;

$| = 1;

require "./libfile.cgi";
require "./lib5.cgi";
require "./libadmin.cgi";
require "./liblog.cgi";
require "./data/config.dat";

if ($ENV{'REQUEST_METHOD'} eq "GET") {
  my (%params) = lib5::getParams();
  libAdmin::substPlusWithPause(\%params);  
  libAdmin::convertHexaToChar(\%params);
  SWITCH: {
  

  ($params{'type'} eq "empty") && do {
    my($FHMain) = libFile::openFile_ex($config::mainLogDetail,"RDWR");
    if (! ($FHMain!=3)) {      libError::logError("Error open file: $config::mainLogDetail",$0);  }
    print "Content-type: text/html\n\n";
    BREAK: {    
      my ($skip) = 0;
      while (<$FHMain>) {
        if (/#%DATA_BEGIN%#/) {$skip = 1;}
        if (/#%DATA_END%#/) {$skip = 0; next;}
        if ($skip) {next;}
        print;
      }
    }    
    last SWITCH;
  };
  
  ($params{'type'} eq "main") && do {
    my ($FH) = libFile::openFile_ex($config::mainDesktopMenu,"RDWR");
    if ($FH != 3) {
      my (@option);
      print "Content-type: text/html\n\n";
      foreach (<$FH>) {
        libAdmin::parseID(\$_);  	      
        s/#%([^%]*)%#/"${$1}"/e;
	if (/%#selectCustom#%/) {
	  my ($nr,$name,$descr,%habahaba,@nabeBuff);
	  foreach (keys %var::custItems) {
	    $_ =~ /^(\d*)/;
	    $nr =$1;	    
	    $name =$var::custItems{$_};
	    $_ =~ /\(([^\)]*)/;	
	    $descr =$1;	
	    $habahaba{$name} = $descr;
	    $nabeBuff[$nr-1]=$name;
	  }
  	    push (@option,"<option value=\"0\">-- Fast Menu --</option>");
	  foreach (@nabeBuff) {
	    if (! defined) {next;}
  	    push (@option,"<option value=\"$_\">$habahaba{$_}</option>");
	  }
	 s/%#selectCustom#%/"@option"/e;
	}
        print $_;
      }
    }
    else {
    libError::logError("Error open file: $config::mainDesktopMenu",$0);
    #error
    }
  last SWITCH;
  };
  
 # menu for log view  
  ($params{'type'} eq "logmenu") && do {
    my ($FH) = libFile::openFile_ex($config::logViewMenu,"RDWR");
    if ($FH != 3) {
      print "Content-type: text/html\n\n";
      my ($skip) = 0;
      foreach (<$FH>) {
        libAdmin::parseID(\$_);  	      
        s/#%([^%]*)%#/"${$1}"/e;
	if (/FRAME_B/ || /BOTH_B/) { $skip=0; next;}
	if (/FRAG_END/ || /BOTH_E/ ) { $skip=1; next;}
	if ($skip) {next;}
        print $_;
      }
    }
    else {
      libError::logError("Error open file: $config::mainDesktopMenu",$0);
      #error
    }
  last SWITCH;
  };
  
  
  ($params{'type'} eq "logmenu_1") && do {
    my ($FH) = libFile::openFile_ex($config::logViewMenu,"RDWR");
    if ($FH != 3) {
      print "Content-type: text/html\n\n";
      my ($skip) = 0;
      foreach (<$FH>) {
        libAdmin::parseID(\$_);  	      
        s/#%([^%]*)%#/"${$1}"/e;
	if (/SUBMENU1_B/ || /BOTH_B/) { $skip=0; next;}
	if (/FRAG_END/ || /BOTH_E/ ) { $skip=1; next;}
	if ($skip) {next;}
        print $_;
      }
    }
    else {
      libError::logError("Error open file: $config::mainDesktopMenu",$0);
      #error
    }
  last SWITCH;
  };
  
  
  ($params{'type'} eq "logmenu_2") && do {
  
   SW_SUB: {
    print "Content-type: text/html\n\n";   
    my ($FH) = libFile::openFile_ex($config::logViewMenu,"RDWR");
    if ($FH != 3) {
      # satisfy this variable
      # submenu s vyberom (fields to show, sort by)
      my ($skip) = 0;
LOOP_MENU:   foreach (<$FH>) {
        libAdmin::parseID(\$_);  	
        s/#%([^%]*)%#/"${$1}"/e;
	if (/SUBMENU2_B/ || /BOTH_B/) { $skip=0; next;}
	if (/FRAG_END/ || /BOTH_E/ ) { $skip=1; next;}
	if (/NAME\s*=\s*.SHOW/) {
	SW_MENU: {
	  ($params{'subtype'} eq "inout") && do {	
	    if ( /SHOW_IPREF/ ) {next LOOP_MENU;}	  
	    # show all from menu_log_2
	  };
	  ($params{'subtype'} eq "in") && do {	
	    # show all from menu_log_2
	    if (  ( /SHOW_RANK/ || /SHOW_ACCOUT/ || /SHOW_COUNTER/)) {next LOOP_MENU;}
	    last SW_MENU;
	  };
	  ($params{'subtype'} eq "out") && do {	
	    # show all from menu_log_2
	    if (  (/SHOW_IPFROM/ || /SHOW_COUNTER/ || /SHOW_IPREF/ ||  /SHOW_COOKIE/)) {next LOOP_MENU;}
	    last SW_MENU;	    
	  };
	  ($params{'subtype'} eq "counter") && do {	
	    # show all from menu_log_2
	    if (!  (/SHOW_ACCIN/ || /SHOW_ID/ )) {next LOOP_MENU;}	    
	    last SW_MENU;	    
	  };
	  ($params{'subtype'} eq "log") && do {	
	    # show all from menu_log_2
	    next LOOP_MENU;
	    last SW_MENU;	    
	  };
	  ($params{'subtype'} eq "error") && do {	
	    # show all from menu_log_2
	    next LOOP_MENU;
	    last SW_MENU;	    
	  };
	  ($params{'subtype'} eq "install") && do {	
	    # show all from menu_log_2
	    next LOOP_MENU;
	    last SW_MENU;	    
	  };
	} # SW_MENU	
	
	} #if name="show
	if ($skip) {next;}
        print $_;
      }
    }
    else {
      libError::logError("Error open file: $config::mainDesktopMenu",$0);
      #error
    }
    last SW_SUB;

  } #3 sub_switch
  last SWITCH;  
  };

  ($params{'type'} eq "statmenu") && do {
    my ($FH) = libFile::openFile_ex($config::statViewMenu,"RDWR");
    if ($FH != 3) {
      print "Content-type: text/html\n\n";
      my ($skip) = 0;
      foreach (<$FH>) {
        libAdmin::parseID(\$_); 	      
        s/#%([^%]*)%#/"${$1}"/e;
	if (/FRAME_B/ || /BOTH_B/)   { $skip=0; next;}
	if (/FRAG_END/ || /BOTH_E/ ) { $skip=1; next;}
	if ($skip) {next;}
        print $_;
      }
    }
    else {
      libError::logError("Error open file: $config::statViewMenu",$0);
      #error
    }
  last SWITCH;
  };







  
 # menu for log view
  ($params{'type'} eq "statview") && do {
  # backrest view ct
  my($FHMain) = libFile::openFile_ex($config::mainStatView,"RDWR");
  if ($FHMain != 3) {
    print "Content-type: text/html\n\n";
    while (<$FHMain>) {
      s/#%([^%]*)%#/"${$1}"/e;
      print $_;
    }
  
    libFile::closeFile($FHMain);
  }
  else {
      libError::logError("Error open file: $config::mainStatView",$0);
  }
    last SWITCH;
  };




  ($params{'type'} eq "statmenu_1") && do {
      my ($FH) = libFile::openFile_ex($config::statViewMenu,"RDWR");
    if ($FH != 3) {
      print "Content-type: text/html\n\n";
      my ($skip) = 0;
      foreach (<$FH>) {
        libAdmin::parseID(\$_);  	      
        s/#%([^%]*)%#/"${$1}"/e;
	if (/SUBMENU1_B/ || /BOTH_B/) { $skip=0; next;}
	if (/FRAG_END/ || /BOTH_E/ ) { $skip=1; next;}
	if ($skip) {next;}
        print $_;
      }
    }
    else {
      libError::logError("Error open file: $config::statViewMenu",$0);
      #error
    }
  last SWITCH;
  };
 







  
  ($params{'type'} eq "backrestview") && do {
  # backrest view ct
  my($FHMain) = libFile::openFile_ex($config::mainBackrestView,"RDWR");
  if ($FHMain != 3) {
    print "Content-type: text/html\n\n";
    while (<$FHMain>) {
      s/#%([^%]*)%#/"${$1}"/e;
      print $_;
    }
  
    libFile::closeFile($FHMain);
  }
  else {
      libError::logError("Error open file: $config::mainBackrestView",$0);
  }
    last SWITCH;
  };

  
 # menu for log view
  ($params{'type'} eq "backrestmenu") && do {
    my ($FH) = libFile::openFile_ex($config::backrestViewMenu,"RDWR");
    if ($FH != 3) {
      print "Content-type: text/html\n\n";
      my ($skip) = 0;
      foreach (<$FH>) {
        libAdmin::parseID(\$_); 	      
        s/#%([^%]*)%#/"${$1}"/e;
	if (/FRAME_B/ || /BOTH_B/)   { $skip=0; next;}
	if (/FRAG_END/ || /BOTH_E/ ) { $skip=1; next;}
	if ($skip) {next;}
        print $_;
      }
    }
    else {
      libError::logError("Error open file: $config::backrestViewMenu",$0);
      #error
    }
  last SWITCH;
  };


  ($params{'type'} eq "backrestmenu_1") && do {
    my ($FH) = libFile::openFile_ex($config::backrestViewMenu,"RDWR");
    if ($FH != 3) {
      print "Content-type: text/html\n\n";
      my ($skip) = 0;
      foreach (<$FH>) {
        libAdmin::parseID(\$_);  	      
        s/#%([^%]*)%#/"${$1}"/e;
	if (/SUBMENU1_B/ || /BOTH_B/) { $skip=0; next;}
	if (/FRAG_END/ || /BOTH_E/ ) { $skip=1; next;}
	if ($skip) {next;}
        print $_;
      }
    }
    else {
      libError::logError("Error open file: $config::backrestViewMenu",$0);
      #error
    }
  last SWITCH;
  };
 
 
  ($params{'type'} eq "backrestmenu_2") && do {
 
   SW_SUB: {
    print "Content-type: text/html\n\n";
    my ($FH) = libFile::openFile_ex($config::backrestViewMenu,"RDWR");
    if ($FH != 3) {
      # satisfy this variable
      # submenu s vyberom (fields to show, sort by)
      my ($skip) = 0;
LOOP_MENU:   foreach (<$FH>) {
        libAdmin::parseID(\$_);
        s/#%([^%]*)%#/"${$1}"/e;
	if (/SUBMENU2_B/ || /BOTH_B/) { $skip=0; next;}
	if (/FRAG_END/ || /BOTH_E/ ) { $skip=1; next;}
	if (/NAME\s*=\s*.SHOW/) {
	SW_MENU: {
	  ($params{'subtype'} eq "backup") && do {
	    # show all from menu_log_2
	    if ( ! ( /SHOW_BACKLOG/ || /SHOW_BACKDATA/ || /SHOW_BACKTEMPL/)) {next LOOP_MENU;}
	    last SW_MENU;
	  };
	  ($params{'subtype'} eq "restore") && do {
	    # show all from menu_log_2
	    if ( ! ( /SHOW_RESTLOG/ || /SHOW_RESTDATA/ || /SHOW_RESTTEMPL/)) {next LOOP_MENU;}
	    last SW_MENU;
	  };
	  ($params{'subtype'} eq "migrate") && do {
	    # show all from menu_log_2
	    if (!  (/SHOW_PACK/ ) ) {next LOOP_MENU;}
	    last SW_MENU;
	  };
	  ($params{'subtype'} eq "import") && do {	
	    # show all from menu_log_2
	    if ( ! (/SHOW_IMPORTAR/ )) {next LOOP_MENU;}	    
	    last SW_MENU;	    
	  };

	} # SW_MENU	
	
	} #if name="show
	if ($skip) {next;}
        print $_;
      }
    }
    else {
      libError::logError("Error open file: $config::backrestViewMenu",$0);
      #error
    }
    last SW_SUB;

  } #3 sub_switch
  last SWITCH;  
  };





  } # SWITCH

}

#%EOF%#
#%File: ./genstat.cgi%#
#--------------------------------------------------------------
#  ##%TL_NAME%## ##%TL_VER%##				      
#--------------------------------------------------------------
#                    DO NOT EDIT THIS FILE                    
#--------------------------------------------------------------

package genstat;
use libgraph;

$| = 1;

require "./libfile.cgi";
require "./lib5.cgi";
require "./libadmin.cgi";
require "./libstat.cgi";
require "./liblog.cgi";
require "./data/var.dat";

my $bmp;
my $bitmap;
my $color;
my $normWidth = 550;
my $normHeight = 70;

local (@mask);
my ($lred,$red,$dred,$lblue,$blue,$dblue,$lgreen,$green,$dgreen) =
   (3    ,4   ,5    ,6     ,7    ,8     ,9      ,10    ,11    );


local (%colors) =(
    'cin' =>$red,
    'cpin' => $lred,
    'rin' => $blue,
    'pin' => $lblue,
    'out' => $green,
    'gout' => $lgreen
);

local (@sortedGraphs) = (
	'out',
	'gout',
	'rin',
	'pin',	
	'cin',	
	'cpin'
);

   
if ($ENV{'REQUEST_METHOD'} eq "GET") {
  my (%params) = lib5::getParams();
  libAdmin::substPlusWithPause(\%params);  
  libAdmin::convertHexaToChar(\%params);
  
foreach my $filter (keys %params) {
  ($filter =~ /G_OUT/) && do {$mask[0] = 1};
  ($filter =~ /G_RIN/) && do {$mask[1] = 1};
  ($filter =~ /G_PIN/) && do {$mask[2] = 1};
  ($filter =~ /G_NBRIN/) && do {$mask[3] = 1};
  ($filter =~ /G_NBPIN/) && do {$mask[4] = 1};
  ($filter =~ /G_GOUT/) && do {$mask[5] = 1};
}

genColors();

SWITCH: {  
  if ($params{'date'} eq 'hour') {
    genTotalSumHour();
    last SWITCH;
  }
  if ($params{'date'} eq 'day') {
    genTotalSumDay();
    last SWITCH;    
  }

  if ($params{'date'} eq 'month') {
    genTotalSumMonth();
    last SWITCH;    
  }
  if ($params{'date'} eq 'year') {
    genTotalSumYear();
    last SWITCH;    
  }
  if ($params{'date'} eq 'outrankstat') {
    genOutRankStat();
    last SWITCH;    
  }
  if ($params{'date'} eq 'uptimestat') {
    genUptimeStat();
    last SWITCH;    
  }

  if ($params{'date'} eq 'reg') {
    genRegStat();
    last SWITCH;    
  }

    getSample($params{'date'});

  

  
}  


$bmp = new TBmp($bitmap,$color);
}



sub genColors {
  $color = new TColor();
  $color->addColor(250,250,250);
  $color->addColor(0,0,0);
  $color->addColor(200,200,200);

#red  
  $color->addColor(255,0,0);
  $color->addColor(200,0,0);
  $color->addColor(100,0,0);  
#blue
#6F79FF
  $color->addColor(103,121,255);
  $color->addColor(0,0,200);
  $color->addColor(0,0,30);  
#green
  $color->addColor(0,255,0);
  $color->addColor(0,200,0);
  $color->addColor(0,100,0);  
}



sub getSample {
my ($type) = shift;
genColors();
my($bitmap) = new TBitmap(20,4,undef,$colors{$type});
#$bitmap->setColor($colors{$type});
#$bitmap->bar( 0,10 ,50 );
$bmp = new TBmp($bitmap,$color);
}

sub  modifyData{
my ($data) = shift;
my ($ratio) = shift;
if (defined $data) {
  $data = $ratio * $data;
  if (!$data) {$data = 1;}
  return $data;
}
else {
  return 1;
}

}

sub getMaxRatio {
my ($data) = shift;
my ($cmax) = shift;
my ($array) = shift;
my $max;
my ($ratio)=1;
my ($counter) = 0;
if ($array == 1) {
  foreach (@$data) {
    if ($_ > $max) {$max =  $_; }
  }
}
elsif ($array == 2) {
  foreach (@$data) {
    $counter = 0;
      foreach (split(/\|/,$_)) {
          if (! $mask[$counter++]){next;}
        if ($_ > $max) {$max =  $_; }
      }
  }
}
else {
foreach (values %$data) {
    $counter = 0;
    foreach (split(/\|/,$_)) {
        if (! $mask[$counter++]){next;}
      if ($_ > $max) {$max =  $_; }
    
    }
  }
}
if ($max) {$ratio  = $cmax / $max; }
return $ratio;
}


sub genTotalSumHour {
my (@dataX) = libStat::getTotalSumHour();
my ($res) = 24;
$bitmap = new TBitmap($normWidth,$normHeight);
$bitmap->drawBorder(0,1);
$bitmap->drawGrid($res,1,2,3);
$bitmap->drawGridHoriz(4,1,2,3);
my ($counter)= 0;
foreach (@dataX) {
  if (/reset/) {
    $bitmap->drawGridReset($res,1,3,$counter);
  }
  $counter++;
}

$bitmap->setSolid();

foreach (@sortedGraphs) {
  $bitmap->setColor($colors{$_});
  drawGraphFromData($bitmap,\@dataX,$var::statTotal{$_},$res,1,2,0);
}
}



sub genTotalSumDay {
my (@dataX) = libStat::getTotalSumDay();
$res = 31;
$bitmap = new TBitmap($normWidth,$normHeight);
$bitmap->drawBorder(0,1);
$bitmap->drawGrid($res,1,2,3);
$bitmap->drawGridHoriz(4,1,2,3);

$bitmap->setSolid();

foreach (@sortedGraphs) {
  $bitmap->setColor($colors{$_});
  drawGraphFromData($bitmap,\@dataX,$var::statTotal{$_},$res,1,2);
}

}


sub genTotalSumMonth {

my (@dataX) = libStat::getTotalSumMonth();

$res = 12;
$bitmap = new TBitmap($normWidth,$normHeight);
$bitmap->drawBorder(0,1);
$bitmap->drawGrid($res,1,2,3);
$bitmap->drawGridHoriz(4,1,2,3);

$bitmap->setSolid();

foreach (@sortedGraphs) {
  $bitmap->setColor($colors{"$_"});
  drawGraphFromData($bitmap,\@dataX,$var::statTotal{"$_"},$res,1,2);
}
}





sub genTotalSumYear {
my (@dataX) = libStat::getTotalSumYear();
$res = 12;
$bitmap = new TBitmap($normWidth,$normHeight);
$bitmap->drawBorder(0,1);
my ($barWidth) = $bitmap->getWidth() / (2*$res);
#$bitmap->drawGrid($res,1,2,3);
$bitmap->drawGridHoriz(4,1,2,3);

$bitmap->setSolid();
my ($degrader) = 1;my($counter) = 0;
foreach (@sortedGraphs) {
  if (++$counter == 3){
    $degrader = 2/3;
  }elsif ($counter == 5){
    $degrader = 2/5;  
    }

  $bitmap->setColor($colors{$_});
  drawGraphFromData_Bar($bitmap,\@dataX,$var::statTotal{$_},$res,1,2,$barWidth*$degrader);
}

}
sub genOutRankStat {
my (@dataX) = libStat::getOutRankStat();
$res = libGenList::getTotalAccs();
$bitmap = new TBitmap($normWidth,$normHeight);
$bitmap->drawBorder(0,1);
$res = $var::listLimit;
$bitmap->drawGrid($res,1,2,3);
$bitmap->drawGridHoriz(4,1,2,3);
$bitmap->setSolid();
$bitmap->setColor($lred);
drawGraphFromData($bitmap,\@dataX,undef,$res*3,1,1);
}

sub genRegStat {
my (@dataX) = libStat::getRegStat();
$res = 31;
$bitmap = new TBitmap($normWidth,$normHeight);
$bitmap->drawBorder(0,1);
$bitmap->drawGrid($res,1,2,3);
$bitmap->drawGridHoriz(4,1,2,3);
#$bitmap->setDot(1);
$bitmap->setSolid();

my ($barWidth) = $bitmap->getWidth() / (2*$res);
my ($degrader) = 1;

$bitmap->setColor($lred);
drawGraphFromData_Bar($bitmap,\@dataX,undef,$res,1,1,$barWidth*$degrader);
#drawGraphFromData($bitmap,\@dataX,undef,$res,1,1);
}

sub genUptimeStat {
my (@dataX) = libStat::getUptimeStat();
$res = 24;
$bitmap = new TBitmap($normWidth,$normHeight);
$bitmap->drawBorder(0,1);
$bitmap->drawGrid($res,1,2,3);
$bitmap->drawGridHoriz(4,1,2,3);
#$bitmap->setDot(1);
$bitmap->setSolid();

$bitmap->setColor($lred);

my ($barWidth) = $bitmap->getWidth() / (1.3*$res);
my ($degrader) = 1;

#drawGraphFromData_Bar($bitmap,\@dataX,undef,$res,1,1,$barWidth*$degrader);
drawGraphFromData($bitmap,\@dataX,undef,$res,1,1,1);
}





    
#---------------------
# params:  rBITMAP,rDATA,field,res ex.(24 or 31 ...),lineType
#
#

sub drawGraphFromData {
my ($bitmap) = shift;
my ($data) = shift;
my ($field) = shift;
my ($res) = shift;
my ($off) = shift;
# array = 1; else hash
my ($array) = shift;
# if graph is continuous . Begin has the same val as end
my ($cont) = shift;

my ($ratio) = getMaxRatio($data,$bitmap->getHeight()-$off*2,$array);
my ($cc) = 0;
my ($xx) = 0;
my $y;
my ($step) = ($bitmap->getWidth()-2*$off)/ $res;
my (@data);
if ( (! $mask[$field])&& (defined $field) ) {return;}

if ($array == 1) {
  $y = modifyData($$data[0],$ratio);
  $bitmap->moveto(1+$off,int($y)+$off);
  while ($cc++ < $res) {
    $y = modifyData($$data[(($cc==$res)&&$cont)?0:$cc],$ratio);  
#    $y = modifyData($$data[$cc],$ratio);  
    $xx += $step;
    $bitmap->lineto($off+int($xx),int($y)+$off);  
  }}
  
elsif ($array == 2)  {

  @data = split(/\|/,$$data[$cc] );
  $y = modifyData($data[$field],$ratio);
  $bitmap->moveto(1+$off,int($y)+$off);
  while ($cc++ < $res) {
#   
@data = split(/\|/ ,$$data[$cc]);
    @data = split(/\|/ ,$$data[(($cc==$res)&&$cont)?0:$cc]);
    $y = modifyData($data[$field],$ratio);
    $xx += $step;
    $bitmap->lineto($off+int($xx),int($y)+$off);
  }


}
else {
  @data = split(/\|/,$$data{$cc});
  $y = modifyData($data[$field],$ratio);
  $bitmap->moveto(1+$off,int($y)+$off);
  while ($cc++ < $res) {
    @data = split(/\|/ ,$$data{$cc});
#    @data = split(/\|/ ,$$data{($cc==$res)?0:$cc});    
    $y = modifyData($data[$field],$ratio);
    $xx += $step;
    $bitmap->lineto($off+int($xx),int($y)+$off);
  }
}
}



sub drawGraphFromData_Bar {
my ($bitmap) = shift;
my ($data) = shift;
my ($field) = shift;
my ($res) = shift;
my ($off) = shift;
# array = 1; else hash
my ($array) = shift;
my ($barWidth) = shift;
my ($ratio) = getMaxRatio($data,$bitmap->getHeight()-$off*2,$array);
my ($cc) = 0;
my ($xx) = 0;
my $y;
my ($step) = ($bitmap->getWidth()-2*$off)/ $res;
my (@data);

if ( (! $mask[$field])&& (defined $field) ) {return;}

if ($array == 1) {
  $y = modifyData($$data[0],$ratio);
  $bitmap->bar(1+$off,int($y),$barWidth  );
  while ($cc++ < $res) {
    $y = modifyData($$data[$cc],$ratio);  
    $xx += $step;
    $bitmap->bar( $off+int($xx),int($y) ,$barWidth );
  }}
  
elsif ($array == 2)  {
  @data = split(/\|/,$$data[$cc] );
  $y = modifyData($data[$field],$ratio);
  $bitmap->bar(1+$off,int($y),$barWidth  );
  while ($cc++ < $res) {
    @data = split(/\|/ ,$$data[$cc]);
    $y = modifyData($data[$field],$ratio);
    $xx += $step;
    $bitmap->bar( $off+int($xx),int($y) ,$barWidth );
  }


}
else {
  @data = split(/\|/,$$data{$cc});
  $y = modifyData($data[$field],$ratio);
  $bitmap->moveto(1+$off,int($y)+$off);
  while ($cc++ < $res) {
    @data = split(/\|/ ,$$data{$cc});
    $y = modifyData($data[$field],$ratio);
    $xx += $step;
    $bitmap->lineto($off+int($xx),int($y)+$off);
  }
}
}





#%EOF%#
#%File: ./help.cgi%#
#--------------------------------------------------------------
#  ##%TL_NAME%## ##%TL_VER%##				      
#--------------------------------------------------------------
#                    DO NOT EDIT THIS FILE                    
#--------------------------------------------------------------

package help;
require "./data/config.dat";
require "./libfile.cgi";
require "./lib5.cgi";
require "./liblog.cgi";




if ($ENV{'REQUEST_METHOD'} eq "GET") {
  my (%params) = lib5::getParams();
  if (($params{'topic'}eq "") ||( $params{'item'} eq"") ) { notFound(); }
  my ($topic) = "topic=$params{'topic'}";
  my ($item) = "item=$params{'item'}";
  my $FH;
  $endtopic="endtopic";
  $enditem="enditem";
  my ($helpFound) = 0;
  @data=();
  my ($status) = 0;
  my ($usedLink) =0;
  $FH = libFile::openFile_ex($config::helpFile,"RDWR");
    if ($FH != 3) {
    foreach (<$FH>) {
      if (/$endtopic/) { $status = 0;next;}
      if (/$enditem/) {if ($status==2) {$helpFound=1;printItem(\@data);exit 0; } if ($status) {$status = 1;}next;}
      if (/$topic/) {/label=(.*)/;$topicx=$1;$status = 1;next;}
      if (/$item/ && ($status == 1) ) { /label=(.*)/;$itemx =$1;$status = 2;next;}
      if ($status == 2) {
        if (s|href=\"([^,]*)\,([^\"]*)\"|"href=\"$config::tlurl\/help.cgi?topic=$1\&item=$2\""|gise) {$usedLink = 1;}
        push(@data,$_);
      }
    }
    if (!$helpFound) { notFound(\%params); }
 }
}

sub printItem {
my ($data) = shift;
if (scalar @$data) {
  # prints help
  my ($datax) = join("<BR>\n",@$data);
  print "Content-type: text/html\n\n";
  print <<END;

<html>
<head>
<title>Help Window</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link rel="stylesheet" href="$config::url_html/main.css" type="text/css">
<script src="$config::url_html/main.js"></script>
</head>
<body onLoad="javascript:autosize();">
<form>
<table border="0" padding="0" cellspacing="0" width ="100%">
<tr>
<td align = "right"colspan ="2"><input class="inputValue"   type="submit" value="Close" onClick="javascript:window.close()" size="20"> </td>
</tr>
<tr>
<td>Topic</td><td class="helpTopic">$topicx</td>
</tr>
<tr>
<td>Item</td><td class="helpItem">$itemx</td>
</tr>
<tr>
<td></td><td class="helpText">$datax</td>
</tr>

<tr>
<td align = "center"colspan ="2"><br><br><input class="inputValue"  type="submit" value="Close" onClick="javascript:window.close()" size="20"> </td>
</tr>
</table>
</form>
</body>
</html>

END

  
}
}

#'
sub notFound {
my ($params) = shift;
  print "Content-type: text/html\n\n";
  print <<END1;

<html>
<head>

<title>Help Window</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link rel="stylesheet" href="/main.css" type="text/css">
</head>
	Specified help content doesn\'t exist !!<br>
        Topis: $$params{'topic'} <br>
	Item: $$params{'item'}
<body>
</body>
</html>

END1



}
#%EOF%#
#%File: ./in.cgi%#
#--------------------------------------------------------------
#  ##%TL_NAME%## ##%TL_VER%##				      
#--------------------------------------------------------------
#                    DO NOT EDIT THIS FILE                    
#--------------------------------------------------------------

package input;
$| = 1;
#use strict;
# error is running from shell
if ($ENV{'REQUEST_METHOD'} ne "") {
#$server_protokol = $ENV{'SERVER_PROTOCOL'};
#print "$server_protokol 200 OK\n";
require "./lib5.cgi";
require "./libfile.cgi";
$lib5::header_posted = 0;
lib5::error_message($config::lang,1001) if($@);
%params = lib5::getParams();
my ($key) = lib5::genKey();
$key = "$key$$";
if(!($ENV{'HTTP_COOKIE'} =~ /STATUS=STOP/)) {
  # NOT STOPPED
  # don't overwrite already set cookie
  lib5::genTopList (\%params,$key,0);
  lib5::add_in_hit(\%params,$key,0);
}
else {
  # STOPPED
  lib5::genTopList (\%params,$key,1);
  lib5::add_in_hit(\%params,$key,1);
}
exit 0;
}
#%EOF%#
#%File: ./index.cgi%#
#--------------------------------------------------------------
#  ##%TL_NAME%## ##%TL_VER%##				      
#--------------------------------------------------------------
#                    DO NOT EDIT THIS FILE                    
#--------------------------------------------------------------

package main;
use vars;
#use strict;

#------------------------- Initialization ----------------------------------




# error is running from shell
if ($ENV{'REQUEST_METHOD'} eq "") {
#  &error_codes::error_message($config::lang,1001);
}





# like try {...} catch(..){...} in C++
eval {
require "./lib5.cgi";
require "./liblog.cgi";
require "./data/config.dat";

$lib5::header_posted = 0;

};

lib5::error_message($config::lang,1001) if($@);

#---------------------------- Get params

%params = lib5::getParams();

#---------------------------- Check params
local *FILE;
print "Content-type: text/html\n\n";
if (open(FILE,"< $config::document_root/$config::index{$params{index}}->[0]")) {
  while (<FILE>) {
     s/$var::toplistparams/id=$params{'id'}/g;
     print "$_\n";
  }
}
else {}
#%EOF%#
#%File: ./info.cgi%#

use Fcntl ':flock';
require "./lib5.cgi";

print "Content-type: text/html\n\n";

if (lib5::openfile(">> $config::log_in_file")) {
print "xccccccccccc";
#opens file
  my ($now);
  $now=localtime();
  $$par{'acc'} = "msio";
  print lib5::FILEx (lib5::genKey(), ".$$par{'$var::acc'}.  $now  $ENV{'REMOTE_HOST'}   $ENV{'REMOTE_ADDR'}  $ENV{'HTTP_REFERER'}\n");
#  print $now;
  lib5::closefile();
}#%EOF%#
#%File: ./lib5.cgi%#
#--------------------------------------------------------------
#  ##%TL_NAME%## ##%TL_VER%##				      
#--------------------------------------------------------------
#                    DO NOT EDIT THIS FILE                    
#--------------------------------------------------------------


# -------------------------- functions for SCRIPT -------------------------
#
#prototypes :
# opendbmfile(reference to hash, file name)
# closedbmfile(hash)
# error_message(language, error code)
# (weblink) add_out_hit(account name)
# add_in_hit(account name)
# (bool) exist_account(account name)
# list_account()
# add_account (referecne to hash with parameters)
# (hash of params) getParams ()
# parsehtml (html file name, hash with dialog titles)
#
# -------------------------------------------------------------------------

package lib5;

# like static in C 
$lib5::header_posted  = 0;
BEGIN {
# nefunguje -> po 5 refreshi browsera sa hodniota nerefresuje
$lib5::header_posted = 0;
}


use strict;
use vars;
use GDBM_File;
use Fcntl;
1;


require "./data/errors.dat";
require "./liblog.cgi";
require "./libfile.cgi";
require "./data/config.dat";
require "./data/var.dat";
require "./data/infos.dat";

$|=1;


sub closefile {
# Closes the file FILEx
close(FILEx);
}

sub printHeader {
# Print if it is first time
if ($lib5::header_posted == 0) {
  print "Content-type: text/html\n\n";
  $lib5::header_posted=1;
}
}

sub printForward {
my ($par) = shift;
print "Location: $par\n\n";
}


sub openfile {
#  Opens the file $file_name
my ($file_name) = shift;
my $counter;
open(FILEx,"$file_name");
$counter = 0;

#WAITx:
#  {
#    while (!flock(FILEx,LOCK_EX | LOCK_NB)) {
#      $counter++;
#      print "ccc\n";
#      if (++$counter eq 10) {lib5::info_message(1,$infos::info{$config::lang}{'FILE_LOCKED'});}
#      sleep 1;
#      last WAITx if ($counter > $var::delay);
#    }
#    my ($xxx) = <FILEx>;
#    print "TEXT:$xxx\n";

    return 1;
#  }
#return 0;
}




sub error_message {
# error_message(language,error_code)

 my ($lang,$code) = @_;
 printHeader();
 $var::dialog{'WINDOW_TEXT'} = "Error Nr. $code";
 $var::dialog{'TITLE_TEXT'} = $error_codes::error{$config::lang}{$code};
 $var::dialog{'BODY_TEXT'} = "<BR>".$infos::error_correct{$config::lang}."<BR>";
 parsehtml($config::htmlErrorMsgTmpl,\%var::dialog);
 exit -1;
}


sub error_message_param {
# error_message(language,error_code)

 my ($lang,$code,$param) = @_;
 
 printHeader();
 
 $var::dialog{'WINDOW_TEXT'} = "Error Nr. $code";
 $var::dialog{'TITLE_TEXT'} = $error_codes::error{$config::lang}{$code};
 $var::dialog{'BODY_TEXT'} = "<BR> <BR> <H1>". $param . "\n </H1> <BR> " . $infos::error_correct{$config::lang} . "";
 parsehtml($config::htmlErrorMsgTmpl,\%var::dialog);
 exit -1;
}


sub statRankOut {
 my ($rank) = shift;
 if ($rank) {
   my ($FH) = (-e $config::outRankStat )? libFile::openFile_ex($config::outRankStat,"RDWR") : libFile::openFile_ex($config::outRankStat,"RDWR|CREAT");
   my (@data) = split(/\|/,<$FH>);
   libFile::closeFile($FH);   
   $data[$rank-1]++;
   my ($FH) = libFile::openFile_ex($config::outRankStat,"RDWR|CREAT");
   print $FH join("|",@data);
   libFile::closeFile($FH);
 }
}




sub info_message {
# error_message(0,info_title,info_body)
# error_message(1,erference to HASH{TITLE/BODY})
 printHeader();
 my ($type) = shift;
 if (!$type) {
   my ($title,$body);
   $title= shift; $body = shift;
   $var::dialog{'WINDOW_TEXT'} = "Information Message";
   $var::dialog{'TITLE_TEXT'} = $title;
   $var::dialog{'BODY_TEXT'} = $body;
 }
 elsif ($type == 1){
   my ($title_body) = shift;
   $var::dialog{'WINDOW_TEXT'} = "Information Message";
   $var::dialog{'TITLE_TEXT'} = $title_body->{'TITLE'};
   $var::dialog{'BODY_TEXT'} = $title_body->{'BODY'};;
   
 }  
 
 elsif ($type == 2){
   my ($title_body) = shift;
   my ($sparam) = shift;
   my ($params) = shift;
   $var::dialog{'WINDOW_TEXT'} = "Information Message";
   $var::dialog{'TITLE_TEXT'} = $title_body->{$config::lang}{'TITLE'};
   $var::dialog{'BODY_TEXT'} = $title_body->{$config::lang}{'BODY'};;
   for (my $i = 1;$i <= scalar keys %$sparam;$i++) {
     $var::dialog{'BODY_TEXT'} =~ s/#%($i)/$sparam->{$1}/gise;
   }
 }  
 
 parsehtml($config::htmlInfoMsgTmpl,\%var::dialog);
 exit -1;
}

sub get_acc_url {
my ($par) = shift;
my ($type) = shift;
my ($ret,%hash,@data);

  if (libFile::openDBM(\%hash,$config::account_database,0)) {
    @data=split(/\|/,$hash{$par});
#    $data[$var::record{'out'}]++;
#    $hash{$par} = join("|",$data[0],$data[1],$data[2],$data[3],$data[4],$data[5],$data[6]);
    $ret = $data[(($type == 1)?$var::record{'web2link'}:$var::record{'weblink'})];
    $ret =~ s|http://||;
    libFile::closeDBM(\%hash);
  }
  else {
    lib5::error_message($config::lang,1006);
  }
return $ret;
}

sub add_out_hit {
my ($par) = shift;
my ($FH) = libFile::openFile_ex($config::log_out_file,"RDWR|APPEND|CREAT");
if ($FH != 3) {
  my ($now);
  $now=time();
  $$par{$var::id} =~ /([^_]*)_(.*)/;
  print $FH "$1|$$par{$var::acc}|$2|$now|$$par{'rank'}\n";
  libFile::closeFile($FH);
}  
else {
  lib5::error_message($config::lang,1007);
  return 0;
}
return 1;


}

sub genKey() {
# returns size of file 
return (stat($config::log_in_file))[7];
}


sub add_in_hit {
my ($par) = shift;
my ($key) =shift;
my ($stopped) = shift;
my ($xer,%hash,@data,$x1,$x3,$x2);
my ($FH);
if ( ($FH = libFile::openFile_ex($config::log_in_file,"RDWR|CREAT|APPEND")) != 3) {
#opens file
  my ($now);
  $now=time();
  print $FH (($stopped)?"X|":"|",$key, "|$$par{$var::acc}|$now|$ENV{'REMOTE_HOST'}|$ENV{'REMOTE_ADDR'}|$ENV{'HTTP_REFERER'}\n");
#  print $now;
  libFile::closeFile($FH);
}  
else {
  lib5::error_message($config::lang,1007);
  return 0;
}
return 1;
}

sub exist_account {
my ($par) = shift;
my ($ret) = 0;
my (%hash,@key,$xx);
eval {

  if (libFile::openDBM(\%hash,$config::account_database,0)) {
    @key = keys(%hash);
    foreach (@key) {
      if (/^$par$/) {
      $ret = 1;
      }  
    }
  libFile::closeDBM(\%hash);
  }    
};
return $ret;
}




sub list_account {
my %hash;
my ($acc,$data);
eval {

 libFile::openDBM(\%hash,$config::account_database,0);

 $var::dialog{'HTML_TITLE'} = "Account List";
 $var::dialog{'LIST_TEXT'} = "Accoutn List";
  
  foreach my $key (keys(%hash)){
#    ($acc,$data)   = split (/=/,$acc);
     print "Account: $key  Data:$hash{$key} <BR>";
     $var::dialog{'DATA'}{$key} = $hash{$key};
  }
  
  libFile::closeDBM(\%hash);
  
 $var::dialog{'SITE_ADMIN'} = "No Admin";
# parsehtml_("./temps/_list.htmlx",\%var::dialog);

};
if ($@) {
  lib5::error_message($var::lang,1001);
}

}



sub add_account {
# assumed params:
# ...cgi?acc=login&pwd=password&webhost=web_page&webtitle&link_description
#   
#
my ($params) = shift;
my %hash = {};

if (!exist_account($params->{$var::acc})) {
# checks parameters
 if ( (($params->{$var::pwd} eq "") || (!defined($params->{$var::pwd})))
 || (($params->{$var::weblink} eq "") || (!defined($params->{$var::weblink})))
 || (($params->{$var::webtitle} eq "") || (!defined($params->{$var::webtitle}))) ) {
 
   lib5::error_message($var::lang,1030);
 }
 else { 
   eval {
     libFile::openDBM(\%hash,$config::account_database,1);
     # stores in hash key=account name, value= pwd|weblink|webtitle										 ENA,HIT_IN_COUNTER,HIT_OUT_COUNTER,RATING
     $hash{$params->{$var::acc}} = join("|",$params->{$var::pwd},$params->{$var::weblink},$params->{$var::webtitle},1,0,0,0);
     libFile::closeDBM(\%hash);
   };
   if ($@) {
     lib5::error_message($var::lang,1005);
   } 
   # create account file
   open(FILE,">./accounts/$params->{'acc'}.acc");
#  print FILE "0";
   close(FILE);
   }
 }
else {
  lib5::error_message($config::lang,1020);
}  
  
}



sub getParams {
my (@params,%params,$pair,$x,$y);
if ($ENV{'REQUEST_METHOD'} eq "GET") {
  @params = split(/&/,$ENV{"QUERY_STRING"});
  foreach $pair (@params) {
    my ($x,$y) = split(/=/,$pair);
    # if returned from multiline select
      $params{$x} = $y; 
      #parameters from line in HASH %params

  }
  
}
return %params;
}


sub parsehtml {
  my($html,$dialog) = @_;
  my $htmlx;
  open(HTML,$html);
  foreach $htmlx (<HTML>) {
    $htmlx =~ s/#%(.*?)%#/$dialog->{$1}/gise;
    print "$htmlx\n";
  }
  close(HTML);
}


sub genTopList {
# from Template document + trafic data
# temporary -> just forward to another location
# toplist files will be generated by CRON every xxx min.

my ($params)  = shift; # ref.to hash
my ($key)   = shift;   #key id
my ($cookies)   = shift;   #0-cookies NOT SET
my $time;
my (@wday,@time);
print "Content-type: text/html\n";

 if ( open(HTML,$config::html_toplist) ) {
   if ($var::cookiesUse && !$cookies) {
     my ($time);
     $time = gmtime(time+$var::cookiesExp);
#     my ($xtime) = time()+$var::cookiesExp;
#     @wday = ('Sun','Mon','Tue','Wed','Thu','Fri','Sat');
#     my (@month) = ('Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec');
#     $time[5] += 1900;
#     $time[4]  =$month[$time[4]+1];
#     $time = "$wday[$time[6]], $time[3]-$time[4]-$time[5] $time[2]:$time[1]:$time[0] GMT";
#    Wdy, DD-Mon-YY HH:MM:SS GMT
     print "Set-cookie: STATUS=STOP; expires= $time\n";     
   }
   print "\n";

   foreach (<HTML>) {
     # Substitues #%params%# with id and acc
     s/$var::toplistparams/"id=$key\_$$params{'acc'}"/ge;
     print;
   }    

 #  while (<HTML3>) {   print;  } # prints footer
  
}


}
#%EOF%#
#%File: ./libaccount.cgi%#
#--------------------------------------------------------------
#  ##%TL_NAME%## ##%TL_VER%##				      
#--------------------------------------------------------------
#                    DO NOT EDIT THIS FILE                    
#--------------------------------------------------------------

package libAccount;
require "./libfile.cgi";
require "./liblog.cgi";
require "./libadmin.cgi";
require "./data/var.dat";
require "./data/config.dat";


use vars;


BEGIN {
my $FH;
$SIG{'__WARN__'} = sub {
  if (! -e 'error.txt') {
     umask 0;
    open($FH,"> ./logs/error.txt");
  } else { open($FH,">> ./logs/error.txt");}
  if (  (stat($FH))[7] > 1000000 ) {close($FH);    open($FH,"> ./logs/error.txt");}
  print $FH (@_);
};
}


sub getNewCount {
my (%hash);
my ($counter) = 0;
my ($key,$value);
libFile::openDBM(\%hash,$config::account_database,0);
while ((undef,$value)  = each %hash) {
  if ((split(/\|/,$value))[$var::record{'new'}] ) {$counter++;}
}
libFile::closeDBM(\%hash);
return $counter;

}

sub getInactCount {
my ($hash) = shift;
my ($counter) = 0;
my ($key,$value);
while ((undef,$value)  = each %$hash) {
  if ((split(/\|/,$value))[$var::record{'activity'}] < 0 ) {$counter++;}
}
return $counter;
}

# ----------------------------------------------------------
# Deletes record from account database
#
#		 Data in $Data
#		 Type of update : if $Type = 1 ADD
#				  if $Type = 0 Replace
# ----------------------------------------------------------

sub deleteAcc {
my ($acc) = shift;
my %hash;
my %stat;
my %lost;
my ($counter) = 0;
my @body;
my ($FH);
libFile::openDBM(\%hash,$config::account_database,1);
if ($var::mailAfterDelete) {
  if($config::reportDeleteType){
     $FH = libFile::openTempl($config::reportAccDeleteHtml,0);  
  }
  else {
     $FH = libFile::openTempl($config::reportAccDeleteText,0);    
  }
if ($FH != 3) {
  while (<$FH>) {
    s/#%ACC_NAME%#/$acc/e;
    push(@body,$_);
  }
  if (libAdmin::sendMailEx($config::reportDeleteType,
                           $var::email,
			   getAccDataEx($acc,$var::record{'mail'},\%hash),
			   $var::emailReportSubject{'deleted'},
			   \@body
			   ))    {
			   
  }
}
}

libFile::openDBM(\%lost,$config::lostAccs,1);
libFile::openDBM(\%stat,$config::stat_database,1);
 delete $stat{$acc};
libFile::closeDBM(\%stat);
while (defined $$lost{$acc}) {
$acc .= $counter++;
}
$lost{$acc} = (getAccData($acc))[$var::record{'mail'}];
libFile::closeDBM(\%lost);

if (exists $hash{$acc}) {
  delete $hash{$acc};
}
else {
  libFile::closeDBM(\%hash);
  return 0;
}

libFile::closeDBM(\%hash);
return 1;
}



# ----------------------------------------------------------
# Deletes record from account database
#
#		 Data in $Data
#		 Type of update : if $Type = 1 ADD
#				  if $Type = 0 Replace
# ----------------------------------------------------------

sub deleteAccEx {
my ($acc) = shift;
my ($hash) = shift;
my %lost;
my %stat;
my ($counter) = 0;

libFile::openDBM(\%stat,$config::stat_database,1);
delete $stat{$acc};
libFile::closeDBM(\%stat);



libFile::openDBM(\%lost,$config::lostAccs,1);
while (defined $$lost{$acc}) {
$acc .= $counter++;
}
$$lost{$acc} = (getAccData($acc))[$var::record{'mail'}];
libFile::closeDBM(\%lost);
delete $$hash{$acc};
}

# ----------------------------------------------------------
# Adds record = ACCOUINT
#
#		 Data in $Data
#		 Type of update : if $Type = 1 ADD
#				  if $Type = 0 Replace
# ----------------------------------------------------------


sub addRecord {
my ($param) = shift;
my %hash;
if (isAccount( $$param{$var::form{'setup_form'}{'acc'}} )) {
  return 0;
}
else {
 if (libFile::openDBM(\%hash,$config::account_database,1)) {
   my ($values) = join("|",$$param{$var::form{'setup_form'}{$var::pwd}},
                           $$param{$var::form{'setup_form'}{$var::weblink}},
                           $$param{$var::form{'setup_form'}{$var::title}},
                           $var::accNew,   #new
			   $var::inForNewAcc,	#in
			   $var::outForNewAcc,	#out
			   0,
                           $$param{$var::form{'setup_form'}{$var::banner} },
                           $$param{$var::form{'setup_form'}{$var::mail} },
			   $$param{$var::form{'setup_form'}{$var::descr}},
			   time(),  # join date
			   0,       # inactivity in resets
			   $var::autoSuspendNewAcc,	    # suspend
			   0,       # freeze
			   0,       # lock
			   $$param{$var::form{'setup_form'}{$var::sample} },       #sample
			   $$param{$var::form{'setup_form'}{$var::bannerw} },		   
			   $$param{$var::form{'setup_form'}{$var::bannerh} },
			   $$param{$var::form{'setup_form'}{$var::samplew} },
			   $$param{$var::form{'setup_form'}{$var::sampleh} },
			   $var::defaultHitRatio,  #ratio
                           $$param{$var::form{'setup_form'}{$var::web2link} },
                           $$param{$var::form{'setup_form'}{$var::info} },
			   undef,	# last rank
			   0		#import sign
			   );

   $hash{$$param{$var::form{'setup_form'}{$var::acc}}} = $values;
   libFile::closeDBM(\%hash);
  
   libFile::openDBM(\%hash,$config::account_database,1);
   libFile::closeDBM(\%hash);   
   
   libFile::openDBM(\%hash,$config::account_database,1);
   libFile::closeDBM(\%hash);
   
      return 1;
}  #openDBM

 } # is Acc
       return 0;
}

# ----------------------------------------------------------
# Imports record form ar form
# type: 0 detail add
#	1 stat add 
# acc:  account
# val	value line in form xxx|ccc|rrr|    
# ----------------------------------------------------------

sub importRecord {
my ($type) = shift;
my ($acc) = shift;
my ($values) = shift;
my %hash;
 if (libFile::openDBM(\%hash,$config::account_database,1)) {
   if ((defined $hash{$acc}) && 
       (! (split(/\|/,$hash{$acc}))[$var::record{'importSign'}]  )  ) {
      libFile::closeDBM(\%hash);
      return 0;
   }
   my($sign) = (split(/\|/,$hash{$acc}))[$var::record{'importSign'}];
   my (@originData) = split(/\|/,$hash{$acc});
   my (@data) = split(/\|/,$values);
   my $pwd = unpack('u', $data[19]);
   if (!$type) {
     @originData = ($pwd,$data[$var::record{'ar_weblink'}],
       $data[$var::record{'ar_title'}],0,$originData[4],$originData[5],0,
       undef,$data[$var::record{'ar_mail'}],
       $data[$var::record{'ar_descr'}],$data[$var::record{'ar_joindate'}],
       $data[$var::record{'ar_inact'}],$data[$var::record{'ar_suspend'}],0,
       $data[$var::record{'ar_lock'}],"http://",$data[$var::record{'ar_wbanner'}],
       $data[$var::record{'ar_hbanner'}],undef,undef,
       $data[$var::record{'ar_ratio'}],"http://",undef,undef,0
     );
     $originData[$var::record{'importSign'}] = ((!$sign)?1:0);
     $originData[$var::record{'banner'}] = ($data[$var::record{'ar_banner'}] eq "")?"http://":$data[$var::record{'ar_banner'}];
   }
   else {
     if (libFile::openDBM(\%stat,$config::stat_database,1)) {
       my (@stat) = split(/\|/,$stat{$acc});
       $stat[$var::stat{'t_rin'}] = $data[2];
       $stat[$var::stat{'t_rout'}] = $data[3];
       $stat[$var::stat{'t_pin'}] = $data[2];       
       $stat[$var::stat{'gen_out'}] = $data[3];
       $stat[$var::stat{'nobotfilter_in'}] = $data[2];       
       $stat{$acc} = join("|",@stat);       
       libFile::closeDBM(\%stat);     
     }
     $originData[$var::record{'in'}] = $data[0]; 
     $originData[$var::record{'out'}] = $data[1];    
     $originData[$var::record{'importSign'}] = ((!$sign)?1:0);    
   }
   $hash{$acc} = join("|",@originData);
   libFile::closeDBM(\%hash);
#   libFile::openDBM(\%hash,$config::account_database,1);
#   libFile::closeDBM(\%hash);   
      return 1;
}  #openDBM
      return 0;
}
# ----------------------------------------------------------
# Update record - one ROW except PWD
#
#		 Data in $Data
#		 Type of update : if $Type = 1 ADD
#				  if $Type = 0 Replace
# ----------------------------------------------------------


sub updateRecord {
my ($param) = shift;
my ($atribut) = shift;
my @res;
my %hash;
my $values;
 if (libFile::openDBM(\%hash,$config::account_database,1)) {
	
#   @res = split(/\|/,$hash{$$param{$var::html_setup_hidden_acc}});
   @res = split(/\|/,$hash{ $$param{ $var::form{'setup_form'}{$var::acc}    }});
     foreach my $field (keys %var::record) {
     if (defined $$param{$var::form{'setup_form'}{$field}}) {
       $res[$var::record{$field}] = $$param{$var::form{'setup_form'}{$field}};
     }    
   }

   my (%hwTemp)= (  $var::samplew => $var::maxSampleWidth, 
		    $var::sampleh => $var::maxSampleHeight, 
		    $var::bannerw => $var::maxBannerWidth, 
		    $var::bannerh => $var::maxBannerHeight

   );
   if ( $var::autoSuspendModifAcc) {$res[$var::record{$var::suspend}] = 1;}
   foreach ($var::samplew,$var::sampleh,$var::bannerw,$var::bannerh) {
     if ($res[$var::record{$_}] == "") {$res[$var::record{$_}] = $hwTemp{$_};}
   }
   
   if ($atribut == 2) {$res[$var::record{$var::new}] |= $var::accModified;}
   $values = join("|",@res);
   $hash{$$param{   $var::form{'setup_form'}{$var::acc}   }} = $values;
   libFile::closeDBM(\%hash);
 }
}





# ----------------------------------------------------------
# Updates record identified by ID (account name) 
#                Field number $Field
#		 Data in $Data
#		 Type of update : if $Type = 1 ADD
#				  if $Type = 0 Replace
# ----------------------------------------------------------


sub updateRec {
my ($Id) = shift;
my ($Field) = shift;
my ($Data) = shift;
my ($Type) = shift;  #0 - overwrite, 1- add
my %hash;
 if (libFile::openDBM(\%hash,$config::account_database,1)) {
   if (defined (my $Record= $hash{$Id})) {
     my (@Record) = split(/\|/,$Record);
     # All field from record that match to $Id
     if ($Type) {$Record[$Field] +=$Data;} else {$Record[$Field] =$Data;}
     $Record = join("|",@Record);
     $hash{$Id} = $Record;
   } 
 libFile::closeDBM(\%hash);
 }
 return 0;
}



# ----------------------------------------------------------
#
# Puts ALL OutHits to ALL accounts
# Input ref. to hash ........ hash{'accout'}  = out hits to add
# Output ---
#
# ----------------------------------------------------------

sub putOutHitToAccount {
 my ($OutAcc) = shift;
 # Hash with params  -- values of Hit Out to ADD 
      # One Record
 if (!isFreezed($OutAcc)) {
   updateRec($OutAcc,$var::record{'out'},1,1);
 }  

}



# ----------------------------------------------------------
#
# FREEZED ?
# Input ref. to hash ........ hash{'accout'}  = out hits to add
# Output ---
#
# ----------------------------------------------------------

sub isFreezed {
 my ($OutAcc) = shift;
 
 if ((getAccData($OutAcc))[$var::record{'freeze'}]) {
   return 1;
 }
 else 
 {
   return 0;
 }
      
}


# ----------------------------------------------------------
#
# LOCKED ?
# Input ref. to hash ........ hash{'accout'}  = out hits to add
# Output ---
#
# ----------------------------------------------------------

sub isLocked {
 my ($OutAcc) = shift;
 
 if ((getAccData($OutAcc))[$var::record{'lock'}]) {
   return 1;
 }
 else 
 {
   return 0;
 }

    }


# ----------------------------------------------------------
#
# SUSPENDED ?
# Input ref. to hash ........ hash{'accout'}  = out hits to add
# Output ---
#
# ----------------------------------------------------------

sub isSuspended {
 my ($OutAcc) = shift;
 my ($DBAcc) = shift; 
 
 if (   (getAccData($OutAcc,$DBAcc))[$var::record{'suspend'}]    ) {
   return 1;
 }
 else 
 {
   return 0;
 }
}



# ----------------------------------------------------------
#
# Puts ALL InHits to ALL accounts
# Input ref. to hash ........ hash{'accout'}  = in hits to add
# Output ---
#
# ----------------------------------------------------------

sub putInHitsToAccount {
 my ($InHits) = shift;
 # Hash with params  -- values of Hit In to ADD 
  if (!isFreezed($OutAcc)) {
    foreach my $InAcc (keys(%$InHits)) {
      # One Record
        updateRec($InAcc,$var::record{'in'},$$InHits{$InAcc},1);

    }
  }
}


# ----------------------------------------------------------
#
# Checks if specifies account exists
# Input:  account to check 
# Output true/false
#
# ----------------------------------------------------------

sub isAccount {
my ($acc) = shift;
my ($DBacc) = shift;
my ($ret) = 0;
my (%hash,@key,$xx);
my ($result)  = 0;

if (! defined $DBacc) {
  libFile::openDBM(\%hash,$config::account_database,0);
  if (exists $hash{$acc}) { $result  = 1; }
  libFile::closeDBM(\%hash);    
}
else {
if (exists $$DBacc{$acc}) { $result  = 1; }
}

return $result;
}


# ----------------------------------------------------------
#
# Gets crypted pwd of desire acc
# Input:  account name
# Output true/false
#
# ----------------------------------------------------------

sub getAccPWD {
my ($acc) =  shift;
my (%hash,@key);
my ($key,$value);

  if (libFile::openDBM(\%hash,$config::account_database,0)) {
    $value = $hash{$acc};
    @key = split(/\|/,$value);
    libFile::closeDBM(\%hash);
    return $key[0];
  }    
  return 0;

}


# ----------------------------------------------------------
#
# Checks if PWD is right
# Input:  account name, uncrypted PWD
# Output true/false
#
# ----------------------------------------------------------

sub checkAccPWD {
my ($acc) = shift;
my ($pwd) = shift;
if (isAccount($acc)) {
  if ($pwd eq getAccPWD($acc)) {return 1;} else{return 0;}
}
}




# ----------------------------------------------------------
#
# returns specif. data
# Input:  account name, field, ref.to hash
# Output true/false
#
# ----------------------------------------------------------

sub getAccDataEx {
my ($acc) = shift;
my ($field) = shift;
my ($hash) = shift;
my @result;
  @result = split(/\|/,$$hash{$acc});
  return $result[$field];
}


# ----------------------------------------------------------
#
# returns array with params
# Input:  account name, uncrypted PWD
# Output true/false
#
# ----------------------------------------------------------

sub getAccData {
my ($acc) = shift;
my ($DBAcc) = shift;
my %hash;
my @result;

if (defined $DBAcc) {
  @result = split(/\|/,$$DBAcc{$acc});
  return @result;

}
else {
  libFile::openDBM(\%hash,$config::account_database,0);
  @result = split(/\|/,$hash{$acc});
  libFile::closeDBM(\%hash);
  return @result;
}
}

# ----------------------------------------------------------
#
# Returns In values /in array/ (real,rated,ratio)
# Input: type,account name,hash/filename
# Output array - (real,rated,ration) in values
#
# ----------------------------------------------------------

sub getIn {
my ($type) = shift;
my ($acc) = shift;
my $result;
my (@data);
my $ratio;
# Search in HASH
($type) && do {
  # there goes hash ref.
  my ($data) = shift;
  @data = (split(/\|/,$$data{$acc}))[$var::record{$var::ratio},$var::record{'in'}];
  $data[0] =~ /([^:]*):.*/;
  $ratio = $1;
  $result = int($1 * $data[1]);
};

# Search in FILE
(!$type) || do {
};
#returns array (real IN,rated IN)

return ($data[1],$result,$ratio);
}


# ----------------------------------------------------------
#
# Returns Out values /in array/ (real,rated)
# Input: type,account name,hash/filename
# Output array - (real,rated) in values
#
# ----------------------------------------------------------

sub getOut {
my ($type) = shift;
my ($acc) = shift;
my $result;
my (@data);
my $ratio;
# Search in HASH
($type) && do {
  # there goes hash ref.
  my ($data) = shift;
  @data = (split(/\|/,$$data{$acc}))[$var::record{$var::ratio},$var::record{'out'}];
  $data[0] =~ /[^:]*:(.*)/;
  $ratio = $1;
  $result = int($1 * $data[1]);
};

# Search in FILE
(!$type) || do {
};
#returns array (real IN,rated IN,ratio)

return ($data[1],$result,$ratio);
}
#%EOF%#
#%File: ./libadmin.cgi%#
#--------------------------------------------------------------
#  ##%TL_NAME%## ##%TL_VER%##				      
#--------------------------------------------------------------
#                    DO NOT EDIT THIS FILE                    
#--------------------------------------------------------------


package libAdmin;
$| = 1;

use Socket;
use IO::Handle;

BEGIN {
my $FH;
$SIG{'__WARN__'} = sub {
  if (! -e 'error.txt') {
     umask 0;
    open($FH,"> ./logs/error.txt");
  } else { open($FH,">> ./logs/error.txt");}
  if (  (stat($FH))[7] > 1000000 ) {close($FH);    open($FH,"> ./logs/error.txt");}
  print $FH (@_);
};

}



use vars;
require "./libfile.cgi";
require "./libcron.cgi";
require "./liblist.cgi";
require "./libsystem.cgi";
require "./libparse.cgi";
require "./libaccount.cgi";
require "./lib5.cgi";
require "./liblog.cgi";
require "./libstat.cgi";
require "./data/config.dat";
require "./data/var.dat";
require "./data/infos.dat";

#use strict;

1;

sub checkHTAccessFile {
  if (-e "$config::cgi_path/admin/.htaccess") {
    return 1;
  }
  else {
    genHtAccessFile();
    return  0;
  }

}

sub genDefaultPWD {
libLog::logAction("PWD RESET !!! Reset to default PWD");
unlink "$config::cgi_path/data/pwdlost";
my (%subst)= ("adminPWD" => cryptPWD($var::emergencyPWD));
my ($FHOld) = libFile::openFile_ex("$config::cgi_root/data/config.dat","RDWR");
my ($FHNew) = libFile::openFile_ex("$config::cgi_root/data/config.new","RDWR|CREAT");
if (($FHOld != 3)  &&   ($FHNew != 3)) {
  updateConf($FHOld,$FHNew,\%subst);
  libFile::closeFile($FHOld);
  libFile::closeFile($FHNew);  
  rename("$config::cgi_root/data/config.new","$config::cgi_root/data/config.dat");
}
# now ,a default pwd is added in config.dat

eval { `htpasswd -b -c $config::cgi_path/admin/.htpasswd $config::adminLogin $var::emergencyPWD` };
if ($var::htAccessUse) { genHtAccessFile();  }else{
  unlink "$config::cgi_path/admin/.htaccess";
}  
return 1;
}

sub checkPWDLost {

return ((-e "$config::cgi_path/data/pwdlost")?1:0);

}

# input - duration in seconds
# output HR:MIN:SEC
sub getMinSec {
my ($time) = shift;
$hr   =  $time/(60*60);
$hr   =  int($hr);
$time -= $hr*60*60;
$min  =  $time/60;
$sec  =  $min - int($min);
$sec  =~ s/0\.(.*)/$1/e;
$sec  *= 0.6;
$sec  =  int($sec);
$sec  =~ /(..)/;
$sec  =  $1;
$min  =  int($min);
return "$hr:$min:$sec";
}


sub getServerInfo {
my (%infoSrv);

$infoSrv{'#%STBAR_VERSION%#'} = $config::version;
$infoSrv{'#%STBAR_NAME%#'} = $config::name;
$infoSrv{'#%STBAR_USR%#'} = libSystem::getUser();
$infoSrv{'#%STBAR_GRP%#'} = libSystem::getGroup();
$infoSrv{'#%STBAR_PERLVER%#'} = $];
$infoSrv{'#%STBAR_ADMLOGIN%#'} = getCurrLogin();
eval {
$infoSrv{'#%STBAR_TIME%#'} = localtime;
};

$infoSrv{'#%STBAR_RERTIME%#'}= libStat::getAdminStat($var::statAdmin{'lastRerankDuration'});
$infoSrv{'#%STBAR_LRERDATE%#'}= localtime (libStat::getAdminStat($var::statAdmin{'lastRerankDate'}));
$infoSrv{'#%STBAR_LRESDATE%#'}= localtime (libStat::getAdminStat($var::statAdmin{'lastResetDate'}));
$infoSrv{'#%STBAR_UPTIME%#'} = libStat::getAdminStat($var::statAdmin{'lastRerankUptime'}); 
$infoSrv{'#%STBAR_LASTLOG%#'} = localtime (libStat::getAdminStat($var::statAdmin{'lastLoginDate'}));
$infoSrv{'#%STBAR_TUSERS%#'} = libStat::getAdminStat($var::statAdmin{'totalAccs'});
$infoSrv{'#%STBAR_IUSERS%#'} = libStat::getAdminStat($var::statAdmin{'inactAccs'});
$infoSrv{'#%STBAR_NUSERS%#'} = libStat::getAdminStat($var::statAdmin{'newAccs'});
$infoSrv{'#%STBAR_OUSERS%#'} = libStat::getAdminStat($var::statAdmin{'oldAccs'});

my ($rerDuration) = time - libStat::getAdminStat($var::statAdmin{'lastRerankDate'});
my ($resDuration) = time - libStat::getAdminStat($var::statAdmin{'lastResetDate'});
$infoSrv{'#%STBAR_RESTIME_USERS%#'} = getMinSec($resDuration);
$infoSrv{'#%STBAR_RERTIME_USERS%#'} = getMinSec($rerDuration);

$infoSrv{'#%STBAR_PINCOUNT%#'}= libStat::getTotalStat($var::statTotal{'pin'});
$infoSrv{'#%STBAR_CINCOUNT%#'}= libStat::getTotalStat($var::statTotal{'cin'});
$infoSrv{'#%STBAR_INCOUNT%#'}= libStat::getTotalStat($var::statTotal{'rin'});
$infoSrv{'#%STBAR_OUTCOUNT%#'} = libStat::getTotalStat($var::statTotal{'out'});
$infoSrv{'#%STBAR_CPINCOUNT%#'} = libStat::getTotalStat($var::statTotal{'cpin'});
$infoSrv{'#%STBAR_OUTCOUNT%#'} = libStat::getTotalStat($var::statTotal{'out'});
$infoSrv{'#%STBAR_GOUTCOUNT%#'} = libStat::getTotalStat($var::statTotal{'gout'});
$infoSrv{'#%STBAR_NEWVER%#'} = libStat::getAdminStat($var::statAdmin{'newver'});
return %infoSrv;
}




sub emailAccs {
my ($email)   = shift;
my (%database);
libFile::openDBM(\%database,$config::account_database,0);
my ($acc);
my (@result);
push(@result,"Accounts using e-mail: $email\n\n");
my ($pwd);
foreach $acc (keys %database) {
  if ((split(/\|/,$database{$acc}))[$var::record{'mail'}] eq $email) {
    $pwd = (split(/\|/,$database{$acc}))[$var::record{'pwd'}];
    push(@result,"Account: $acc  Password: $pwd\n");
  }
}
sendMailEx(0,$var::email,$email,"Email's accounts",\@result);
libFile::closeDBM(\%database);
}


sub pwdForgot {
my ($acc)   = shift;
my (%database);
libFile::openDBM(\%database,$config::account_database,0);
if (libAccount::isAccount($acc,\%database)) {
my ($pwd) = (split(/\|/,$database{$acc}))[$var::record{'pwd'}];
my (@body) = ("Accounts informations:\n\n","Account: $acc\n","Password: $pwd");
my ($email) = (split(/\|/,$database{$acc}))[$var::record{'mail'}];
sendMailEx(0,$var::email,$email,"Forgotten pwd",\@body);
libFile::closeDBM(\%database);
return 1;
}
else {
 return 0;
}
}

sub strResult {
my ($text) = shift;
  print "Content-type: text/html \n\n";
  print "<html><head><link rel=\"stylesheet\" href=\"/main.css\" type=\"text/css\"></head><body>";
  print "$text";
  print "</body></html>";
}

sub wrongBrowser {
if ($ENV{'HTTP_USER_AGENT'} =~ /MSIE\s([^.]*)([^;]*)/ ) {
  my ($verMaj) = $1;
  my ($verMin) = $2;  
  libLog::logAction("-$verMaj -$verMin");
  if (($verMaj == 5) && ($verMin < 5)) {
    return 1;
  }
  else {
    return 0;
  }
}
else {
  return 0;
}

}

sub mainFrameset {
  if (wrongBrowser()) {
    libLog::logAction("Browser Error");
    #print "Content-type: text/html\n";    
    #print "<b>Browser Error<b> - Use version greater then 5.5";
    #exit -1;
  }
my ($FH) = libFile::openFile_ex($config::mainFrameset,"RDWR");
print "Content-type: text/html\n";
   if (! $var::htAccessUse) {
     print "Set-cookie: $var::cookieVarName\=$config::adminPWD\n";     
   }
print "\n";

if ($FH != 3) {
  foreach (<$FH>) {
    parseID(\$_);  	  
    s/#%([^%]*)%#/"${$1}"/e;
    print $_;
  }
} 
else {
  libError::logError("Error opening:$config::mainFrameset ",$0);
}
}

sub runOnce {
optimizeDatabase();
checkCSS();
checkJScript();
emptyTemp();
}

sub optimizeDatabase {
my (%dataOld,%dataNew);
my ($FH) = libFile::openFile_ex($config::optimizeTS,"RDWR");
my ($oldTime) = <$FH>;
if ( (time - $oldTime) > ($var::optimizeDelay * 60 * 60) ) {
  libFile::closeFile($FH);
  $FH = libFile::openFile_ex($config::optimizeTS,"RDWR|CREAT");
  print $FH time();
  libFile::closeFile($FH);
  
  foreach (@var::filesToBeOptimized) {
    libLog::logAction("Optimizing database: $_");
    libFile::openDBM(\%dataOld,$_,0);  
    libFile::openDBM(\%dataNew,$_."new",1);  
    %dataNew = %dataOld;
    libFile::closeDBM(\%dataNew);
    libFile::closeDBM(\%dataOld);
    rename "$_"."new", "$_";
  }
  
}
libFile::closeFile($FH);
}


sub checkCSS {
if (! -e "$config::document_root/main.css") {
  if ( ! libFile::copyFileX("$config::cssPath/skin_"."$var::selectedSkin".".css" ,"$config::document_root/main.css",0666)) {
    libError::logError("Error Copy CSS in libAdmin::checkCSS",$0);
  }
}

}

sub checkJScript {
if (! -e "$config::document_root/main.js") {
  if ( ! libFile::copyFileX("$config::jsPath/main.js" ,"$config::document_root/main.js",0666)) {
    libError::logError("Error Copy JS in libAdmin::checkCSS",$0);
  }
}

}


sub emptyTemp {
foreach (<$config::tempDir/*>) {
  #erase older then 30 min files
  if ( (stat($_))[8] + 60*30 < time() ) { unlink $_; }
}
}




sub frmAccAdd {
my ($FH)= libFile::openFile_ex($config::adminAcc,"RDWR");
my (@detail);
my ($count) = $var::newAccBoxes;
my ($pusher)=0;
my ($temp);
if ($FH != 3) {
   while (<$FH>) {
     if (/<!-- BEGINDETAILSECTION/) {$pusher = 1; next;}
     if (/<!-- ENDDETAILSECTION/) {
        my ($detail) = join("",@detail);
	$detail=~s/(var::[A-Za-z]*)/${$1}/gie;
	$pusher = 0; my($detcopy) =$detail;
	my ($tabindex) = 0;
	while($count--) { 
	  $detail = $detcopy;
	  $detail =~ s/(name\s*\=\s*\")(field)/"$1$count$2"/gie;
	  $detail =~s/(tabindex\s*\=\s*\")([^\"]*)/"$1". ($tabindex*30+$2)/gie;	  	    
	  $tabindex++;
	  print $detail; 
	}
         print  "\n"; 
         next;
      }     
     if ($pusher) {
	  # make tab order
       push(@detail,$_);
       next;
     }
     s|#%ACCADD_CGI%#|"$config::tlurl/admin/admin.cgi"|e;
     print $_;
   }
}
else {
  libError::logError("Error open file: $config::adminAcc",$0);
}
}


sub frmStatTotalDate {
my ($params) = shift;
my ($FH) = libFile::openFile_ex($config::htmlStatTotalDate,"RDWR");
my ($skip) =0;

my (%valType)  = ("CH_DAY" => "hits",
    		 "CH_MONTH" => "hits",
	         "CH_YEAR" => "hits",
                 "CH_HOUR" => "hits",
    		 "CH_UPTIME" => "load",
		 "CH_OUT" => "out hits",
		 "CH_REG" => "accounts"		 
);


my (@time) = localtime;
local ($month,$hour,$day,$year) = (4,2,3,5);
local ($uptime) = $hour;
local ($reg) = $day;
$time[$month]++;
$time[$year] +=1900;

my ($lines);
my (%maxims);

foreach (keys %$params)  {
  if (/G_/)  {
    $lines .="\&$_";
  }
  
}

foreach (keys %$params)  {
  if (/CH_/)  {
    $maxims{$_} = libStat::getStatMaxim($_,$lines);
  }
  
}


if ($FH != 3 ) {
#  print "Content-type: text/html \n\n";
  my ($type);
  
  my ($line);
  foreach $line (<$FH>) {
    parseID(\$line);
    $line =~ s|(config::[^?]*)|${$1}|e;
    if ($line =~ /(CH_[A-Za-z]*)/) {
      $type = $1;
      if (defined $$params{$1}) { $skip  = 0;} else {$skip = 1;}
    }
    $line =~ s/#%LINES%#/$lines/ge;
    if ($skip) {next;}
    ($type eq "CH_DAY" || $type eq "CH_HOUR" || $type eq "CH_MONTH" || $type eq "CH_YEAR" || $type eq "CH_UPTIME" || $type eq "CH_REG") && do {
      $type =~ /CH_(.*)/;
      my ($cc) = lc $1; 
      $line =~ /%#NR_([0-9]*)#%/;      
      my ($xx) =  $time[${$cc}] + 1 - $1;
      ($type eq "CH_DAY") && do {       if ($xx <= 0) {$xx += 31;} };
      ($type eq "CH_REG") && do {       if ($xx <= 0) {$xx += 31;} };      
      ($type eq "CH_MONTH") && do {       if ($xx <= 0) {$xx += 12;} };      
      ($type eq "CH_YEAR") && do {        };            
      ($type eq "CH_HOUR") && do {       if ($xx <= 0) {$xx += 24;} };            
      ($type eq "CH_UPTIME") && do {       if ($xx <= 0) {$xx += 24;} };
      if (length $xx == 1) {$xx = "0$xx";}
      $line =~ s/%#NR_([0-9]*)#%/$xx/;
    };
    
    ($type eq "CH_OUT") && do{
      $line =~ /%#NR_([0-9]*)#%/;
      my ($xx) = int($1 * $var::listLimit/24);
      $line =~ s/%#NR_([0-9]*)#%/$xx/;
    };
    my ($max) =0;
# ------------------ VAL SUBSTIT
    $line =~ /%#VAL_([0-9]*)#%/;
    if ($1 > 0) {
      $max = ($maxims{$type} * ( (5-$1)/4)  );
      
    }
    if ($type eq  "CH_UPTIME") {
      $max =~ /([0-9]*\.?[0-9]?[0-9]?)/;      
    $max = "$1 $valType{$type}";      
    }
    else {
      $max =~ /([0-9]*\.?[0-9]?)/;
    $max = "$1 $valType{$type}";      
    }

    $line =~ s/%#VAL_[0-9]*#%/$max/ge;
    
   print $line."\n";
  
}  
  
  
  libFile::closeFile($FH);
}

}

sub parseID {
my ($line) = shift;
$$line =~ s/#%toplistID%#/$var::topListID/e;
}

sub sendMailDeleted {
my ($subj) = shift;
# reference
my ($body) = shift;
my %database;
libFile::openDBM(\%database,$config::lostAccs,0);
sendMailFromMenu(2,$subj,$body,join("\0",values %database));
libFile::closeDBM(\%database);
return 1;
}

#----------------------------------
# Returns an array with inactive accs for spec. period
#
#----------------------------------
sub getInactivesWL {
my ($database) = shift;
my ($border) = $var::inactivityEdgeValue;
my @list;my @data;
foreach $acc (keys %$database) {
  @data = split(/\|/,$$database{$acc});
  if (-$data[$var::record{'inactivity'}] >= $border) {    push (@list,$acc);  }
}
return @list;
}

sub sendMailInactive {
my %database;
my @data;
libFile::openDBM(\%database,$config::account_database,0);
my (@list) = getInactivesWL(\%database);
my ($type) = $config::reportInactivityType;
my @body;
my $FH;

if ($type==1) {  $FH = libFile::openTempl($config::reportAccInactivityHtml,0);}
elsif ($type) { $FH = libFile::openTempl($config::reportAccInactivityText,0);}

foreach (<$FH>) { push(@body, $_);}
libFile::closeFile($FH);
foreach $acc (@list) {
  @data = split(/\|/,$database{$acc});
  sendMailEx($config::reportInactivityType,$var::mail,$data[$var::record{'mail'}],$var::emailReportSubject{'inactive'},\@body);
}
libFile::closeDBM(\%database);
}

sub getCurrLogin {
#LABEL: 123456789AA
return $config::adminLogin;
}

#sub logAdminIn


sub addDescrPart{
#ref
# dokoncit aby den skoncil aj na 30
# ale hodina nie na 24
my ($result) = shift;
my ($step) = shift;
my ($top) = shift;
my ($div) = shift;
my ($type) = shift;
my ($cum) = 0;
if ($step != 1) {
while ($cum+$type < $top) {
  $$result .= $cum/$div + $type.",";
  $cum += $step;
}

chop $$result;
}
# every minute
else {$$result = '*';}
}

sub genDiscreteTime {
my ($data) = shift;
my ($result);
# year in mins
my (%per);
%per = ('year'=> 60*24*30*12,'month'=> 60*24*30,'day'=> 60*24,'hour'=>60,'min'=>1);
# must be in sort from big to small
my (@sorted) = sort {$per{$a} <=> $per{$b}} (keys %per);    
my ($occ);
my ($res) = 0;
my ($index) = 0;
my ($frag)= 0;

#"*	*	*	*	*"
# min	hour	day	month   day of week
  SW:{
foreach (@sorted){

  if (  (($res = ( $per{$_} / $data ))  >= 1)  &&  ((int($res) * $data)== $per{$_})  ){
    (/year/) && do {
      $result = "0 0 1 ";
      addDescrPart(\$result,$data,$per{$_},$per{'month'},1);
      $result .= " *";
      last SW;
    };
    (/month/) && do {
      $result = "0 0 ";
      addDescrPart(\$result,$data,$per{$_},$per{'day'},1);
      $result .= " * *";
      last SW;
    };

    (/day/) && do {
      $result = "0 ";
      addDescrPart(\$result,$data,$per{$_},$per{'hour'},0);
      $result .= " * * *";
      last SW;
    };

    (/hour/) && do {
      $result = "";
      addDescrPart(\$result,$data,$per{$_},1,0);
      $result .= " * * * *";
      last SW;
    };

    

  }# IF

}# FOREACH
    } # SW  
return $result;
}#start of proc


sub updateCronTab {
my ($useCron) = shift;
# numbers in mins
my ($rerankPeriod) = shift;
my ($resetPeriod) = shift;
my ($tlName) = shift;
# gen from period number discrete points of action
my @crontab;

if ($useCron) {
# home says cron where to start in dir structure

  my ($oldID)= $var::cronTabBeginID;
  my ($tID) = $var::topListID;
  $tID =~ s/(\W)/"\\$1"/gise;
  $oldID =~ s/$tID/$tlName/ge;
  push (@crontab,"$oldID\n");
  push (@crontab,"HOME=$config::cronHome\n");

  my ($data) = genDiscreteTime($resetPeriod);
  push (@crontab,"$data ".(($var::useNice)?'nice ':'')." $config::cronReset\n");

  $data = genDiscreteTime($rerankPeriod);
  push (@crontab,"$data ".(($var::useNice)?'nice ':'')."$config::cronRerank\n");
  $oldID = $var::cronTabEndID;
  $oldID =~ s/$tID/$tlName/ge;
  push (@crontab,"$oldID\n");
  
  
  if (libCron::sendTab(\@crontab,$tlName)) {
  return 1;}
  else {return 0;}
}
else {
  if (libCron::deleteTab()) {
   return 1;
   }
  else {return 0;}
}
}


sub  getRestrWords {
my ($FH) = libFile::openFile_ex($config::restrictedWords,"RDWR");
if ($FH != 3) {
  my (@res) = (<$FH>);
  libFile::closeFile($FH);
  return (@res);
}
}


sub  getRestrUrls {
my ($FH) = libFile::openFile_ex($config::restrictedUrls,"RDWR");
if ($FH != 3) {
  my (@res) = (<$FH>);
  libFile::closeFile($FH);
  return (@res);
}
}


sub saveWords {
my ($data) = shift;  
my ($status) = 0;
my ($FHW) = libFile::openFile_ex("$config::restrictedWords","RDWR|CREAT");
my ($FHU) = libFile::openFile_ex("$config::restrictedUrls","RDWR|CREAT");
if ($FHW != 3) {
  print $FHW ($$data{'fieldWORDS1'});
  libFile::closeFile($FHW);
  $status = 1;
}

if ($FHU != 3) {
  print $FHU ($$data{'fieldWORDS2'});
  libFile::closeFile($FHU);
  $status = 1;
}


return  $status;
}


sub cryptPWD {
my ($data) = shift;
return crypt($data,substr($data,0,2));
}
# ----------------------------------------------------------
# Saves setup  form
# # Input: - ref. to paramets 
# Output: status
# ----------------------------------------------------------
sub saveSetup {
my ($data) = shift;
my %subst;
my $temp;
my ($counter) = 0;
# Cumulated sum of acc counts
my ($cumul) = 0;
my ($erased) = 0;
local %dataConfig;
local %dataVar;
my ($pwdhtaccess);
my $tm;
my ($status) = 1;


foreach $var (keys %$data) {
  $subst{$var} = $$data{$var};
}


# convert minutes to seconds
$subst{'var::rerankPeriodCron'} = $subst{'var::rerankPeriodCron'} * 60;
$subst{'var::resetPeriodCron'} = $subst{'var::resetPeriodCron'} * 60;

$subst{'var::inputRestr{\'title_max_chars\'}'} = $$data{'inputTitleMax'};
$subst{'var::inputRestr{\'descr_max_chars\'}'} = $$data{'inputDescrMax'};
$subst{'var::inputRestr{\'sample_max_h\'}'} = $$data{'maxSampleHeight'};
$subst{'var::inputRestr{\'banner_max_h\'}'} = $$data{'maxBannerHeight'};
$subst{'var::inputRestr{\'sample_max_w\'}'} = $$data{'maxSampleWidth'};
$subst{'var::inputRestr{\'banner_max_w\'}'} = $$data{'maxBannerWidth'};

if ($$data{'grpID'} ne "") {
    $subst{'config::multiAddGroupID'} = cryptPWD($$data{'grpID'});
} 



 
if ($$data{'pwd1'} ne "") {
  if ($$data{'pwd2'} eq $$data{'pwd1'}) {
    $pwdhtaccess= $$data{'pwd1'};
    $subst{'config::adminPWD'} = cryptPWD($$data{'pwd1'});
 } else {$status = 0; $pwdhtaccess =""; }
} 
else {
  $pwdhtaccess ="";
}


# add var ich in check box
# Label - DON'T REMOVE
#addIfCheckbox889
#config::reportAdminType

foreach (
    'var::cookiesUse',
    'var::autoSuspendNewAcc',    
    'var::autoSuspendModifAcc',        
    'config::reportAdminType',
    'config::reportAdminEditType',    
    'config::reportDeleteType',
    'config::reportInactivityType',
    'var::usePHP',
#    'var::gen_useLast',
#    'var::gen_useRandom',
    'var::useCron',
    'var::useNice',
    'var::mailAfterReg',
    'var::mailAfterRegAcc',
    'var::mailAfterEdit',
    'var::mailAfterDelete',
    'var::mailAfterInactivity',
    'var::parallelRunResRer',
    'var::antiHitBOTUse',    
    'config::reportAccType',
    'var::useAccViewAlarm',
    'var::htAccessUse'
) {
  $subst{$_} = ($$data{$_})?1:0;
}

foreach (keys %subst) {
}

my (@names)  = split(/,/,$$data{indexNames});
my (@counts)  = split(/,/,$$data{indexAccCount});
my (@breaks)  =    sort {$a <=> $b}  split(/,/,$$data{indexBreaks});
$temp = "(";
$counter = 0;
# ---------------- generate %index

foreach my $name (@names) {
  $temp .= ($counter?",":"").($counter+1)."=>[\"".$name."\",$counts[$counter]";
  #  Process breaks
  for (my $i=0;$i < scalar @breaks;$i++) {
    if (( $breaks[$i]-$cumul) <= $counts[$counter]) {
      $temp .= ','.($breaks[$i]-$cumul); $erased++;
    }
  }
  while ($erased) {
    splice(@breaks,0,1); $erased--;
  }
  
  $temp .= "]";  $cumul += $counts[$counter];  $counter++;
}
$temp .= ")";
  
$subst{'config::index'} = $temp;

foreach (keys %subst) {
  /^var/ && do{
    $tm = $_;
    $tm =~ s/^var:://;
    $subst{$_} =~ s/@/\\@/;
    $dataVar{$tm} = $subst{$_};
  };
  
  /^config/ && do{
    $tm = $_;
    $tm =~ s/^config:://;
    $subst{$_} =~ s/@/\\@/;    
    $dataConfig{$tm} = $subst{$_};
  };
}



  if ($var::topListID ne $subst{'var::topListID'}) {
    libLog::logAction("TL name changed from $var::topListID to $subst{'var::topListID'} ");
    if (! libCron::deleteTab()) {
      libError::logError("Error delete cron tab record in libAdmin::savesetup line 494",$0);     
    }
  }


# Data ready for apply 
foreach my $type ('Config','Var') {
  local $xxx;
  $xxx = "data".$type;
# Label gjg547gh
  my ($FHOld) = libFile::openFile_ex("$config::cgi_root/data/".lc($type).".dat","RDWR");
  my ($FHNew) = libFile::openFile_ex("$config::cgi_root/data/".lc($type).".new","RDWR|CREAT");
  if (($FHOld != 3)  &&   ($FHNew != 3)) {
    updateConf($FHOld,$FHNew,\%{$xxx});
    libFile::closeFile($FHOld);
    libFile::closeFile($FHNew);  
    rename("$config::cgi_root/data/".lc($type).".new","$config::cgi_root/data/".lc($type).".dat");

  }  else {$status = 0;}
}

    if (! updateCronTab($subst{'var::useCron'},$$data{'var::rerankPeriodCron'},$$data{'var::resetPeriodCron'},$subst{'var::topListID'})) 
      {$status = 0; }

    # update CSS file
    if (! libFile::copyFileX("$config::cssPath/skin_"."$subst{'var::selectedSkin'}".".css" ,"$config::document_root/main.css",0666))
    {
      libError::logError("Error copy file :$config::cssPath/skin_"."$subst{'var::selectedSkin'}".".css  into:$config::document_root/main.css",$0);
    }  
    # update htaccess files ...
#    unlink "$config::cgi_path/admin/.htpasswd";
    
    if ( $subst{'var::htAccessUse'} ) {
      if ($subst{'config::adminPWD'} eq "") {
        $subst{'config::adminPWD'} = $config::adminPWD;
      }
     if (! -e "$config::cgi_path/admin/.htpasswd") {
       $pwdhtaccess = $var::emergencyPWD;
       $subst{'config::adminPWD'}  = cryptPWD($var::emergencyPWD);
     }
     if ($pwdhtaccess ne "") {
       eval { `htpasswd -b -c $config::cgi_path/admin/.htpasswd $config::adminLogin $pwdhtaccess` };
     }
     genHtAccessFile();  
   } #if
   else {
       unlink "$config::cgi_path/admin/.htaccess";
   }

#libLog::logActioh("$status".$subst{'config::adminPWD'});
return "$status".(($subst{'config::adminPWD'}eq"")?$config::adminPWD:$subst{'config::adminPWD'});
}


sub genHtAccessFile {

my ($FH) = libFile::openFile("$config::cgi_path/admin/.htaccess","RDWR|CREAT");
  if ($FH != 3) {
    print $FH ("AuthUserFile $config::cgi_path/admin/.htpasswd\n");
    print $FH ("AuthName \"TOPLIST Admin\"\n");  
    print $FH("AuthType Basic\n");    
    print $FH ("<LIMIT GET POST>\n");    
    print $FH ("require user $config::adminLogin\n");      
    print $FH ("</LIMIT>\n");        
    libFile::closeFile($FH);
 }
 else {
   libError::logError("Error create file: .htaccess in libadmin",$0);
 }
}

sub updateConf {
my ($FHOld) = shift;
my ($FHNew) = shift;
my ($data) = shift;
if ($FHOld != 3  && $FHNew != 3) {
  while (<$FHOld>) {
  # If TRUE, exists construction like $|@|%name = ...
    /^(\$|\%|\@)([^\s]*)(\s*=\s*\"?)([^\"]*|[^;]*)(\"?;)$/ &&  (defined $$data{$2}) && do {
      s/^(\$|\%|\@)([^\s]*)(\s*=\s*\"?)([^\"]*|[^;]*)(\"?;)$/$1.$2.$3.$$data{$2}.$5/e;
    };

    print $FHNew ($_);
  
  }
} else {
# L66655414
  libError::logError("Error open files Config.dat/Var.dat in libAdmin label L66655414",$0);
}

}



sub iCheck {
  $iCheckWeb = "www.xxxscripts.net";
  $iCheck = "http://$iCheckWeb/cgi-bin/check/icheck.cgi";
  $EOF = "\015\012";
  $BLANK = $EOF x 2;
  socket(SOCK,PF_INET,SOCK_STREAM,getprotobyname('tcp'));
  my ($iaddr) = inet_aton($iCheckWeb );
  my ($port)   = 80;#getservbyname('http','tcp');
  my ($sa);
  $sa = sockaddr_in($port,$iaddr) || die "socket: $!\n";
  connect(SOCK,$sa) || die "connect: $!\n";
  SOCK->autoflush(1);
  my ($pathsize) = length "$config::cgi_path";
  print SOCK "GET $iCheck?www=$config::tlurl&pathsize=$pathsize&id=$config::iID&ver=$config::version HTTP/1.0$BLANK";
  my ($result);
  foreach (<SOCK>) {
    if (/tlver:(.*)/) {
      $result = $1;
    }
  }
  close(SOCK);
  return $result;
}

# ----------------------------------------------------------
# Generates help part of HTML Edit form with
# used variables
# Input: - /header,footer,body/
# Output: array
# ----------------------------------------------------------
sub authFailed {
# #%PWD%#
my $FH;
$FH = libFile::openFile_ex($config::htmlAdminAuthFailed,"RDWR");
if ($FH != 3 ) {
  while (<$FH>) {
    parseID(\$_);
    print;
  }

}
}


# ----------------------------------------------------------
# Generates help part of HTML Edit form with
# used variables
# Input: - /header,footer,body/
# Output: array
# ----------------------------------------------------------
sub authForm {
# #%PWD%#
my $FH;
$FH = libFile::openFile_ex($config::htmlAdminAuth,"RDWR");
if ($FH != 3 ) {
  while (<$FH>) {
    parseID(\$_);
    s/action\s*\=\s*\"([^\"]*)\"/"action = \"$var::html_admin_display{$1}\""/gise;
    print;
  }

}
exit 0;
}
# ----------------------------------------------------------
# Generates help part of HTML Edit form with
# used variables
# Input: - /header,footer,body/
# Output: array
# ----------------------------------------------------------
sub setupForm {
my ($fType) = shift;
my $FH;
$FH = libFile::openFile_ex($config::htmlAdminSetup,"RDWR");
if ($FH != 3 ) {
  local ($inputTitleMax) = $var::inputRestr{'title_max_chars'};
  local ($inputDescrMax) = $var::inputRestr{'descr_max_chars'};
  local ($maxSampleHeight) =$var::inputRestr{'sample_max_h'};
  local ($maxBannerHeight) =$var::inputRestr{'banner_max_h'};  
  local ($maxSampleWidth) =$var::inputRestr{'sample_max_w'};
  local ($maxBannerWidth) =$var::inputRestr{'banner_max_w'};  
  local ($indexNames,$indexAccCount,$indexBreaks);
  my ($lastCount,@temp);
  foreach my $index (keys %config::index) {
    $indexNames .= ($config::index{$index})->[0]. (($index < scalar keys %config::index)?",":"");
    $indexAccCount .= ($config::index{$index})->[1]. (($index < scalar keys %config::index)?",":"");
    if ( $index == 1) {$lastCount = 0}
    else {
      $lastCount += $config::index{$index-1}->[1];
    }
    @temp = @{$config::index{$index}}[2..scalar @{$config::index{$index}}-1];
      if ($temp[0] ne "") {
      for (my $i=0;$i<scalar @temp;$i++) {
        $temp[$i] += $lastCount;
      }
      $indexBreaks .= join(",",@temp). (($index < scalar keys %config::index)?",":"");
    }
#    local ($indexAccCount)
#    local ($indexBreaks)
  }
  if ($indexAccCount =~ /(,)$/) {chop $indexAccCount;}
  if ($indexBreaks =~ /(,)$/) {chop $indexBreaks;}
  my ($pStatus) = $fType;
  my (@notUsed) = ();
  my ($storeSel);
  my ($xStatus) = 0;
  while (<$FH>) {
    if (!$fType && /<!-- ADVANCED/) { $pStatus = 1; next;}
    if (!$fType && /<!-- END/) {$pStatus = 0; next;}    
    if ($fType && /<!-- ADVANCED/) {$pStatus = 0; next;}
    if ($fType && /<!-- END/) {$pStatus = 1; next;}    
    if ( /<!-- BOTH/) {$pStatus = 0; next;}
    if (  /<!-- selectCustom/) {$xStatus = 10; next;}
    if ( /<!-- selectSkin -->/) {$xStatus = 20; next;}    
    if ($pStatus) { 
        my ($back) =$_; 
        if (s/.*(<input.*type\=\")([^"]*)(\"[^>]*>).*/"$1hidden_$2$3"/e) 	{
		  push(@notUsed,$_);
	}
	if (/option.*value=\"([^\"]*)\"\s*(.*::[A-Za-z0-9_]*)/) {
	  if ( (${$2} == $1*60)  && ( !  ($1 =~ /%/) )) {
	    push(@notUsed,"<input type=\"hidden\" name=\"$2\" value=\"$1\">\n");
	  }
	}
	if ((/select.*name=\"([^\"]*)\"/) && ($1 ne "var::resetPeriodCron" ) && ($1 ne "var::rerankPeriodCron" )  ) {
	    push(@notUsed,"<input type=\"hidden\" name=\"$1\" value=\"${$1}\">\n");
	}
        next;
    } else {
    if (($xStatus == 10) ) {
      my ($line) = $_;
      my $linex;
      foreach (keys %var::custItems) {
        $linex = $line;
	$_ =~ /^([^\(]*)/;
	$name =$1;
	$_ =~ /\(([^\)]*)/;	
	$descr =$1;	
        $linex =~ s/%#VALUE#%/"$descr"/ge;
        $linex =~ s/%#NAME#%/"$name"/ge;	
    if (($linex=~ /option\s*value\s*=\s*\"?([^\"]*)\"?\s*([^>]*)/    ) && ($1 eq ${$2})) {
         my ($main) = $2;
         $linex=~s/$main/"selected"/e;
    }
    else {
         my ($main) = $2;
     $linex=~s/$main/""/e;
    }
        print $linex."\n";
      }
      $xStatus = 0;
      next; 
    }
    if ($xStatus >= 20) {
      my ($line) = $_;
      my $linex;
      my ($FH);
      my ($title,$descr,$name);
      foreach (<$config::cssPath/skin*>) {
        /skin_([A-Za-z0-9]*)/;
	$name = $1;
        $FH = libFile::openFile_ex("$_","RDWR");
        $linex = $line;
	$title = <$FH>; $title =~ /\"([^\"]*)\"/;
	$descr = $1;
        $linex =~ s/%#VALUE#%/$descr/ge;
	$linex =~ s/%#NAME#%/$name/ge;	
        libFile::closeFile($FH);
    if (($linex=~ /option\s*value\s*=\s*\"?([^\"]*)\"?\s*([^>]*)/    ) && ($1 eq ${$2})) {
     my ($main) = $2;
     $linex=~s/$main/"selected"/e;
    }
    else {
         my ($main) = $2;
     $linex=~s/$main/""/e;
    }
        print $linex."\n";
      }
      $xStatus = 0;
      next; 
    }
    }
    parseID(\$_);
    if (/%#SAVE_SETUP#%/) {
      # not usede field added before button save setup  !!!!!!!!
      $_ .= "\n@notUsed\n";
    }
    s/action\s*\=\s*\"([^\"]*)\"/"action = \"$var::html_admin_display{$1}\""/gise;
    if ((/option\s*value\s*=\s*\"?(\d*)\"?\s*([^>]*)/) && ($1 == ${$2}/60)) {
      s/(option\s*value\s*=\s*\"?\d*\"?\s*)([^>]*)/"$1 selected"/e;
    }
    else {
      s/(option\s*value\s*=\s*\"?\d*\"?\s*)([^>]*)/"$1"/e;    
    }
    # give value
    s/\s*(text|hidden)(.*value\s*=\s*\")([^\"]*)/"$1$2". (     (  defined ${$3} && ( ( ${$3}ne$1) && (${$3}ne$2) && (${$3}ne$0) )) ?"${$3}":"$3")/gie;
    # set checked if needed
    my ($match) = $_;
    if (s/(type\s*=\s*\"([^_]*_?checkbox|radio)\")(.*)(value\s*=\s*\"([0-9]*)\")(.*)((var|config)::[A-Za-z0-9_]*)\s*\>/"$1$3$4$6". ((${$7}==$5)?"checked>":">")/ge) {
    }
    
#name="var::fwdType"    


#    s/(radio|checkbox)(.*value\s*=\s*\")([^\"]*)(\"\s*)([^>]*)/"$1$2$3$4".((${$5} == $3)?"checked":"")/gie;
    # remove checked form hidden radio or checkbox
    s/(<input.*hidden)_(radio|checkbox)(.*)checked(.*)/"$1$3$4"/gie;
    # not checked hidden radio or checkbox make as comment
    s/(<input.*hidden)_(radio|checkbox)(.*)/"<!-- $1$3 -->"/gie;
    # finaly make all hidden with type="hidden"
    s/hidden_text/"hidden"/gie;   
    print;
  }
  libFile::closeFile($FH);
}

}


# ----------------------------------------------------------
# Generates help part of HTML Edit form with
# used variables
# Input: - /header,footer,body/
# Output: array
# ----------------------------------------------------------
sub genHtmlEditHelp {
my ($part) = shift;
my @result;
# item count
my (%varPart) = (
    'header' => \%var::genHeader,
    'footer' => \%var::genFooter,
    'body' => \%var::genBody,
    'maildel' => \%var::genMailDelete,
    'mailinact' => \%var::genMailInact
);

my ($ref) = $varPart{$part};
foreach my $var (keys %$ref) {
  if (defined $var) {
    push(@result,"$$ref{$var}{'val'} <BR> \"$$ref{$var}{'def'}\"<BR>");
  }    
}
return @result;
}


# ----------------------------------------------------------
# Substitues & with &amp; in input array ref.
#
# Input:  ref. to array
# Output: -
# ----------------------------------------------------------
sub showAmp {
my ($data) = shift;
#  @$data  =~ s/&/&amp;/g;
#  @$data  =~ s/</&#60;/g;
#  @$data  =~ s/>/&#62;/g;


for (my $i=0;$i<scalar @$data;$i++) {
  $$data[$i]  =~ s/&/&#38;/g;   
  $$data[$i]  =~ s/</&#60;/g;   
  $$data[$i]  =~ s/>/&#62;/g;
  $$data[$i]  =~ s/\+/&#43;/g;  
  $$data[$i]  =~ s/\@/&#64;/g;    
}

}




sub removeDefault {
my ($fn) = shift;
($fn =~ s|defaults/||);
return $fn;
}



# ----------------------------------------------------------
# Saves header/body/footer of template
#
# Input:  message type
# Output: message text
# ----------------------------------------------------------
sub saveTempl {
# 0 - from toplist templates
# 1 - from mail ed
my ($type) = shift;
my $ref;
my $data;
my $FH;
my (%proc)  = (
		'header' => *libList::genTemplUserHeaderFN,
		'footer' => *libList::genTemplUserFooterFN,
		'body' => *libList::genTemplUserDataFN
);

# from EMAIL
if ($type) {
my ($name) = shift;
# HTML / TEXT
my ($version) = shift;
my ($params) = shift;

  $ref = "config::reportAcc$name$version";
#  $FH = libFile::openFile_ex("> ".removeDefault(${$ref}),0);
  $name = uc $name;
  $version = uc $version;
  $data = $$params{"field$name$version"};
  if ( $data ne "") {
    $FH = libFile::openFile_ex(removeDefault(${$ref}),"RDWR|CREAT");

  }
  else {
    unlink removeDefault(${$ref});
    return 1;
  }
}
# from TOPLIST
else {
my ($typeX) = shift;
my ($params) = shift;

  $data = $$params{$var::htmlAdminEdit{$typeX}};
  
  if ( $data ne "") {
    $FH = libFile::openFile_ex(removeDefault($proc{$typeX}->($$params{'index'})),"RDWR|CREAT");

  }
  else {
    # remove unlinked
    # $proc{$typeX}
    # delete $acc = "dict"
    unlink removeDefault($proc{$typeX}->($$params{'index'},0));
    return 1;
  }
  
  
}
if ($FH != 3) {
  print $FH ($data);
  libFile::closeFile($FH);
  return 1; 
}
else {
  return 0;
}

}

# ----------------------------------------------------------
# Gets status in spec. language
#
# Input:  message type
# Output: message text
# ----------------------------------------------------------

sub getStatusMessage {
my ($st) = shift;
return $infos::status{$config::lang}{$st};
}



# ---------------------------------------------
#
# Sends mail to multiple users
# Input:  ref. to array of TOs, ref. to subj, ref. to body
# Output: ---
#
# ---------------------------------------------
# Label 4565458454sdf
sub sendMultiMail {
# ref.
my ($addr) = shift;
# ref.
my ($subj) = shift;
# ref.
my ($body) = shift;
my ($counter) = 0;
foreach my $adr (@$addr) {
  if (!sendMailEx(0,$var::email,$adr,$$subj,$body)) {next;}
  $counter++;  
}
if ($counter == scalar @$addr) {return 1;}
else {return 0;}

}
# ---------------------------------------------
#			0	   1
# Sends mail /type?(plain text, html text), from?, to?, subject?, body?/
# Input:  Menu type
# Output:1 if successfull
#
# ---------------------------------------------

sub sendMailEx {
# mail type /plain text/ = 0 /html/ = 1 /combined/ = 2
my ($type) =  shift;

my ($from) =  shift;
my ($to) =  shift;
my ($subject) =  shift;
my ($body) =  shift;
my ($sendmail) = "$config::sendmail -t -oi";
#my ($sendmail) = "$config::sendmail -t -n -oi";
my @head;

if (open(SENDMAIL,"| $sendmail")) {
SWX: {
SW:{
  ($type == 1) && do {
     @head = (
       "From: $from\n",
       "To: $to\n",
       "Subject: $subject\n",
       "X-Mailer: $config::name v.$config::version\n",
       "MIME-Version: 1.0\n",
       "Content-Type: text/html; charset=us-ascii\n",
       "Content-Transfer-Encoding: 7bit\n"
     ); 
    last SW;
  };
  
  ($type == 0) && do {
     @head = (
       "From: $from\n",
       "To: $to\n",
       "Subject: $subject\n",
       "X-Mailer: $config::name v.$config::version\n",
       "MIME-Version: 1.0\n",
       "Content-Type: text/plain; charset=us-ascii\n",
       "Content-Transfer-Encoding: 7bit\n"
     ); 
    last SW;
  
  };
  
  ($type == 2) && do {
  my ($bodyHTML) =  shift;
     @head = (
       "From: $from\n",
       "To: $to\n",
       "Subject: $subject\n",
       "X-Mailer: $config::name v.$config::version\n",
       "MIME-Version: 1.0\n",
       "Content-Type: multipart/alternative;\n",
	" boundary=\"------------1\"\n\n",       
	"--------------1\n",
       "Content-Type: text/plain; charset=us-ascii\n",
       "Content-Transfer-Encoding: 7bit\n\n",
	"$body\n\n",
	"--------------1\n",
	"Content-Type: text/html; charset=us-ascii\n",
	"Content-Transfer-Encoding: 7bit\n\n",
	"<html>\n",
         "$bodyHTML\n\n",
	 "--------------1--\n"
     ); 
     #21E026051C86CA9105967481
    print SENDMAIL @head;
    close(SENDMAIL);
    last SWX;
  
  };
  
  
  
} # SW
eval {
print SENDMAIL @head;
};
if ($@) {libError::logError("SendMail Header Error",$0);}
my ($sep) = $";
$" = "";
eval {
print SENDMAIL "\n@$body\n";
};
if ($@) {libError::logError("SendMail Body Error",$0);}
#open(STDOUT,"/dev/null");
#print 
if (! close(SENDMAIL)) { libError::logError("SendMail Close Error",$0); }

$" = $sep;

}; #SX
return 1;
}
#if Opened OK
return 0;
}
# ---------------------------------------------
#
# Sends email
# Input:  Menu type
# Output: ---
#
# ---------------------------------------------

sub sendMail {
my ($type) = shift;
my ($subject) = shift;
my ($body) = shift;
my ($sendmail) = "$config::sendmail -t -oi";
#my ($sendmail) = "$config::sendmail -t -n -oi";
my @to;
if (open(SENDMAIL,"| $sendmail")) {
#OK ...
  print SENDMAIL "From: $var::email\n";
SW:{
  ($type == 0) && do {
    my %database;

    libFile::openDBM(\%database,$config::account_database,0);
    # Send mail
    foreach my $acc (keys %database){
       push(@to,(split(/\|/,$database{$acc}))[$var::record{'mail'}]);
    }
    libFile::closeDBM(\%database);
    last SW;
  };
  ($type == 1) && do {
    my %database;
    libFile::openDBM(\%database,$config::account_database,0);
    foreach my $acc (keys %database){
       if ((split(/\|/,$database{$acc}))[$var::record{'activity'}] < 0) {
         push(@to,(split(/\|/,$database{$acc}))[$var::record{'mail'}]);
       } 
    }
    libFile::closeDBM(\%database);
    last SW;
  
  };
  ($type == 2) && do {    
  my ($list) = shift;  # reference to array
  @to = @$list;
  last SW;
  };
  
} 


  
  my ($to) = join(",",@to);
  print SENDMAIL "To: $to\n";
  print SENDMAIL "Subject: $subject\n";

  print SENDMAIL "\n$body\n";
  close(SENDMAIL);
}
}



sub getMeasure {
my ($type) = shift;
my (@data);
my ($FH) = libFile::openFile_ex($config::powerMeasure,"RDWR");
if ($FH != 3) {
OUT:{
  foreach (<$FH>) {
    (/|/) && do {
      @data = split(/\|/,$_);
      last OUT;
    };
  }
 } 
  libFile::closeFile($FH);
  return $data[$var::measure{$type}];
}
else {
return -1;
}
}

sub setMeasure {
my ($type) = shift;
my ($data) = shift;
my (@data);
my ($FH);
my $line;my @line;
if (-e $config::powerMeasure) {
  $FH = libFile::openFile_ex($config::powerMeasure,"RDWR");
}
else {
  $FH = libFile::openFile_ex("$config::powerMeasure","RDWR|CREAT");
}

if ($FH != 3) {
  $line = (<$FH>);
  libFile::closeFile($FH);
  @data = split(/\|/,$line);
  $data[$var::measure{$type}] = $data;
  $FH  = libFile::openFile_ex("$config::powerMeasure","RDWR|CREAT");
  $data = join("|",@data);
  print $FH  ($data);
  libFile::closeFile($FH);
}
}



# ---------------------------------------------
#
# Sends email
# Input:  Menu type
# Output: ---
#
# ---------------------------------------------
sub sendMailFromMenu {
my ($type) = shift;
my ($subject) = shift;
my ($body) = shift;
my @to;my @accs;
my (@body) = split(/\0/,$body);
SW:{

  ($type == 0) && do {
    my %database;
    libFile::openDBM(\%database,$config::account_database,0);
    foreach my $acc (keys %database){
       push(@to,(split(/\|/,$database{$acc}))[$var::record{'mail'}]);
    }
    libFile::closeDBM(\%database);
    last SW;
  };
  ($type == 1) && do {
    my %database;
    libFile::openDBM(\%database,$config::account_database,0);
    foreach my $acc (keys %database){
       if ((split(/\|/,$database{$acc}))[$var::record{'activity'}] < 0) {
         push(@to,(split(/\|/,$database{$acc}))[$var::record{'mail'}]);
       } 
    }
    libFile::closeDBM(\%database);
    last SW;
  
  };
  ($type == 2) && do {    
  my ($list) = shift;  # reference to array
  @to = split (/\0/,$list);
  last SW;
  };
  ($type == 3) && do {    
  my ($list) = shift;  # reference to array
  my %database;
  libFile::openDBM(\%database,$config::account_database,0);
  @accs = split (/\0/,$list);
  foreach (@accs) {
    push(@to,(split(/\|/,$database{$_}))[$var::record{'mail'}]   );
  }
  libFile::closeDBM(\%database);  
  last SW;
  };  
  
  
} 

if (sendMultiMail(\@to,\$subject,\@body)) {
  return 1;
}else {return 0;}  

}

sub accLock {
my ($acc) = shift;
my @temp;
my %database;
libFile::openDBM(\%database,$config::account_database,1);
@temp = split(/\|/,$database{$acc});
if ($temp[$var::record{'lock'}]) {$temp[$var::record{'lock'}] = 0;}
else{  $temp[$var::record{'lock'}] = 1;}
$database{$acc}= join("|",@temp);
libFile::closeDBM(\%database);
return 1;
}

sub accSuspend {
my ($acc) = shift;
my @temp;
my %database;
libFile::openDBM(\%database,$config::account_database,1);
@temp = split(/\|/,$database{$acc});
if ($temp[$var::record{'suspend'}]) {$temp[$var::record{'suspend'}] = 0;}
else{  $temp[$var::record{'suspend'}] = 1;}
$database{$acc}= join("|",@temp);
libFile::closeDBM(\%database);
return 1;
}



sub accFreeze {
my ($acc) = shift;
my @temp;
my %database;
libFile::openDBM(\%database,$config::account_database,1);
@temp = split(/\|/,$database{$acc});
if ($temp[$var::record{'freeze'}]) {$temp[$var::record{'freeze'}] = 0;}
else{  $temp[$var::record{'freeze'}] = 1;}
$database{$acc}= join("|",@temp);
libFile::closeDBM(\%database);
return 1;
}


sub makeRatedSave {
# round down
my ($value) = shift;
my ($ratio) = shift;
if ($ratio eq "") {$ratio = "1:1";}
my ($newValue) = int ( ((defined $value)?$value:0) / $ratio );
return $newValue;
}


sub accSave {
my ($acc) = shift;
my ($params) = shift;
my %database;
my %stat;
my @temp;
my @temp1;
my $field;
#validateInput($params,1);
# parameters checked - everything is OK
libFile::openDBM(\%database,$config::account_database,1);
@temp = split(/\|/,$database{$acc});
$field  = 'in';
$temp[$var::record{$field}] = makeRatedSave($$params{$var::form{'setup_form'}{$field}},(libAccount::getIn(1,$acc,\%database))[2]);
$field  = 'out';
$temp[$var::record{$field}] = makeRatedSave($$params{$var::form{'setup_form'}{$field}},(libAccount::getOut(1,$acc,\%database))[2]);

libFile::openDBM(\%stat,$config::stat_database,1);

@tempStat = split(/\|/,$stat{$acc});


# LABEL 5646456465SDF
$field = 't_in';
if  (defined $$params{$var::form{'setup_form'}{$field}}) {
  $tempStat[$var::stat{$field}] = makeRatedSave($$params{$var::form{'setup_form'}{$field}},(libAccount::getIn(1,$acc,\%database))[2]);
}

$field = 't_out';
if  (defined $$params{$var::form{'setup_form'}{$field}}) {
  $tempStat[$var::stat{$field}] = makeRatedSave($$params{$var::form{'setup_form'}{$field}},(libAccount::getOut(1,$acc,\%database))[2]);
}

#print @temp;
$stat{$acc}=join("|",@tempStat);

libFile::closeDBM(\%stat);


if ($$params{$var::form{'setup_form'}{$var::ratio}} eq "") {
  $$params{$var::form{'setup_form'}{$var::ratio}} = $var::defaultHitRatio;
}

   my (%hwTemp)= (  $var::samplew => $var::maxSampleWidth, 
		    $var::sampleh => $var::maxSampleHeight, 
		    $var::bannerw => $var::maxBannerWidth, 
		    $var::bannerh => $var::maxBannerHeight

   );


foreach my $field (($var::sampleh,$var::samplew,$var::bannerw,$var::bannerh))
{
  # when checkbox is unchecked it's undefined in params
  $temp[$var::record{$field}] = (defined $$params{$var::form{'setup_form'}{$field}} )?$$params{$var::form{'setup_form'}{$field}}:$hwTemp{$field};
}


foreach my $field (($var::freeze,$var::suspend,$var::lock,$var::activity))
{
  # when checkbox is unchecked it's undefined in params
  $temp[$var::record{$field}] = (defined $$params{$var::form{'setup_form'}{$field}} )?$$params{$var::form{'setup_form'}{$field}}:0;
}

$temp[$var::record{$var::new}] = 0;
foreach my $field ($var::new,$var::modif) {
 $temp[$var::record{$field}] |=  ($$params{$var::form{'setup_form'}{$field}})?$$params{$var::form{'setup_form'}{$field}}:0;
}

foreach my $field (($var::ratio,$var::sample,$var::mail,$var::banner,$var::weblink,$var::web2link,$var::info,$var::descr,$var::title,$var::pwd))
{
  # when checkbox is unchecked it's undefined in params
  $temp[$var::record{$field}] = $$params{$var::form{'setup_form'}{$field}};
}

$database{$acc}=join("|",@temp);

libFile::closeDBM(\%database);
return 1;

}

sub accDelete {
my ($acc) = shift;
libAccount::deleteAcc($acc);
return 1;
}

sub accSendMailMenu {
my ($params) = shift;
my ($acc) = $$params{'fieldAcc'};
my ($FH);
my ($email);my %data;
$FH = libFile::openFile_ex($config::htmlAccViewMail,"RDWR");
if ($FH != 3) {
   libFile::openDBM(\%data,"$config::account_database",0);
   $email = (split(/\|/,$data{$acc}))[$var::record{'mail'}];
   libFile::closeDBM(\%data);
    my (@vars) = ("<input type=\"hidden\" name=\"selby\" value=\"$$params{'selby'}\">",
    		   "<input type=\"hidden\" name=\"perpage\" value=\"$$params{'perpage'}\">",
		   "<input type=\"hidden\" name=\"chooseby\" value=\"$$params{'chooseby'}\">",
		   "<input type=\"hidden\" name=\"last\" value=\"$$params{'last'}\">",
		   "<input type=\"hidden\" name=\"env\" value=\"$$params{'env'}\">",
		   "<input type=\"hidden\" name=\"textuname\" value=\"$$params{'textuname'}\">"		   
     );
   
   print "Content-type: text/html \n\n";
  while (<$FH>) {
    parseID(\$_);  
    s/#%ACC_VIEW_VARS%#/"@vars"/e;
    s/#%MAIL_TO%#/"$acc ($email)"/e;
    s/#%ACCOUNT_NAME%#/"$acc"/e;    
    s/($var::html_admin_cgi)/$var::html_admin_display{$1}/gise;  
    print;
  }
  libFile::closeFile($FH);
  exit 0;
}
else {
  return 0;
}
}



sub makeRatedLoad {
# round up
my ($value) = shift;
my ($ratio) = shift;
my $newValue;
if (! defined $value){$value = 0;}
$newValue =  int ($value * $ratio);
if ($value*$ratio  != $newValue) {$newValue++}
return $newValue;
}



# ---------------------------------------------
#
# Fills account detail template
# Input:  $account , ref. na @detail
# Output: ---
#
# ---------------------------------------------


sub fillDetail {
my ($xacc) = shift;
my ($pos) = shift;
my ($detail) = shift;     # poiter to array
my ($fName) = shift;
my @copy;
my (%xrecord,%database,%stat);
@copy = @$detail;
libFile::openDBM(\%database,$config::account_database,0);
libFile::openDBM(\%stat,$config::stat_database,0);

$xrecord{$var::h_adm_acc_view{'position'}} = $pos;
$xrecord{$var::h_adm_acc_view{'acc'}} = $xacc;

foreach $item ($var::pwd,$var::weblink,$var::web2link,$var::info,$var::title,$var::banner,$var::mail,$var::descr,
$var::activity,$var::sample,$var::samplew,$var::sampleh,$var::bannerw,$var::bannerh,$var::ratio) {
  $xrecord{$var::h_adm_acc_view{$item}} = (split(/\|/,$database{$xacc}))[$var::record{$item}];
}
# not rated productive IO
$xrecord{$var::h_adm_acc_view{'in_real'}} = (split(/\|/,$database{$xacc}))[$var::record{'in'}];
$xrecord{$var::h_adm_acc_view{'out_real'}} = (split(/\|/,$database{$xacc}))[$var::record{'out'}];
  
# rated TOTAL IN
$xrecord{$var::h_adm_acc_view{'total_in'}} = makeRatedLoad((split(/\|/,$stat{$xacc}))[$var::stat{'total_in'}],(libAccount::getIn(1,$xacc,\%database))[2]);
$xrecord{$var::h_adm_acc_view{'total_out'}} = makeRatedLoad((split(/\|/,$stat{$xacc}))[$var::stat{'total_out'}],(libAccount::getOut(1,$xacc,\%database))[2]);

#(#%REAL_PROD_IN%#,#%REAL_NOTBOT_IN%#)
$xrecord{$var::h_adm_acc_view{'total_real_in'}} =  (split(/\|/,$stat{$xacc}))[$var::stat{'t_rin'}];
$xrecord{$var::h_adm_acc_view{'total_notbot_in'}} = (split(/\|/,$stat{$xacc}))[$var::stat{'nobotfilter_in'}];
if (!$xrecord{$var::h_adm_acc_view{'total_real_in'}}) {$xrecord{$var::h_adm_acc_view{'total_real_in'}} = 0};
if (!$xrecord{$var::h_adm_acc_view{'total_notbot_in'}}) {$xrecord{$var::h_adm_acc_view{'total_notbot_in'}} = 0};

$xrecord{$var::h_adm_acc_view{'gen_out'}} =  (split(/\|/,$stat{$xacc}))[$var::stat{'gen_out'}];
if (!$xrecord{$var::h_adm_acc_view{'gen_out'}}) {$xrecord{$var::h_adm_acc_view{'gen_out'}} = 0};

#$h_adm_acc_view{'gen_out'}

# rated IO
$xrecord{$var::h_adm_acc_view{'in'}} = makeRatedLoad((libAccount::getIn(1,$xacc,\%database))[0],(libAccount::getIn(1,$xacc,\%database))[2]);
$xrecord{$var::h_adm_acc_view{'out'}} =makeRatedLoad((libAccount::getOut(1,$xacc,\%database))[0],(libAccount::getOut(1,$xacc,\%database))[2]);

$xrecord{$var::h_adm_acc_view{'suspend'}} = (split(/\|/,$database{$xacc}))[$var::record{'suspend'}]?"checked":"";
$xrecord{$var::h_adm_acc_view{'lock'}} =(split(/\|/,$database{$xacc}))[$var::record{'lock'}]?"checked":""; 
$xrecord{$var::h_adm_acc_view{'freeze'}} = (split(/\|/,$database{$xacc}))[$var::record{'freeze'}]?"checked":"";
$xrecord{$var::h_adm_acc_view{'new'}} = (((split(/\|/,$database{$xacc}))[$var::record{'new'}] & 1) == 1)?"checked":"";
$xrecord{$var::h_adm_acc_view{'modif'}} = (((split(/\|/,$database{$xacc}))[$var::record{'modif'}] & 2) ==2)?"checked":"";

# not RATED IO
$xrecord{$var::h_adm_acc_view{'total_in_real'}} =  (split(/\|/,$stat{$xacc}))[$var::stat{'total_in'}];
if (!$xrecord{$var::h_adm_acc_view{'total_in_real'}}) {$xrecord{$var::h_adm_acc_view{'total_in_real'}} = 0}
$xrecord{$var::h_adm_acc_view{'total_out_real'}} = (split(/\|/,$stat{$xacc}))[$var::stat{'total_out'}];
if (!$xrecord{$var::h_adm_acc_view{'total_out_real'}}) {$xrecord{$var::h_adm_acc_view{'total_out_real'}} = 0}

my ($in) =  $xrecord{$var::h_adm_acc_view{'total_in_real'}};
my ($out) =  $xrecord{$var::h_adm_acc_view{'total_out_real'}};
if ($in > $out) {
  $xrecord{$var::h_adm_acc_view{'ratio_io'}} = ($in == 0 || $out == 0)? "$in:$out": int( $in / $out).":1";
}
else {
  $xrecord{$var::h_adm_acc_view{'ratio_io'}} = ($in == 0 || $out == 0)? "$in:$out": "1:".int( $out / $in);
}

#$h_adm_acc_view{'ratio_io'} = "#%RATIO_IO%#";
#$h_adm_acc_view{'ratio_io_hour'} = "#%RATIO_IO_HOUR%#";
#$xrecord{$var::h_adm_acc_view{'ratio_io_hour'}} =  unpack("I",(split(/\|/,$stat{$xacc}))[$var::stat{total_in}]) / unpack("I",(split(/\|/,$stat{$xacc}))[$var::stat{total_out}]);



libFile::closeDBM(\%database);
libFile::closeDBM(\%stat);
my $temp;
#my ($XXX) = libFile::openFile_ex("> xxx.xxx",0);

for (my $i=0;$i<(scalar(@copy));$i++) {
  $temp = $copy[$i];
  $temp =~s/%#FORM_NAME#%/$fName/e;
  $temp =~ s/(#%[^%]*%#)/$xrecord{$1}/gsie;
  $copy[$i] = $temp;
}
return @copy;
}



sub substPlusWithPause{
my ($param) = shift;
my ($key,$value);

while (($key,$value) =  (each %$param)) {
    $value =~ s/\+/" "/eg;
    $$param{$key} = $value;
  }
}



sub substPlusWithPauseKey{
my ($param) = shift;
my ($key,$value);

while (($key,$value) =  (each %$param)) {
    delete $$param{$key};
    $key =~ s/\+/" "/ge;
    $$param{$key} = $value;
  }
}




sub convertHexaToCharKey {
my ($param) = shift;
my ($key,$value);
while (($key,$value) =  (each %$param)) {
    delete $$param{$key};
    $key =~ s/%([\dA-Fa-f][\dA-Fa-f])/pack ("C",hex ($1))/eg;
    $$param{$key} = $value;
  }
}


sub convertHexaToChar {
my ($param) = shift;
my ($key,$value);
while (($key,$value) =  (each %$param)) {
    $value =~ s/%([\dA-Fa-f][\dA-Fa-f])/pack ("C",hex ($1))/eg;
    $$param{$key} = $value;
  }
}
#%EOF%#
#%File: ./libbackup.cgi%#
#--------------------------------------------------------------
#  ##%TL_NAME%## ##%TL_VER%##				      
#--------------------------------------------------------------
#                    DO NOT EDIT THIS FILE                    
#--------------------------------------------------------------

package libBackup;

use vars;
require "./data/config.dat";
require "./data/var.dat";
require "./libfile.cgi";
require "./liblog.cgi";

1;
$| = 1;

#-----------------------------------------
# Backups data
# info: backups directories defined in @var::backup
# input: --
# output: status
#-----------------------------------------
sub backup {
my ($type) = shift;
my (@result);
($type eq 'LOG') && do { $type = 2; $outDir[2]=  "\$config::logDir"};
($type eq 'DATA') && do { $type = 0; $outDir[0]=  "\$config::dataDir"};
($type eq 'TEMPL') && do { $type = 1; $outDir[1]=  "\$config::templDir"};

libLog::logAction("Backup type:$type");

my ($FH,$FHx);
my ($dir) = $var::backup[$type];
$FH = libFile::openFile_ex("$config::backup/$var::backup{$dir}","RDWR|CREAT");
  if ($FH == 3) {
    lib5::error_message($config::lang,1007);
  }
  foreach my $file (<$dir/*>) {
    if (-d $file)   {next;}
    if (($FHx = libFile::openFile_ex("$file","RDWR")) == 3) {
#      lib5::error_message($config::lang,1007);
    push(@result,$file." ... <font color=\"#EE5500\">ERROR OPEN</font>");    
     
    }
    else {
    push(@result,$file." ... OK");    
      $file =~ /\/([A-Za-z0-9_]*\.[A-Za-z0-9_]*)$/;
#      libLog::logAction("file: $file .. frag: $1");      
      print $FH ("__FILE:$outDir[$type]/$1\n");
      while(<$FHx>){
        print $FH ($_);
      }
      print $FH ("__END\n");
    }  # else
  }# 2. for

libFile::closeFile($FH);
return @result;
}


#-----------------------------------------
# Backups data
# info: backups directories defined in @var::backup
# input: --
# output: status
#-----------------------------------------
sub checkSum {
my ($ch1) =shift;
my ($ch2) =shift;
my ($data) =shift;
my ($length) = length $data;
$$ch1 += length $data;
$length++;
while (--$length) {
$$ch2 +=  ord (substr($data,$length-1,1));
}


}






sub restore {
my ($type) = shift;
my (@result);
($type eq 'LOG') && do { $type = 2; $outDir[2]=  "\$config::logDir"};
($type eq 'DATA') && do { $type = 0; $outDir[0]=  "\$config::dataDir"};
($type eq 'TEMPL') && do { $type = 1; $outDir[1]=  "\$config::templDir"};


my ($FH,$FHx,$stat);
my $ffile;
if (($FH = libFile::openFile_ex("$config::backup/$var::backup{$var::backup[$type]}","RDWR")) == 3) {
    push(@result,"Backup file $config::backup/$var::backup{$var::backup[$type]} doesn't exist !!");    
    return @result;
}
$stat = 0;
my ($skip) = 0;
foreach (<$FH>) {
  (/^__FILE:\$(config::[A-Za-z0-9_]*)(.*)/) && do {
    #  $ffile = $1;  eval {$ffile};
    
      if (($FHx = libFile::openFile_ex("${$1}$2","RDWR|CREAT|TRUNC")) != 3) {
        push(@result, "${$1}$2 ... OK");
	$skip = 0;
      }
      else {
        push(@result, "${$1}$2 ... <font color=\"#EE5500\">ERROR CREATE</font>");
	$skip = 1;
      }
  next;
  };
  (/__END/) && do {
    s/__END//;
    chomp;
    print $FHx ($_);  
    libFile::closeFile($FHx);  
    chmod(0666,$ffile);
	$skip = 1;    
    next;
  };

  if (! $skip) {
    print $FHx ($_);
  }

}
libFile::closeFile($FH);
return @result;
}


sub importAR {
my ($FH);
local ($FHt);
my ($result);
my ($status) = -1;
my (@url) = ($config::restrictedUrls,$config::restrictedWords);
my ($type) = 0;
my ($jData);
my ($found) = 0;my ($accCount) = 0;
my ($acc);
my ($accDetail);
if (($FH = libFile::openFile_ex($config::autorankData,"RDWR")) != 3) {
  libLog::logAction("import has started");
OUTR: {  
  foreach my $data (<$FH>) {
    # getting to next file, reset index and close file
    
    # this will end up Black Word/URL
    ($data =~/Database:.*/)&&($status != -1) && do {
      eval {
        if ($jData ne "") {
          if (($FHt = libFile::openFile_ex($url[$type],"RDWR|CREAT|TRUNC")) != 3) {
	    $jData =~ s/^\n//;
            print $FHt ("$jData");
	    libFile::closeFile($FHt);
          }	  
        else {
          $result .= "Error open/creat $url[$type]";
        }
	  
       }
        $found = 0;$type = 0;$status = 0;$jData="";
      };
    };
    
    # process Banned words update
    (($data =~/Database:.*$var::arBannedUrl/) || ($data =~/Database:.*$var::arBannedWord/) || ($status == 1)) && do {
      if ($status!=1) {
        $status=1;
	$type = (($data =~/Database:.*$var::arBannedWord/)?1:0);
	$result.="<br>Opening section ".(($type)?"Banned Word":"Banned Url&Email")."<br>\n";
        if (($FHt = libFile::openFile_ex($url[$type],"RDWR|CREAT|APPEND")) == 3) {
          $result.="Error open/creat $config::restrictedUrls for RW<BR>\n";
	  $status =0;
	}
	else {
	  $jData = join("",(<$FHt>));
	  libFile::closeFile($FHt);
	}
	next;
      }
      else{
         # check, if already exists
	 chomp $data;
          $result.="Reading $data ... OK<BR>\n";		 	 
         if (!($jData =~ /$data/)) {
          $result.="Writing $data ... OK<BR>\n";		 
	   $jData .= "\n".$data;
	 }
	 else {
          $result.="Writing $data ... Skip, already exists<BR>\n";		 
	 }
      }
    };

    (($data =~/Database:.*(members\/([^\.]*)\.cnt)/) || $status==4 ) && do {    

      if ($status !=4) {
        $acc = $2;
	$status = 4;
      }
      else {
        if (! libAccount::importRecord(1,$acc,$data) ) {
          $result.="Account $acc ... Stat Skip, already exists<BR>\n";		 	
        }else {
	  $accCount++;
	  $result.="$accCount. Account $acc ... Stat Added<BR>\n";
	}
      
       $status = -1;
      }
      #$1 - members/xxxx.dat
      #$2 - member name xxxx
    # there will continue data update process
    };
    
    
    
    
    
    (($data =~/Database:.*(members\/([^\.]*)\.dat)/) || $status==3 ) && do {
      if ($status !=3) {
        $acc = $2;
	$status = 3;
      }
      else {
        #now, in $acc is account name, in $data are joined acc's data
        if (! libAccount::importRecord(0,$acc,$data) ) {
          $result.="Account $acc ... Detail Skip, already exists<BR>\n";		 	
        }else {
	  $accCount++;
	  $result.="$accCount. Account $acc ...Detail Added<BR>\n";
	}
        $status = -1;
      }
      #$1 - members/xxxx.dat
      #$2 - member name xxxx
    # there will continue data update process
    };
  } # while
  };#OUTR
}# if file
else {
  $result= "Error open file: $config::autorankData for RW";
}
return $result;
}

sub packTL {
my $FH;
my $FHx;
my @result;
my (@excluded) = ("$config::cgi_path/install.dat","$config::cgi_path/install.cgi","$config::cgi_path/install.log","$config::cgi_path/backup/install.dat" );
if (($FH = libFile::openFile_ex($config::pack,"RDWR|CREAT|TRUNC")) == 3) {
  push(@result,"Error create $config::pack");
  return @result;
#    lib5::error_message($config::lang,1007);
}
print $FH ("$config::version\n");
# Inherit interpreter
my $buff;
my @dirs;

# add also cur. dir

# must be .. because cur dir is ./admin/
push(@dirs,"$config::cgi_path");
# stores root, and two levels up
foreach my $dir (@dirs) {
  pushDirs($dir,\@dirs);
}

# ----------------------------------------------
#	Add scrip and data files to nistall.cgi
# ----------------------------------------------
my ($markN) = 0;
libLog::logAction("Begin backup");
MAIN: {
#last MAIN;
my ($checksum1,$checksum2) =(0,0);
foreach $dir (@dirs) {
  print $FH "#%Dir: $dir%#\n";
  libLog::logAction("Dir: $dir");
 while (<$dir/*>) {  
  libLog::logAction("File: $_"); 
   (-e) && (!(-d)) && (!isExcluded($_)) && do {
     print $FH "#%File: $_%#\n";
          checkSum(\$checksum1,\$checksum2,"#%File: $_%#");
     if (open($FHx,$_)) {
       push(@result,"$_ ... OK");
       while (<$FHx>) {
         (!(/^#!/)) && do { 
           s/$config::cgi_path/"."/ie;
         checkSum(\$checksum1,\$checksum2,"$_");	   	   
	   print $FH ($_);
	 };
       }
     checkSum(\$checksum1,\$checksum2,"\#\%EOF\%\#");                     
       print $FH ("\#\%EOF\%\#\n");     

       close($FHx);
     } else {  push(@result,"$_ ... <font color=\"#EE5500\">ERROR CREATE</font>");} 
   }; 
 }  
}



close($FH);
chmod (0777,$install);
}

return @result;
}


# ------------------------------------------------------------
#	Pushes subdirs of dir "PATH" into ref. to array
# ------------------------------------------------------------

sub pushDirs {
my ($path) = shift;
# ref. to array
my ($data) = shift;

while (<$path/*>) {
  (-d) && do{push(@$data,$_);};
}

}


sub isExcluded {
my ($file) = shift;
foreach my $filed (@var::packExclude) {
  if ($file eq $filed) {return 1 ;}
}
return 0;
}#%EOF%#
#%File: ./libcron.cgi%#
#--------------------------------------------------------------
#  ##%TL_NAME%## ##%TL_VER%##				      
#--------------------------------------------------------------
#                    DO NOT EDIT THIS FILE                    
#--------------------------------------------------------------

package libCron;

use vars;
1;
$| = 1;

require "./data/config.dat";
require "./data/var.dat";
require "./libfile.cgi";
require "./liblog.cgi";



sub putTab {
my ($crontab) = shift;
if (open(CRON,"| $config::cronTabPath ``-''")) {

#  foreach (@$crontab) {
    print CRON ($crontab);
 # }
  close(CRON);
  return 1;
} else {
  return 0;
}
}
# ------------------------------
# Sends data to crontab
# 
#
# ------------------------------
sub sendTab {
my ($crontab) = shift;
my ($sameName) = shift;
$sameName =~ s/(\W)/"\\$1"/gise;
my ($sameB) = "Begin__$sameName";
my ($sameE) = "End____$sameName";
if ($sameName eq "") {$sameName = "xsfjkolkjbgvf";}
deleteTab();
my (@oldData) = getTab();
my ($FCRON) = libFile::openFile_ex("$config::cronOut","RDWR|CREAT");
if (open(CRON,"| $config::cronTabPath ``-''")) {
  my ($status) = 0;
#  libLog::logAction("------ cron data old: @oldData");
  foreach (@oldData) {
    # skit comment
    (/^#[^#]/) && do {next};
#    libLog::logAction("------> Begin__$sameName");
    (/$sameB/) && do {$status++;     next;};
    (/$sameE/) && do {$status=0; next;};  
    if ($status) {next;}
  
    print CRON ($_);
#    libLog::logAction("------- cron data old printed: $_");    
  }

  foreach my $data (@$crontab) {
    print CRON ($data);
    print $FCRON ($data);    
#    libLog::logAction("------- new DATA: $data");
  }
  
  close(CRON);
  close($FCRON);  
  return 1;
} else {
  return 0;
}

}

# ------------------------------
# Gets data to crontab
# 
#
# ------------------------------
sub getTab {
my @data;
my @data1;
@data  = `$config::cronTabPath -l`;
foreach (@data) {
 if (/^#[^#]+/) {next; }
 push(@data1,$_);
}
return @data1;
}



# ------------------------------
# Removes data to crontab
# 
#
# ------------------------------
sub deleteTab {
my (@data);
my ($status) = 0;
my (@newData);
@data  = getTab();
my ($data) = join("",@data);
my ($bID) = $var::cronTabBeginID;
my ($eID) = $var::cronTabEndID;
$bID =~ s/(\W)/"\\$1"/gise;
$eID =~ s/(\W)/"\\$1"/gise;

libLog::logAction("-------Before-------- $data");
#$data =~ s/#[^#]+\w+//gise;
$data =~ s/$bID[^#]*$eID\n//gise;
libLog::logAction("-------After-------- $data");
# foreach my $line (@data) {
 # if ($line =~/$var::cronTabBeginID/) {$status = 1;next;}
  #if ($line =~/$var::cronTabEndID/) {$status = 0;next;}
#  if ($line =~ /^#[^#]/) {next;}  
#  if (!$status) {
#    push(@newData,$line);
 # }
#}
if (!(length $data)) {
#if (!(scalar @newData)) {
libLog::logAction("Data removed");
  `$config::cronTabPath -r`;
}
else {
  putTab($data);
}
return 1;
}



#%EOF%#
#%File: ./liberror.cgi%#
#--------------------------------------------------------------
#  ##%TL_NAME%## ##%TL_VER%##				      
#--------------------------------------------------------------
#                    DO NOT EDIT THIS FILE                    
#--------------------------------------------------------------

package libError;
use vars;

1;
$| = 1;
require "./data/config.dat";
require "./data/var.dat";

#-----------------------------------------------------------------
#  Logs an error
#  Input: 1, error description
#         
#  Output: to log_file
#  !!! Don't use libFile::openFile, if error in openFile then cyrcle
#-----------------------------------------------------------------


sub logError {
 my ($descr) = shift;   #error description
 my ($file) = shift;   #file with error....
 local *HANDLE;
 if ((stat($config::log_error_file))[7] > $var::log_limit ) {
   open(HANDLE,"> $config::log_error_file");
   print HANDLE ("File too long, deleted\n");   
 }  
 else  {
   open(HANDLE,">> $config::log_error_file");
 }
 my ($now);
 $now = localtime();
 print HANDLE ("  $descr ",  "IN: $file","$now","\n");
 close(HANDLE) ;
}#%EOF%#
#%File: ./libfile.cgi%#
#--------------------------------------------------------------
#  ##%TL_NAME%## ##%TL_VER%##				      
#--------------------------------------------------------------
#                    DO NOT EDIT THIS FILE                    
#--------------------------------------------------------------

package libFile;
use vars;

use GDBM_File;
# from flock and sysopen
use Fcntl;
1;

local ($opened) = 0;

require "./liberror.cgi";
require "./liblog.cgi";
require "./data/config.dat";

sub getTemplName{
 my ($fn) = shift;
 
 if ((-e $fn) || (-e $fn,($fn=~s|/([A-Za-z0-9_.]*)$|/$config::def_templ/$1|))) {
    return $fn; }
} 

#-----------------------------------------------------------------
#
# Opens template and returns handle i's handle
# /determinates if user def. template exists or
# only defaults. Priority has user. def of course/
# Input: filename
# Output: handle
#
#-----------------------------------------------------------------

sub openTempl {
#  Opens the file $file_name
 my ($fn) = shift;
 
 local *FH;

 
 if ((-e $fn) || (-e $fn,($fn=~s|/([A-Za-z0-9_.]*)$|/$config::def_templ/$1|))) {
 libLog::logAction("open template: $fh");
   if (open(FH,$fn)) { return *FH; } else {   
                               return 3; 
		               # if file doesn;t exist or no permissions
                                     }
 }
 else {  
   libLog::logAction("open template [error]: $fh"); 
   return 3;
 }
} 





#-----------------------------------------------------------------
#
# Copy file and set 
# Input: filename
# Output: 0,1,2
# 1-exist only def, 2-exist both /user d. and def./, 0-none
#-----------------------------------------------------------------

sub copyFile {
my ($source) = shift;
my ($dest) = shift;
my ($mode) = shift;
my ($FHS) = openFile_ex($source,"RDWR");
my ($FHD) = openFile_ex($dest,"RDWR|CREAT");
foreach (<$FHS>) {   print $FHD ($_);}
closeFile($FHS);closeFile($FHD);
if ($mode) {chmod($mode,$dest);}
}


sub copyFileX {
my ($source) = shift;
my ($dest) = shift;
my ($mode) = shift;
my ($FHS) = openFile_ex($source,"RDWR");
my ($FHD) = openFile_ex($dest,"RDWR|CREAT");
if ( ($FHS !=3) && ($FHD !=3) ) {
  foreach (<$FHS>) {
    if (/ANTISTOLLER/) {next;}
    print $FHD ($_);
  }
  closeFile($FHS);closeFile($FHD);
  if ($mode) {chmod($mode,$dest);}
  return 1;
}
else {
  return 0;
}
}






#-----------------------------------------------------------------
#
# Checks if user. def. value exists, def or  none
# Input: filename
# Output: 0,1,2
# 1-exist only def, 2-exist both /user d. and def./, 0-none
#-----------------------------------------------------------------

sub checkTempl {
 my ($fn) = shift;
 my ($result) = 0;
 
 if (-e $fn) {
   $result = 1;
 }
 elsif (-e $fn,($fn=~s|/([A-Za-z0-9_.]*)$|/$config::def_templ/$1|)) {
   $result = 2;
 }

return $result;
}

#-----------------------------------------------------------------
#
# Closes file identified by handle
# Input: Handle to file
# Output: ----
#
#-----------------------------------------------------------------

sub closeFile {
 $fh = shift;
# flock($fh,LOCK_UN  | LOCK_NB);
 if (!close($fh)) {
 libError::logError("Close File: $!",$0);}
}



#-----------------------------------------------------------------
#
# Opens file
# Input: Filename as string, type of lock
#                            1-Share 2-Exclusive
# Output: handle to file
#
#-----------------------------------------------------------------

# new form
# filename, O_RDWR,O_CREAT,O_APPEND,....;
# 

sub openFile {
#  Opens the file $file_name
%fflag = (
'RDWR' => O_RDWR,
'CREAT' => O_CREAT,
'APPEND' => O_APPEND
);


 my ($file_name) = shift;
 my ($params) = shift;
 my (@p) = split (/\|/,$params);
 $params = 0;
 foreach (@p) {
   $params |=   $fflag{$_};
 }
 if (  (($params & O_CREAT)==O_CREAT)  && (($params & O_APPEND)!=O_APPEND)  ) {$params |= O_TRUNC;}
 
 local *FH;
 my ($str);
 my ($counter) = 0;
 umask 0;
 if (sysopen(FH,$file_name,$params,0666)) {
       return *FH;
 }
 else
 { #libError::logError("libFile::openFile /$file_name/ $!",$0);
   return 0;
 }

}  





#-----------------------------------------------------------------
#
# Opens file
# Input: Filename as string, type of lock
#                            1-Share 2-Exclusive
# Output: handle to file
#
#-----------------------------------------------------------------

sub openFile_ex {
#  Opens the file $file_name
%fflag = (
'RDWR' => O_RDWR,
'CREAT' => O_CREAT,
'APPEND' => O_APPEND
);

 my ($file_name) = shift;
 
 # 1 - Share;
 # 2 - Exclusive;
 my ($params) = shift;
 my (@p) = split (/\|/,$params); 
 $params = 0;

 foreach (@p) {
   $params |=   $fflag{$_};
 }
 if ( (($params & O_CREAT)==O_CREAT)  && (($params & O_APPEND)!=O_APPEND)  ) {$params |= O_TRUNC;}


 local *FH;
 my ($counter) = 0;
 umask 0;
 if (sysopen(FH,$file_name,$params,0666)) {
   return *FH;
 }
 else
 {
   #libError::logError("libFile::openFile /$file_name/ $!",$0);
   return 3; # if file doesn;t exist or no permissions
 }

}  





#-----------------------------------------------------------------
#
# Opens DBM file as DB Hash
# Input: Reference to hash, filename
# Output: true/false
#
#-----------------------------------------------------------------

sub openDBM {
# params ...(hash_reference,file_name);
# waits $var::delay secs and then breaks loop
my ($hash_handle) = shift;
my ($file_name) = shift;
# 0-read
# 1-write
umask 0;
my ($type) = shift;
$type = (defined $type)?$type:0;
if (! -e $file_name) {
  tie(%$hash_handle,'GDBM_File',$file_name,RDWR|O_CREAT,0666);
  untie %$hash_handle;
}
#if (!tie(%$hash_handle,'GDBM_File',$file_name,GDBM_WRITER,0666)) {
  # database doesn't exist
  tie(%$hash_handle,'GDBM_File',$file_name,$type,0666);# || do { lib5::error_message($config::lang,1004);};
  $opened++;
#  libLog::logAction("Opened:$opened \n New:$file_name as $type");
#dbmopen(%$hash_handle,$file_name,0666);
#}  
return 1;
}

#-----------------------------------------------------------------
#
# Closes DBM file
# Input:  HASH
# Output: ----
#
#-----------------------------------------------------------------

sub closeDBM {
# closes file FILE
my ($hash_handle) = shift;
#dbmclose(%hash_handle);
untie(%$hash_handle);
$opened--;
}


#-----------------------------------------------------------------
#
# Gets name of temp TP file paged as xxx
# Input:  page number
# Output: ----
#
#-----------------------------------------------------------------

sub getTLTempFileName {
my ($index) = shift;
return "$config::html_toplist_tmp_dir/$config::index{$index}->[0]_t";
}

#-----------------------------------------------------------------
#
# Gets name of TP file paged as xxx
# Input:  page number
# Output: ----
#
#-----------------------------------------------------------------


sub getTLFileName {
my ($index) = shift;
return "$config::document_root/$config::index{$index}->[0]";
}#%EOF%#
#%File: ./libgenlist.cgi%#
#--------------------------------------------------------------
#  ##%TL_NAME%## ##%TL_VER%##				      
#--------------------------------------------------------------
#                    DO NOT EDIT THIS FILE                    
#--------------------------------------------------------------

package libGenList;

use vars;

require "./libfile.cgi";
require "./libstat.cgi";
require "./libaccount.cgi";
require "./liblog.cgi";
require "./data/config.dat";
require "./data/var.dat";

$|= 1;


#print "$var::fwdPref\n";

sub getPref {
my ($rank) = shift;
  return int((1/( (($rank-$var::fwdPref)**2)/(0.2*($var::fwdTo-$var::fwdFrom)) + 1 ))*10);
}



sub cacheTopX {
my ($order)  = shift;
my ($rank) = 0;
my ($from,$to) = ($var::fwdFrom,$var::fwdTo);

if (! scalar @$order) {return;}

if ($from > scalar @$order) {$from = scalar @$order;}
if ($to > scalar @$order) {$to = scalar @$order;}

  $FH = libFile::openFile("$config::topXFwdCache","RDWR|TRUNC|CREAT");
  foreach  (@$order[$from-1..$to-1]) {
    if ($_ eq "") {next;}
    for ($i = 1,$rank++;$i <= getPref($rank);$i++) {
      print $FH ("$_\n");
    }
  }


  libFile::closeFile($FH);
}


sub getLowerLimit {
  return $var::gen_startMinInList;
}

sub getUpperLimit {
  return $var::listLimit;
}


sub genRank {
my ($res) = shift;
my ($hash) = shift;
my $diff;
#my ($accCount) = getLowerLimit();

# from accs per indexes but guarded by $var::listLimit
my ($accCount) = getTotalAccs();
  # Sorted by IN
  @$res = libList::sortAccByIn($hash,$config::in_hit_min_limit);
  # Enter if not enought accs
  libLog::logAction(scalar (@$res)."count ... $var::listLowerLimit");
  if ((scalar (@$res)) < $var::listLowerLimit)  {
    libLog::logAction("not enough");
      # If set "LAST TOP", use it
      if ($var::gen_useLast) { 
          libLog::logAction("use last");
        # opens temo files with xxx first from prev. generation
	my $FHANDLE;
	if ( ($FHANDLE = libFile::openFile("$config::last_best_accounts","RDWR")) != 3) {
	  my ($counter) = 0;
	  my ($protection) = 100000;
	  $diff = $var::listLowerLimit - (scalar (@$res)) ;
LOOP_EXT:{	  
LOOP_FILEW:  while (<$FHANDLE>) {
	       chomp;
	       my ($account_x) = $_;
	       foreach my $item (@$res) {
	         chomp($item);
	         #!libAccount::isAccount($account_x) -> check if acc is still account
	         if ($account_x eq $item) {
		   next LOOP_FILEW;
		 }
	       }
	      if (  (!libAccount::isSuspended($account_x,$hash)) && (libAccount::isAccount($account_x,$hash)) ) {
	        push(@$res,$account_x);
              }
	      if (!--$diff) {last LOOP_EXT;}
	      if (! --$protection) { 	       last LOOP_EXT;}
	    } #while (<$FHANDLE>)
	 }
	  
	  libFile::closeFile($FHANDLE);
	}
      }
      # IF RANDOM CHOOSED DO IT.
      
      # ALSO IF NON RANDOM METHOD FAILD /to few account saved by reset,.../
      # USE ALSO RANDOM METHOD
      # if forced to use random and still lower then min limit or if still 0 for list
#                      libLog::logAction("before use random");
      if (($var::gen_useRandom && $diff )|| !(scalar (@$res))) {
#                libLog::logAction("in use random");
        # yea, use some random loosers
	my (@accs) = keys %$hash; # stores accounts
	my ($rand,@last);
	my ($wrong)=0;
	my ($randoms) = 0;
	# difference between wanted start statue and reality
	my($diff) = $var::listLowerLimit - (scalar (@$res));
#        libLog::logAction("accs".(scalar(@accs))." in res:".(scalar(@$res))." diff:$diff" );
	#if there is less accounts in database then needed by $diff
	if (($diff + scalar(@$res)) > scalar(@accs)) { $diff = scalar(@accs) - scalar(@$res)}
#	            libLog::logAction("deif in random $diff");
	my ($accsC) = scalar @accs;
	my ($unsucc) = 0;
	my ($protection);	
LOOP_DIFF: {	
LOOP_WHILE:while ($diff) {   # still need another one to list
#	            libLog::logAction("in while in random");
            # protection 
  	    if (++$unsucc> $accsC) {	    last LOOP_DIFF;}
	    # seed another random number
	    # random >= 0 and < then ...
	    $rand = int (rand(scalar(@accs)));
	    $wrong = 0;
	    # checks if new random is unique
	    for (my $index = 0;$index < $randoms;$index++) {
	      if ($last[$index] == $rand) {next LOOP_WHILE;}  # checks for duplicity
	    }
	  
  	    # new random generated
            $last[$randoms++] = $rand;             # stores last random number
	  
	    # check for duplicity random and already choosen
	    foreach my $item (@$res) {
	      if ($item eq $accs[$rand]) {next LOOP_WHILE;}
	    }
	    
	    # check if is suspended
            if (!libAccount::isSuspended($accs[$rand])) {
	      $unsucc = 0;
              push(@$res,$accs[$rand]);		 # and pushes it into the array @res
              $diff--;				 # counts down difference
	    }
      } #------------- while ($diff) ....
      	
    }
  } # maybe start of random 
  
 } # if lower then should be /lowet then lower limit/
} # begin






#----------------------------------------------
# Return number of break acc. to specified index
# Input: index
# Output: number of breaks / index
#----------------------------------------------

sub getBreaks {
my ($index) = shift;
my ($maxAccs) = 0;
my $temp;
$temp= $config::index{$index};  # gets reference to array
return scalar @$temp - 2;
}


#----------------------------------------------
# Return break of specified index
# Input: index
# Output: number of breaks / index
#----------------------------------------------

sub getBreaksEx {
my ($index) = shift;
my $temp;
$temp= $config::index{$index};  # gets reference to array
return @$temp[2..scalar @$temp -1];
}




#----------------------------------------------
# Return name of index nr. x
# Input: index nr
# Output: name /string/
#----------------------------------------------

sub getIndexName {
my ($index) = shift;
return $config::index{$index}->[0];;
}



#----------------------------------------------
# Return number of accs that will be listed in all indexes
# Input: -
# Output: number of accs
#----------------------------------------------

sub getTotalAccs {
my ($indexCount) = getIndexCount();
my ($maxAccs) = 0;
for (my ($i) = 1;$i<= $indexCount;$i++) {
  $maxAccs += $config::index{$i}->[1];  # gets accs per index
}
#  gets total accs to be listed in all indexes
return (($var::listLimit < $maxAccs)?$var::listLimit:$maxAccs);
}

#----------------------------------------------
# Return number of indexes that will be created
# Input: -
# Output: number of indexes
#----------------------------------------------
sub getIndexCount {
  return scalar keys %config::index;
}



#----------------------------------------------
# Fills stat database with last rerank perion 	- real IN /acc
#						- real OUT /acc	    
# 					    	- productive IN /acc
# 
#----------------------------------------------

sub analyseIO {
my $FH;
my(@ret) = setValid();  
}
# |----------------------------------------------
# | Update Accounts's - hits
# | Called in genList.CGI
# |-----------------------------------------------

sub updateHits {
#  libStat::logRerankStat();
  analyseIO();
#  giveInHits();  
#  giveOutHits();
#  libStat::updateStatRef();  
#  libStat::IOStat('rin');
#  libStat::IOStat('rout');
#  libStat::IOStat('pin');

  return 1;
}

# |----------------------------------------------
# | Give Out Hits to ACCOUNTs
# | 
# |-----------------------------------------------
sub giveOutHits {
my (%statData,%accData);
libFile::openDBM(\%statData,$config::stat_database,1);
libFile::openDBM(\%accData,$config::account_database,1);
 
foreach my $acc (keys %statData) {
  my @dataAcc;
  my @dataStat;
  if (defined $accData{$acc}) {
    @dataAcc = split(/\|/,$accData{$acc});
    @dataStat = split(/\|/,$statData{$acc});
    my ($test1654)  =unpack("I",$dataStat[$var::stat{'last_rerank_rout'}]);
    $dataAcc[$var::record{'out'}] += unpack("I",$dataStat[$var::stat{'last_rerank_rout'}]);
    $accData{$acc} =join("|",@dataAcc); 
  }    
}
libFile::closeDBM(\%statData);
libFile::closeDBM(\%accData);
}
# |----------------------------------------------
# | Give In Hits to ACCOUNTs
# | Applies Double-Click Check 
# | Applies some TRICKS against Cheaters
# |----------------------------------------------

sub giveInHits {
my (%statData,%accData);
libFile::openDBM(\%statData,$config::stat_database,1);
libFile::openDBM(\%accData,$config::account_database,1);
 
foreach my $acc (keys %statData) {
  my @dataAcc;
  my @dataStat;
  

  if (defined $accData{$acc}) {
    @dataAcc = split(/\|/,$accData{$acc});
    @dataStat = split(/\|/,$statData{$acc});
    my ($newHits) = unpack("I",$dataStat[$var::stat{'last_rerank_pin'}]);
    # set active if is inacitve and have new in hits
    if ($newHits && ($dataAcc[$var::record{'activity'}]<0)) {$dataAcc[$var::record{'activity'}] = 0;}
    $dataAcc[$var::record{'in'}] += $newHits;
    $accData{$acc} =join("|",@dataAcc); 
  }    
}
libFile::closeDBM(\%statData);
libFile::closeDBM(\%accData);

}
# |----------------------------------------------
# |
# | Removes Dbl-Clicks ...
# |
# | Input - Reference to Hash(it points to ARRAY)
# | Output - The same, without double-clicks
# |----------------------------------------------
sub removeDblClks {
# my ($data) = shift;
# Double-Click is out-of-problem ...
# log.in, log.out osetruje tento problem 

}

# |----------------------------------------------
# |
# | Creates TEMP.LOG file with valid in/out records
# |
# |----------------------------------------------
sub setValid {
 my ($in_) = $config::log_in_file;
 my ($out_) =$config::log_out_file;
 
 my ($id_in,$id_out);
 my ($in_line,$out_line);
 my ($IN,$OUT,$TEMP);
 my ($timeB,$timeE);
 my ($counter)=0;
 my ($maxIn) = $var::inPerPartes; 
 my (%DBStat,%DBAcc);
 my (@itemsCount) = (0,0,0,0,0,0);
 # Make timestamp BEGIN
 $timeB = time;
 # open account + statistic database
 libFile::openDBM(\%DBStat,$config::stat_database,1);
 libFile::openDBM(\%DBAcc,$config::account_database,1);
 # reset statistic !! check !!
 # if exist IN & OUT do
   libLog::logAction("Before VALIDATE");
 if  (($OUT = libFile::openFile($out_,"RDWR"))  &&  ($IN = libFile::openFile($in_,"RDWR"))   ) {
   libLog::logAction("Entering VALIDATE");
   # hash instand of array -> hash offers keys uniformity
   my %outID;
   my @data;
   my @outID; 
   my %temp;
   my %tempPIN;
   my %tempNHBIN;
   my %counterBOT;   
   my %tempOUTPROD;
   my (@DXStat, @DXAcc);
   my ($xburn) = 0;
   
  # ---------------------------------------------------------------------------------------------#
  #	ANALYZE COUNTER.LOG									 #
  # ---------------------------------------------------------------------------------------------#   
  # record is set by banner.cgi : antihitbot							 #
  # $itemsCount[3] => sum of records in COUNET.LOG						 #
  # $counterBOT{$1} => unique ID
  # ---------------------------------------------------------------------------------------------#   		   	
  # out.log struct:  ID|ACC_TO|ACC_FROM|TIME							 #
  # ---------------------------------------------------------------------------------------------#   		   	
  
  my ($FHCounter);
  if (($FHCounter = libFile::openFile_ex($config::counterLog,"RDWR"))!=3) {
     my (@data);
     foreach (<$FHCounter>) {
     @data = split(/\|/,$_);
     #separate id's
       if (defined $data[0]) {      
         $counterBOT{$data[0]} = 1;
	 $itemsCount[$var::statTotal{'cin'}]++;
#         libLog::logAction("ACCOUNT: $data[0] ... CIN increased");
       }
     }
    libFile::closeFile($FHCounter);
  }
  
  # ---------------------------------------------------------------------------------------------#
  #	ANALYZE OUT.LOG										 #
  # ---------------------------------------------------------------------------------------------#   
  # get data from OUT:  total OUT /sum/ , total OUT /per_user/, hash of ID's + how m. OUT from ID#
  # $itemsCount[0] => sum of records in OUT.LOG						  	 #
  # %temp          => keys-ACCOUNT TO     values-HOW MANY OUTS/ACC				 #
  # %outID	    => keys-ID		   values-HOW MANY OUTS FROM SAME ID			 #
  # @data	    => record from out.log							 #
  # ---------------------------------------------------------------------------------------------#   		   	
  # out.log struct:  ID|ACC_TO|ACC_FROM|TIME							 #
  # ---------------------------------------------------------------------------------------------#   		   	
      
   foreach (<$OUT>) {
     @data = split(/\|/,$_);
     $itemsCount[$var::statTotal{'out'}]++;
     if ($data[$var::logOUT{'ACC_TO'}]) { $temp{$data[$var::logOUT{'ACC_TO'}]}++; }
     if ($data[$var::logOUT{'ACC_FROM'}]) {
       $tempOUTPROD{$data[$var::logOUT{'ACC_FROM'}]}++;
       $itemsCount[$var::statTotal{'gout'}]++
     }
     if ( $data[0]) {  $outID{$data[0]}++;        
#       libLog::logAction("OUT ACCOUNT: $data[0] ");
         }
   }     

  #--------------------
  # REAL OUT STAT
  #--------------------
  foreach my $acc (keys %temp) { 
#     libLog::logAction("acc:$acc bef isacc");
    if (! libAccount::isAccount($acc,\%DBAcc)) {next;}
#         libLog::logAction("acc:$acc after isacc");
    @DXStat = split(/\|/,$DBStat{$acc});
    @DXAcc = split(/\|/,$DBAcc{$acc});
    foreach my $index ( $var::stat{'t_rout'} ) {           $DXStat[$index] +=  $temp{$acc}; }
    foreach my $index ($var::stat{'last_rerank_rout'}  ) { $DXStat[$index] =   $temp{$acc} ; }    
    foreach my $index ($var::record{'out'} ) {             $DXAcc[$index] +=  $temp{$acc};   }
    $DBStat{$acc} = join ("|",@DXStat);
    $DBAcc{$acc} = join ("|",@DXAcc); 
  }

   # Make array of UNIQUE IDs  
   foreach (keys %outID) {
     push (@outID,$_);
   }
  

  # ---------------------------------------------------------------------------------------------#
  #	ANALYZE IN.LOG										 #
  # ---------------------------------------------------------------------------------------------#   
  # get data from IN:  total IN /sum/, total IN PROD /sum/ , total OUT /per_user/, 
  #                    total OUT PROD/per_user/, hash of ID's
  # $itemsCount[1] => sum of records in IN.LOG						  	 #
  # %temp          => keys-ACCOUNT FROM     values-HOW MANY INS/ACC				 #
  # %inData	    => keys-ID		    values-ACC FROM					 #
  # @data	    => record from out.log							 #
  # ---------------------------------------------------------------------------------------------#   		   	
  # out.log struct:  ID|ACC_TO|ACC_FROM|TIME							 #
  # ---------------------------------------------------------------------------------------------#   		   	
  
  
  
   undef %temp;
   my (%tempRIN);
   my (%inData);
   my @tempID;
   my ($counter) = 0;
   
   local *mill =sub {
   foreach (@outID) {
#     libLog::logAction("Out ID: >$_<");
#     libLog::logAction("inData: >$inData{$_}<");
     if (! defined) {next;}
     if (defined $inData{$_}) {
       $tempPIN{ $inData{$_}   }++;
#            libLog::logAction("TempPin INCREased : $inData{$_}");
       if ( defined $counterBOT{$_} ) {
         $tempNHBIN{ $inData{$_} }++;
#            libLog::logAction("NB");	 
	 
	 $itemsCount[$var::statTotal{'cpin'}]++;
#            libLog::logAction("cpin increrased");	 	 
       }
       $itemsCount[$var::statTotal{'pin'}]++;
#            libLog::logAction("pin increrased");	 	        
     } else {push (@tempID,$_);}
   }
   };

  foreach (<$IN>) {
    @data = split(/\|/,$_);
    $itemsCount[$var::statTotal{'rin'}]++;
    if ($data[$var::logIN{'ACC_FROM'}]) {  
#    libLog::logAction("IN acc = $data[$var::logIN{'ACC_FROM'}] ID: $data[$var::logIN{'ID'}] ");
      $tempRIN{$data[$var::logIN{'ACC_FROM'}]}++;}
    # if X means, that access from this ACC is restricted using COOKIES
    if (  ($data[0] eq "X") || (! defined $data[$var::logIN{'ACC_FROM'}]) || (! defined $data[$var::logIN{'ID'}])  ) {#libLog::logAction("Next:>$data[0]< | >$data[$var::logIN{'ACC_FROM'}]<  |  >$data[$var::logIN{'ID'}]<");
    next;}
    $inData{  $data[$var::logIN{'ID'}]  } = $data[$var::logIN{'ACC_FROM'}];
#    libLog::logAction("DATA".$data[$var::logIN{'ID'}]."inDAta :".$inData{$data[$var::logIN{'ID'}]});
    if (++$counter < $maxIn) {next;}
    # now inData is full of records from IN.LOG a could be processed    
    $counter = 0;
    mill();
    # new @outID without IDs that has already been associated
    @outID = @tempID;
    # erase @tempID data
    splice(@tempID,0);
    # erases inData
    %inData = ();
  } # foreach IN


  if ($counter < $maxIn) {
    mill();
  }




  # Add OUTs to DBaccount->out, DBStat->total_out, DBStat->last_rerank_rout
  foreach my $acc (keys %tempRIN) {
    if (! libAccount::isAccount($acc,\%DBAcc)) {next;}
    @DXStat = split(/\|/,$DBStat{$acc});
    foreach my $index ( $var::stat{'t_rin'} ) {
      $DXStat[$index] +=$tempRIN{$acc};
    }
    foreach my $index ($var::stat{'last_rerank_rin'}  ) {
      $DXStat[$index] =$tempRIN{$acc};
    }
    
    
    $DBStat{$acc} = join ("|",@DXStat);
  }
  
  # PROS|DUCTIVE IN ACTIVITY
  foreach my $acc (keys %tempPIN) {
    if (! libAccount::isAccount($acc,\%DBAcc)) {next;}
    @DXStat = split(/\|/,$DBStat{$acc});
    @DXAcc = split(/\|/,$DBAcc{$acc});
    
    foreach my $index ( $var::stat{'t_pin'} ) {
      $xburn  = $DXStat[$index];
      $DXStat[$index] +=  $tempPIN{$acc}   ;
      
      if (! defined  $DXStat[$var::stat{'t_pin'}]) {
      }	       
      
      if ( $tempPIN{$acc}  == $DXStat[$index]) {
	$xxtest = $DXStat[$index];
      }
    }

    foreach my $index ($var::stat{'last_rerank_pin'}  ) {
      $DXStat[$index] = (defined $tempPIN{$acc})?$tempPIN{$acc}:0;
    }


    foreach my $index ($var::stat{'gen_out'}  ) {
      $DXStat[$index] += (defined $tempOUTPROD{$acc})?$tempOUTPROD{$acc}:0;
    }


    # IN with COUNTER / user
    foreach my $index ( $var::stat{'nobotfilter_in'}  ) {
      $DXStat[$index] +=(defined $tempNHBIN{$acc})?$tempNHBIN{$acc} : 0;
    }


    foreach my $index ($var::record{'in'} ) {
      # If productive IN, unset inactivity
      if ($tempPIN{$acc} && ($DXAcc[$var::record{'activity'}]<0)) {$DXAcc[$var::record{'activity'}] = 0;}
      $DXAcc[$index] +=  $tempPIN{$acc};
      
    }
    $DBStat{$acc} = join ("|",@DXStat);
    $DBAcc{$acc} = join ("|",@DXAcc);    
  }

  libStat::totalSumStat(\@itemsCount);
  
  libFile::closeFile($OUT);
  libFile::closeFile($IN);
  libFile::closeDBM(\%DBStat);
  libFile::closeDBM(\%DBAcc);
  
   unlink $in_;
   unlink $out_;
   unlink $config::counterLog;
   $timeE = time;
   libLog::logAction("End of ANALYZE");
   libStat::totalSumStat(\@itemsCount);
   return ($timeE-$timeB,$incount,$outcount);
  }
  else {
    libStat::totalSumStat(\@itemsCount);
    return -1;
  }
}#%EOF%#
#%File: ./libgraph.pm%#
#--------------------------------------------------------------
#  ##%TL_NAME%## ##%TL_VER%##				      
#--------------------------------------------------------------
#                    DO NOT EDIT THIS FILE                    
#--------------------------------------------------------------

package TBmp;

$| = 1;

1;

sub new {
shift;
my ($bitmap) = shift;
my ($color) = shift;
my ($colors) = $color->getCount();
my ($width) = $bitmap->getWidth();
my ($height) = $bitmap->getHeight();
my ($bit, $offset) = (8,0);


$bmp = [];
bless $bmp , 'TBmp';


  my (@DATA,@newDATA);
  my ($i,$ii);
  my ($accOf) = 0;
  my ($compress) = 1;
if ($compress) {

  @DATA = @$bitmap;
  my ($line,$linepixel,$counter,$ref);
   @newDATA = ();
   for ($line = 0;$line < $height;$line++)   {
     for ($counter = 0,$ref = unpack("C",$DATA[$line*$width]),$linepixel = 0;$linepixel < $width;$linepixel++) {
       if ( ($ref == unpack("C",$DATA[$line*$width+$linepixel])) && ($counter < 255) ) {
         $counter++;
       }
       else {
         push(@newDATA,pack("C",$counter));push(@newDATA,pack("C",$ref));
	 $ref = unpack("C",$DATA[$line*$width+$linepixel]);
	 $counter = 1;
       }
     } # end of line
     push(@newDATA,pack("C",$counter));push(@newDATA,pack("C",$ref));
     push(@newDATA,pack("C",0)); push(@newDATA,pack("C",0));
   }# end of bitmap
     push(@newDATA,pack("C",0));push(@newDATA,pack("C",1));   
 
}
else {

  
  for ($ii=0;$ii < $height;$ii++) {
    for ($i = 0 ;$i<$width;$i++) {
      $DATA[$ii*$width + $i+$accOf] = $$bitmap[$ii*$width + $i];
#            $DATA[$ii*$width + $i+$accOf] = pack("c",1);
          }
    for($xx = 0;$xx < $offset;$xx++) {
      $DATA[$ii*$width + $i+$accOf+$xx] = pack("C",0);
    }
    $accOf +=$offset;
  }
  $DATA[$ii*$width + $i+$accOf] = pack("CC",0);
  @newDATA = @DATA;
}


  # this size: 40
#  print scalar @newDATA . "\n";
  $BITMAPINFOHEADER = [ pack("I",40),	#SIZE OF THIS STRUCT
                     pack("L",$width),		#WIDTH of picture
		     pack("L",$height),		#HEIGHT	of picture	    
		     pack("S",1),		#PLANES
		     pack("S",$bit),		#bitcount		    
		     pack("SS",$compress),		#compression
		     pack("SS",scalar @newDATA-2),		#img size, can be 0 if BI_RGB
		     pack("L",0),		#in meters
		     pack("L",0),		#in meters		    
		     pack("SS",$colors),		#Nr. of colors in RGB able
		     pack("SS",$colors)		#Importatnt color. of colors in RGB able
  ];
 
  # this size: 14
#    print (40+14+$colors*4+(scalar @newDATA)*$bit/8)."\n";
  my ($fsize)     = 40+14+$colors*4+(scalar @newDATA)*$bit/8;
  $BITMAPFILEHEADER = [ "BM",   		#ID
                       pack("SS",$fsize),	#Size of file
                       pack("SS",0),	#RESERVED 2* UINT
                       pack("SS",40+14+$colors*4)	#OFFSET from the begining of file
  ];
  #		       BLUE       GREEN       REd      RESERVED
  $RGBQUAD = $color;
  
  my ($dat) =  join("",@$BITMAPFILEHEADER);
  $dat .= join("",@$BITMAPINFOHEADER);
  $dat .= join("",@$RGBQUAD);
  $dat .= join("",@newDATA);  
  

#  open(FILE,">./test.bmp");
#  print FILE $dat;
#  close(FILE);
  
#  print "Content-type: image/bmp\n";  
  print "Pragma: no-cache\n";  
  print "Content-length: $fsize\n\n";
  print $dat;
}


package TBitmap;
$width = 0;$height = 0;
$curx= 1; $cury = 1;
$linetype = 1;
$curColor = 0;
$backg = 0;
$lwidth = 1;
$FH;

sub new {
shift;
my ($x) =shift;my ($y) =shift;my ($off) =shift;$backg = shift;
 $width = $x;
 $height = $y;
 $bitmap = [];
 my ($i);
 for ( $i = $width*$height-1;$i >= 0;$i--) {$$bitmap[$i]=pack("c",$backg); }
 bless $bitmap,'TBitmap';
 return $bitmap;
}


sub setSolid {
  $linetype = 1;
}


sub setLineWidth {
shift;
my ($lw) = shift;
  $lwidth = $lw;
}

sub setDot {
shift;
$dot = shift;
  $linetype = 1+$dot;
}




sub bar {
my ($bitmap) = shift;
my ($xStart) = shift;
my ($yTop) = shift;
my ($barWidth) = shift;

for (my ($ii) = 1; $ii < $yTop; $ii++) {
  for (my ($i) = $xStart; $i <= int($barWidth+$xStart) ; $i++) {
    $$bitmap[(int($ii))*$width+$i-1] = pack("c",$curColor);  
  }
}
#    $bitmap->bar( $off+int($xx),int($y)+$off    ,int($step/2) );
  

}



sub lineto {
my ($bitmap) = shift;
my ($x) = shift;
my ($y) = shift;
my ($color) = shift;

if ( ($x <= $width) && ($y <= $height)&&  ($x >= 1) && ($y >= 1)  ) {




if ($curx == $x) {
#    print "ZERO $curx,$x\n";
    
    for ($i = (($cury<$y)?$cury:$y);  $i  <=  (($cury>$y)?$cury:$y)  ;$i += $linetype       ){
      # y = k.i +y0
      $$bitmap[(int($i))*$width+$x-1] = pack("c",$curColor);
    } 
  

} 
else {
my ($k) = ($cury - $y)/($curx - $x);
  if (abs $k < 1) {
      my $y0  = (($curx<$x)?$cury:$y) - $k*(($curx<$x)?$curx:$x);   
    for ($i = (($curx<$x)?$curx:$x);  $i  <=  (($curx>$x)?$curx:$x)  ;$i += $linetype       ){
      # y = k.i +y0
      $$bitmap[(int($k*$i+$y0-1))*$width+$i-1] = pack("c",$curColor);
    } 
  }
  else {
    my $y0  = (($curx<$x)?$cury:$y) - $k*(($curx<$x)?$curx:$x);   
    for ($i = (($cury<$y)?$cury:$y);  $i  <=  (($cury>$y)?$cury:$y)  ;$i += $linetype       ){
       $$bitmap[ ($i-1)*$width + int(($i-$y0)/$k  ) - 1 ] = pack("c",$curColor);
    }
  }

}
$curx=  $x;
$cury=  $y;
} # if x,y is in borders width,height
}


sub getWidth  {
  return $width;
}

sub getHeight  {
  return $height;
}


sub setColor  {
shift;
my ($color) = shift;
 $curColor = $color;
}





sub moveto {
shift;
my ($tox) = shift;my($toy) = shift;
if (($tox <= $width) && ($toy <= $height)    &&  ($tox >= 1) && ($toy >= 1) ) {
  $curx = $tox;
  $cury = $toy;
}
}


sub drawBorder {
$this = shift;
my ($lt) = shift;
my ($col) = shift;
  $this->setDot($lt);
  $this->setColor($col);
  $this->moveto(1,1);
  $this->lineto($width,1);
  $this->lineto($width,$height);
  $this->lineto(1,$height);
  $this->lineto(1,1);
}


sub drawGrid {
$this = shift;
my ($res) = shift;
my ($lt) = shift;
my ($col) = shift;
my ($colHL) = shift;
$this->setDot($lt);
$this->setColor($col);
$this->moveto(1,1);
my ($xx) = 0;
my ($counter) = $res;
my ($step) = $width / $res;

while (  ($xx += $step) < $width  ) {
#  if ( ($xx > (($width/2)-$step/2)  ) && ($xx < (($width/2)+$step/2)  ))   {
#    $bitmap->setColor($colHL);
 # }
  #else {
    $bitmap->setColor($col);
  #}
  $bitmap->moveto(int($xx),1);
  $bitmap->lineto(int($xx),$height-2);
}
}



sub drawGridHoriz {
$this = shift;
my ($res) = shift;
my ($lt) = shift;
my ($col) = shift;
my ($colHL) = shift;
$this->setDot($lt);
$this->setColor($col);
my ($yy) = 0;
my ($counter) = $res;
my ($step) = $height / $res;

while (  ($yy += $step) < $height  ) {

  $this->setColor($col);
  $this->moveto(2,int($yy));
  $this->lineto($width-1,int($yy));
}
}



sub drawGridReset {
$this = shift;
my ($res) = shift;
my ($lt) = shift;
my ($colHL) = shift;
my ($reset) = shift;
$this->setDot($lt);
$this->setColor($colHL);
my ($counter) = $res;
my ($step) = $width / $res;
my ($xx) = $reset*$step;
#while (  ($xx += $step) < $width  ) {
 # if ( ($xx > (($reset*$step)-$step/2)  ) && ($xx < (($reset*$step)+$step/2)  ))   {
  $this->setColor($colHL);
  $this->moveto(int($xx),1);
  $this->lineto(int($xx),$height-2);
    
  #}
  
#}
}







package TColor;

sub new {
$color = [];
  bless $color ,'TColor';
}

sub addColor {
my ($color) = shift;
my ($red) = shift;my ($green) = shift;my ($blue) = shift;
my ($cnt) = scalar @$color;
#print "count:$cnt\n";
  $$color[$cnt] = pack("C",$blue); $$color[$cnt+1] = pack("C",$green); $$color[$cnt+2] = pack("C",$red);$$color[$cnt+3] = pack("C",0);
}

sub getCount {
my ($color) = shift;
  return (scalar @$color) / 4;
}

sub erase {
my ($color) = shift;
 @$color = ();
}

1;#%EOF%#
#%File: ./liblist.cgi%#
#--------------------------------------------------------------
#  ##%TL_NAME%## ##%TL_VER%##				      
#--------------------------------------------------------------
#                    DO NOT EDIT THIS FILE                    
#--------------------------------------------------------------

package libList;
use vars;
require "./libutils.cgi";
require "./libfile.cgi";
require "./libaccount.cgi";
require "./liblog.cgi";
require "./liberror.cgi";
require "./libgenlist.cgi";
require "./data/config.dat";
require "./data/var.dat";
1;
$| = 1;

#-----------------------------------------------------------------
#  Generates footer Of TOPLIST

#  Input: 1, ref. to File Handle
#         
#  Output: 
#-----------------------------------------------------------------
sub genFooter {
my ($curIndex) = shift;
my ($FHp) = shift;
my ($realAccs) = shift;
$realAccs = ( ($realAccs == 0)?1:$curIndex+1);
my ($FH) =libFile::openTempl(getTemplFNFooter($curIndex));
my ($order) = shift;
my ($data) = shift;
my ($randAcc) =shift;
my ($ok) = 1;
my ($counter) = 100;
my ($urlPart) = ($var::usePHP)?$config::phpOutUrl:$config::out_cgi;


if ($FH != 3) {
  my ($tdcount) = 0;
    my ($banner,$bannerw,$bannerh,$title) = (
      libUtils::getFieldFromRecord($$data{$$order[$randAcc]},$var::record{$var::banner}),
      libUtils::getFieldFromRecord($$data{$$order[$randAcc]},$var::record{$var::bannerw}),
      libUtils::getFieldFromRecord($$data{$$order[$randAcc]},$var::record{$var::bannerh}),
      libUtils::getFieldFromRecord($$data{$$order[$randAcc]},$var::record{$var::title})          
   );
    if (($banner eq "http://") || ($banner eq "")) {$banner = $config::defaultBannerURL;}
    $bannerw =  ($bannerw eq "")?$var::maxBannerWidth:$bannerw;
    $bannerh =  ($bannerh eq "")?$var::maxBannerHeight:$bannerh;  
      
  foreach (<$FH>) {
#   s/$var::genFooter{'links'}{'val'}/"<A HREF=\"$config::virtual_cgi_path\/index.cgi\?index\=$realAccs\&$var::toplistparams\"\>$var::html_TL_next<\/A>"/e;
    s/$var::genFooter{'links'}{'val'}/"$config::virtual_cgi_path\/index.cgi\?index\=$realAccs\&$var::toplistparams"/e;

    if ($randAcc eq "%%error_find_user%%") {  
      # first remove title var
      s/$var::genFooter{'title'}{'val'}//gise;
      # then remove banner var. It's necessary when inside Anchor
      s/(<[^>]*$var::genFooter{$var::banner}{'val'})([^>]*>)//gise;
      s/(<\s*A[^>]*$var::genFooter{'link'}{'val'})([^<]*<\s*\/A\s*>)/"<!-- no banner -->"/gise;
    
    }
    else {
      s/$var::genFooter{$var::banner}{'val'}/"$banner"/gise;
      s/$var::genFooter{'bannerw'}{'val'}/"$bannerw"/gise;
      s/$var::genFooter{'bannerh'}{'val'}/"$bannerh"/gise;
      s/$var::genFooter{'link'}{'val'}/"$urlPart?acc=".$$order[$randAcc]."\&\%params\%"/e;
      s/$var::genFooter{'title'}{'val'}/$title/e;          
    }
    print $FHp $_;
  }
  print $FHp "<CENTER><A HREF=\"$config::support\">$var::bottomText</A></CENTER>";

libFile::closeFile($FH); 
}
else  {
  libError::logError("Gen footer: $!",$0);
}


}







#-----------------------------------------------------------------
#  Generates header Of TOPLIST

#  Input: 1, ref. to File Handle
#  There will be ANTIHITBOT Script generated if allowed       
#  Output: 
#-----------------------------------------------------------------
sub genHeader {
my ($curIndex) = shift;
my ($FHp) = shift;
my ($order) = shift;
my ($data) = shift;
my ($randAcc) =shift;
my ($counter) = 100;
my ($ahb);
my ($FH) =libFile::openTempl(getTemplFNHeader($curIndex));
my ($urlPart) = ($var::usePHP)?$config::phpOutUrl:$config::out_cgi;
if ($FH != 3) {
  my ($tdcount) = 0;
  my ($banner,$bannerw,$bannerh,$title) = (
    libUtils::getFieldFromRecord($$data{$$order[$randAcc]},$var::record{$var::banner}),
    libUtils::getFieldFromRecord($$data{$$order[$randAcc]},$var::record{$var::bannerw}),
    libUtils::getFieldFromRecord($$data{$$order[$randAcc]},$var::record{$var::bannerh}),
    libUtils::getFieldFromRecord($$data{$$order[$randAcc]},$var::record{$var::title})          
  );
  if (($banner eq "http://") || ($banner eq "")) {$banner = $config::defaultBannerURL;}
  $bannerw =  ($bannerw eq "")?$var::maxBannerWidth:$bannerw;
  $bannerh =  ($bannerh eq "")?$var::maxBannerHeight:$bannerh;  

#  libLog::logAction("randAcc= $randAcc >$banner< >$bannerw< >$bannerh<");  
  foreach (<$FH>) {
#    s/$var::genHeader{'links'}{'val'}/"<A HREF=\"$config::virtual_cgi_path\/index.cgi\?index\=$realAccs\&$var::toplistparams\"\>$var::html_TL_next<\/A>"/e;
    s/$var::genHeader{'links'}{'val'}/"$config::virtual_cgi_path\/index.cgi\?index\=$realAccs\&$var::toplistparams"/e;
#    $randAcc = "%%error_find_user%%";
    if ($randAcc eq "%%error_find_user%%") {  
      # first remove title var
      s/$var::genHeader{'title'}{'val'}//gise;
      # then remove banner var. It's necessary when inside Anchor
      s/(<[^>]*$var::genHeader{$var::banner}{'val'})([^>]*>)//gise;
      s/(<\s*A[^>]*$var::genHeader{'link'}{'val'})([^<]*<\s*\/A\s*>)/"<!-- no banner -->"/gise;
    }
    else {
      s/$var::genHeader{$var::banner}{'val'}/"$banner"/gise;
      s/$var::genHeader{'bannerw'}{'val'}/"$bannerw"/gise;
      s/$var::genHeader{'bannerh'}{'val'}/"$bannerh"/gise;
      s/$var::genHeader{'link'}{'val'}/"$urlPart?acc=".$$order[$randAcc]."\&\%params\%"/e;
      s/$var::genHeader{'title'}{'val'}/$title/e;          
    }  
      print $FHp $_;    
  }


libFile::closeFile($FH); 
}
else {
  libError::logError("Gen header: $!",$0);
}

}



#-----------------------------------------------------------------
#  Generates body Of TOPLIST

#  Input: 1, ref. to File Handle
#         2, ref. to order array (sorted array of accounts)
#	  3, ref. to opened Database file
#  Output: 
#-----------------------------------------------------------------
sub genBody {
my ($curIndex) = shift;
my ($accBegin) = shift;
my ($accEnd) = shift;
my ($FHp) = shift;
my ($order) = shift;
my ($data) = shift;
my ($curPos)= 0;
my ($urlPart) = ($var::usePHP)?$config::phpOutUrl:$config::out_cgi;
my ($FH) =libFile::openTempl(getTemplFNData($curIndex));
my ($counterx) = 100;
if ($FH != 3) {
  # ----------- Adds into final toplist file 1. part of data_table template
  my ($stamp) = 0;
  my ($tempPos) = 0;
  my %stamp;
  my (@stamp);
  my (@stampCopy);
  my (@data_index);
  my ($counter) = 0;
  my (@break) = libGenList::getBreaksEx($curIndex);
  my ($tdcount) = 0;
  my ($ahb);
# ------------------ COUNTER SECTION  {
  if ($var::antiHitBOTUse && ($curIndex==1) ) {
    my $FHJS;
    if (($FHJS = libFile::openFile_ex($config::jscriptPrototype)) != 3) {
      my ($jsData) = join("",(<$FHJS>));
      if ($var::usePHP) {    $jsData =~ s/%#HTTP_PATH#%/"$config::url_html"/ie;      } 
      else {      $jsData =~ s/%#HTTP_PATH#%/"$config::virtual_cgi_path"/ie;            }
      my ($banner);
      my ($protection) = 5;

      $config::phpInPath =~ /\.([a-zA-Z0-9_]*)$/;
      my ($ext);
      my ($extPHP) = ($1 eq "")?"php":$1;
      $ext = ($1 eq "")?"cgi":$1;

#     Counter NAME GENERATION

WW:   while ($protection--) {
        $fNameLeght = int(rand(10)) + 4;
	
        for (my $i = 1;$i < $fNameLeght;$i++)  {
          $banner  .= chr( int(rand(25)) + 65 );
        }
        $banner = lc $banner;	
	# protection in case of file name same as important one nic. in soft
        if ( (! -e "$config::cgi_root/$banner.cgi") && (! -e "$document_root/$banner.$extPHP")  ) {last WW;}
      }
      
      
      my ($FHBAN) = libFile::openFile_ex($config::counterName,"RDWR");
      my ($bannerOld,$extOld,$bannerxOld,$extxOld,undef,undef) = <$FHBAN>;      
      
      if ( ($extOld eq "") || (! defined $extOld)) {$extOld = $extPHP;}
      libFile::closeFile($FHBAN);      
      chomp $bannerOld;
      chomp $extOld;      
      chomp $bannerxOld; chomp $extxOld;
      
      if ( ($bannerOld eq "") || (! -e "$config::cgi_root/$bannerOld.cgi") ) {
#        libLog::logAction("Using default banner, name: $config::defaultCounter");
        $bannerOld = $config::defaultCounterName;
      }
      
      $FHBAN = libFile::openFile_ex($config::counterName,"RDWR|CREAT");
      print $FHBAN $banner."\n".$extPHP."\n".$bannerOld."\n".$extOld."\n".$bannerxOld."\n".$extxOld;
      libFile::closeFile($FHBAN);
#      libLog::logAction("old ABOVE $bannerOld.$extOld");
#      rename "$config::cgi_root/$bannerOld.$extPHP" ,"$config::cgi_root/$banner.$extPHP";
      if ($bannerxOld ne $config::defaultCounterName) {
        unlink "$config::cgi_root/$bannerxOld.cgi";
      }
      
      libFile::copyFileX("$config::defaultCounter" ,"$config::cgi_root/$banner.cgi",0777);
      $banner .= ($var::usePHP) ? ".$ext":".cgi";
      $jsData =~ s/%#BANNER_NAME#%/"$banner"/ie;
      $ahb = "$jsData\n";      
      libFile::closeFile($FHJS);
    }
  }
  
# ------------------ COUNTER SECTION  }


# make detail snapshot  
  foreach (<$FH>) {
    push(@stamp,$_);
  }    
  $tdcount = $accEnd - $accBegin;
  my ($tdpos) = int(rand($tdcount))+1;
  
    # ----------- Generates data into table
  my ($pos) = 1;
  my $posTemp;
  my ($accCounter) = 0;
  if (scalar @$order >= $accEnd) {

  # prepare icon's templates
   my ($FHIcons) = libFile::openTempl($config::htmlIcon,0);
   local (@iconNEW,@iconUP,@iconDOWN,@iconSTQUO,@iconLONG);
   my ($section);
#   my ($sep)  = $";
#   $" = "";
   if  ($FHIcons != 3)  {
     while (<$FHIcons>) {
       if (/(%#ICON_SECTION_(.*)#%)/) {$section = $2;  next;}
       if (/%#END_$section#%/) {next;}       
       chomp;
       push(@{"icon$section"},$_);
     }
   }
  # ONE LOOP ONE ACCOUNT
   foreach my $acc (@$order[$accBegin-1..$accEnd-1]) {
#    libLog::logAction("###############acc:$acc  1. gen from: ".($accBegin-1). "..". ($accEnd-1));
    if ( ($acc eq "") || (! defined $acc) ) {next;}
#    libLog::logAction("###############acc:$acc  2. gen from: ".($accBegin-1). "..". ($accEnd-1));    
    if (++$accCounter == $tdpos) {
      print $FHp $ahb;    
    }
#    libLog::logAction("###############acc:$acc  3. gen from: ".($accBegin-1). "..". ($accEnd-1));    
    @stampCopy = @stamp;

    if (++$curPos == (($posTemp = shift(@break))+1) ) {
      # This is a position where break will we inserted
      my ($FHx) = libFile::openTempl(getBreakFN($curIndex,$curPos-1),0);
      print $FHp (<$FHx>);
    }
    else {
      unshift (@break,$posTemp);
    }
      my ($replaced) = 0;
      $_=join(/"\n"/,@stampCopy);
#      do {
      $replaced=0;
      if (!$counterx--) {last SWITCH;}
        foreach my $key ($var::title,$var::descr,$var::bannerw,$var::samplew,$var::bannerh,$var::sampleh) {
          if (s/$var::genBody{$key}{'val'}/libUtils::getFieldFromRecord($$data{$acc},$var::record{$key})/ge) {
            $replaced++;
          }
        }
	
	my ($tempPos) = $accBegin+ $curPos- 1;	
        my ($url);
        foreach my $key ('banner','sample') {
	 if (  $tempPos <= ${"var::$key"."Limit"}   ) {
	   $url = libUtils::getFieldFromRecord($$data{$acc},$var::record{$key});
	   (($url eq "") || ($url eq "http://")) && do {
	     $url = $config::defaultBannerURL;
	   };
	 }
	 # don't use URL if default returns empty or if ower limit
	 if (  ($tempPos > ${"var::$key"."Limit"})|| ($url eq "http://")||($url eq "")  ) {
           my ($cut) = "<[^>]*".$var::genBody{$key}{'val'}."[^>]*>";	   
	   s/$cut//gise;
         }
         if (s/$var::genBody{$key}{'val'}/$url/ge) {  $replaced++; }	 
	}# foreach
	
	#   local (@iconNEW,@iconUP,@iconDOWN,@iconSTQUO,@iconLONG);

	

	foreach my $key ('icon') {
	  my ($activity) = libUtils::getFieldFromRecord($$data{$acc},$var::record{$var::activity});
	  my ($age) = time - libUtils::getFieldFromRecord($$data{$acc},$var::record{'joindate'});
	  my ($oldRank) = libUtils::getFieldFromRecord($$data{$acc},$var::record{$var::lastRank});
	  $oldRank = (defined $oldRank)?$oldRank:10000000;
#	  libLog::logAction("Acc $acc-> $oldRank,". ($tempPos));
	  # NEW section
 	  if ($var::newEnabled && ($age <= $var::newDuration*60*60) &&($var::newLimit >= $tempPos)) {
	    s/$var::genBody{"time$key"}{'val'}/"@iconNEW"/ge;
	  }
	  elsif ($var::longEnabled && ($activity >= $var::longDuration)  &&($var::longLimit >= $tempPos))  {
	    s/$var::genBody{"time$key"}{'val'}/"@iconLONG"/ge;
	  }
	  else {
	    # erase var if ower limit
	    s/$var::genBody{"time$key"}{'val'}//ge;	      	    
	  }
	  if ($var::directionLimit >= $tempPos ) {
	      ((($accBegin+ $curPos- 1) - $oldRank) == 0) && ($var::stquoEnabled) && do {
	        s/$var::genBody{"dir$key"}{'val'}/"@iconSTQUO"/ge;
	      };
	      ((($accBegin+ $curPos- 1) - $oldRank) < 0) && ($var::upEnabled) && do {
	        s/$var::genBody{"dir$key"}{'val'}/"@iconUP"/ge;	      
	      };
	      ((($accBegin+ $curPos- 1) - $oldRank) > 0) && ($var::downEnabled) && do {
	        s/$var::genBody{"dir$key"}{'val'}/"@iconDOWN"/ge;	      
	      };
	      s/$var::genBody{"dir$key"}{'val'}//ge;	      	    
	    }
	    else {
	    	    # erase var if ower limit
	      s/$var::genBody{"dir$key"}{'val'}//ge;	      	    
	    }
	  
	}
        s/$var::genBody{'rank'}{'val'}/$tempPos/ge;
        s/$var::genBody{'link'}{'val'}/"$urlPart?acc=$acc\&rank\=$tempPos\&\%params\%"/ge;
        s/$var::genBody{'in'}{'val'}/(libAccount::getIn(1,$acc,$data))[1]/ge;
        s/$var::genBody{'out'}{'val'}/(libAccount::getOut(1,$acc,$data))[1]/ge;
	#next;
#	} while ($replaced);

	if ($var::selectiveFS) {
	  s/$var::genBody{'fontb'}{'val'}/"<font size=\"".(getFontSize($tempPos))."\">"/ge;	  	
	  s/$var::genBody{'fonte'}{'val'}/"\<\/font\>"/ge;	  
	}
	
        my ($edgeSize);
          if (! $var::selectiveFS) {
	    s/$var::genBody{'fontb'}{'val'}/""/ge;	  	
	    s/$var::genBody{'fonte'}{'val'}/""/ge;	  
            if ($edgeSize = edgeFontBegin($tempPos)) {
	      print $FHp ("<font size=\"$edgeSize\">");
	    }
#	   This prints all work done before into INDEX file	 
         print  $FHp ($_);       
	 
         if (edgeFontEnd($tempPos)) {
	   print $FHp ("</font>");	 
	 }
       }
       else {
#	   This prints all work done before into INDEX file	 
         print  $FHp ($_);       
       
       }
       
       my (@tempRow) = split(/\|/,$$data{$acc});
       $tempRow[$var::record{$var::lastRank}] = $tempPos;
       $$data{$acc} = join("|",@tempRow);
  }  # For each ACC
  } # if (scalar @$order...
  # --- this will add break if it is dedic. to last pos. in the index
  if (++$curPos == (($posTemp = shift(@break))+1) ) {
    # This is a position where break will we inserted
    my ($FHx) = libFile::openTempl(getBreakFN($curIndex,$curPos-1),0);
    print $FHp (<$FHx>);
  }
} #Opened file        
} #main



sub getFontSize {
my ($pos) = shift;
my (@byRange) = split(/\,/,$var::fontSizes);
my ($val);
foreach my $data (@byRange) {
#  libLog::logAction("->>> $data, $pos");
  $data =~ /([0-9]*)-([0-9]*)=([0-9+-]*)/;
  $val  =$3;
  if (($1 <=$pos) && ($2 >=$pos)) {
    return $3;
  }
}

return $val;
        


}

sub edgeFontBegin {
my ($pos) = shift;
my (@byRange) = split(/\,/,$var::fontSizes);
foreach my $data (@byRange) {
  $data =~ /([0-9]*)-([0-9]*)=([0-9+-]*)/;
  if (($1 ==$pos) ) {
    return $3;
  }
  else {
    return 0;
 }        
}


}

sub edgeFontEnd {
my ($pos) = shift;
my (@byRange) = split(/\,/,$var::fontSizes);
foreach my $data (@byRange) {
  $data =~ /([0-9]*)-([0-9]*)=([0-9+-]*)/;
  if (($2 ==$pos)) {
    return $3;
  }
  else {
    return 0;
 }        
}


}


#-----------------------------------------------------------------
#  Generates toplist HTML file. Name is stored in config.dat

#  Input: 1, database HASH
#         2, array of sorted account
#  Output: 
#-----------------------------------------------------------------

sub generateTopList {
#getTotalAccs
my ($order) = shift;  # ref.to order. /choosen data/
my ($data) = shift;   # ref to hash of data.
my ($curIndex)  = 0;
my ($totalIndex)  = libGenList::getIndexCount();
my ($accBegin) = 1;
my ($accEnd) = 0;
# count of choosen accs
my ($realAccs) = scalar @$order;
# total alloweb by setting in SETUP
my ($accsTotal) = libGenList::getTotalAccs();

#random acc
my ($randAcc);
my ($protection) = 1000;
my $ban;
if (($config::defaultBannerURL eq "") || ($config::defaultBannerURL eq "http://")) {
BREAKER:{
  while (--$protection) {
    $randAcc = int (rand(scalar(@$order)));  
    $ban = (libAccount::getAccData($$order[$randAcc],$data))[$var::record{'banner'}];
    if ( ($ban ne "") && ($ban ne "http://") ) {last BREAKER;}
  }
};  
if (!$protection) {$randAcc = "%%error_find_user%%";}
}

if ($realAccs > $accsTotal) {$realAccs = $accsTotal;}
#while ((++$curIndex <= $totalIndex) && $realAccs) {
while ((++$curIndex <= $totalIndex) ) {

  if ($realAccs < $config::index{$curIndex}->[1]) {

    $accBegin = $accEnd+1;
    $accEnd += $realAccs;
    $realAccs = 0;
  }
  else{

    $accBegin = $accEnd+1 ;
    $accEnd += $config::index{$curIndex}->[1];
    $realAccs -= $config::index{$curIndex}->[1];
  }

  # temp file for newly generated index
  my ($FH) =libFile::openFile_ex(libFile::getTLTempFileName($curIndex),"RDWR|CREAT");

  if ($FH != 3) {
    genHeader($curIndex,$FH,$order,$data,$randAcc);
    genBody($curIndex,$accBegin,$accEnd,$FH,$order,$data);
    genFooter($curIndex,$FH,$realAccs,$order,$data,$randAcc);
    libFile::closeFile($FH);
    rename(libFile::getTLTempFileName($curIndex),libFile::getTLFileName($curIndex));
  }
  else {
    libError::logError("Gen toplist: $!",$0);
  } 

}

if ($var::usePHP) {genPHP(libFile::getTLFileName(1));}

}


#-----------------------------------------------------------------
#  Generates PHP in & out
#  Input: 1, name of html file to modif to php
#  Output: -
#-----------------------------------------------------------------

sub genPHP {
my ($indexHTML) = shift;
my $FH;my $FHPHP;
my ($inPHP) = $config::phpInPath;
my $firstTime = 1;
my $state = 0;
my (@mainPHPFrag,@paramPHPFrag,@timedActionPHPFrag);
# ------------------------ COUNTER PHP PArt ---------------------------
my ($FHBAN) = libFile::openFile_ex($config::counterName,"RDWR");
my ($banner,$ext,$oldname,$oldext,$oldxname,$oldxext) = <$FHBAN>;
chomp $oldxname;
chomp $oldxext;
chomp $oldname;
chomp $oldext;
chomp $banner;
chomp $ext;

unlink "$config::document_root/$oldxname.$oldxext";
#libLog::logAction("try to unlink: $config::document_root/$oldxname.$oldxext");

libFile::closeFile($FHBAN);      
my ($FHPROTO) = libFile::openFile_ex("$config::phpCounterPrototype","RDWR");
#libLog::logAction(">>: $config::document_root/$banner".".$ext");
my ($FHCOUNTER) = libFile::openFile_ex("$config::document_root/$banner.$ext","RDWR|CREAT");
foreach (<$FHPROTO>) {
  if (/exit()/) {next;}
  s/config::counterLog/"$config::counterLog"/e;
  print $FHCOUNTER $_;
}
libFile::closeFile($FHPROTO);
libFile::closeFile($FHCOUNTER);

# ------------------------ IN PHP PArt ---------------------------

if (($FH = libFile::openFile_ex($config::phpFragment,"RDWR"))!=3) {
  while (<$FH>) {
    (/%IN_FRAGMENT_B%/) && do {
      $state = 1;next;
    };
    (/FRAGMENT_E%/) && do {
      $state = 0;next;
    };
    (/%PARAMS_FRAGMENT_B%/) && do {
      $state = 2;next;
    };
    (/%TIMEDACTION_FRAGMENT_B%/) && do {
      $state = 3;next;
    };
    
    if ($state == 1) {     s/\"(.*::[^\"]*)\"/"\"${$1}\""/e; push(@mainPHPFrag,$_);}
    if ($state == 2) {     push(@paramPHPFrag,$_);}
    if ($state == 3) {     s/([A-Za-z0-9_]*::[A-Za-z0-9_]*)/"${$1}"/ge; push(@timedActionPHPFrag,$_);}    
  }
  libFile::closeFile($FH);
}
$FH = libFile::openFile_ex($indexHTML,"RDWR");

$FHPHP = libFile::openFile_ex("$inPHP","RDWR|CREAT|TRUNC");
if (($FH!=3) && ($FHPHP!=3)) {

  if ($var::cookiesUse) {
  
    print $FHPHP <<PHPX;
<?php
  \$cookieSet = 0;
  if (!(\$HTTP_COOKIE == \"STATUS=STOP\")) {
    setcookie(\"STATUS\",\"STOP\",time()+$var::cookiesExp);
    \$cookieSet = 1;
  } 
?>
PHPX

  }

  if (! $var::useCron) { print $FHPHP ("@timedActionPHPFrag"); } 
  while (<$FH>) {
    if (s/$var::toplistparams/"@mainPHPFrag@paramPHPFrag"/e) {
      s/\n//;
      @mainPHPFrag = ();
    }
    
    print $FHPHP ($_);
  }
  libFile::closeFile($FH); 
  libFile::closeFile($FHPHP); 
}
# ------------------------ OUT PHP PArt ---------------------------
my (@xmainPHPFrag,@xAntiloopFrag);
if (($FH = libFile::openFile_ex($config::phpOutPrototype,"RDWR"))!=3) {
  my($fwdSection) = "%ANTILOOP_".$var::fwdType."_FRAGMENT_B%";
  while (<$FH>) {
    (/%MAIN_FRAGMENT_B%/) && do {
      $state = 1;next;
    };
    (/$fwdSection/) && do {
      $state = 2;next;
    };
    (/FRAGMENT_E%/) && do {
      $state = 0;next;
    };
    
    if ($state == 1) {     s/([A-Za-z0-9_]*::[A-Za-z0-9_]*)/"${$1}"/ge; push(@xmainPHPFrag,$_);}
    if ($state == 2) {     s/([A-Za-z0-9_]*::[A-Za-z0-9_]*)/"${$1}"/ge; push(@xAntiloopFrag,$_);}
  }

  $FHPHP = libFile::openFile_ex("$config::phpOutPath","RDWR|CREAT|TRUNC");
#  while (<$FH>) {
#    s/\>(.*::[^<]*)</"${$1}"/e;
#    print $FHPHP ($_);
#  }
  print $FHPHP ("@xAntiloopFrag@xmainPHPFrag");
}
}

#-----------------------------------------------------------------
#  Sorts Hash by In_Hits Asc...
#  Input: 1, reference to hash.... hash{acc} = in,out,title,...
#         2, min. value of In_Hit
#  Output: Sorted array of accounts
#-----------------------------------------------------------------

sub sortAccByIn {
my ($hash) = shift;   #reference to hash .... hash{acc}=record
my ($limit) = shift;  #bottom limit for In_Hit value
my ($in);
my @result;
my %result;
my ($counter) = 0;
my ($in);
LAST : {
  foreach  my $key  (keys %$hash) {
    if (! libAccount::isSuspended($key)) {
      # Apply bottom LIMIT
      # gets Rated IN !!! ->[1]
      # z nerealnej hodnoty pocitat minimum
      if (($in = (libAccount::getIn(1,$key,$hash))[1]) >= $limit) {
        $result{$key} = $in;
	if (++$counter >= $var::listLimit) { libLog::logAction("limit reached");   last LAST;}
      } 
      else {}
    } else {
    }
    # Sort
    # Done ... fills reference hash with new data
}
};
  
  if (defined %result) {
    @result = sort {$result{$b} <=> $result{$a}} keys %result;
  }
return @result;
}


#-----------------------------------------------------------------
#  Gets IN ratio for specified acc
#  Input: 1, acc
#         2, reference accs databasee
#  Output: ratio (int)
#-----------------------------------------------------------------

sub getInRatio {
my ($result);

my ($unrealLimit)  = $config::in_hit_min_limit;
return $result;
}




#-----------------------------------------------------------------
#  Returns name of break for spec index and position
#  Input: 1, index
#         2, break pos
#  Output: ratio (string)
#-----------------------------------------------------------------

sub getBreakFN {
my ($index) = shift;
my ($break) = shift;
my ($result) =$config::htmlBreakPath.'/'.$config::htmlBreakPrefix . "_".$break."_".$config::index{$index}->[0];

if (!(-e $result)) {
  $result = $config::htmlBreak;
}

return $result;
}







sub getTemplFNHeader {
my ($index) = shift;
$config::html_header =~ /(.*)\.[A-Za-z0-9_]*$/;
my ($result) = $1."_".$config::index{$index}->[0];
if (!(-e $result)) {
  $result = $config::html_header;
}

return $result;
}

sub getTemplFNFooter {
my ($index) = shift;
$config::html_footer =~ /(.*)\.[A-Za-z0-9_]*$/;
my ($result) = $1."_".$config::index{$index}->[0];
if (!(-e $result)) {
  $result = $config::html_footer;
}

return $result;
}

sub getTemplFNData {
my ($index) = shift;
$config::html_data_table =~ /(.*)\.[A-Za-z0-9_]*$/;
my ($result) = $1."_".$config::index{$index}->[0];
if (!(-e $result)) {
  $result = $config::html_data_table;
}

return $result;
}

sub genTemplUserDataFN {
my ($index) = shift;
  $config::html_data_table =~ /(.*)\.[A-Za-z0-9_]*$/;
  return $1."_".$config::index{$index}->[0];
}




sub genTemplUserHeaderFN {
my ($index) = shift;
  $config::html_header =~ /(.*)\.[A-Za-z0-9_]*$/;
  return $1."_".$config::index{$index}->[0];

}

sub genTemplUserFooterFN {
my ($index) = shift;
  $config::html_footer =~ /(.*)\.[A-Za-z0-9_]*$/;
  return $1."_".$config::index{$index}->[0];

}


sub genTemplMailHeaderFN {
 return $config::reportAccHeaderText;
}
sub genTemplMailFooterFN {
 return $config::reportAccFooterText;
}
sub genTemplMailDeleteFN {
 return $config::reportDeleteText;
}

sub genTemplMailInactFN {
 return $config::reportInactivityText;
}




sub genBreakFN {
my ($index) = shift;
my ($break) = shift;

return $config::htmlBreakPath.'/'.$config::htmlBreakPrefix . "_".$break."_".$config::index{$index}->[0];

}
#%EOF%#
#%File: ./liblog.cgi%#
#--------------------------------------------------------------
#  ##%TL_NAME%## ##%TL_VER%##				      
#--------------------------------------------------------------
#                    DO NOT EDIT THIS FILE                    
#--------------------------------------------------------------

package libLog;
use vars;
require "./data/config.dat";
require "./data/var.dat";
require "./libfile.cgi";

1;
$| = 1;


sub logAction {
 if ($var::log) {
   my ($str) = shift;
   my ($type)  = shift;   
   my ($time,$FH);
   my ($FName) = $type ? "$config::special_log_file"  :  "$config::log_file";
 
   $time = localtime(time);
   
   if ((stat($config::log_file))[7] > $var::log_limit ) {
     $FH = libFile::openFile_ex($FName,"RDWR|CREAT");   
     print $FH "Action: "."Log File Erased /too big/"."  Time: $time\n";
     libFile::closeFile($FH);
   }
   
   $FH = libFile::openFile_ex($FName,"RDWR|CREAT|APPEND");
   print $FH "Action: "."$str"."  Time: $time\n";
   libFile::closeFile($FH);
 
}
}


sub getLogData {
my ($type) = shift;
my ($fields) = shift;
my ($sort) = shift;
my ($filter) = shift;
my ($fieldRank) = shift;
my (%sort) = (1=>"ID",2=>"DT",3=>"ACCIN",4=>"ACCOUT");
my (@result);
my @res;
my ($sortPos) = -1;
SWX:{

    ($type == 1 ) && do {
      my %dataIN;
      my %dataOUT;      
      my %dataX;            

      # analyze counter log file
      $FH = libFile::openFile_ex("$config::counterLog","RDWR");	  
      if ($FH != 3) {
      my (@data);
        foreach (<$FH>) {
	  chomp;
          @data = split(/\|/,$_);
#	         acc      	     id     checked
          $dataX{$data[1]}{$data[0]}  = 1;
        }
        libFile::closeFile($FH);
      } else {    libLog::logAction("Error open file $config::counterLog");	}
      
      # analyze in log file
      my ($FH) = libFile::openFile_ex("$config::log_in_file","RDWR");
      my (@data);
      if ($FH != 3) {
        foreach (<$FH>) {
          @data = split(/\|/,$_);
#	  one record for one unique ID
#	       acc         id	         COOKIE   TIME IN IPFROM
          $dataIN{$data[2]}{$data[1]} =  "$data[0]|$data[3]|$data[5]|".((defined $dataX{$data[2]}{$data[1]})?"Checked|":"Not Checked|");
        }
        libFile::closeFile($FH);
      }
      else {    libLog::logAction("Error open file $config::log_in_file");	}
      
      # analyze out log file
      $FH = libFile::openFile_ex("$config::log_out_file","RDWR");	  
            my (@data);
      if ($FH != 3) {      
        foreach (<$FH>) {
          @data = split(/\|/,$_);
#	           id              OUTACC  TIME IN      RANK
         push(@{$dataOUT{$data[0]}}, "$data[1]|$data[3]|$data[4]");
        }
        libFile::closeFile($FH);
      } else {    libLog::logAction("Error open file $config::counterLog");	}
    my ($arrCounter) = 0;
    my (@sortByAcc) = sort {$a cmp $b} (keys %dataIN);
	my ($times) = 0;
	my ($ttx);
    
    foreach my $acc (@sortByAcc) {
#      libLog::logAction("Acc: $acc");
      foreach my $id (keys %{$dataIN{$acc}}) {
#        libLog::logAction("DaTa1: $id|$acc|$dataIN{$acc}{$id}");
	push(@res,"$id|$acc|$dataIN{$acc}{$id}");
	$arrCounter++;
	$times = 0;
        foreach my $out (@{$dataOUT{$id}}) {
	  chomp $out;
	  if ($times) {
	    $arrCounter++;
	    @res = (@res[0..($arrCounter-2)],"$ttx$out",@res[($arrCounter-1)..(scalar( @res) -1)]);
#	    push(@res,"$ttx$out");
	    next;
	  }
#	  libLog::logAction("DaTa2: $out");
	  if (! $times) {
	    my (@xxx) = split(/\|/,$res[$arrCounter-1]);
	    $xxx[0] = "---the same in ---";	    $xxx[1] = "-";
	    $ttx = join("|",@xxx)."|";
#            $ttx = $res[$arrCounter-1];
	  }
          $res[$arrCounter-1] .= "$out";
	  $times++;
	}
      }
	push(@res,"PAUSE");    
	$arrCounter++;
    }
    

        foreach my $out (@{$dataOUT{""}}) {
	  chomp $out;
	  my (@xxx) = split(/\|/,$out);
	  push(@res,"|||$xxx[1]|||$out");
}
    
#    in @res ID|ACCIN|COOKIE|TIME|IPFROM|CHECKED|ACCOUT|TIMEIN|RANK
    my (%fileFieldRank_in_log)  = (
                "COOKIE"=>2,"ID"=>0,"ACCIN"=>1,"DT"=>3,
		"IPFROM"=>4,"COUNTER"=>5,"ACCOUT"=>6,"RANK" => 8);
		
#    libLog::logAction("---------> @res");
    
  my (@tempd)      ;
    my (@result) = ();
    my (@data)      ;    
    my ($counter) =0;
SX: {	      
    foreach (@res) {
      if (/PAUSE/) {
        push (@result,"<HR>|<HR>|<HR>|<HR>|<HR>|<HR>|<HR>|<HR>|");
        next;
      }
      @data = split(/\|/,$_);
#      libLog::logAction(">>>>>>>>> @data");
  foreach (@$fieldRank) {
#	    if (  $sort{$sort} eq $_  &&  $filter ne "" && ! ($_ =~ $filter) ) {last SX;}
	    if ( defined $$fields{$_}  ) {
	        if ($sort{$sort} eq $_) { 
		  $sortPos = $counter;
		  if (!($data[$fileFieldRank_in_log{$_}] =~ /$filter/) && $filter ne ""  ) {@tempd=  ();last SX;}
		}
	      $tempd[$counter] = ($data[$fileFieldRank_in_log{$_}] ne "") ? $data[$fileFieldRank_in_log{$_}] : "-";
	      if ($_ eq "COOKIE") {$tempd[$counter] = $tempd[$counter] eq ""?"SET":"NOT SET"   }	      
	      $counter++;
	    }
	  }#foreach
	  push (@result,join("|",@tempd));    
	  @tempd =();
	  $counter=0;
}    
    };
    @res = @result;
    last SWX;    
    };
    # IN,OUT,COUNTER .LOG
    ($type == 2 || $type == 3 ||$type == 4) && do {
    my (%fileFieldRank_in_log,$FH);
    ($type == 2) && do {
      %fileFieldRank_in_log  = ("COOKIE"=>0,"ID"=>1,"ACCIN"=>2,"DT"=>3,"HOST"=>4,"IPFROM"=>5,"IPREF"=>6);
      $FH = libFile::openFile_ex("$config::log_in_file","RDWR");
    };  
    ($type == 3) && do {    
      %fileFieldRank_in_log  = ("ID"=>0,"ACCOUT"=>1,"ACCIN"=>2,"DT"=>3,"RANK"=>4);
      $FH = libFile::openFile_ex("$config::log_out_file","RDWR");
    };
    ($type == 4) && do {
      %fileFieldRank_in_log  = ("ID"=>0,"ACCIN"=>1);
      $FH = libFile::openFile_ex("$config::counterLog","RDWR");
    };
      
      
      if ($FH != 3) {
        my (@data,@tempd);
	my ($res) = 0;
        while (<$FH>) {
	  chomp;
	  @data = split(/\|/,$_);
	  my ($counter) = 0;
	  # get right fields order FILE FIELDS ORDER => WEB PAGE FIELDS ORDER
	  
	  # ONE ROW
SX: {	  
	  foreach (@$fieldRank) {
#	    if (  $sort{$sort} eq $_  &&  $filter ne "" && ! ($_ =~ $filter) ) {last SX;}
	    if ( defined $$fields{$_}  ) {
	        if ($sort{$sort} eq $_) { 
		  $sortPos = $counter;
#		  libLog::logAction("Filter: >$filter<, data to filter $data[$fileFieldRank_in_log{$_}]");
		  if (!($data[$fileFieldRank_in_log{$_}] =~ /$filter/) && $filter ne ""  ) {@tempd=  ();last SX;}
		}
	      $tempd[$counter] = ($data[$fileFieldRank_in_log{$_}] ne "") ? $data[$fileFieldRank_in_log{$_}] : "-";
	      if ($_ eq "COOKIE") {$tempd[$counter] = $tempd[$counter] eq ""?"SET":"NOT SET"   }	      
	      $counter++;
	    }
	  }#foreach
	  push (@result,join("|",@tempd));
 };# SX	  
	}#while
	if ($sortPos != -1) {
	  @res = sort { (split(/\|/,$a))[$sortPos] cmp (split(/\|/,$b))[$sortPos]   } (@result);    
	}
	else {
	  @res = @result;
	}
	libFile::closeFile($FH);
	
      }
      else {
        logAction("Error open file: $config::log_in_file in liblog.cgi");
      }
      last SWX;    
    };



    ($type == 5 || $type == 6||$type == 7) && do {
    my (%fileFieldRank_in_log,$FH);
      ($type == 5) && do {
        $FH = libFile::openFile_ex("$config::log_file","RDWR");
      };  
      ($type == 6) && do {    
        $FH = libFile::openFile_ex("$config::log_error_file","RDWR");
      };
      ($type == 7) && do {
        $FH = libFile::openFile_ex("$config::logInstall","RDWR");
      };
      if ($FH != 3) {
        my (@data,@tempd);
        my ($res) = 0;
        while (<$FH>) {
	  s/\n//;
          push (@res,$_);
        }#while
	libFile::closeFile($FH);
      }
      else {
        logAction("Error open file: $config::log_in_file in liblog.cgi");
      }
	
    };



    
} # SWX    

return @res;
}
#%EOF%#
#%File: ./libmenu.cgi%#
#--------------------------------------------------------------
#  ##%TL_NAME%## ##%TL_VER%##				      
#--------------------------------------------------------------
#                    DO NOT EDIT THIS FILE                    
#--------------------------------------------------------------

package libMenu;
use vars;
require "./libfile.cgi";
require "./libparse.cgi";
require "./data/menu.dat";


$| = 1;
1;
#-----------------------------------------------------------------
#  Generates menu
#  Input: 1, number of next params
#         2 .. n menu def. f.e. "WM","MAIN"
#  Output: Sorted hash with hash{acc}=in
#-----------------------------------------------------------------
sub genMenu() {
my ($count) = shift;
my ($root_menu) = shift;
my ($sub_menu) = shift;

my ($FH) = libFile::openFile_ex("< $menu::menu{$root_menu}{$sub_menu}{$menu::m_temp}{$menu::m_temp_name_f}",0);
if ($FH == 2) {
# timeout - locked
print "Content-type: text/html \n\n";
print "\nFILE ERROR 1 \n";
}
elsif($FH == 3) {
# doesn't exists
print "Content-type: text/html \n\n";
print "\nFILE ERROR 2\n";
}
else {
  # template file for desired MENU exist and now is opened !
  my ($type) = 0;
  my @buff; 
  #            1 header;
  #            
print "Content-type: text/html \n\n";
WHL:  while (<$FH>) {

    if (/$menu::menu_header/) {$type = 1;next;}

    if (/$menu::menu_header_end/) {$type = 2;next;}    

    if (/$menu::menu_footer/) {$type = 1;next;}

    if (/$menu::menu_footer_end/) {$type = 2;next;}    

    if (/$menu::menu{$root_menu}{$sub_menu}{$menu::m_name}/) {$type = 1;next;}

   if (/$menu::menu{$root_menu}{$sub_menu}{$menu::m_temp}{$menu::m_temp_name}/) {$type = 3;@buff = undef;next;}    

    if (/$menu::menu_end/) {$type = 2;next;}    

    if ((/$menu::temp_end/) && ($type == 3)) {$type = 4;}    

SWITCH : 
{
	($type == 2) && do {
                         next WHL;
        };

	($type == 3) && do {
                         push(@buff,"$_");
        		 next WHL;
        };
	($type == 4) && do {

	                 # servis the @buff
			 # parse @buff parameters with ...

			for (my ($ii) = 1;$ii <= $menu::menu{$root_menu}{$sub_menu}{$menu::m_temp}{$menu::items}[0] ;$ii++) {

			 my (@buff1) = @buff ;
			 {
			  for (my ($i) = 0;$i < scalar (@buff);$i++) {

			      $buff1[$i] =~ s/(#%[^%]*%#)/$menu::menu{$root_menu}{$sub_menu}{$menu::m_temp}{$menu::items}[$ii]{$1}/gise;

			    #  $buff[$i] =~ s/(#%[^%]*%#)/NnahradaA/gise;
			  }
			  print @buff1;
			 }
			} 
			 $type = 2;
                         next WHL;
        };


}        
    
#    libParse::cutComment(\$_);
    print;
  
  } #end of while
  libFile::closeFile($FH);
} #end of ELSE

} # end of sub#%EOF%#
#%File: ./libparse.cgi%#
#--------------------------------------------------------------
#  ##%TL_NAME%## ##%TL_VER%##				      
#--------------------------------------------------------------
#                    DO NOT EDIT THIS FILE                    
#--------------------------------------------------------------

package libParse;
use vars;
require "./data/var.dat";

1;
$| = 1;



#-----------------------------------------------------------------
#  Remove ref. to line if it is comment
#  Input: line (string)
#         
#  Output: ----
#-----------------------------------------------------------------

sub cutComment {
my ($par) = shift;
  $$par =~ s/^#[^%].*//;   # removes lines with comment, skips also #%-it is variable
}


#-----------------------------------------------------------------
#  Substitues 
#  Input: line (string)
#         
#  Output: ----
#-----------------------------------------------------------------

sub substParam {
my ($line) = shift;
my ($par) = shift;
my ($sub) = shift;

  $$line =~ s/$par/$sub/e;

  
}



#-----------------------------------------------------------------
#  Remove ref. to line if it is comment
#  Input: line (string)
#         
#  Output: ----
#-----------------------------------------------------------------

sub isSubstr {
my ($line) = shift;
my ($pattern) = shift;
  ($$line =~ /$pattern/) && do{return 1;};
  return 0;
}
#%EOF%#
#%File: ./libstat.cgi%#
#--------------------------------------------------------------
#  "tBOSS" 1.6 Add Form Editor				      
#--------------------------------------------------------------
#                    DO NOT EDIT THIS FILE                    
#--------------------------------------------------------------

package libStat;
$| = 1;
use vars;
#use strict;

require "./libfile.cgi";
require "./liblog.cgi";
require "./libaccount.cgi";
require "./data/config.dat";
require "./data/var.dat";


sub getMaxBot {
my (%hash);
my ($counter) = 0;
my ($key,$value);
my ($acc,$bot);
my (@data);
libFile::openDBM(\%hash,$config::stat_database,0);
$bot = 0;
$notb = 0;
$acc = "none";
while (($key,$value)  = each %hash) {
  @data = split(/\|/,$value);
  my ($boted) = $data[$var::stat{'t_pin'}]-$data[$var::stat{'nobotfilter_in'}];
  if ($bot < $boted ) {
    $bot = $boted;
    $notb = $data[$var::stat{'t_pin'}];
    $acc= $key;
  }
}
libFile::closeDBM(\%hash);
my ($percent) = (!$notb)?0:($bot/$notb)*100;
$percent =~ /([^\.]*\...)/;
$percent = $1;
return (!$bot)?" no cheating":(" $acc - $1% hits in cheated");


}


sub getStatMaxim {
my ($dataType) = shift;
my ($filter) = shift;
my ($FH);
my (%stat);
my ($maxim) = 0;
my (@mask);
my ($counter)=0;

($filter =~ /G_OUT/) && do {$mask[0] = 1};
($filter =~ /G_RIN/) && do {$mask[1] = 1};
($filter =~ /G_PIN/) && do {$mask[2] = 1};
($filter =~ /G_NBRIN/) && do {$mask[3] = 1};
($filter =~ /G_NBPIN/) && do {$mask[4] = 1};
($filter =~ /G_GOUT/) && do {$mask[5] = 1};


MAIN: {
  ($dataType eq 'CH_HOUR') && do {
    libFile::openDBM(\%stat,$config::statTotalSumHour,0);  
    foreach (keys %stat) {
      $counter=0;
      foreach (split(/\|/,$stat{$_})) {
        if ($mask[$counter++]) {
          ($maxim < $_) ? $maxim = $_: 1;
	}
      }
      
    }
    libFile::closeDBM(\%stat);
    last MAIN;
  };
  ($dataType eq 'CH_REG') && do {
    libFile::openDBM(\%stat,$config::statReg,0);  
    foreach (keys %stat) {
          ($maxim < $stat{$_}) ? $maxim = $stat{$_}: 1;
    }
    libFile::closeDBM(\%stat);
    last MAIN;
  };

  ($dataType eq 'CH_DAY') && do {
    libFile::openDBM(\%stat,$config::statTotalSumHour,0);  
    my (@data);
    my (@xx);
    my ($day);
    my ($rec);
    foreach $rec (keys %stat) {
    $rec =~ /-(.*)/;
    $day = $1-1;
    if ($day >= 0) {
      @xx  = split(/\|/,$data[$day]);
      my ($counter) = 0;
      foreach (split(/\|/,$stat{$rec})) {
        $xx[$counter++] += $_;
      }
      $data[$day] = join("|",@xx);
     } 
    }
    
    foreach (@data) {
      $counter = 0;
      foreach (split(/\|/,$_)) {
        if ($mask[$counter++]) {
          ($maxim < $_) ? $maxim = $_: 1;
	}

      }
    }
      
    
    libFile::closeDBM(\%stat);
  
  
  
    last MAIN;
  };

  ($dataType eq 'CH_YEAR' || $dataType eq 'CH_MONTH' ) && do {
    ($dataType eq 'CH_YEAR') && do {
      libFile::openDBM(\%stat,$config::statTotalSumYear,0);  
    };
    ($dataType eq 'CH_MONTH') && do {
      libFile::openDBM(\%stat,$config::statTotalSumMonth,0);  
    };
    
    foreach (keys %stat) {
      $counter = 0;
      foreach (split(/\|/,$stat{$_})) {
         if ($mask[$counter++]) {
          ($maxim < $_) ? $maxim = $_: 1;
	}
      }
    }
    libFile::closeDBM(\%stat);
  
    last MAIN;
  };

  ($dataType eq 'CH_UPTIME' ) && do {
    $FH = libFile::openFile_ex($config::statUptime,"RDWR");
#    $FHx = libFile::openFile_ex($config::statUptimeCounter,"RDWR");
#    my ($count) =  <$FHx>;
#    libFile::closeFile($FHx);
    
    my $T;
    # make avarage value
#    if ($var::useCron) {$T=(3600/$var::rerankPeriodCron);}else {$T=(3600/$var::rerankPeriod);}
    if ($FH != 3) {
      foreach (split(/\|/,<$FH>)) { 
        my ($time,$count) = split(/\#/,$_);
        if (! $count) {next;}
        if ($maxim < $time/$count) {$maxim = $time/$count};
      }
      libFile::closeFile($FH);
    }
    else {
      libError::logError("Error open file $config::statUptime in libStat::getStatMaxim",$0);
    }
    last MAIN;
  
  };

  ($dataType eq 'CH_OUT') && do {
    $FH = libFile::openFile_ex($config::outRankStat,"RDWR");
    if ($FH != 3) {
      foreach (split(/\|/,<$FH>)){ 
        if ($maxim < $_) {$maxim = $_};
      }
      libFile::closeFile($FH);
    }
    else {
      libError::logError("Error open file $config::outRankStat in libStat::getStatMaxim",$0);
    }
    last MAIN;
  
    last MAIN;
  };
}
return $maxim;
}


sub statReg {
my (%hash);
libFile::openDBM(\%hash,$config::statReg,1);
my (@nowTime) = localtime;
my ($month,$hour,$day,$year)= (4,2,3,5);
$nowTime[$month]++;
my($FHSTATTS) = libFile::openFile_ex($config::statTotalSumTS,"RDWR");
my (@oldTime) = localtime(<$FHSTATTS>);
$oldTime[$month]++;
my ($protection) = 32*2;
  if ( ! scalar @oldTime) {
    @oldTime = @nowTime;
  }
  # Write stat to MONTH raster (YEAR)

  if ( ($oldTime[$hour] ==$nowTime[$hour]) && ($oldTime[$day]==$nowTime[$day]) ) {
    # if now is the same hour, day, month as last stat
    # no removal is necessery
  }
  else {


WARR4: { 

    for ( my ($xday,$xmonth) = ($oldTime[$day]+1,$oldTime[$month]); 
      !(($xday==$nowTime[$day]+1) && ($xmonth==$nowTime[$month]));
      # 24 is wrong but useful for detour
      ($xday == 32)?( $xday=1,($xmonth == 12)?$xmonth=1:$xmonth++):$xday++ )  {
      if ($xday == 32) {next;}
      libLog::logAction("->>> erasing in REG: day:$xday, month:$xmonth",1);      
       $hash[$xday] = 0;
       
      if (! --$protection) {libLog::logAction("Protection in ERASE HOUR",1);       last WARR4;}
    }  
}

}
  $hash{ $nowTime[$day]}++ ;
  libFile::closeDBM(\%hash);
}


sub statUpTime {
my ($ut) = shift;

my (@nowTime) = localtime;
my ($month,$hour,$day,$year)= (4,2,3,5);
my($FHSTATTS) = libFile::openFile_ex($config::statTotalSumTS,"RDWR");
my (@oldTime) = localtime(<$FHSTATTS>);

  if ( ! scalar @oldTime) {
    # if there is no old time value
    @oldTime = @nowTime;
#    libLog::logAction("1..empty oldtime",1);        
  }

#libLog::logAction("2..Uptime nowtime:@nowTime, old: @oldTime",1);    



#libLog::logAction("Uptime: now time:@nowTime, old time:@oldTime");
my (@data);
my ($FH) = libFile::openFile_ex($config::statUptime,"RDWR");
if ($FH != 3) {
  @data = split(/\|/,<$FH>);
#libLog::logAction("3..statUptime: @data",1);  
  # erase data HOLE-s
  my ($protection) = 24+1;
WARR4: {  
  if ( ($oldTime[$hour] ==$nowTime[$hour]) && ($oldTime[$day]==$nowTime[$day]) ) {
#        libLog::logAction("4..equal times",1);        
    # if now is the same hour, day, month as last stat
    # no removal is necessery
  }
  else {
  for ( my ($xhour, $xday) = ($oldTime[$hour]+1,$oldTime[$day]);
     !(($xhour == ($nowTime[$hour]+1)) && ($xday == $nowTime[$day]));
       $xhour==24 ? ( $xday==31 ?  $xday = 1 : $xday++  , $xhour = 0  ) : $xhour++) {
       if ($xhour==24) {next;}
#         libLog::logAction("5..Uptime: erasin date day:$xday,hour:$xhour",1);       
       $data[$xhour] = 0;
    if (! --$protection) {libLog::logAction("6..Protection in ERASE UPTIMESTAT",1);       last WARR4;}
     }
    } 
};
  libFile::closeFile($FH);

}
else {
  libError::logError("Error open File: $config::statUptime in libStat\:\:statUpTime",$0);
}
#      libLog::logAction("7..uptime: $ut",1);        

  my ($time,$count) = split(/\#/,$data [  $nowTime[$hour]  ]);
  $count++;$time += $ut;
  $data [  $nowTime[$hour]  ] = "$time#$count";
  $FH = libFile::openFile_ex($config::statUptime,"RDWR|CREAT");
  print $FH ( join("|",@data) );
  libFile::closeFile($FH);

}

sub getUptimeStat {
my ($FH) = libFile::openFile_ex($config::statUptime,"RDWR");
my(@data) = split(/\|/,<$FH>);

libFile::closeFile($FH);

my (@nowTime) = localtime;
my ($month,$hour,$day,$year)= (4,2,3,5);

my (@newData);
my $T;

# make avarage value
#if ($var::useCron) {$T=int(3600/$var::rerankPeriodCron);}else {$T=int(3600/$var::rerankPeriod);}
#foreach (@data) {push(@newData,$_/$T);}
foreach (@data) {
  my ($time,$count) = split (/\#/,$_);
  push(@newData,(! $count)?0:$time/$count);
}

my ($counter) = $nowTime[$hour];
foreach (1..23,0) {
  $data[$counter-1] = (defined $newData[$_])?$newData[$_]:0;
  --$counter == 0 ? $counter = 24 : 1;
}
return @data;
}



sub getOutRankStat {
my ($FH) = libFile::openFile_ex($config::outRankStat,"RDWR");
if ($FH != 3) {
  my (@data) = split(/\|/,<$FH>);
  libFile::closeFile($FH);
  return @data;
}
  
}

sub resetStatRankOut {
unlink $config::outRankStat;
}

sub getTotalSumHour {
my (%stat,@data,@data1,@sx);
my (@nowTime) = localtime;
my ($month, $hour,$day,$year) = ( 4, 2, 3, 5);
libFile::openDBM(\%stat,$config::statTotalSumHour,0);  
my ($xx) = 0;

for(my($xday) = $nowTime[$day],my($xhour) = $nowTime[$hour]; 
          $xx < 24    ; 
	    ($xhour == 0)?($xhour=23, ($xday == 1)?$xday=31:$xday--):$xhour--  ) {
  if (defined $stat{"reset$xhour-$xday"}) {
    $data[$xx++] = $stat{"$xhour-$xday"}."|reset";  
  }
  else {
    $data[$xx++] = $stat{"$xhour-$xday"};
  }
}

libFile::closeDBM(\%stat);
return @data;
}

sub getRegStat {
my (%stat,@data,@data1,@sx);
my (@nowTime) = localtime;
my ($month, $hour,$day,$year) = ( 4, 2, 3, 5);
$nowTime[$month]++;
libFile::openDBM(\%stat,$config::statReg,0);  
my ($xx) = 0;
for(my($xmonth) = $nowTime[$month],my($xday) = $nowTime[$day]; 
          $xx < 31    ; 
	    ($xday == 1)?($xday=31, (--$xmonth)?$xmonth=12:$xmonth):$xday--  ) {
    $data[$xx++] = $stat{$xday};  

}

libFile::closeDBM(\%stat);
return @data;
}



sub getTotalSumDay {
my (%stat,@data,@data1,@sx);
my (@nowTime) = localtime;
my ($month, $hour,$day,$year) = ( 4, 2, 3, 5);
libFile::openDBM(\%stat,$config::statTotalSumHour,0);  

foreach (keys %stat) {
  /-(.*)/;
  #$1 is month
  if ($1 > 0) {
    @sx = split(/\|/,$data1[$1]);
    my ($cntr) = 0;
    foreach (split(/\|/,$stat{$_})) {
      $sx[$cntr++]  += $_;
    }
    $data1[$1] = join("|",@sx);
  }    
}

my ($counter) = $nowTime[$day];

foreach (1..31) {
  $data[$counter-1] = (defined $data1[$_])?$data1[$_]:0;
  (--$counter == 0) ? $counter = 31 : 1;
}

libFile::closeDBM(\%stat);
return @data;
}

# ------------------- Dokoncit !!!!!!!!! --------------

sub getTotalSumMonth {
my (%stat,@data);
my (@nowTime) = localtime;
my ($month, $hour,$day,$year) = ( 4, 2, 3, 5);
libFile::openDBM(\%stat,$config::statTotalSumMonth,0);
my ($counter) = $nowTime[$month]+1;
foreach (1..12) { 
  $data[$counter-1] = (defined $stat{$_})?$stat{$_}:0;
  --$counter == 0 ? $counter = 12 : 1;
}
libFile::closeDBM(\%stat);
return @data;
}


sub getTotalSumYear {
my (%stat,@data);
libFile::openDBM(\%stat,$config::statTotalSumYear,0);  
my (@xx) = sort {$a <=> $b} (keys %stat);
my ($counter) = 0;
foreach (@xx) { $data[$counter] = $stat{$_};}
libFile::closeDBM(\%stat);
return @data;
}



sub resetTotalSumReset {
my $FHSTAT;
if (-e $config::statTotalSum) {
  ($FHSTAT) = libFile::openFile_ex($config::statTotalSum,"RDWR");

  if ($FHSTAT != 3) {
   # last rerank data
    my ($data1,$data2,$data3) =  <$FHSTAT>;
    libFile::closeFile($FHSTAT);
    ($FHSTAT) = libFile::openFile_ex($config::statTotalSum,"RDWR|CREAT");   
    print $FHSTAT $data1;
    print $FHSTAT join("|",(0,0,0,0,0,0)),"\n";    
    print $FHSTAT $data3;    
    libFile::closeFile($FHSTAT);
   



  }

}

}

sub totalSumStat {
my ($data) = shift;
#------------------
#  1. line: OUT|GOUT|RIN|PIN|CIN|CPIN	-> last rerank
#  2. line: OUT|GOUT|RIN|PIN|CIN|CPIN	-> last reset
#  3. line: OUT|GOUT|RIN|PIN|CIN|CPIN   -> total 
#  	$data[0]: OUT
#  	$data[5]: GOUT            
#  	$data[1]: RIN   
#  	$data[2]: PIN      
#  	$data[3]: CIN        
#  	$data[4]: CPIN          								 #
#------------------

# ----------------------
#  TOTAL SUM STAT
#
# ----------------------

my (@data1,@data2,@data3);
my $i;
if (-e $config::statTotalSum) {
  ($FHSTAT) = libFile::openFile_ex($config::statTotalSum,"RDWR");
}
else {
  ($FHSTAT) = libFile::openFile_ex($config::statTotalSum,"RDWR|CREAT");
}  
  if ($FHSTAT != 3) {
   
   @data1 = ($$data[$var::statTotal{'out'}],$$data[$var::statTotal{'rin'}],
             $$data[$var::statTotal{'pin'}], $$data[$var::statTotal{'cin'}], 
	     $$data[$var::statTotal{'cpin'}],$$data[$var::statTotal{'gout'}]
   );
#   libLog::logAction("from VALID: @data1");
   # skip 1st line
   <$FHSTAT>;
   # last reset
   @data2 =split(/\|/,<$FHSTAT>);
   # last total
   @data3 =split(/\|/,<$FHSTAT>);
   libFile::closeFile($FHSTAT); # now write
   
   ($FHSTAT) = libFile::openFile_ex($config::statTotalSum,"RDWR|CREAT");
   for($i = 0;$i < scalar @data1;$i++)  {
     $data2[$i] += $data1[$i]; $data3[$i] += $data1[$i];
   }
     print $FHSTAT join("|",@data1),"\n";
     print $FHSTAT join("|",@data2),"\n";     
     print $FHSTAT join("|",@data3);     

   libFile::closeFile($FHSTAT);
        
  } 
  else {
    libError::logError("Error open/create file: $config::statTotalSum",$0);
  }
# ------------------------
#  TOTAL SUM STAT PER TIME
#			  
# ------------------------
# use the same time in whole code fragment
my ($time) = time;
if (-e $config::statTotalSumTS) {
  my ($hour,$day,$month,$year);
  
  ($FHSTATTS) = libFile::openFile_ex($config::statTotalSumTS,"RDWR");
  my (@nowTime) = localtime($time);
  $month = 4;  $hour = 2;$day=3;$year=5;
  $nowTime[$month]++;
#  (undef,undef,$hour,$day,$month,$year,undef,undef,undef)=localtime;
my ($oldTime) = <$FHSTATTS>;
  my (@oldTime) = localtime($oldTime);
  $oldTime[$month]++;
  if ( ! scalar @oldTime) {
    # if there is no old time value
    @oldTime = @nowTime;
    ($oldTime[$hour] == 23)? ($oldTime[$hour] == 0) :  ($oldTime[$hour]++);
  }
  
  my (%statTotalYear,%statTotalMonth,%statTotalDay,%statTotalHour);
  libFile::openDBM(\%statTotalYear,$config::statTotalSumYear,1);
  libFile::openDBM(\%statTotalMonth,$config::statTotalSumMonth,1);
  libFile::openDBM(\%statTotalHour,$config::statTotalSumHour,1);  
  my (@dataSum,@data,$counter);

  my ($protection) = 31*24+1;
  # reset data HOLE  in MONTH in hour's


WARR1: {
  if ( ($oldTime[$hour] ==$nowTime[$hour]) && ($oldTime[$day]==$nowTime[$day]) &&  ($oldTime[$month] ==$nowTime[$month])) {
    # if now is the same hour, day, month as last stat
    # no removal is necessery
  }
  else {
    # if now and old time is different
    #   -> new stat interval
    #   -> toplist stopped for some time period
    for ( my ($xhour,$xday,$xmonth) = ($oldTime[$hour]+1,$oldTime[$day],$oldTime[$month]); 
      !(($xhour == ($nowTime[$hour]+1)) && ($xday==$nowTime[$day]) && ($xmonth==$nowTime[$month]));
      # 24 is wrong but useful for detour
      ($xhour == 24)?($xhour=0, ($xday == 31)?( $xday=1,($xmonth == 12)?$xmonth=1:$xmonth++):$xday++):$xhour++ )  {
      if ($xhour == 24) {next;}
      libLog::logAction("->>> erasing dates: hour:$xhour, day:$xday, month:$xmonth",1);
      @data = split(/\|/, $statTotalHour{ $xhour."-".$xday } );
      delete $statTotalHour{"reset".$xhour."-".$xday };    
      @data = (0,0,0,0,0,0);
      $statTotalHour{ $xhour."-".$xday } = join("|",@data);
      if (! --$protection) {libLog::logAction("Protection in ERASE HOUR",1);       last WARR1;}
    }
  }
};

  my ($protection) = 24+1;  # reset data HOLE  in YEAR by MONTHS  
  
WARR2: {  
  if ( ($oldTime[$year] ==$nowTime[$year]) &&  ($oldTime[$month] ==$nowTime[$month])) {
    # if now is the same hour, day, month as last stat
    # no removal is necessery
  }
  else {
    for ( my ($xmonth,$xyear) =($oldTime[$month]+1,$oldTime[$year]);
      ! (($xmonth == $nowTime[$month]+1) && ($xyear == $nowTime[$year]));
      ($xmonth == 13)?($xmonth=1,$xyear++):$xmonth++ ) {
      if ($xmonth == 13) {next;}
        libLog::logAction("->>> erasing dates: month:$xmonth, year:$xyear",1);
        @data = split(/\|/, $statTotalMonth{ $xmonth } );
        @data = (0,0,0,0,0,0);
        $statTotalMonth{ $xmonth } = join("|",@data);
        if (! --$protection) {libLog::logAction("Protection in ERASE MONTH",1);       last WARR2;}
    }
  }
};
# reset data HOLE  in x by YEARs
  my ($protection) = 24+1;  # reset data HOLE  in YEAR by MONTHS  
WARR3: {
  if (  ($oldTime[$year] ==$nowTime[$year])) {
    # if now is the same hour, day, month as last stat
    # no removal is necessery
  }
  else {

  for ( my ($xyear) =$oldTime[$year]+1;$xyear != ($nowTime[$year]+1);$xyear++ ) {
      libLog::logAction("->>> erasing yeras: $xyear",1);
      @data = split(/\|/, $statTotalYear{ $xyear } );
      @data = (0,0,0,0,0,0);
      $statTotalYear{ $xyear } = join("|",@data);
    if (! --$protection) {libLog::logAction("Protection in ERASE YEAR",1);       last WARR3;}
  }
  }
};
  
#  libLog::logAction("before great nowtime : $nowTime[$hour],$nowTime[$day],$nowTime[$month],$nowTime[$year]");
#  libLog::logAction("before great oldtime : $oldTime[$hour],$oldTime[$day],$oldTime[$month],$oldTime[$year]");

  ($FHReset) =libFile::openFile_ex($config::timeStampReset,"RDWR");
  my (@resetTimeX) = localtime(<$FHReset>);
  if ($FHReset != 3) {
    $statTotalHour{"reset".$resetTimeX[$hour]."-".$resetTimeX[$day]}=1;    
    libFile::closeFile($FHReset);
  }
  # Write stat to HOUR raster (MONTH by hour)
  @data = split(/\|/, $statTotalHour{ $nowTime[$hour]."-".$nowTime[$day] } );
  $counter=  0;
  foreach (@data1) {$data[$counter] += $data1[$counter];$counter++;}
  $statTotalHour{$nowTime[$hour] ."-".$nowTime[$day]} = join("|",@data);
#  libLog::logAction("adding data HOUR : @data1");
  
  
  # Write stat to MONTH raster (YEAR)
  @data = split(/\|/, $statTotalMonth{ $nowTime[$month]} );
  $counter=  0;
  foreach (@data1) {$data[$counter] += $data1[$counter];$counter++;}
   # month is in nowTime from 0
  $statTotalMonth{$nowTime[$month]} = join("|",@data);
#  libLog::logAction("adding data MONTH: @data1");

  # Write stat to YEAR raster
  @data = split(/\|/, $statTotalYear{ $nowTime[$year]} );
  $counter=  0;
  foreach (@data1) {$data[$counter] += $data1[$counter];$counter++;}
  $statTotalYear{$nowTime[$year]} = join("|",@data);
#  libLog::logAction("adding data YEAR: @data1");
}


  libFile::closeDBM(\%statTotalYear);
  libFile::closeDBM(\%statTotalMonth);
  libFile::closeDBM(\%statTotalDay);  
  libFile::closeDBM(\%statTotalHour);  
  
  my ($result);
  eval {
    $result = `uptime`;
  };

  $result =~ /([0-9.]*)\s*\,\s*([0-9.]*)\s*\,\s*([0-9.]*)$/;
  libStat::statUpTime($1);
  libStat::setAdminStat($var::statAdmin{'lastRerankUptime'},$1);  
  


  libFile::closeFile($FHSTATTS);
  ($FHSTATTS) = libFile::openFile_ex($config::statTotalSumTS,"RDWR|CREAT|TRUNC");
  print $FHSTATTS ($time);
  libFile::closeFile($FHSTATTS);
  

}


sub getTotalStat {
my ($field) = shift;
my ($FHSTAT) = libFile::openFile_ex($config::statTotalSum,"RDWR");
my ($line) = <$FHSTAT>;
chomp $line;
my (@data);
if ($FHSTAT != 3) {
  @data = split(/\|/,$line);
  libFile::closeFile($FHSTAT);
}
  return ((defined $data[$field])?$data[$field]:0);
}






sub getAdminStat {
my ($field) = shift;

my ($FHSTAT) = libFile::openFile_ex($config::statAdmin,"RDWR");
my (@data) = split(/\|/,<$FHSTAT>);
libFile::closeFile($FHSTAT);
return ((defined $data[$field])?$data[$field]:0);
}

sub setAdminStat {
my ($field)  =  shift;
my ($data) =   shift;
my ($FHSTAT);

$FHSTAT = libFile::openFile_ex("$config::statAdmin","RDWR");
my (@data) = split(/\|/,<$FHSTAT>);
libFile::closeFile($FHSTAT);
$data[$field] = $data;
$FHSTAT = libFile::openFile_ex("$config::statAdmin","RDWR|CREAT");
print $FHSTAT (join("|",@data));
libFile::closeFile($FHSTAT);
}


# --------------------------
# Last login date
# Last reset date
# Last rerank date
# Server time 
# Total accs
# Total inactive
# another admin stat done in another modules :
#		
#		uptime , ...
# --------------------------
sub adminStat {
my %hash;
  libFile::openDBM(\%hash,$config::account_database,0);
  setAdminStat($var::statAdmin{'lastLoginDate'},
  getAdminStat($var::statAdmin{'nowDate'}));
  setAdminStat($var::statAdmin{'nowDate'},time);
  setAdminStat($var::statAdmin{'totalAccs'},scalar keys %hash);
  setAdminStat($var::statAdmin{'inactAccs'},libAccount::getInactCount(\%hash));
  setAdminStat($var::statAdmin{'newAccs'},libAccount::getNewCount(\%hash));
  setAdminStat($var::statAdmin{'oldAccs'},(scalar keys %hash)-libAccount::getNewCount(\%hash));
  setAdminStat($var::statAdmin{'newver'},libAdmin::iCheck());
  libFile::closeDBM(\%hash);
}

sub resetRerankStat{
my ($database) = shift;
my @temp;
foreach my $acc (keys %$database) {
  @temp= split(/\|/,$$database{$acc});
  $temp[$var::stat{'last_rerank_rin'}] = pack("I",0);
  $temp[$var::stat{'last_rerank_rout'}] = pack("I",0);
  $temp[$var::stat{'last_rerank_pin'}] = pack("I",0);
  $$database{$acc} = join("|",@temp);
}
  
}

sub logRerankStat{
my ($database) = shift;
my @temp;
foreach (keys %$database) {
  @temp= split(/\|/,$$database{$_});
  libLog::logAction("RIN:".unpack("I",$temp[$var::stat{'last_rerank_rin'}]));
  libLog::logAction("ROUT:".unpack("I",$temp[$var::stat{'last_rerank_rout'}]));
  libLog::logAction("PIN:".unpack("I",$temp[$var::stat{'last_rerank_pin'}]));
}

}


sub putStatData {
my ($data) = shift;
#ref to hash
my ($database) = shift;
my ($field) = shift;
my @temp;
foreach my $acc (keys %$data) {
  @temp = split(/\|/,$$database{$acc});
  $temp[$field] = pack("I",$$data{$acc});
  $$database{$acc} = join("|",@temp);
}
}




sub lastResetStat {
my %accs;
my %statx;
my (@data_src,@data_dest);
libFile::openDBM(\%statx,$config::stat_database,1);
libFile::openDBM(\%accs,$config::account_database,1);

foreach my $key (keys %accs) {
  @data_src = split(/\|/,$accs{$key});
  @data_dest = split(/\|/,$statx{$key});
# foreach my $i (keys %var::stat) {
#   if (!(defined $data_dest[$var::stat{$i}])) {  $data_dest[$var::stat{$i}]   = pack("I",0);}
# }
  $data_dest[$var::stat{'last_reset_in'}] = pack("I",$data_src[$var::record{'in'}]);
  $data_dest[$var::stat{'last_reset_out'}] = pack("I",$data_src[$var::record{'out'}]);
  $statx{$key} = join("|",@data_dest);
  @data_src = undef;
  @data_dest = undef;
}

libFile::closeDBM(\%statx);
libFile::closeDBM(\%accs);

}


#-----------------------------------------------------------------
#  Reads log_in file and do statistic
#  Input: in, out
#         
#  Output: ----
#-----------------------------------------------------------------
sub IOStat {
# rin, rout, pin
my ($type) = shift;
my @ref;
my @log_line;
my %database;
my $acc;
my $data;
my @data;
my %rep;
my $lRer;
my ($FH) = libFile::openFile_ex($config::stat_ref,"RDWR");

while (<$FH>) {
  (/|/) && do {
    @ref = split(/\|/,$_);
  }
}
libFile::closeFile($FH);

libFile::openDBM(\%database,$config::stat_database,1);

UNDEF:{
  if ($type eq 'rout') {
    %rep = ( 	3 => 'day_out',
		4 => 'week_out',
		5 => 'month_out',
		6 => 't_rout'
		);
    $ref[6] = 0;
  
  } 
  elsif ($type eq 'pin') {
    %rep = ( 	3 => 'day_in',
		4 => 'week_in',
		5 => 'month_in',
		6 => 't_pin'		
		);
    $ref[6] = 0; 
  }   
  elsif ($type eq 'rin') {
    %rep = ( 	3 => 't_rin'
		);
    $ref[3] = 0;
  } else {
    last UNDEF;
  }

foreach my $acc (keys %database) {
  $data = $database{$acc};
  @data = split(/\|/,$data);
  $lRer = unpack("I",$data[$var::stat{"last_rerank_$type"}]);
  if ($lRer > 0) {
    foreach my $i (keys %rep) {
      if ( $ref[$i] ) { 
        $data[$var::stat{$rep{$i}}] = pack("I",0); 
      }
      $data[$var::stat{$rep{$i}}] = pack("I",unpack("I",$data[$var::stat{$rep{$i}}]) + $lRer);
    }
    $data = join("|",@data);
    $database{$acc} = $data;
  }
}
} # labe l UNDEF
libFile::closeDBM(\%database);
}

#-----------------------------------------------------------------
#  Update day,week,mounth reference
#  Input: line (string)
#         
#  Output: ----
#-----------------------------------------------------------------

sub updateStatRef {
my $FH;
my @data;
my $temp;
my %trans;

if (-e $config::stat_ref) { 
  $FH = libFile::openFile_ex($config::stat_ref,"RDWR");
  while (<$FH>) {
    (/|/) && do {
      @data = split(/\|/,$_);
    }
  }
  @data[3..5] = (0,0,0);
  my ($now) = time();
  my $res;
  my ($day_sec,$week_sec,$month_sec) = ($var::day_sec,$var::week_sec,$var::month_sec);
  $res = $now  - $data[0];

  if ($res > $day_sec) {
    $data[0] = $now - $day_sec*( ($temp = $res/$day_sec) - int $temp);
    $data[3] = 1;
  }
  $res = $now  - $data[1];  

  if ($res > $week_sec) {
    $data[1] = $now - $week_sec*( ($temp = $res/$week_sec) - int $temp);
    $data[4] = 1;
  }
  $res = $now  - $data[2];  
  
  if ($res > $month_sec) {
    $data[2] = $now - $month_sec*( ($temp = $res/$month_sec) - int $temp);
    $data[5] = 1;
  }
  
  libFile::closeFile($FH);
}
else {
  my $now;
  $now = time();
  @data[0..2] = ($now,$now,$now);
  @data[3..5] = (0,0,0);
}

$FH = libFile::openFile_ex("$config::stat_ref","RDWR|CREAT");
my ($data) = join("|",@data);
print $FH ($data);
libFile::closeFile($FH);
}#%EOF%#
#%File: ./libstatistic.cgi%#
#--------------------------------------------------------------
#  ##%TL_NAME%## ##%TL_VER%##				      
#--------------------------------------------------------------
#                    DO NOT EDIT THIS FILE                    
#--------------------------------------------------------------

package libStatistic;
$| = 1;
use vars;
require "./libfile.cgi";
require "./data/config.dat";
require "./data/var.dat";


sub acc_total_in_out {
my ($acc) = shift;
my ($in) = shift;    # In hits to add
my ($out) = shift;   # Out hits to add
my %stat_in_out;
# Do some statistic!
if ($var::statistic) {

  # Makes total in/out per account statistic
  if ($var::acc_total_in_out) {

    if (libFile::openDBM(\%stat_in_out,$config::statistic,1)) {

      
      @data_stat = split(/\|/,$stat_in_out{$acc});
      $data_stat[$var::acc_total_in] += $in;        # (xxx) adds in to total in
      $data_stat[$var::acc_total_out] += $out;      # (yyy) adds out to total out
      $stat_in_out{$acc} = join ("|",@data_stat);   # xxx|yyy
      libFile::closeDBM(\%stat_in_out);
    }
			
  }
  
  
}
}   #%EOF%#
#%File: ./libstd.cgi%#
#--------------------------------------------------------------
#  ##%TL_NAME%## ##%TL_VER%##				      
#--------------------------------------------------------------
#                    DO NOT EDIT THIS FILE                    
#--------------------------------------------------------------

package libUtils;
use vars;
use strict;

require "./libfile.cgi";
1;
#-----------------------------------------------------------------
#  Puts timestamp into spec. file
#  Input: 1, reference to hash.... hash{acc} = in,out,title,...
#         2, min. value of In_Hit
#  Output: Sorted hash with hash{acc}=in
#-----------------------------------------------------------------
sub putTimeStamp {
my ($filename) = shift;

}#%EOF%#
#%File: ./libsystem.cgi%#
#--------------------------------------------------------------
#  ##%TL_NAME%## ##%TL_VER%##				      
#--------------------------------------------------------------
#                    DO NOT EDIT THIS FILE                    
#--------------------------------------------------------------

package libSystem;
use vars;
require "./data/config.dat";
require "./liblog.cgi";
$| = 1;
1;
# ----------------------------------------------------------
# Executes system command
#
# Input: command to run 
#	
# Output: status /1-ok,0-bad/
# ----------------------------------------------------------

sub systemCmd{
my ($cmd) = shift;
#if (!system($cmd)) {
if (!system($cmd)) {
  return 1;
}
else {
  libLog::logAction("error exec $cmd");
  return 0;
}

}


sub getUser {
  my $user = (getpwuid( $< ))[0];
  return $user;
}

sub getGroup {
  my $group = (getgrgid( $) ))[0];
  return $group;
}
#%EOF%#
#%File: ./libutils.cgi%#
#--------------------------------------------------------------
#  ##%TL_NAME%## ##%TL_VER%##				      
#--------------------------------------------------------------
#                    DO NOT EDIT THIS FILE                    
#--------------------------------------------------------------

package libUtils;
use vars;
use strict;

1;
#-----------------------------------------------------------------
#  Sorts Hash by In_Hits Asc...
#  Input: 1, reference to hash.... hash{acc} = in,out,title,...
#         2, min. value of In_Hit
#  Output: Sorted hash with hash{acc}=in
#-----------------------------------------------------------------


sub getFieldFromRecord {
 my ($row) = shift;   #row of record
 my ($field) = shift;  #which field 0,1,2,3,...
 my $result;
 $result = (split(/\|/,$row))[$field];

 return $result;
 
}

#%EOF%#
#%File: ./logview.cgi%#
#--------------------------------------------------------------
#  ##%TL_NAME%## ##%TL_VER%##				      
#--------------------------------------------------------------
#                    DO NOT EDIT THIS FILE                    
#--------------------------------------------------------------

require "./data/config.dat";

my (@params,%params,$pair,$x,$y);
if ($ENV{'REQUEST_METHOD'} eq "GET") {
  $x = $ENV{"QUERY_STRING"};
  
SWITCH: {
  ($x eq "counter") && do {    view($config::counterLog);
    last SWITCH;
  };


  ($x eq "special") && do {    view($config::special_log_file);
    last SWITCH;
  };

  ($x eq "in") && do {    view($config::log_in_file);
    last SWITCH;
  };
  ($x eq "out") && do {    view($config::log_out_file);  
    last SWITCH;
  };
  ($x eq "error") && do {    view($config::log_error_file);  
    last SWITCH;
  };
  ($x eq "install") && do {    view("/install.log");  
    last SWITCH;
  };
  ($x eq "log") && do {    view($config::log_file);  
    last SWITCH;
  };
  ($x eq "cronview") && do {    cron(0);
    last SWITCH;
  };
    ($x eq "config") && do {    view("/data/config.dat");  
    last SWITCH;
  };
  ($x eq "var") && do {    view("/data/var.dat");  
    last SWITCH;
  };

  ($x eq "crondel") && do {    cron(1);
    last SWITCH;
  };
  help();

}
}

sub view {
my ($fname) = shift;
if (open(FH,"$fname")) {
print "Content-type: text/html \n\n";
foreach $line (<FH>) {
print "$line<BR>";
}
close(FH);
}
else {
print "Content-type: text/html \n\n";
print "file $fname is empty<BR>";
}
}

sub help {
print "Content-type: text/html \n\n";
print "type .../logview.cgi?X, where X:<BR>";
print "in - view in.log<BR>";
print "out - view out.log<BR>";
print "error - view error.log<BR>";
print "log - view log.log<BR>";
print "install - view install.log<BR>";
print "config - view config.dat<BR>";
print "var - view var.dat<BR>";
print "cronview - view crontab<BR>";
print "crondel - del crontab<BR>";
print "\n";
}

sub cron {
my ($type)  =shift;
my (@output);
if ($type) {`crontab -r`;}
else {
@output = `crontab -l`;
print "Content-type: text/html \n\n";
print "Crontab:<BR>\n";
foreach my $line (@output) {
  print $line."<BR>";
}

}
}#%EOF%#
#%File: ./minstall.cgi%#
#--------------------------------------------------------------
#  ##%TL_NAME%## ##%TL_VER%##				      
#--------------------------------------------------------------
#                    DO NOT EDIT THIS FILE                    
#--------------------------------------------------------------

package minstall;
require "./data/config.dat";

$| = 1;

# The install dat file
my (@excluded) = ("./install.dat",
	     "./install.cgi",
	     "./install.log",
	     "./backup/install.dat"
	     );
open(FH,"> ./install.dat");
print FH "$config::version\n";
# Inherit interpreter
my $buff;


# ------------------------------------------------------------
#	Pushes subdirs of dir "PATH" into ref. to array
# ------------------------------------------------------------

sub pushDirs {
my ($path) = shift;
# ref. to array
my ($data) = shift;

while (<$path/*>) {
  (-d) && do{push(@$data,$_);};
}

}


# --------------------
#	Get sub dirs
# --------------------
my @dirs;

# add also cur. dir
push(@dirs,".");

#pushDirs(".",\@dirs);

# stores root, and two levels up
foreach my $dir (@dirs) {
  pushDirs($dir,\@dirs);
}

# ----------------------------------------------
#	Add scrip and data files to nistall.cgi
# ----------------------------------------------
my ($markN) = 0;
MAIN: {
#last MAIN;
my ($fileType) = 0;
my ($checksum1)=0;
my ($checksum2)=0;
foreach $dir (@dirs) {
  print FH "#%Dir: $dir%#\n";
     checkSum(\$checksum1,\$checksum2,"#%Dir: $dir%#\n");  
 while (<$dir/*>) {  
   (-e) && (!(-d)) && (!isExcluded($_)) && do {
     print "File in dir$dir : $_\n";
     print FH "#%File: $_%#\n";
     checkSum(\$checksum1,\$checksum2,"#%File: $_%#\n");     
     if ($_ =~ /\.html/i) {$fileType = 1;}
     if (open(FX,$_)) {
       while (<FX>) {
         (!(/^#!/)) && do { 
           s/$config::cgi_path/"."/ie;
	   if ($fileType == 1) { s/(href|src)\s*\=\s*\"\/([^\"]*)/$1=\"%#TL_URL#%\/$2\"/i;}
           checkSum(\$checksum1,\$checksum2,"$_");	   
	   print FH ($_);
	 };
       }
     checkSum(\$checksum1,\$checksum2,"\#\%EOF\%\#\n");       
       print FH ("\#\%EOF\%\#\n");     
       close(FX);
     } else {print "Error open file $_\n";} 
   }; 
 }  
}



close(FTHIS);
print FH ("checksum:$checksum1-$checksum2");
close(FH);
chmod (0777,$install);
}
exit 0;


sub checkSum {
my ($ch1) =shift;
my ($ch2) =shift;
my ($data) =shift;
my ($length) = length $data;
$$ch1 += length $data;
$length++;
while (--$length) {
$$ch2 +=  ord (substr($data,$length-1,1));
}


}

sub isExcluded {
my ($file) = shift;
foreach my $fn (@excluded) {
  if ($file eq $fn) {return 1;}
}
return 0;
}#%EOF%#
#%File: ./multiadd_slave.cgi%#
#--------------------------------------------------------------
#  ##%TL_NAME%## ##%TL_VER%##				      
#--------------------------------------------------------------
#                    DO NOT EDIT THIS FILE                    
#--------------------------------------------------------------

package multiadd;

$| = 1;

require "./data/config.dat";
require "./libadmin.cgi";
require "./libfile.cgi";
require "./libaccount.cgi";
require "./liblog.cgi";

# recieve parameters
# ACCNAME|EMAIL|PWD|TITLE|DESCR|PRIM|SEC|banner|sample|HW|...
my @params;
my %params;
if ($ENV{'REQUEST_METHOD'} eq "GET") {
  @params = split(/&/,$ENV{"QUERY_STRING"});
  foreach my $pair (@params) {
    my ($x,$y) = split(/=/,$pair);
    # if returned from multiline select
      $params{$x} = $y; 
      #parameters from line in HASH %params
  }
  prepareInput(\%params);
# Input ready to be used
#  if ($params{'pwd'} eq $config::adminPWD)  {
SWITCH: {
    # do account check
    ($params{'type'} == 1)  && do{
      if (! libAccount::isAccount($params{'acc'})) {
        result("Account: $params{'acc'} doesn't exist");
      }
      else {
        result("Account: $params{'acc'} already exists");    
      }
      last SWITCH;
    };
    ($params{'type'} == 3) && do {      
      result("$config::version");
    };
    ($params{'type'} == 4) && do {      
      result("$var::topListID");
    };

    ($params{'type'} == 5) && do {      
      my (%result) = libAdmin::getServerInfo();
      my ($tosend);
      my ($res);
      foreach (keys %result) {$res .= "$_=".$result{$_}."|";}
      result($res."tlname=$var::topListID");
    };


    ($params{'type'} == 2) && do {  
      if (! libAccount::isAccount($params{'fieldAcc'})) {
	libAccount::addRecord(\%params);
#	libLog::logAction("towrite ".join("-",(keys %params)));
        result("Account: $params{'acc'} added");
      }
      else {
        result("Account: $params{'acc'} already exists");
      }
    };        
};  
} 

sub prepareInput {
my $param = shift;
while (($key,$value) =  (each %$param)) {
  $value =~ s/\+/" "/eg;
  $$param{$key} = $value;
}

while (($key,$value) =  (each %$param)) {
  delete $$param{$key};
  $key =~ s/%([\dA-Fa-f][\dA-Fa-f])/pack ("C",hex ($1))/eg;
  $$param{$key} = $value;
}

}

sub result {
my ($res) = shift;
print "Content-type: text/plain \n\n";
print "ma_status:$res";
}

exit 0;
#%EOF%#
#%File: ./out.cgi%#
#--------------------------------------------------------------
#  ##%TL_NAME%## ##%TL_VER%##				      
#--------------------------------------------------------------
#                    DO NOT EDIT THIS FILE                    
#--------------------------------------------------------------

# parameters : id= id for in.-out. record, acc = account to look for URL

package output;
$| = 1;
#use strict;

# error is running from shell
if ($ENV{'REQUEST_METHOD'} eq "") {
#  &error_codes::error_message($config::lang,1001);
}

# like try {...} catch(..){...} in C++

require "./lib5.cgi";
require "./liberror.cgi";
require "./liblog.cgi";
require "./data/config.dat";
require "./data/var.dat";
$lib5::header_posted = 0;

my ($rerankDone) = 0;

lib5::error_message($config::lang,1001) if($@);
%params = lib5::getParams();
lib5::add_out_hit(\%params);

# in some browser this doesn't work if Redirection is before this
if (!$var::useCron) {
# CRON is not used, so go on with alternative method -> check time stamps
  local *FILEE;
  
  # open timestamp file for rerank
  if (open(FILEE,"< $config::timeStampRerank")) {
    my ($tStampRerank) = <FILEE>;
    chomp $tStampRerank;
    # if true, start rerank
    if ( (time - $tStampRerank) >= $var::rerankPeriod ) {
    libLog::logAction("It's time to rerank");
      close(FILEE);
      if (open(FILEE,"> $config::timeStampRerank")){
        print FILEE (time);
        close(FILEE);       
      }
      system("$config::virtual_cgi_path/genlist.cgi");
      $rerankDone = 1;
    }    
    close(FILEE);
  } 
  else {
  # if stamp doesn't exists, create with present time
    if (open(FILEE,"> $config::timeStampRerank")){
      print FILEE (time);
      close(FILEE);       
    }
  }
  
  if ( !(($rerankDone) && ($var::parallelRunResRer))) {
  if (open(FILEE,"< $config::timeStampReset")) {
    my ($tStampReset) = <FILEE>;
    chomp $tStampReset;    
    if ((time - $tStampReset) >= $var::resetPeriod) {
        libLog::logAction("It's time to rerank");
      close(FILEE);
      if (open(FILEE,"> $config::timeStampReset")){
        print FILEE (time);
        close(FILEE);	
      }
      system("./reset.cgi");
    }
  } else {
      if (open(FILEE,"> $config::timeStampReset")){
        print FILEE (time);
      }

  }
}
}
my $url="";

# stat
lib5::statRankOut($params{$var::rank});

if ( $params{'id'} =~ /$params{$var::acc}/ ) {
#from  ACCx to ACCx
# add code for choose substitute user
  libLog::logAction("fwd type: $var::fwdType");
  SWITCH: {
    # send to default
    ($var::fwdType == 3) && do {
      libLog::logAction("Used secondary url");  
      $url = lib5::get_acc_url($params{$var::acc},1);      
      last SWITCH;
    };
    #send to random
    ($var::fwdType == 2) && do {
    
       my ($accx);
      if (open(XCACHE,"$config::topXFwdCache")) {
        my (@cache) = (<XCACHE>);
        my ($protection)  = 100 *  scalar @cache;
NEXT: 	while (1) {
	  my ($rand) = int (rand(scalar(@cache)));
	  #print scalar @cache;
	  $accx = $cache[$rand];
	  chomp $accx;
	  
	  if ($accx eq "") { splice(@cache,$rand,1);next NEXT;}
	  if ($accx ne $params{$var::acc} )  {last NEXT;}
	  if (! $protection--) {$accx = $params{$var::acc};last SWITCH;}
	} 
      } 
      else {
	# if topxcache doesn't exists
    	  $accx = $params{$var::acc};
      }
      $url = lib5::get_acc_url($accx);
      libLog::logAction("Used random FORWARD to acc: ...$accx..., url : $url");
      last SWITCH;
    };
    #send to default url
    ($var::fwdType == 1) && do {
      libLog::logAction("Used default url");      
      $url = $var::fwdDefaultURL;
      last SWITCH;
    };
    #send to primary url
          libLog::logAction("Used primary url");      
    $url = lib5::get_acc_url($params{$var::acc});
  };  
  libLog::logAction("hitcycle from acc:$params{$var::acc} .... to URL $url");  
}
#else {
  if ( ($url eq "") || ($url eq "http://")) {$url = lib5::get_acc_url($params{$var::acc});}
#}
libLog::logAction("being forwarded to url:>$url<");
print "Location: $url\n\n";
#%EOF%#
#%File: ./reset.cgi%#
#--------------------------------------------------------------
#  ##%TL_NAME%## ##%TL_VER%##				      
#--------------------------------------------------------------
#                    DO NOT EDIT THIS FILE                    
#--------------------------------------------------------------

package reset;

require "./libfile.cgi";
require "./libstat.cgi";
require "./liblog.cgi";
require "./lib5.cgi";
require "./liblist.cgi";
require "./liberror.cgi";
require "./data/config.dat";
require "./data/var.dat";
require "./libstatistic.cgi";

$| = 1;


# -----------------------------------------
#
#  There is only one reason why this package exists.
#  To RESET In,Out Hits

# -----------------------------------------
my %hash,%hash1;
my ($key,$value);
my @data;
my %stat_in_out;
my @data_stat;
my $temp;

libLog::logAction("Reset");

#libStat::lastResetStat();

if (libFile::openDBM(\%hash,$config::account_database,1)) {
  if ($var::gen_useLast) {
     my (@res) = libList::sortAccByIn(\%hash,0);
     my ($FH) = libFile::openFile("$config::last_best_accounts","RDWR|CREAT");
    
LOOP: for (my $index = 0 ; $index < $var::gen_storedforLast;$index++ ) {
        print $FH $res[$index]."\n";
        if (scalar(@res) == ($index+1)) {last LOOP;}
      }
    libFile::closeFile($FH);
  }
    while ( ($key,$value) = (each %hash) ) {
      @data = split(/\|/,$value);
      if (($data[$var::record{'in'}] == 0) && ($data[$var::record{'inactivity'}] <= 0)) {$data[$var::record{'inactivity'}]--}
      elsif (($data[$var::record{'in'}] == 0) && ($data[$var::record{'inactivity'}] > 0)) {$data[$var::record{'inactivity'}] = -1}
      elsif (($data[$var::record{'in'}] != 0) && ($data[$var::record{'inactivity'}] < 0)) {$data[$var::record{'inactivity'}] = 1}
      elsif (($data[$var::record{'in'}] != 0) && ($data[$var::record{'inactivity'}] >= 0)) {$data[$var::record{'inactivity'}]++}
      $data[$var::record{'in'}] = 0;
      $data[$var::record{'out'}] = 0;
      $value = join("|",@data);
      $hash1{$key} = $value;
    }
   %hash = %hash1;
   libLog::logAction("After WHILE IN RESET",1);
   
libFile::closeDBM(\%hash);

# ---------------------- time stamp ---------------------
 my ($FHx) = libFile::openFile("$config::timeStampReset","RDWR|CREAT|TRUNC");
 print $FHx (time,"\n");
 libFile::closeFile($FHx);

 libStat::setAdminStat($var::statAdmin{'lastResetDate'},time);

}
else
{
  libError::logError("reset: $!",$0);
}

# reset Out Rank Stat

libStat::resetStatRankOut();#%EOF%#
#%File: ./service.cgi%#
#--------------------------------------------------------------
#  ##%TL_NAME%## ##%TL_VER%##				      
#--------------------------------------------------------------
#                    DO NOT EDIT THIS FILE                    
#--------------------------------------------------------------

package service;

print "Content-type: text/plain \n\n";


my ($supporTEmail) = "service\@xxxscripts.net";
my ($from) = "nobody\@nobody.com";
my ($sendmail) = getMail()." -t -oi";

sub getMail {
  my @cm = qw( /usr/sbin/sendmail /usr/bin/sendmail /usr/lib/sendmail /var/qmail/bin/qmail-inject );
  for( @cm ) {
    return $_ if( -x $_ );
  }
  return "Unknown";
}


@head = (
  "From: $from\n",
  "To: $supporTEmail\n",
  "Subject: $subject\n",
  "X-Mailer: Support v.mailer\n",
  "MIME-Version: 1.0\n",
  "Content-Type: text/plain; charset=us-ascii\n",
  "Content-Transfer-Encoding: 7bit\n"
); 


if (open(SENDMAIL,"| $sendmail")) {

eval {print SENDMAIL @head;};
my ($sep) = $"; $" = "";
my (@body);
my ($FH);


foreach my $file ("./logs/log.log","./logs/error.log","./logs/error.txt","./data/config.dat","./data/var.dat","./install.log") {

if (open($FH,"$file")) {
  push(@body,"\n\n\n-------------- $file --------------------");
  while (<$FH>) {push(@body,$_)}
  close($FH);
}else {
print "Error open file $file\n";
}

}



eval {print SENDMAIL "\n@body\n";};
if (! close(SENDMAIL)) { print "Error close sendmail\n" }
}

else {
print "Error open pipe to e-mailer\n";
}#%EOF%#
#%Dir: ./admin%#
#%File: ./admin/admin.cgi%#
#--------------------------------------------------------------
#  ##%TL_NAME%## ##%TL_VER%##				      
#--------------------------------------------------------------
# admin.cgi                                                   
# --------                                                    
# This script does the most work when using admin             
#--------------------------------------------------------------

#--------------------------------------------------------------
#                    DO NOT EDIT THIS FILE                    
#--------------------------------------------------------------

#      COPYRIGHT  2000-2002 xxxScripts. ALL RIGHTS RESERVED  

#  This portion of the header appears only in this script file,
#  but applies to all of the scripts that make up this software 
#  package.
                                                                               
#  COPYRIGHT NOTICE                                                            
#  ----------------                                                            
#  This script is not freeware.  Any redistribution of this script without     
#  the written consent of xxxScripts is strictly prohibited.  Copying          
#  any of the code contained within these scripts and claiming it as your      
#  own is also prohibited.  You may not remove any of these header notices.    
#  By using this code you agree to indemnify xxxScripts from any liability      
#  that might arise from it's use.                                             
#                                                                               
#  TECHNICAL SUPPORT NOTICE                                                     
#  ------------------------                                                     
#  You will not be eligible for technical support if you modify any of the      
#  scripts in this software package other than setting the location of perl in  
#  the first line of each of the scripts.  Any editing can result in copyright  
#  violations, and will automatically suspend your technical support.           
#

package admin;
use vars;
#use strict;

BEGIN {
my $FH;
  print "Content-type: text/html\n";
$SIG{'__WARN__'} = sub {
  if (! -e '../logs/error.txt') {
   umask 0;
    open($FH,"> ../logs/error.txt");
  } else { open($FH,">> ../logs/error.txt");}
  if (  (stat($FH))[7] > 1000000 ) {close($FH);    open($FH,"> ../logs/error.txt");}
  print $FH (@_);
  print "<b><br>Script Error:</b> @_\n\n";
  
  close $FH;
};

$SIG{'__DIE__'} = sub {
  if (! -e '../logs/error.txt') {
   umask 0;  
    open($FH,"> ../logs/error.txt");
  } else { open($FH,">> ../logs/error.txt");}
  if (  (stat($FH))[7] > 1000000 ) {close($FH);    open($FH,"> ../logs/error.txt");}
  print $FH (@_);
  print "<b><br>Script Error:</b> @_\n\n";
  
  close $FH;
};



}
$| = 1;

eval {
  main();
};
if( $@ ) {
  print "Content-type: text/html\n";
  print "<b>Script Error:</b> $@ \n\n";
  exit -1;
}
1;

sub main{

require "./libfile.cgi";
require "./libbackup.cgi";
require "./liberror.cgi";
require "./liblog.cgi";
require "./liblist.cgi";
require "./libparse.cgi";
require "./libaccount.cgi";
require "./libgenlist.cgi";
require "./lib5.cgi";
require "./libadmin.cgi";
require "./libsystem.cgi";
require "./libstat.cgi";
require "./data/config.dat";
require "./data/var.dat";
require "./data/infos.dat";

$lib5::header_posted = 0;
local ($cookies);
my %params;
my ($invalid) = 0;


# -------------- PARAMS DIGGER

if ($ENV{'REQUEST_METHOD'} eq "GET") {
  %params = lib5::getParams();
}
elsif ($ENV{'REQUEST_METHOD'} eq "POST") {
  read(STDIN,my $data,$ENV{'CONTENT_LENGTH'});
  my @temp;
  @temp = split(/\&/,$data);
   
  foreach my $keyval (@temp) {
    (my $key,my $val)=split(/\=/,$keyval);

    if (defined $params{$key}) {
      $params{$key} = join("\0",$params{$key},$val);
    }
    else {
    $params{$key} = $val;
      #parameters from line in HASH %params
    }
  }
  
  
#  lib5::error_message($config::lang,1031);
}
else {
  print "\nDon't run from SHELL\n";
  exit 0;
}
  substPlusWithPause(\%params);   
  convertHexaToChar(\%params);


if ($var::htAccessUse) {
  if (!libAdmin::checkHTAccessFile()) {
    libLog::logAction("!!! htaccess not found, generated");
  }
}

# handle pwd lost situation

if ( (libAdmin::checkPWDLost())?libAdmin::genDefaultPWD():0 ) {
  if (! $var::htAccessUse) {
  #there if : lost pwd and not used htaccess
    $cookies = "Set-cookie: $var::cookieVarName=".libAdmin::cryptPWD($var::emergencyPWD)."\n";
  }
}
else {

# --------------------- PASSWORD GATE
my ($ident) = "$var::cookieVarName\=$config::adminPWD";
if ( (! $var::htAccessUse)   &&  ( ! ($ENV{'HTTP_COOKIE'} =~ /$ident/)) ) {
  if (!  ($params{'action'} eq  $var::adminAuth) )   {
    setMenu(666);
  }
  # else if _#AUTH#_ let it go
} 
}


# --------------------- MENU 


 SWITCH: {
    (%params == 0) && do{
                        libStat::adminStat();
			libAdmin::runOnce();
			setMenu(999);
			last SWITCH;
		      };
    

    # DISPLAY was chosen
    my $menu;
    $menu = $params{$var::html_admin_menu_id};
    serviceMenuChoice($var::html_admin_menu{$menu},\%params);
    last SWITCH;

	   
 }	   




}

# ---------------------------------------------
#
# Loads mail list
# Input:  Menu type
# Output: ---
#
# ---------------------------------------------

sub loadMailList {
my ($typeX) = shift;
# ref. to data;
my ($data) = shift;
if ($typeX == 1) {
  if (($$data=~/$var::htmlAdminMListB/) && ($$data=~/$var::htmlAdminMListE/)){
    $$data =~ /$var::htmlAdminMListB(.*)$var::htmlAdminMListE/;
    my ($temp) = $1;
    my ($temp_c) = $1;
    my $mail;
    my %hash;
    $$data =~ s/$var::htmlAdminMListB//;
    $$data =~ s/$var::htmlAdminMListE//;
    libFile::openDBM(\%hash,$config::account_database,0);
    foreach my $acc (keys %hash) {
      $temp_c = $temp;
      $mail = libAccount::getAccDataEx($acc,$var::record{'mail'},\%hash);
      $temp_c =~ s/$var::htmlAdminMListValue/$mail/e;
      $temp_c =~ s/$var::htmlAdminMListDisplay/$acc."(".$mail.")"/e;
      print $temp_c."\n";
    }
    libFile::closeDBM(\%hash);
    return 1;
  } 
  else {
    return 0;
  }
} 
else {
  $$data =~ s/$var::htmlAdminMListB//;
  $$data =~ s/$var::htmlAdminMListE//;
  $$data =~ s/$var::htmlAdminMListValue//;
  $$data =~ s/$var::htmlAdminMListDisplay/$var::MListEmptyMessage/;
  return 0;    	 
}
}








# ---------------------------------------------
#
# Creates desired MENU
# Input:  Menu type
# Output: ---
#
# ---------------------------------------------
sub serviceMenuChoice {
my ($type) = shift;
my ($params) = shift;
my $status = "";
SWITCH: {    
   # Display was chosen
   ($type == 1) && do {
     setMenu(1,   (defined  $$params{'firsttime'})?333:undef  );
     last SWITCH;   
   };
   ($type == 2) && do {

     my @list;
     my %choose_hash = ("active",1,"inactive",2,"all",3,"username",6,"new",4,"modif",5);
     my %sort_hash = ("in",10,"out",11,"tin",20,"tout",21,"din",30,"dout",31,
     "win",40,"wout",41,"min",50,"mout",51,"join",6,"user",7,"inact",8,"mail",9);
     
     # choosed by Activity, Inactivity, All, ...
     @list = chooseAccBy($choose_hash{$$params{"chooseby"}},$$params{"textuname"});
     if (scalar @list) {
       # sorts accs by selected ...
       sortAccBy($sort_hash{$$params{"selby"}},\@list);
       # now in @list choosed and sorted account which complies par
       # in setMenu, accounts will be cut acc. to interval
       setMenu(2,$params,\@list,$$params{"perpage"},$choose_hash{$$params{"chooseby"}},$sort_hash{$$params{"selby"}},$$params{"last"},$$params{"textuname"});
     }
     else {
       setMenu(1,libAdmin::getStatusMessage('accDNExist'));
     }  
     last SWITCH;
   };
   # Edit was choosed
   ($type == 3) && do {
     if ($$params{"radiobuttonEdit"} eq "editHtml") {
       setMenu(10,$$params{"selectHtml"});
     }
     elsif ($$params{"radiobuttonEdit"} eq "editBreaks") {
       setMenu(11,$$params{"selectBreak"});     
     }

     elsif ($$params{"radiobuttonEdit"} eq "editMails") {
       setMenu(12);
     }     
     elsif ($$params{"radiobuttonEdit"} eq "editAddForm") {
       setMenu(1016);
     }     
     elsif ($$params{"radiobuttonEdit"} eq "editIcons") {
       setMenu(1015);
     }     
     
     elsif ($$params{"radiobuttonEdit"} eq "editWords") {
       setMenu(14);
     }     
     last SWITCH;
   };
   # Execute 
   
   ($type == 4) && do {
     SWITCH1: {
       ($$params{'radiobutton'} eq $var::execReset) && do {
         if (libSystem::systemCmd($config::resetPath)) {$status = libAdmin::getStatusMessage('resetOK');}
	 else	 {$status = libAdmin::getStatusMessage('resetNOK');}
	 last SWITCH1;
       };
       ($$params{'radiobutton'} eq $var::execRerank ) && do {
         if (libSystem::systemCmd($config::rerankPath)) {$status = libAdmin::getStatusMessage('rerankOK');}
	 else {$status = libAdmin::getStatusMessage('rerankNOK');}
	 last SWITCH1;
       };

       ($$params{'radiobutton'} eq $var::execAccAdd ) && do {
	 setMenu(1212);
	 exit 0;	 
	 last SWITCH1;

       };
             
       ($$params{'radiobutton'} eq $var::execSetRatio) && do {
	 if ( ($$params{$var::execSetRatioFrom} =~ /[1-9][0-9]*/) &&  ($$params{$var::execSetRatioTo} =~  /[1-9][0-9]*/ ) && ($$params{$var::execSetRatioData}=~/[1-9][0-9]*:[1-9][0-9]*/)) {
           my (@res);
	   my %hash;
	   my $data;
	   libFile::openDBM(\%hash,$config::account_database,0);
	   libGenList::genRank(\@res,\%hash);
	   libFile::closeDBM(\%hash);
	   @res = @res[$$params{$var::execSetRatioFrom}-1..$$params{$var::execSetRatioTo}-1];
	   foreach my $acc (@res) {
	     libAccount::updateRec($acc,$var::record{'ratio'},$$params{$var::execSetRatioData},0);
	   }
	   $status = libAdmin::getStatusMessage('setRatioOK');
	 }
	 else {
	   $status = libAdmin::getStatusMessage('setRatioNOK');	 
	 }
	 last SWITCH1;
       };
       
       ($$params{'radiobutton'} eq $var::execRemove) && do {
	 my %hash;       
	 if ($$params{$var::execRemoveData} ne "") {
	   libFile::openDBM(\%hash,$config::account_database,1);         
	   foreach my $acc (keys %hash) {
	     if (libAccount::getAccDataEx($acc,$var::record{'activity'},\%hash)<= -$$params{$var::execRemoveData}) {
	       libAccount::deleteAccEx($acc,\%hash);
	     }
	   }
	   libFile::closeDBM(\%hash);	 
	   $status = libAdmin::getStatusMessage('removeInactiveOK');
	 }
	 else {
	   $status = libAdmin::getStatusMessage('removeInactiveNOK');	 
	 }  
	 last SWITCH1;       
       };
     }
     setMenu(1,$status);     
     last SWITCH;   };
     
   # Mail
   ($type == 5) && do {

   SW1:{   
     $status = libAdmin::getStatusMessage('mailSendOK');
     ($$params{'rbMail'} eq "all") && do {libAdmin::sendMailFromMenu(0,$$params{'fieldSubject'},$$params{'fieldBody'});last SW1;};
     ($$params{'rbMail'} eq "inactive") && do {libAdmin::sendMailFromMenu(1,$$params{'fieldSubject'},$$params{'fieldBody'});last SW1;};
     ($$params{'rbMail'} eq "inactiveAuto") && do {libAdmin::sendMailInactive(); last SW1;};     
     ($$params{'rbMail'} eq "deleted") && do {libAdmin::sendMailDeleted($$params{'fieldSubject'},$$params{'fieldBody'}); last SW1;};
     ($$params{'rbMail'} eq "list") && do {
     if (libAdmin::sendMailFromMenu(2,$$params{'fieldSubject'},$$params{'fieldBody'},$$params{'selectMailList'})) {
     last SW1; }
     };
     ($$params{'rbMail'} eq "loadlist") && do {setMenu(1,"List Loaded",1);last SWITCH;};
     $status = libAdmin::getStatusMessage('mailSendNOK');
   }
   setMenu(1,$status);
          last SWITCH;
   };
   # Execution from ACC_VIEW
   ($type == 6) && do {
   SW1:{
     ($$params{'buttontype'} eq "suspend") && do {
                   if (libAdmin::accSuspend($$params{'fieldAcc'}))  {$status = libAdmin::getStatusMessage('suspendOK');}
		   else {$status = libAdmin::getStatusMessage('suspendNOK');}
		   last SW1;
		 };
		 
     ($$params{'buttontype'} eq "lock") && do {
                   if (libAdmin::accLock($$params{'fieldAcc'})) {	 $status = libAdmin::getStatusMessage('lockOK');}
		   else 	{ $status = libAdmin::getStatusMessage('lockNOK');}
		   last SW1;};
		   
     ($$params{'buttontype'} eq "freeze") && do {
                   if (libAdmin::accFreeze($$params{'fieldAcc'})) {	 $status = libAdmin::getStatusMessage('freezeOK');}
		   else {	 $status = libAdmin::getStatusMessage('freezeNOK');}
		   last SW1;};
     ($$params{'buttontype'} eq "save") && do { 
    		   if (libAdmin::accSave($$params{'fieldAcc'},$params)) {	 $status = libAdmin::getStatusMessage('saveOK');}
		   else {	 $status = libAdmin::getStatusMessage('saveNOK');}
		   last SW1;};
     ($$params{'buttontype'} eq "delete") && do {
    		   if (libAdmin::accDelete($$params{'fieldAcc'})) {	 $status = libAdmin::getStatusMessage('deleteOK');}
		   else {	 $status = libAdmin::getStatusMessage('deleteNOK');}
		   last SW1;};
     ($$params{'buttontype'} eq "mail") && do {
    		   if (libAdmin::accSendMailMenu($params)) {	 $status = libAdmin::getStatusMessage('mailOK');}
		   else {	 $status = libAdmin::getStatusMessage('mailNOK');}
		   last SW1;};

   }    
   
#     serviceMenuChoice(2,$params);
   
     my (@list);
     @list = chooseAccBy($$params{"chooseby"},$$params{"textuname"});
     if (scalar @list) {
       sortAccBy($$params{"selby"},\@list);
       setMenu(2,$params,\@list,$$params{"perpage"},$$params{"chooseby"},$$params{"selby"},$$params{"last"},$$params{'textuname'});
     } else {
       setMenu(1,libAdmin::getStatusMessage('accDNExist'));    
     }
   
          last SWITCH;
   };
   
   
   # process backup
   ($type == 7) && do {
   my (@result);
   SW1:{
   foreach (keys %$params) {
     if (/SHOW_(BACK|REST)([^|]*)/) {
       if ($1 eq 'BACK') {
         push(@result, libBackup::backup($2));
         push(@result,"");
       }
       else {
         push(@result, libBackup::restore($2));
         push(@result,"");
       }
     }
     elsif (/SHOW_IMPORTAR/) {
         push(@result,libBackup::importAR($2));             
         push(@result,"");	 
     }
     elsif (/SHOW_PACK/) {
         push(@result, libBackup::packTL($2));
         push(@result,"");
     }
  }  #foreach
    
  }  #SW1
   if ($status) {
     $status = libAdmin::getStatusMessage('backrestOK');    
   }
   else {
     $status = libAdmin::getStatusMessage('backrestNOK');        
   }
#   libLog::logAction("Status: $status");
#   setMenu(1,$status);
   libAdmin::strResult("Processing files:<BR><BR>".join("<BR>\n",@result));
   last SWITCH;   
   };

    # save html
   ($type == 8) && do {
     SW4: {   
       foreach ('header','footer','body') {
         if (!(libAdmin::saveTempl(0,$_,$params))) {
           $status = libAdmin::getStatusMessage('saveHTMLNOK');
	   last SW4;
         }
       }
       $status = libAdmin::getStatusMessage('saveHTMLOK');
     }     
     setMenu(1,$status);
     last SWITCH;   
   };


    # Run setup normal
    ($type == 101) && do {
      setMenu(111,0);
      last SWITCH;   
    };

    # Run setup advanced
    ($type == 102) && do {
      setMenu(111,1);
      last SWITCH;   
    };
    # save Add Cover Page
    ($type == 105) && do {
      my ($hardCopyCSS,%definedCSS,$coverPage);
      my ($FH,$FHnew);
      my ($status);
      foreach my $key (keys %$params) {
        ($key =~/css/) &&($$params{$key} ne "") && do {
	  # get Class name & item name
	  $key =~ /css([^_]*)_(.*)/;
	  $definedCSS{$1} .= "$2: $$params{$key};";
	};
	($key =~/fieldOWNCSS/) && do {
	  $hardCopyCSS = $$params{$key};
	  chomp $hardCopyCSS;
	};
	($key =~/fieldCoverPage/) && do {
	  $coverPage = $$params{$key};
	};
      } # foreach
      if (($FH = libFile::openTempl($config::htmlAccAddFile)) != 3) {
        if (($FHnew = libFile::openFile_ex("$config::tempDir/temp_add_form.tmpl","RDWR|CREAT"))!= 3) {
	  $status.= "Saved successfully";
	  my ($style)  = 0;
	  while (<$FH>) {
	    (/#CUSTOM_STYLE#/) && do {$style = 1; print $FHnew ($_);};
	    (/#HARD_ADDED_STYLE#/) && do {$style = 2;print $FHnew ($_); };
	    (/<!-- BEGINCHOOSE -->/) && do {$style = 3;print $FHnew ($_); next;};
	    (/#END#/) && do {$style = 0; print $FHnew ($_);next;};
	    (/<!-- ENDCHOOSE -->/) && do {$style = 0;print $FHnew ($_);next;};

	    (!$style) && do {
	      print $FHnew ($_);
	    };
	    
	    ($style == 1) && do {
	      foreach $val (keys %definedCSS) {
	        print $FHnew ("$val { $definedCSS{$val} }\n");
	      }
	      $style = -1;
	    };
	    ($style == 2) && do {
              print $FHnew ($hardCopyCSS."\n");	    
	      $style = -1;
	    };
	    ($style == 3) && do {
              print $FHnew ($coverPage);
              $style = -1;
	    };
	  }# while
	  libFile::closeFile($FHnew);
	  libFile::closeFile($FH);	  
	  libFile::copyFile("$config::tempDir/temp_add_form.tmpl",libAdmin::removeDefault($config::htmlAccAddFile),0666);
	  unlink "$config::tempDir/temp_add_form.tmpl";
	}
	else {
          $status .= "Error open $config::htmlAccAddFile";	
	}
      }
      else {
         $status .= "Error open $config::htmlAccAddFile";
      }
      
      setMenu(1,$status);    
      last SWITCH;   
    };
    
    # save ICON edit
    ($type == 104) && do {
      convertHexaToCharKey($params);
      substPlusWithPauseKey($params);
    
    my ($FH) = libFile::openTempl($config::htmlIcon);
    my ($fContent) = join("", (<$FH>));
    libFile::closeFile($FH);    
    
    # one loop one from NEW,UP,... icon template saved    
    local (%dataConfig,%dataVar);
    %dataVar = ('newEnabled' =>0, 'upEnabled'=>0, 'downEnabled'=>0,
                'stquoEnabled'=>0,'longEnabled'=>0 );
    
    foreach (keys %$params) {
      if (s/config:://) {
        $dataConfig{$_} = $$params{"config::$_"};
      }
      if (s/var:://) {
        $dataVar{$_} = $$params{"var::$_"};        
      }
      
      if (/fieldICON(.*)/) {
        my ($type) = $1;
	if ($fContent =~ /ICON_SECTION_$type/) {
          $fContent =~ s/(ICON_SECTION_$type[^>]*>).*(<!-- %#END_$type)/"$1\n$$params{$_}$2"/gise;
	}
	else {
	  $fContent .= "<!-- %#ICON_SECTION_$type#% -->\n$$params{$_}\n<!-- %#END_$type -->";
	}
      }
    }
    
    
    foreach my $type ('Config','Var') {
      local $xxx;
      $xxx = "data".$type;
      my ($FHOld) = libFile::openFile_ex("$config::cgi_root/data/".lc($type).".dat","RDWR");
      my ($FHNew) = libFile::openFile_ex("$config::cgi_root/data/".lc($type).".new","RDWR|CREAT");
      if (($FHOld != 3)  &&   ($FHNew != 3)) {
        libAdmin::updateConf($FHOld,$FHNew,\%{$xxx});
        libFile::closeFile($FHOld);
        libFile::closeFile($FHNew);  
        rename("$config::cgi_root/data/".lc($type).".new","$config::cgi_root/data/".lc($type).".dat");
      } 
      else {
	    $status = 0;libError::logError("Error saving Config.dat,Var.dat changes",$0);
	  }
        }

    
    

    my ($FH) = libFile::openFile($config::htmlIcon,"RDWR|CREAT");
    print $FH ($fContent);
    libFile::closeFile($FH);    
    setMenu(1,$status);    
    last SWITCH;   

    };

    # Acc Add Save 
    ($type == 103) && do {
    my ($index);
    my ($buff);
    my (@multiStatus);
    my (%redParams);
         my($status) = "Nothing to save.";
MAINXX: foreach my $index (0..$var::newAccBoxes-1) {
      $index .= "field";
      foreach  ( keys  %$params) {
              $buff = $_;
        if (/$index/) {
          s/\d*//;
	  if (   (($redParams{$_} = $$params{$buff}) eq "")&& ($_ eq "fieldAcc")) {next MAINXX;}
	}
      }	
      
   if ( libAdmin::accSave($redParams{'fieldAcc'},\%redParams)) { libStat::statReg();$status = libAdmin::getStatusMessage('saveOK');}
   else { push (@multiStatus,"$redParams{'fieldAcc'}" );
   }
   }

#redhat    
     if (scalar @multiStatus) {
     $status = libAdmin::getStatusMessage('saveNOK') . "(@multiStatus)";
     }
     setMenu(1,$status);
      last SWITCH;   
    };

    # Save Edit Mail
    ($type == 11) && do {
     SW4: {	
     my (%hash) = (
     "emailReportSubject{'acc'}" => $$params{'fieldSubjAdd'},
     "emailReportSubject{'deleted'}" => $$params{'fieldSubjDel'},
     "emailReportSubject{'inactive'}" => $$params{'fieldSubjInact'}
     );
     my ($FH) = libFile::openFile_ex("$config::varPath","RDWR");
     my ($FHn) = libFile::openFile_ex("$config::varPath"."xxx","RDWR|CREAT");
     if ( ($FH != 3) && ($FHn != 3) ) {
       libAdmin::updateConf($FH,$FHn,\%hash);
       libFile::closeFile($FH);  libFile::closeFile($FHn);
       rename("$config::varPath"."xxx",$config::varPath);
     }
     else {
       # L198746
       libError::logError("Error update Config.dat/Var.dat in admin.cgi label L198746",$0);
     }
       foreach ('Header','Footer','Delete','Inactivity') {
         if (!(libAdmin::saveTempl(1,$_,'Html',$params))  || !(libAdmin::saveTempl(1,$_,'Text',$params))  ) {
           $status = libAdmin::getStatusMessage('saveMailNOK');
	   last SW4;
         }
       }
       $status = libAdmin::getStatusMessage('saveMailOK');     
     }     
     setMenu(1,$status);
     last SWITCH;   
    };
    
   ($type == 16) && do {
     my ($status) =  libAdmin::getStatusMessage('retOK');     
     setMenu(1,$status);
     last SWITCH;   
   };
   ($type == 17) && do {
     libAdmin::sendMailFromMenu(3,$$params{'fieldSubject'},$$params{'fieldBody'},$$params{'acc'});
     my ($status) =  libAdmin::getStatusMessage('retOK');     
#     setMenu(1,$status);
     
     my (@list);
     
     @list = chooseAccBy($$params{"chooseby"},$$params{"textuname"});
     if (scalar @list) {
       sortAccBy($$params{"selby"},\@list);
       setMenu(2,$params,\@list,$$params{"perpage"},$$params{"chooseby"},$$params{"selby"},$$params{"last"},$$params{'textuname'});
     } else {
       setMenu(1,libAdmin::getStatusMessage('accDNExist'));    
     }
 
     last SWITCH;   
   };


    # Check admin's password
    ($type == 12) && do {
      if (crypt($$params{$var::adminPWD},substr($$params{$var::adminPWD},0,2)) eq $config::adminPWD) {
#	if ($var::mailAfterInactivity) {libAdmin::sendMailInactive();}
      libLog::logAction("Pwd checked"); 
        setMenu(999);
    #    setMenu(1,"sendpwd254");
      }
      else{
        libLog::logAction("Pwd wrong"); 
        setMenu(666);
      }
     last SWITCH;   
    };


    # Save Setup Changes
    ($type == 13) && do {
      convertHexaToCharKey($params);
      substPlusWithPauseKey($params);
      my($status) = libAdmin::saveSetup($params);
      
      if ($status) {
       # dont's want from user to enter pwd when changed in setup
#	if (! $var::htAccessUse) {
	  $status =~ s/.(.*)/$1/;
	  $cookies = "Set-cookie: $var::cookieVarName=$status\n";
#	}
        $status = libAdmin::getStatusMessage('saveSETUPOK');     	
      }
      else{
        $status = libAdmin::getStatusMessage('saveSETUPNOK');           
      }
      
      setMenu(1,$status); 
     last SWITCH;   
    };

    # Statistic 
    ($type == 18) && do {
      # gen stat
      setMenu(200,$params);
     last SWITCH;   
    };




    # Save Words Changes
    ($type == 15) && do {
      $status = libAdmin::saveWords($params);
      if ($status) {
        $status = libAdmin::getStatusMessage('saveWORDSOK');     
      }
      else{
        $status = libAdmin::getStatusMessage('saveWORDSNOK');           
      }
      
      setMenu(1,$status); 
     last SWITCH;   
    };



   # save breaks
   ($type == 9) && do {
     my ($index) =  $$params{'index'};
     my (@breaks) = libGenList::getBreaksEx($index);
     my $temp;
     my ($FH);
     SW5:{
     foreach my $i (@breaks) {
       $temp = $$params{'fieldBreak'.$i};
       if ($temp ne "")  {
         $FH = libFile::openFile_ex(libList::genBreakFN($index,$i),"RDWR|CREAT");
	 if ($FH != 3) {
	   print $FH ($temp);
	   libFile::closeFile($FH);
	 }
	 else {
	   $status = libAdmin::getStatusMessage('saveBreakNOK');     
	   last SW5;
	 }
       }
       elsif ( ($temp eq "") && ( -e libList::genBreakFN($index,$i))) {
         unlink libList::genBreakFN($index,$i);
       }
     }
       $status = libAdmin::getStatusMessage('saveBreakOK');          
     }
    setMenu(1,$status); 
   last SWITCH;   
  }


 
 }

 

}

# ---------------------------------------------
#
# choose by 
# Input:  type, reference to list
# Output: ---
#
# ---------------------------------------------
sub sortAccBy {
my ($type) = shift;
my ($list) = shift;
my (%hash,%database,%temp);
SWITCH: {

  # 1- by actual 0-IN
  ( ($type <= 11) && ($type >= 6) ) && do {
  
      my (%hash) = (10,$var::record{'in'},11,$var::record{'out'},
	        6,$var::record{'joindate'},8,$var::record{'inactivity'},
		7,$var::record{'in'},9,$var::record{'mail'}
    );
    libFile::openDBM(\%database,$config::account_database,0);
#    print @$list;
    foreach my $acc (@$list) {
    $temp{$acc} = (split(/\|/,$database{$acc}))[$hash{$type}];
#    print $temp{$acc}."-\n";    
    }
    # sort by IN descen...
    if ($type == 7) {
#    print @$list;  
  
      @$list = sort {$a cmp $b} (keys %temp);    

    }
    elsif ($type == 9){
#    print @$list;  
  
      @$list = sort {$temp{$a} cmp $temp{$b}} (keys %temp);    

    }
    else {
      @$list = sort {$temp{$b} <=> $temp{$a}} (keys %temp);
    }  
    libFile::closeDBM(\%database);
    last SWITCH;
  };
  
  # By total IN/OUT day IN/OUT week IN/OUT month IN/OUT
  ( ($type >= 20) && ($type <= 51)) && do {

    my (%hash) = (20,$var::stat{total_in},21,$var::stat{total_out},
	        30,$var::stat{day_in},31,$var::stat{day_out},
	        40,$var::stat{week_in},41,$var::stat{week_out},		
	        50,$var::stat{month_in},51,$var::stat{month_out}    
    );
    
    libFile::openDBM(\%database,$config::stat_database,0);
    foreach my $acc (@$list) {
      $temp{$acc} = (split(/\|/,$database{$acc}))[ $hash{$type} ];

    }
    # sort by OUT descen...
    @$list= sort {$temp{$b} <=> $temp{$a}} (keys %temp);
    libFile::closeDBM(\%database);
    
    last SWITCH;    
  };


} # switch
}
# ---------------------------------------------
#
# choose by 
# Input:  type 
# Output: array of accounts that match ...
#
# ---------------------------------------------
sub chooseAccBy {
my ($type) = shift;
my ($name) = shift;
my @list;
my (%acc,%statx);
my @temp;
libFile::openDBM(\%acc,$config::account_database,0);
SWITCH: {
     # only inactives
     ($type == 2) && do {

       foreach my $acc (keys %acc) {
         @temp = split(/\|/,$acc{$acc});
         if ($temp[$var::record{'inactivity'}] < 0) {
	   push(@list,$acc);
         }
       }
       last SWITCH;
     };
     
     # only new
     ($type == 4) && do {

       foreach my $acc (keys %acc) {
         @temp = split(/\|/,$acc{$acc});
         if ( ($temp[$var::record{'new'}]&1) == 1) {
	   push(@list,$acc);
         }
       }
       last SWITCH;
     };

     # only modif
     ($type == 5) && do {

       foreach my $acc (keys %acc) {
         @temp = split(/\|/,$acc{$acc});
         if ( ($temp[$var::record{'modif'}]&2) == 2) {
	   push(@list,$acc);
         }       
       }
       last SWITCH;
     };



     # only actives
     ($type == 1) && do {

       foreach my $acc (keys %acc) {
         @temp = split(/\|/,$acc{$acc});
         if (($temp[$var::record{'inactivity'}])>= 0) {
	   push(@list,$acc);
         }
       }
       last SWITCH;
     
     };

     # all
     ($type == 3) && do {

       @list  = keys %acc;
       last SWITCH;
     
     };

     # NAME  in $type is now string, so in scalar contect it is ZERO
     ($type == 6) && do {
     SW: {
	    libLog::logAction("SW");	        
     if ($name eq "") {last SW;}
     my ($position) = 0;
     if ( $name =~ /^\*/) { $position = 1;}
     if ( $name =~ /\*$/) { $position = 2;}
     if (( $name =~ /\*$/) && ($name =~ /^\*/)) { $position = 3;}
     $name =~ s/\*//g;
     if ($name eq "") {$name=".*"}
       libLog::logAction("type: $name");
       foreach my $acc (keys %acc) {
         if ($position == 0) {
           if ($acc eq $name) {
	    libLog::logAction("0 acc:$acc type: $name");
	     push(@list,$acc);
	   }
	 }
	 elsif ($position == 1) {
           if ($acc =~ /$name$/) {
	    libLog::logAction("1 acc:$acc type: $name");	   
	     push(@list,$acc);
	   }
	 
	 }
	 elsif ($position == 2) {
           if ($acc =~ /^$name/) {
	    libLog::logAction("2 acc:$acc type: $name");	   
	     push(@list,$acc);
	   }
	 
	 }
	 elsif ($position == 3) {
           if ($acc =~ /$name/) {
	    libLog::logAction("3 acc:$acc type: $name");	   
	     push(@list,$acc);
	   }
	 
	 }
	 
       } # foreach
       
       };
       last SWITCH;       
};
     
}
libFile::closeDBM(\%acc);
return @list;
}



sub getHotInfo  {
my (@data) = (
         "<table border=\"0\" cellspacing=\"0\" cellpadding=\"0\"><tr>",
	 "<td class=\"alarmText\">&nbsp;</td>",
         "<td class=\"alarmText\"> [New Accs:".libAccount::getNewCount()."]</td>",
	 "<td class=\"alarmText\">&nbsp;</td>",	 
	 "<td class=\"alarmText\" > [Max Bot:".libStat::getMaxBot()."]</td>",
	 "</tr></table>"
             );
return (@data);
}


sub setMenu {
my ($type) = shift;
SWITCH: {
   # Main menu
   if ($type != 999) {print "Content-type: text/html\n";
                      print "$cookies\n";
   }
   
   ($type == 1) && do {
     my ($statusText) = shift;
     
     # if 1 -> load mail list
     my ($typeX) = shift;
     if ($statusText==333) {
       $statusText = join("", join("",getHotInfo() ));
     }
     if (!$statusText) {$statusText= ""};

     my ($FH) = libFile::openTempl($config::html_admin_main,0);
     my ($status) = 0;
     my ($indexes) = libGenList::getIndexCount();
     my $line;
     my (%serverInfo)  = libAdmin::getServerInfo();
     while (<$FH>) {
     libAdmin::parseID(\$_);
     s/(#%STBAR_[^#]*#)/$serverInfo{$1}/gise;
     s/$var::htmlAdminStatus/$statusText/;
      if (/$var::htmlAdminEditHtmlB/ && /$var::htmlAdminEditHtmlE/){
         /$var::htmlAdminEditHtmlB(.*)$var::htmlAdminEditHtmlE/;
         my ($temp) = $1;
	 my ($temp_c) = $1;
         for (my ($i) = 1;$i<=$indexes;$i++) {
	   $temp_c = $temp;
	   $temp_c =~ s/$var::htmlAdminEditHtmlValue/$i/;
	   $temp_c =~ s/$var::htmlAdminEditHtmlDisplay/libGenList::getIndexName($i)/e;	   
	   print $temp_c."\n";
         }
	next; 
       }

      if (/$var::htmlAdminEditBreakB/ && /$var::htmlAdminEditBreakE/){
         /$var::htmlAdminEditBreakB(.*)$var::htmlAdminEditBreakE/;
         my ($temp) = $1;
	 my ($temp_c) = $1;
         for (my ($i) = 1;$i<=$indexes;$i++) {
	   $temp_c = $temp;
	   $temp_c =~ s/$var::htmlAdminEditBreakValue/$i/;
	   $temp_c =~ s/$var::htmlAdminEditBreakDisplay/libGenList::getIndexName($i)/e;
	   print $temp_c."\n";
         }
	next; 
       }
       if (loadMailList($typeX,\$_)) {
         next;
       }
       


        s/action\s*\=\s*\"([^\"]*)\"/"action = \"$var::html_admin_display{$1}\""/gise;
       
       print;
     }
    libFile::closeFile($FH);
   last SWITCH;
   };
  
   ($type == 2) && do {

     my ($params) = shift;   
     my ($accs) = shift; #reference to array
     my ($perpage) =shift;
     my ($fName) = 1;
     #			   in contest with acc count as infinity
     $perpage = ($perpage eq 'all')?10000000:$perpage;
     my ($typex) = shift;
     my ($by) = shift;
     my ($last) = shift;
     my ($uname) = shift;#$$params{"textuname"}     
     my ($FH) = libFile::openTempl($config::html_admin_acc_view,0);
     my ($status) = 0;
     my (@detail,@head,@foot);
     my ($ok) =0; 
     my ($end) =0; 
     my $link;
     my ($next) =  (((defined $last) && ($last))?++$last:0);
     my ($LabelBeg) = $next+1;
     my ($top) = $next+$perpage-1;
     if ($top >= scalar @$accs-1) {
       $top = scalar @$accs -1;
       $end++;
     }  
     my ($LabelEnd) = $top+1;
     my ($nrTolink) = 0;
     
     if (!$end) {$nrTolink = $top;}
     my ($env) = $ENV{'QUERY_STRING'};
     if ($env eq "") {$env = $$params{'env'};}
     $env =~ s/&last\s*=\s*\w*//;
     
     $env =~ s/ /+/;     
     $link = "$config::admin_cgi\?$env&last=$nrTolink";     
     my (@vars) = ("<input type=\"hidden\" name=\"selby\" value=\"$by\">",
    		   "<input type=\"hidden\" name=\"perpage\" value=\"$perpage\">",
		   "<input type=\"hidden\" name=\"chooseby\" value=\"$typex\">",
		   "<input type=\"hidden\" name=\"last\" value=\"".($last-1)."\">",
		   "<input type=\"hidden\" name=\"env\" value=\"$env\">",
		   "<input type=\"hidden\" name=\"textuname\" value=\"$uname\">"	   		   
     );

     while (<$FH>) {
       libAdmin::parseID(\$_);   
       if (! $var::useAccViewAlarm) {
         s/regIt\(this\)\;?//;
       }
       (/$var::html_admin_acc_view{'begin'}/) && do {
         $status =1;
	 next;
       };
       (/$var::html_admin_acc_view{'end'}/) && do {
         $status =2;
	 next;	 
       };
       if (!$status) {

         s/$var::adminAccViewInfo{'interval'}/$LabelBeg." - ".$LabelEnd/gise;
         s/$var::adminAccViewInfo{'type'}/$var::accSelected{$typex}/e;
         s/$var::adminAccViewInfo{'by'}/$var::accSortedBy{$by}/e;
	 s/$var::adminAccViewInfo{'next'}/$link/e;
	 s/$var::adminAccViewInfo{'back'}/"$config::admin_cgi\?action=$var::htmlAdminRetFromAView"/e;
         push(@head,$_);
       
         }
       if ($status == 2) {
       	 s/$var::adminAccViewInfo{'next'}/$link/e;
	 s/$var::adminAccViewInfo{'back'}/"$config::admin_cgi\?action=$var::htmlAdminRetFromAView"/e;	 
         push(@foot,$_);	 
         }
	 
       if ($status == 1) {
            s/#%INPUT_VARIABLES%#/"@vars"/e;
            s/($var::html_admin_cgi)/$var::html_admin_display{$1}/gise;
         push(@detail,$_);
       }

     } #while


# print HEADER	
	 print @head;
# print BODY
         my (@cut) = @$accs[$last..$top];
	 my ($fName) =0;
	 my ($bodyView);
	 my ($counter) = 1;
	 my ($counterX) = 0;
GEN:{	 foreach my $acc (@cut) {
	   $bodyView  = join("", libAdmin::fillDetail($acc,$last+$counter++,\@detail,$fName++) );
	   $bodyView  =~ s/(tabindex\s*\=\s*\")(\d*)/"$1". (($counterX*30)+$2)/ige;
	   print $bodyView;
	   $counterX++;
	  }
     } # gen
     
# print FOOTER 
         print @foot;
	 print "\n";

     
    libFile::closeFile($FH);
   last SWITCH;
   };
   
   ($type == 10) && do {
   
     my ($index) =  shift;
     my (@body,@head,@foot);
     # Template for html edit form
     my ($FH) = libFile::openTempl($config::htmlAdminEditTempl,0);
     # Templates for "index" /header,body,footer/
     my ($FHHeader) = libFile::openTempl(libList::getTemplFNHeader($index),0);     
     my ($FHFooter) = libFile::openTempl(libList::getTemplFNFooter($index),0);       
     my ($FHBody) = libFile::openTempl(libList::getTemplFNData($index),0);         

     my ($FNHeader) = libFile::getTemplName(libList::getTemplFNHeader($index),0);     
     my ($FNFooter) = libFile::getTemplName(libList::getTemplFNFooter($index),0);       
     my ($FNBody) = libFile::getTemplName(libList::getTemplFNData($index),0);         

     my $separator;
     $separator = $";
     $" = "";
 
     # Fills array with full context of there files
     #LABEL - DONT' DELETE IT    
     #labelC3320011
     
     @body = (<$FHBody>);
     @head = (<$FHHeader>);     
     @foot = (<$FHFooter>);     
     
     libAdmin::showAmp(\@body);
     libAdmin::showAmp(\@head);
     libAdmin::showAmp(\@foot);
     my (@helpBody) = libAdmin::genHtmlEditHelp('body');
#     push(@helpBody,"Filename: $FNBody");
     my (@helpFooter) = libAdmin::genHtmlEditHelp('footer');;
#     push(@helpFooter,"Filename: $FNFooter");     
     my (@helpHeader) = libAdmin::genHtmlEditHelp('header');;
#     push(@helpHeader,"Filename: $FNHeader");     
     while (<$FH>) {
       libAdmin::parseID(\$_);
       s/$var::htmlAdminEditTemplBody/"@body"/e;
       s/$var::htmlAdminEditTemplHeader/"@head"/e;	  
       s/$var::htmlAdminEditTemplFooter/"@foot"/e;
       
       s/_#HELP_PATH_HEADER#_/"Filename: $FNHeader"/e;
       s/_#HELP_PATH_FOOTER#_/"Filename: $FNFooter"/e;
       s/_#HELP_PATH_BODY#_/"Filename: $FNBody"/e;
       
       s/$var::htmlAdminEditTemplHeaderHelp/"@helpHeader"/e;
       s/$var::htmlAdminEditTemplBodyHelp/"@helpBody"/e;
       
       s/$var::htmlAdminEditTemplFooterHelp/"@helpFooter"/e;
       s/$var::htmlAdminEditTemplHeaderHelp/"@helpHeader"/e;
       s/$var::htmlAdminEditTemplBodyHelp/"@helpBody"/e;

       s/$var::htmlAdminEditIndex/$index/e;
       s/action\s*\=\s*\"([^\"]*)\"/"action = \"$var::html_admin_display{$1}\""/gise;
       print;
     }
     $" = $separator;     
     last SWITCH;
   };

   ($type == 11) && do {
     my ($index) =  shift;
     my ($breakCount) = libGenList::getBreaks($index);
     my (@breaks) = libGenList::getBreaksEx($index);


     
     # Template for html edit form
     my ($FH) = libFile::openTempl($config::htmlAdminEditBreak,0);
     my ($status) = 0;
     my $snapShot;
     # Templates for "index" /header,body,footer/

     if ($FH != 3) {
     while (<$FH>) {
       libAdmin::parseID(\$_);
       s/$var::htmlAdminEditBreakIndex/libGenList::getIndexName($index)/ge;
       s/$var::htmlAdminEditIndex/$index/ge;   
       s/action\s*\=\s*\"([^\"]*)\"/"action = \"$var::html_admin_display{$1}\""/gise;
       (/$var::htmlAdminEditBreakBegin/) && do {
         $status = 1;next;       };
       (/$var::htmlAdminEditBreakEnd/) && do {
         $status = 2;next;       };
       
       ($status == 1) && do {
         $snapShot .= $_; next;
       };
       
       ($status == 2) && do {
         my $tempSH = $snapShot;
	 my $FHBreak;
	 my @data;
	 my $info;
	 foreach my $i (@breaks) {
	   $tempSH = $snapShot;
           $tempSH =~ s/$var::htmlAdminEditBreakLabel/"Break position \"".$i."\" in index \"".libGenList::getIndexName($index)."\""/ge;
           $tempSH =~ s/$var::htmlAdminEditBreakField/"fieldBreak".$i/ge;	 
           $FHBreak = libFile::openTempl(libList::getBreakFN($index,$i),0);
           $info = libFile::getTemplName(libList::getBreakFN($index,$i),0);
	   @data = <$FHBreak>;
	   my $separator;
	   $separator = $";
	   $" = "";
    	   libAdmin::showAmp(\@data);
           $tempSH =~ s/$var::htmlAdminEditBreakData/"@data"/ge;
	   $tempSH =~ s/$var::infoEditFile{'htmlBreak'}/"$info"/ge;       
	   $" = $separator;
	   libFile::closeFile($FHBreak);
	   print $tempSH;
	 }
	 $status = 0;
       };
       print;  
     }
     } else {
       liberror::logerror("error reading template for break edit","admin.cgi");
     }
     last SWITCH;
   };

# Edit Mail header,footer, delete mail, inactivity mail
   ($type == 12) && do {
     my ($FH) = libFile::openTempl($config::htmlAdminEditMail,0);
     my %data;
     my ($counter) = 0;
     my (%FH,%FN);
     my $FHX;
     # Text & Html version of templates
     foreach my $version ('Text','Html') {
       foreach my $item ('Header','Footer','Delete','Inactivity') {
         my ($ref) =  "config::reportAcc".$item.$version;
         $FHX = libFile::openTempl(${$ref},0);
         $FN{uc $item}{uc $version} = libFile::getTemplName(${$ref},0);	 
	 my (@temp) = (<$FHX>);
	 $data{uc $item}{uc $version} = join("",@temp);
       }
     }  
     
##%INFO_HEADER_TEXT%#
#<textarea name="fieldHEADERTEXT" cols="100">_#VAL_TEXT_HEADER#_</textarea>
     
     
     my (@help) = libAdmin::genHtmlEditHelp('maildel');
     my (@helpInact) = libAdmin::genHtmlEditHelp('mailinact');
     
     my ($separator) = $";
     $" = "";
     my (%subj) = (
     "#%SUBJ_DEL%#" => $var::emailReportSubject{'deleted'},
     "#%SUBJ_ADD%#" => $var::emailReportSubject{'acc'},
     "#%SUBJ_INACT%#" => $var::emailReportSubject{'inactive'}
     );

     if ($FH != 3) {
       while (<$FH>) {
         libAdmin::parseID(\$_);
	 s/(#%SUBJ_[^%]*%#)/$subj{$1}/e;
         s/action\s*\=\s*\"([^\"]*)\"/"action = \"$var::html_admin_display{$1}\""/gise;
	 
	 # this one line fills all template's textareas
	 s/_#VAL_([^_]*)_([^#]*)#_/$data{$2}{$1}/ge;
	 s/#%INFO_([^_]*)_([^%]*)%#/$FN{$1}{$2}/ge;	 
	 
	 s/$var::htmlAdminEditMailDeleteHelp/"@help"/ge;
	 s/$var::htmlAdminEditMailInactHelp/"@helpInact"/ge;	 
	 print;
       }  
     $" = $separator;  
     } else {
       liberror::logerror("error reading template for mail edit","admin.cgi");
     }
     last SWITCH;
   };

# Edit Add Form
   ($type == 1016) && do {
     my ($FH) = libFile::openTempl($config::htmlAdminAddEdit,0);     
     my ($FHtempl) = libFile::openTempl($config::htmlAccAddFile,0);     
     my ($data);
     my (%css);
     my ($i);     
     # classes separated by ,
     my ($hatchClass) = "body,.mainTitle,.subTitle,.fieldLabel,.inputValue,.infoText,.choose,.help,.error";
     # values in classes ,
     my ($hatchItem) = "color,font-weight,font-size,font-family,background-color";
     my ($class);
     my ($hardCopy);     
     if ($FHtempl != 3) {
       my ($status) = 0;
       while (<$FHtempl>) {
         (/#END#/)&& do {$status = 0; next;};       
         (/#CUSTOM_STYLE#/)&& do {$status = 2; next;};
         (/#HARD_ADDED_STYLE#/)&& do {$status = 3; next;};	 
         (/<!--\s*BEGINCHOOSE\s*-->/) && do {$status = 1; next;};
	 (/<!--\s*ENDCHOOSE\s*-->/) && do {$status = 0; next;};
         ($status==1) && do {$data .= $_;};
	 # get hard copied CSS definitions
         ($status==3) && do {$hardCopy.=$_};
         ($status==2) && do {
	   my ($x,$y);
           /([^{]*){?\s*([^:]*):?([^(;|})]*)(;|})?\s*([^:]*):?([^(;|})]*)(;|})?\s*([^:]*):?([^(;|})]*)(;|})?\s*([^:]*):?([^(;|})]*)(;|})?\s*([^:]*):?([^(;|})]*)(;|})?\s*}?/;
           for ($i=1;$i<20;$i++) {
             $x = ${$i};
             $y = ${$i+1};    
	     # do some clean
             $x =~ s/\s*//gise;  $y =~ s/\s*//gise;
             $x =~ s/\n*//gise;  $y =~ s/\n*//gise;  
	     # find start of the class
             if ( ($hatchClass =~ /$x/) && ($x ne "")) {
	       libLog::logAction("class defined class: $x");	       
               $class = $x;
	     }
             if (($hatchItem =~ /$x/) && ($x ne "") &&  ($y ne "") &&  ($class ne "")  ) {
               $css{$class}{$x}=$y;
#	       libLog::logAction("class=$class, item=$x, val = $y");
             }
           }
	 }; #status 2
       }# while
     }
     else {
       liberror::logerror("error reading template: $config::htmlAccAddFile","admin.chi");
     }
    # prepare classes
    my ($help);
    foreach $mkey (keys %var::genAddForm) {
      $help .= "$var::genAddForm{$mkey}{'val'} - $var::genAddForm{$mkey}{'def'} <BR>\n";
    }
    my (@data) = $data;
    libAdmin::showAmp(\@data);
    $data = join("",@data);
    while (<$FH>) {
      libAdmin::parseID(\$_);
      s/%#VAR_INFO#%/$help/e;
      s/%#OWN_CSS#%/$hardCopy/e;
      s/value\s*=\s*\"css([^\_]*)\_([^\"]*)\"/"value=\"$css{$1}{$2}\""/e;
      s/%#VAL_ICON_UP#%/$data/e;
      s/_#ADMIN_CGI#_/$config::admin_path/e;      
      print;
    }
    last SWITCH;
   };
   

# Edit Mail header,footer, delete mail, inactivity mail
   ($type == 1015) && do {
     my ($FH) = libFile::openTempl($config::htmlAdminEditIcon,0);
     my ($FHIcons) = libFile::openTempl($config::htmlIcon,0);
     local (@iconNEW,@iconUP,@iconDOWN,@iconSTQUO,@iconLONG);
     my ($section);
     my ($sep)  = $";
     $" = "";
     if ( ($FH != 3) && ($FHIcons != 3) ) {
       while (<$FHIcons>) {
         if (/(%#ICON_SECTION_(.*)#%)/) {$section = $2;  next;}
	 if (/<!-- %#END_/) {next;}
         push(@{"icon$section"},$_);

       }
       libAdmin::showAmp(\@iconNEW);       libAdmin::showAmp(\@iconUP);
              libAdmin::showAmp(\@iconDOWN);              libAdmin::showAmp(\@iconSTQUO);
	                    libAdmin::showAmp(\@iconLONG);
       while (<$FH>) {
         libAdmin::parseID(\$_);
         s/action\s*\=\s*\"([^\"]*)\"/"action = \"$var::html_admin_display{$1}\""/gise;	 
         s/%#VAL_ICON_(.*)#%/"@{\"icon$1\"}"/ge;
         s/(value\s*=\s*\")((var|config)::[A-Za-z0-9_]*)/"$1${$2}"/ge;	 	 
         s/(type\s*=\s*\"checkbox\")(.*)((var|config)::[A-Za-z0-9_]*)\s*\>/"$1$2". ((${$3}==1)?"checked>":">")/ge;
	 print;
       }
     }
     else {
       libError::logError("Error open file:$config::htmlAdminEditIcon OR $config::htmlIcon in file $!",$0);
     }
     $" = $sep;
     last SWITCH;
   };


# Edit restricted strings
   ($type == 14) && do {
     my ($FH) = libFile::openTempl($config::htmlAdminEditWords,0);
     my (@data1,@data2);
     # Templates for "index" /header,body,footer/
     
     # Text version
     @data1 = libAdmin::getRestrWords();
     @data2 = libAdmin::getRestrUrls();
     
     my ($separator) = $";
     $" = "";
     
     if ($FH != 3) {
       while (<$FH>) {
         libAdmin::parseID(\$_);
         s/action\s*\=\s*\"([^\"]*)\"/"action = \"$var::html_admin_display{$1}\""/gise;
         s/$var::htmlAdminEditMailWords/"@data1"/ge;
         s/$var::htmlAdminEditMailUrls/"@data2"/ge;
	 s/$var::infoEditFile{'blackWords'}/$config::restrictedWords/ge;
	 s/$var::infoEditFile{'blackUrls'}/$config::restrictedUrls/ge;	 
	 print;
       }  
     $" = $separator;  
     } else {
       liberror::logerror("error reading template for mail edit","admin.cgi");
     }
     last SWITCH;
   };


   #gen Setup Form
   ($type == 111) && do {
     libAdmin::setupForm(shift);
     last SWITCH;   
   };
   #gen Authentif. Form
   ($type == 666) && do {
     libAdmin::authForm();
     last SWITCH;   
   };
  #admin acc add
   ($type == 1212) && do {
     libAdmin::frmAccAdd();
     last SWITCH;   
   };


   #gen Main frame set
   ($type == 999) && do {
     libAdmin::mainFrameset();
     last SWITCH;   
   };



   #gen stat total date form
   ($type == 200) && do {
     # $params shifted
     libAdmin::frmStatTotalDate(shift);
     last SWITCH;   
   };


   #gen Authentif. Error
   ($type == 665) && do {
     libAdmin::authFailed();
     last SWITCH;   
   };


   
}
}

sub substPlusWithPause{
my ($param) = shift;
my ($key,$value);

while (($key,$value) =  (each %$param)) {
    $value =~ s/\+/" "/eg;
    $$param{$key} = $value;
  }
}



sub substPlusWithPauseKey{
my ($param) = shift;
my ($key,$value);

while (($key,$value) =  (each %$param)) {
    delete $$param{$key};
    $key =~ s/\+/" "/ge;
    $$param{$key} = $value;
  }
}




sub convertHexaToCharKey {
my ($param) = shift;
my ($key,$value);
while (($key,$value) =  (each %$param)) {
    delete $$param{$key};
    $key =~ s/%([\dA-Fa-f][\dA-Fa-f])/pack ("C",hex ($1))/eg;
    $$param{$key} = $value;
  }
}


sub convertHexaToChar {
my ($param) = shift;
my ($key,$value);
while (($key,$value) =  (each %$param)) {
    $value =~ s/%([\dA-Fa-f][\dA-Fa-f])/pack ("C",hex ($1))/eg;
    $$param{$key} = $value;
  }
}

# ---------------------------------------------
#
# Generates ADD account dialog 
# Input:  ---
# Output: ---
#
# ---------------------------------------------

sub validateInput {
my ($param) = shift;
my ($type) = shift;
my ($invalid) = 0;
my ($field) = 0;

$lib5::header_posted = 0;

  #  -----------------------------------------------------------------------
  #  ---------------- Validated input form ADD Account field---------------------
  $field = $var::acc;
  if (defined $$param{$var::form{'setup_form'}{$field}}) {  
  SWITCH: {  
    # --------- Validate ACCOUNT field, if match max.number of chars

    $var::formCheck{$field}{$var::checkMax} &&
      (length($$param{$var::form{'setup_form'}{$field}})
               > $var::inputRestr{$field.'_max_chars'})  && do{ $invalid = 1; last SWITCH;};

    # --------- Validate ACCOUNT field, if match min.number of chars
    (defined $$param{$var::form{'setup_form'}{$field}}) &&    
    $var::formCheck{$field}{$var::checkMin} &&
      (length($$param{$var::form{'setup_form'}{$field}})
               < $var::inputRestr{$field.'_min_chars'})  && do{ $invalid = 3; last SWITCH;};
	     
    # --------- Validate ACCOUNT field, if ommits wrong words
    (defined $$param{$var::form{'setup_form'}{$field}}) &&    
    $var::formCheck{$field}{$var::checkWord} &&
      (isInChosenWords($$param{$var::form{'setup_form'}{$field}})) &&
                                           do {$invalid = 2;last SWITCH;}; 
    
   
  }
  
  SWITCH : {
    ($invalid == 1) && do {lib5::error_message_param($config::lang,1051,$var::error_field{$field}."<BR> Max is:&nbsp;".$var::inputRestr{$field.'_max_chars'});last SWITCH;};
    ($invalid == 2) && do {lib5::error_message_param($config::lang,1050,$var::error_field{$field});last SWITCH;};    
    ($invalid == 3) && do {lib5::error_message_param($config::lang,1052,$var::error_field{$field}."<BR> Min is:&nbsp;".$var::inputRestr{$field.'_min_chars'});last SWITCH;};        
  }
  
  }
 # -------- if $invalid = 0 then ACCOUNT field contains valid data ---------
 # -------------------------------------------------------------------------



 #  -----------------------------------------------------------------------
 #  ---------------- Validated input form ADD PWD field ---------------------
  $field = 'pwd';
  if (defined $$param{$var::form{'setup_form'}{$field}}) {    
  SWITCH: {  
  # --------- Validate PWD field, if match max.number of chars
    (defined $$param{$var::form{'setup_form'}{$field}}) &&  
   $var::formCheck{$field}{$var::checkMax} &&
    (length($$param{$var::form{'setup_form'}{$field}})
             > $var::inputRestr{$field.'_max_chars'})  && do{ $invalid = 1; last SWITCH;};

   $var::formCheck{$field}{$var::checkMin} &&
    (length($$param{$var::form{'setup_form'}{$field}})
             < $var::inputRestr{$field.'_min_chars'})  && do{ $invalid = 3; last SWITCH;};
	     
  # --------- Validate ACCOUNT field, if ommits wrong words
     $var::formCheck{$field}{$var::checkWord} &&
    (isInChosenWords($$param{$var::form{'setup_form'}{$field}})) &&
					do {$invalid = 2;last SWITCH;}; 

  }
  
  SWITCH : {
    ($invalid == 1) && do {lib5::error_message_param($config::lang,1051,$var::error_field{$field}."<BR> Max is:&nbsp;".$var::inputRestr{$field.'_max_chars'});last SWITCH;};
    ($invalid == 2) && do {lib5::error_message_param($config::lang,1050,$var::error_field{$field});last SWITCH;};    
    ($invalid == 3) && do {lib5::error_message_param($config::lang,1052,$var::error_field{$field}."<BR> Min is:&nbsp;".$var::inputRestr{$field.'_min_chars'});last SWITCH;};        
  }
 }
  
 # -------- if $invalid = 0 then ACCOUNT field contains valid data ---------
 # -------------------------------------------------------------------------






 #  -----------------------------------------------------------------------
 #  ---------------- Validated input form ADD MAIL field ---------------------
 $field = 'mail';
  if (defined $$param{$var::form{'setup_form'}{$field}}) {   
  SWITCH: {  
  # --------- Validate PWD field, if match max.number of chars
     $var::formCheck{$field}{$var::checkMax} &&
    (length($$param{$var::form{'setup_form'}{$field}})
             > $var::inputRestr{$field.'_max_chars'})  && do{ $invalid = 1; last SWITCH;};

   $var::formCheck{$field}{$var::checkMin} &&
    (length($$param{$var::form{'setup_form'}{$field}})
             < $var::inputRestr{$field.'_min_chars'})  && do{ $invalid = 3; last SWITCH;};
	     
  # --------- Validate ACCOUNT field, if is correct syntax
     $var::formCheck{$field}{$var::checkSyntax} &&
    (!checkMail($$param{$var::form{'setup_form'}{$field}})) && do{
                                                  $invalid = 2;last SWITCH;
						}; 
    

  }
  
  SWITCH : {
    ($invalid == 1) && do {lib5::error_message_param($config::lang,1051,$var::error_field{$field}."<BR> Max is:&nbsp;".$var::inputRestr{$field.'_max_chars'});last SWITCH;};
    ($invalid == 2) && do {
      lib5::error_message_param($config::lang,1053,$var::error_field{$field});
      last SWITCH;
    };    
    ($invalid == 3) && do {lib5::error_message_param($config::lang,1052,$var::error_field{$field}."<BR> Min is:&nbsp;".$var::inputRestr{$field.'_min_chars'});last SWITCH;};        
  }
 }
  
 # -------- if $invalid = 0 then MAIL field contains valid data ---------
 # -------------------------------------------------------------------------







 #  -----------------------------------------------------------------------
 #  ---------------- Validated input form ADD TITLE field ---------------------
  $field = 'title';
  if (defined $$param{$var::form{'setup_form'}{$field}}) {    
  SWITCH: {  
  # --------- Validate PWD field, if match max.number of chars
     $var::formCheck{$field}{$var::checkMax} &&
    (length($$param{$var::form{'setup_form'}{$field}})
             > $var::inputRestr{$field.'_max_chars'})  && do{ $invalid = 1; last SWITCH;};

   $var::formCheck{$field}{$var::checkMin} &&
    (length($$param{$var::form{'setup_form'}{$field}})
             < $var::inputRestr{$field.'_min_chars'})  && do{ $invalid = 3; last SWITCH;};
	     
  # --------- Validate ACCOUNT field, if ommits wrong words
     $var::formCheck{$field}{$var::checkWord} &&
    (isInChosenWords($$param{$var::form{'setup_form'}{$field}})) &&
					do {$invalid = 2;last SWITCH;}; 
    

  }
  
  SWITCH : {
    ($invalid == 1) && do {lib5::error_message_param($config::lang,1051,$var::error_field{$field}."<BR> Max is:&nbsp;".$var::inputRestr{$field.'_max_chars'});last SWITCH;};
    ($invalid == 2) && do {lib5::error_message_param($config::lang,1050,$var::error_field{$field});last SWITCH;};    
    ($invalid == 3) && do {lib5::error_message_param($config::lang,1052,$var::error_field{$field}."<BR> Min is:&nbsp;".$var::inputRestr{$field.'_min_chars'});last SWITCH;};          
    }
 }
  
 # -------- if $invalid = 0 then TITLE field contains valid data ---------
 # -------------------------------------------------------------------------





 #  -----------------------------------------------------------------------
 #  ---------------- Validated input form ADD DESCRIPTION field ---------------------
  $field = 'descr';
  if (defined $$param{$var::form{'setup_form'}{$field}}) {    
  SWITCH: {  
  # --------- Validate PWD field, if match max.number of chars
  

  
     $var::formCheck{$field}{$var::checkMax} &&
    (length($$param{$var::form{'setup_form'}{$field}})
             > $var::inputRestr{$field.'_max_chars'})  && do{ $invalid = 1; last SWITCH;};


  
   $var::formCheck{$field}{$var::checkMin} &&
    (length($$param{$var::form{'setup_form'}{$field}})
             < $var::inputRestr{$field.'_min_chars'})  && do{ $invalid = 3; last SWITCH;};
	     

  # --------- Validate ACCOUNT field, if ommits wrong words
     $var::formCheck{$field}{$var::checkWord} &&
    (isInChosenWords($$param{$var::form{'setup_form'}{$field}})) &&
					do {$invalid = 2;last SWITCH;}; 
    

  }
  
  SWITCH : {
    ($invalid == 1) && do {lib5::error_message_param($config::lang,1051,$var::error_field{$field}."<BR> Max is:&nbsp;".$var::inputRestr{$field.'_max_chars'});last SWITCH;};
    ($invalid == 2) && do {lib5::error_message_param($config::lang,1050,$var::error_field{$field});last SWITCH;};    
    ($invalid == 3) && do {lib5::error_message_param($config::lang,1052,$var::error_field{$field}."<BR> Min is:&nbsp;".$var::inputRestr{$field.'_min_chars'});last SWITCH;};        
  }
} 
  
 # -------- if $invalid = 0 then DESCRIPTION field contains valid data ---------
 # -------------------------------------------------------------------------




 #  -----------------------------------------------------------------------
 #  ------------ Validated input form ADD WEBLINK field ---------------
  $field = 'weblink';
  if (defined $$param{$var::form{'setup_form'}{$field}}) {    
  SWITCH: {  
  # --------- Validate WEBLINK field, if match max.number of chars
     $var::formCheck{$field}{$var::checkMax} &&
    (length($$param{$var::form{'setup_form'}{$field}})
             > $var::inputRestr{$field.'_max_chars'})  && do{ $invalid = 1; last SWITCH;};

   $var::formCheck{$field}{$var::checkMin} &&
    (length($$param{$var::form{'setup_form'}{$field}})
             < $var::inputRestr{$field.'_min_chars'})  && do{ $invalid = 3; last SWITCH;};

  # --------- Validate WEBLINK field, if ommits wrong words
     $var::formCheck{$field}{$var::checkWord} &&
    (isInChosenWords($$param{$var::form{'setup_form'}{$field}})) &&
					do {$invalid = 2;last SWITCH;}; 

  # ----------- Removes http://  from URL
     $var::formCheck{$field}{$var::removeHTTP} && do {
       $$param{$var::form{'setup_form'}{$field}} =~ s/^http\:\/\///;
     };
#    print "Content-type: text/html\n\n";
#    print $$param{$var::form{'setup_form'}{$field}};
  }
  
  SWITCH : {
    ($invalid == 1) && do {lib5::error_message_param($config::lang,1051,$var::error_field{$field}."<BR> Max is:&nbsp;".$var::inputRestr{$field.'_max_chars'});last SWITCH;};
    ($invalid == 2) && do {lib5::error_message_param($config::lang,1050,$var::error_field{$field});last SWITCH;};    
    ($invalid == 3) && do {lib5::error_message_param($config::lang,1052,$var::error_field{$field}."<BR> Min is:&nbsp;".$var::inputRestr{$field.'_min_chars'});last SWITCH;};        
  }
} 
  
 # ----- if $invalid = 0 then WEBLINK field contains valid data --------
 # -------------------------------------------------------------------------


 #  -----------------------------------------------------------------------
 #  ------------ Validated input form ADD BANNER field ---------------
  $field = 'banner';
  if (defined $$param{$var::form{'setup_form'}{$field}}) {    
  SWITCH: {  
  # --------- Validate WEBLINK field, if match max.number of chars
     $var::formCheck{$field}{$var::checkMax} &&
    (length($$param{$var::form{'setup_form'}{$field}})
             > $var::inputRestr{$field.'_max_chars'})  && do{ $invalid = 1; last SWITCH;};

   $var::formCheck{$field}{$var::checkMin} &&
    (length($$param{$var::form{'setup_form'}{$field}})
             < $var::inputRestr{$field.'_min_chars'})  && do{ $invalid = 3; last SWITCH;};

  # --------- Validate WEBLINK field, if ommits wrong words
     $var::formCheck{$field}{$var::checkWord} &&
    (isInChosenWords($$param{$var::form{'setup_form'}{$field}})) &&
					do {$invalid = 2;last SWITCH;}; 

  # ----------- Removes http://  from URL
     $var::formCheck{$field}{$var::removeHTTP} && do {
       $$param{$var::form{'setup_form'}{$field}} =~ s/^http\:\/\///;
     }
#    print "Content-type: text/html\n\n";
#    print $$param{$var::form{'setup_form'}{$field}};
  }
  
  SWITCH : {
    ($invalid == 1) && do {lib5::error_message_param($config::lang,1051,$var::error_field{$field}."<BR> Max is:&nbsp;".$var::inputRestr{$field.'_max_chars'});last SWITCH;};
    ($invalid == 2) && do {lib5::error_message_param($config::lang,1050,$var::error_field{$field});last SWITCH;};    
    ($invalid == 3) && do {lib5::error_message_param($config::lang,1052,$var::error_field{$field}."<BR> Min is:&nbsp;".$var::inputRestr{$field.'_min_chars'});last SWITCH;};        
  }
} 
  
 # ----- if $invalid = 0 then BANNER field contains valid data --------
 # -------------------------------------------------------------------------
 
 
 #  -----------------------------------------------------------------------
 #  ------------ Validated input form IN,...  field ---------------
 foreach my $field (('t_in','t_out','in','out','activity')) {
  
  if (defined $$param{$var::form{'setup_form'}{$field}}) {    
    SWITCH: {  
      ($$param{$var::form{'setup_form'}{$field}} =~ /[^0-9\-]/) && do {
        $invalid =1 ;
      };
    }
  
    SWITCH : {
      ($invalid == 1) && do {lib5::error_message_param($config::lang,1081,$var::error_field{$field}."<BR>You have written restricted chars!");last SWITCH;};
    }
  } 
 } 
 
 
 
 $lib5::header_posted = 1;
  if (!$invalid) {return 1;} else {return 0;}

}



sub showSuccessMessage {
my ($par) = shift;
my ($acc)= shift;
my %parx;
if ($par == 0) {
    $parx{"1"} = $acc;
   lib5::info_message(2,$infos::info{'ACC_ADD'},\%parx);
 }
 elsif($par == 1) {
     $parx{"1"} = $acc;
   lib5::info_message(2,$infos::info{'ACC_MOD'},\%parx);
 }
 
}


sub checkMail {
my ($param) = shift;
#print "Content-type: text/html\n\n";
#print $param;
  if ($param =~ /[^\@]*\@[^\.]*\..+/) {return 1;} else {return 0;}
  
}



sub isInChosenWords {
my ($param) = shift;
my ($FH) = libFile::openFile($config::chosen_words,"RDWR");
if (!($FH eq "0")) {
SWITCH: {
     while (<$FH>) {
       chomp;
       ($param =~ /$_/) && do{
                                libFile::closeFile($FH);
			        return 1;
			      };
     }
  } 
  libFile::closeFile($FH);
}
else {
  lib5::error_message($config::lang,1055);
}
return 0;
}



# ---------------------------------------------
#
# Generates choice dialog
# Input:  ---
# Output: ---
#
# ---------------------------------------------
sub askForType {
my $FH;
  
  $FH = libFile::openTempl($config::html_ask_type,0);
  if (!($FH eq "0")) {
    print "Content-type: text/html\n\n";
    while (<$FH>) { 
      libParse::substParam(\$_,$var::html_param_setup_cgi,$config::setup_cgi);
      libParse::cutComment(\$_);
      print;
    }
  }
  libFile::closeFile($FH);
}





#%EOF%#
#%File: ./admin/rmtctrl.cgi%#
#--------------------------------------------------------------
#  ##%TL_NAME%## ##%TL_VER%##				      
#--------------------------------------------------------------
#                    DO NOT EDIT THIS FILE                    
#--------------------------------------------------------------

package rmtctrl;

$| = 1;

require "./libfile.cgi";
require "./lib5.cgi";
require "./liblog.cgi";
require "./libaccount.cgi";
require "./libadmin.cgi";
require "./data/config.dat";
require "./data/var.dat";

1;



local $cookies;
my %params;

if ($ENV{'REQUEST_METHOD'} eq "GET") {
  %params = lib5::getParams();
}
elsif ($ENV{'REQUEST_METHOD'} eq "POST") {
  read(STDIN,my $data,$ENV{'CONTENT_LENGTH'});
  my @temp;
  @temp = split(/\&/,$data);
   
  foreach my $keyval (@temp) {
    (my $key,my $val)=split(/\=/,$keyval);

    if (defined $params{$key}) {
      $params{$key} = join("\0",$params{$key},$val);
    }
    else {
    $params{$key} = $val;
      #parameters from line in HASH %params
    }


   }
}
else {
  print "Content-type: text/html\n\n";
  print "Only GET|POST allowed\n";
  exit 0;
}
  libAdmin::substPlusWithPause(\%params);  
  libAdmin::convertHexaToChar(\%params);


  SWITCH: {  
    ($params{'action'} =~ /rmacc/ ) && do {
    
      if ( (! $var::htAccessUse)   &&  ( ! ($ENV{'HTTP_COOKIE'} =~ /$var::cookieVarName\=$config::adminPWD/)) ) {      
        authForm();
      }
      else {
        delAcc($params{'acc'},$params{'id'});
      }
      
    last SWITCH;  
    };
    ($params{'action'} =~ /#AUTH#/ ) && do {
      if (libAdmin::cryptPWD($params{'fieldPWD'}) eq $config::adminPWD) {
        $cookies="Set-cookie: $var::cookieVarName=".($config::adminPWD)."\n";
        delAcc($params{'acc'});
      }else {
        messagePWDError();
      }
    last SWITCH;        
    };
    messageError($params{'action'});
  
  } # switch  








sub delAcc {
my ($acc) = shift;
      if (libAccount::deleteAcc($acc)) {
        messageDeletedOK($acc);
      }else {
        messageDeletedNOK($acc);      
      }
}


sub messageDeletedOK {
my ($acc)  =shift;
  print "Content-type: text/html\n";
  print "$cookies\n";
print <<MSGEND1;
<html>
<head>
<title>Remote Control Status</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link rel="stylesheet" href="$config::url_html/main.css" type="text/css">
<script src="$config::url_html/main.js"></script>
</head>
<body>
<br><br><br><br>
! Account <b>$acc</b> has been deleted !
<br><br><br><br>
</body>
</head>
</html>
MSGEND1

}



sub messageDeletedNOK {
my ($acc)  =shift;
print "Content-type: text/html\n";
print "$cookies\n";
print <<MSGEND2;
<html>
<head>
<title>Remote Control Status</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link rel="stylesheet" href="$config::url_html/main.css" type="text/css">
<script src="$config::url_html/main.js"></script>
</head>
<body>
<br><br><br><br>
! Account <b>$acc</b> probably does\'t exist !
<br><br><br><br>
</body>
</head>
</html>
MSGEND2
}


sub messageError {
my ($par)  =shift;
  print "Content-type: text/html\n\n";
print <<MSGEND3;
<html>
<head>
<title>Remote Control Status</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link rel="stylesheet" href="$config::url_html/main.css" type="text/css">
<script src="$config::url_html/main.js"></script>
</head>
<body >
<br><br><br><br>
Parameters are wrong : $par;
<br><br><br><br>
</body>
</head>
</html>
MSGEND3
}


sub messagePWDError {
my ($par)  =shift;
  print "Content-type: text/html\n\n";
print <<MSGEND4;
<html>
<head>
<title>Remote Control Status</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link rel="stylesheet" href="$config::url_html/main.css" type="text/css">
<script src="$config::url_html/main.js"></script>
</head>
<body >
<br><br><br><br>
PASSWORD ERROR
<br><br><br><br>
</body>
</head>
</html>
MSGEND4
}



sub authForm {
# #%PWD%#
my $FH;
$FH = libFile::openFile_ex($config::htmlAdminAuth,"RDWR");
if ($FH != 3 ) {
  print "Content-type: text/html\n\n";
  
  while (<$FH>) {
     libAdmin::parseID(\$_);
     s/action\s*\=\s*\"([^\"]*)\"/"action = \"$var::html_rmtctrl_display{$1}\""/gise;
    print;
  }

}
}#%EOF%#
#%Dir: ./backup%#
#%Dir: ./cron%#
#%File: ./cron/cron.dat%#
######### TrafficPro Section Begin #########
HOME=.
0 0 1 * * ./cronReset.cgi
0,5,10,15,20,25,30,35,40,45,50,55 * * * * ./cronRerank.cgi
######### TrafficPro Section End #########
#%EOF%#
#%File: ./cron/readme.txt%#
CRON Manual Setup:
1. run admin.cgi->Setup
2. goto Cron section and check Use Cron
3. Select period for reset, rerank
4. Save changes
5. Last step generates data into crontab and also info file located 
   in ./cron/cron.dat
6. Now you can manually add data into cron tab and as user you like
7. run crontab -u "user name" "path to cron.dat"
   Example: crontab -u webmaster ./cron.dat
8. type crontab -u "user name" -l and if everythink is OK, you will see
   what is in cron.dat
#%EOF%#
#%Dir: ./css%#
#%File: ./css/skin_blue.css%#
/*descr="Blue"*/
textarea,select,frameset,.alarmText,.inputValue,.shortMenu,div,A,p,.help,table,body,input {
	background-color:#81A5DC;
	color:#DEE1F3;
	font-family: Arial, Helvetica, sans-serif; 
	font-size: 10pt;
/*        border-color: #7195CC #91B5EC #91B5EC #7195CC;*/
        border-color: white white white white;	
/*	border-color: #6185BC #A1C5FC #A1C5FC #6185BC;*/
/*	border-color: red red red red;*/
	cursor: default;
/*	scrollbar-arrow-color */
	scrollbar-face-color: #81A5DC;
	scrollbar-shadow-color: #81A5DC;
	scrollbar-highlight-color:#81A5DC;
	scrollbar-track-color:#81A5DC;	
}


frameset,td,table,.noBorder {
	border-width: 0;
	margin: 0;
	background-color:#91B5EC;
	cell-spacing: 2;	
}

td {
	background-color:#81A5DC;
}

.noBorder{
	background-color:#81A5DC;
}

.shortMenu{
	font-weight:800;
	height:11pt;
	margin: 0pt;
}


input {
	border-top-width: thin;
	border-right-width: thin;
	border-bottom-width: thin;
	border-left-width: thin;

}

.alarmText {
	color:#DD1111;
}

td,body {
	margin: 35px;
	font-weight: 800;
}

td.helpTopic {
	color: #C8CFE1;
	font-weight:800;
	font-size:16pt;
}
td.helpItem {
	color: #C8CFE1;
	font-weight:700;
	font-size:13pt;
}
td.helpText {
	font-weight:200;
	font-size:10pt;
}



.help {
	font-weight:600;
	color: rgb(180,190,230);
	font-size:10pt;
}

}


body.accadd {
	margin-left: 150px;
	margin-top: 10px;	
	font-weight: 800;
}

body.accaddadmin {
	margin-left: 40px;
	margin-top: 10px;	
	font-weight: 800;


}



input {
	border-width: 1;
}

.error {
	color: rgb(210,50,50);
}

input[type="text"] {
	height:17pt;
	padding: 1px;
}

.inputValue {
	font-weight: 700;
	color: #DDDDDD;
}

.inputValueList {
	font-weight: 700;
	color: #DDDDFF;
}


input[type="submit"] {
	height:17pt;
	font-weight: 800;	
	padding: 0px;
	margin: 0px;
}

input[type="checkbox"],input[type="radio"] {
	height:10pt;
	width:10pt;	
	margin: 0pt;
}


.mainTitle {
	color: #C8CFE1;
	font-weight:800;
	font-size:18px;
}

.fieldLabel {
	color: #C8CFE1;
	font-weight:700;
	font-size:14px;
}


.copyright {
	color: #CDD0E2;
	font-weight:100;
	font-size:10pt;
}


.warningText {
	color: #FFB7B9;
	font-family: Arial, Helvetica, "sans-serif filter"
	filter: Glow(Color=white, Strength=5)	
}


.infoText { 
	color: #E3C6CC;
	font-family: Arial, Helvetica, sans-serif;
	font-size: 10px;	
}


.exampleText { 
	color: #E3C6CC;
	font-family: Arial, Helvetica, sans-serif;
	filter: Glow(Color=white, Strength=5)

}

input:focus {
	color: #FFFFFF;
}




.setupMainTitle,.messageMainTitle {
	color: #C8CFE1;
	font-weight:800;
	font-size:15pt;
}

.setupSubTitle,.messageSubTitle,accViewTitleX {
	color: #E3C6CC;
	font-weight:600;
	font-size:13pt;
}
.editItems {
	color: #E3C6CC;
	font-weight:600;
	font-size:13pt;
}


.setupItems,.messageItems {
	color: #C8CFD1;
	font-weight:500;
	font-size:12pt;
}

.setupValName,.messageValName {

	color: #C8CFE1;
	font-weight:700;
	font-size:15px;
}

.setupValue,.messageValue {

	color: #DDDDDD;
	font-weight:700;
}


.accViewValName {
	color: #C8CFE1;
	font-weight:700;
	font-size:14px;
}

.accViewValStat {
	color: #C8CFE1;
	font-weight:500;
	font-size:12px;
}

.accViewValueStat {
	height:16px;
	color: #DDDDDD;
	font-weight:500;
	font-size:12px;	
}



.accViewValue {

	color: #DDDDDD;
	font-weight:700;
	font-size:14px;		
}






.highlight {
	color: rgb(200,200,200);
}

A.choose {
	font-weight:700;
	font-size:13pt;
	text-decoration: none;
	
}

.logMenu,.logDetailItems,.mainmenu,.mainmenulink,.statTips {
	margin: 0px;
	font-weight:700;
	font-size:10pt;
}

.mainmenulink {
	text-decoration: none;
}

.logDetailLabel {
	font-weight:600pt;
	font-size:10pt;
}

.logDetailItems,.statTips {
	padding: 0px 0px 0px 0px;
	margin: 0px  0px 0px 0px;
	spacing: 0px 0px 0px 0px;
	border: 0px 0px 0px 0px;	
	padding-right: 5px;
	border-width: 0px;
	color:#DEE1F3;	font-weight:200px;
	font-size:10px;
}



.logMenu {
	margin: 5;
}

.logTable {
/*	border-style: solid;*/
/*	border-color: ;*/
/*	padding: 100 100 100 100;*/
/*	cell-padding: 100,0,0,100;*/
/*	border-width: medium;*/
/*	padding-left: 20;*/
/*	border:10pt;*/
	margin:	5 5 5 5;
}




A:hover {
	color: white;
}



.axis {
  font-size: 12px;
  font-weight: 800;
}


.infobox {
	margin: 10px 10px 10px 10px;
 font-size: 8pt;
 font-weight: 300;
}

.small {
 margin: 0px 0px 0px 0px;
 font-size: 9pt;
 font-weight: 300;
}

.menuBorder {
	border-color: #AAD9FB, #AAD9FB, #AAD9FB, #AAD9FB;
}

#%EOF%#
#%File: ./css/skin_default.css%#
/*descr="Default"*/
textarea,select,frameset,.alarmText,.inputValue,.shortMenu,div,A,p,.help,table,body,input {
	background-color:#81A5DC;
	color:#DEE1F3;
	font-family: Arial, Helvetica, sans-serif; 
	font-size: 10pt;
/*        border-color: #7195CC #91B5EC #91B5EC #7195CC;*/
        border-color: white white white white;	
/*	border-color: #6185BC #A1C5FC #A1C5FC #6185BC;*/
/*	border-color: red red red red;*/
	cursor: default;
/*	scrollbar-arrow-color */
	scrollbar-face-color: #81A5DC;
	scrollbar-shadow-color: #81A5DC;
	scrollbar-highlight-color:#81A5DC;
	scrollbar-track-color:#81A5DC;	
	
}


frameset,td,table,.noBorder {
	border-width: 0;
	margin: 0;
	background-color:#91B5EC;
	cell-spacing: 2;	
}

td {
	background-color:#81A5DC;
}

.noBorder{
	background-color:#81A5DC;
}


.shortMenu{
	font-weight:800;
	height:11pt;
	margin: 0pt;
}


input {
	border-top-width: thin;
	border-right-width: thin;
	border-bottom-width: thin;
	border-left-width: thin;

}

.alarmText {
	color:#DD1111;
}

td,body {
	margin: 35px;
	font-weight: 800;
}

td.helpTopic {
	color: #C8CFE1;
	font-weight:800;
	font-size:16pt;
}
td.helpItem {
	color: #C8CFE1;
	font-weight:700;
	font-size:13pt;
}
td.helpText {
	font-weight:200;
	font-size:10pt;
}



.help {
	font-weight:600;
	color: rgb(180,190,230);
	font-size:10pt;
}

}


body.accadd {
	margin-left: 150px;
	margin-top: 10px;	
	font-weight: 800;
}

body.accaddadmin {
	margin-left: 40px;
	margin-top: 10px;	
	font-weight: 800;


}



input {
	border-width: 1;
}

.error {
	color: rgb(210,50,50);
}

input[type="text"] {
	height:17pt;
	padding: 1px;
}

.inputValue {
	font-weight: 700;
	color: #DDDDDD;
}

.inputValueList {
	font-weight: 700;
	color: #DDDDFF;
}


input[type="submit"] {
	height:17pt;
	font-weight: 800;	
	padding: 0px;
	margin: 0px;
}

input[type="checkbox"],input[type="radio"] {
	height:10pt;
	width:10pt;	
	margin: 0pt;
}


.mainTitle {
	color: #C8CFE1;
	font-weight:800;
	font-size:18px;
}

.fieldLabel {
	color: #C8CFE1;
	font-weight:700;
	font-size:14px;
}


.copyright {
	color: #CDD0E2;
	font-weight:100;
	font-size:10pt;
}


.warningText {
	color: #FFB7B9;
	font-family: Arial, Helvetica, "sans-serif filter"
	filter: Glow(Color=white, Strength=5)	
}


.infoText { 
	color: #E3C6CC;
	font-family: Arial, Helvetica, sans-serif;
	font-size: 10px;	
}


.exampleText { 
	color: #E3C6CC;
	font-family: Arial, Helvetica, sans-serif;
	filter: Glow(Color=white, Strength=5)

}

input:focus {
	color: #FFFFFF;
}




.setupMainTitle,.messageMainTitle {
	color: #C8CFE1;
	font-weight:800;
	font-size:15pt;
}

.setupSubTitle,.messageSubTitle,accViewTitleX {
	color: #E3C6CC;
	font-weight:600;
	font-size:13pt;
}
.editItems {
	color: #E3C6CC;
	font-weight:600;
	font-size:13pt;
}


.setupItems,.messageItems {
	color: #C8CFD1;
	font-weight:500;
	font-size:12pt;
}

.setupValName,.messageValName {

	color: #C8CFE1;
	font-weight:700;
	font-size:15px;
}

.setupValue,.messageValue {

	color: #DDDDDD;
	font-weight:700;
}


.accViewValName {
	color: #C8CFE1;
	font-weight:700;
	font-size:14px;
}

.accViewValStat {
	color: #C8CFE1;
	font-weight:500;
	font-size:12px;
}

.accViewValueStat {
	height:16px;
	color: #DDDDDD;
	font-weight:500;
	font-size:12px;	
}



.accViewValue {

	color: #DDDDDD;
	font-weight:700;
	font-size:14px;		
}






.highlight {
	color: rgb(200,200,200);
}

A.choose {
	font-weight:700;
	font-size:13pt;
	text-decoration: none;
	
}

.logMenu,.logDetailItems,.mainmenu,.mainmenulink,.statTips {
	margin: 0px;
	font-weight:700;
	font-size:10pt;
}

.mainmenulink {
	text-decoration: none;
}

.logDetailLabel {
	font-weight:600pt;
	font-size:10pt;
}

.logDetailItems,.statTips {
	padding: 0px 0px 0px 0px;
	margin: 0px  0px 0px 0px;
	spacing: 0px 0px 0px 0px;
	border: 0px 0px 0px 0px;	
	padding-right: 5px;
	border-width: 0px;
	color:#DEE1F3;	font-weight:200px;
	font-size:10px;
}



.logMenu {
	margin: 5;
}

.logTable {
/*	border-style: solid;*/
/*	border-color: ;*/
/*	padding: 100 100 100 100;*/
/*	cell-padding: 100,0,0,100;*/
/*	border-width: medium;*/
/*	padding-left: 20;*/
/*	border:10pt;*/
	margin:	5 5 5 5;
}




A:hover {
	color: white;
}



.axis {
  font-size: 12px;
  font-weight: 800;
}


.infobox {
	margin: 10px 10px 10px 10px;
 font-size: 8pt;
 font-weight: 300;
}
.small {
 margin: 0px 0px 0px 0px;
 font-size: 9pt;
 font-weight: 300;
}

.menuBorder {
	border-color: #AAD9FB, #AAD9FB, #AAD9FB, #AAD9FB;
}
#%EOF%#
#%File: ./css/skin_green.css%#
/*descr="Green and Gray"*/

textarea,select,frameset,.alarmText,.inputValue,.shortMenu,div,A,p,.help,table,body,input {
	background-color:#CCCCCC;
	color:	#339900;
	font-family: Arial, Helvetica, sans-serif; 
	font-size: 10pt;
        border-color: white white white white;	
/*	border-color: #6185BC #A1C5FC #A1C5FC #6185BC;*/
/*	border-color: red red red red;*/
	cursor: default;
/*	scrollbar-arrow-color */
	scrollbar-face-color: #CCCCCC;
	scrollbar-shadow-color: #CCCCCC;
	scrollbar-highlight-color:#CCCCCC;
	scrollbar-track-color:#CCCCCC;
	
}

frameset,td,table,.noBorder {
	border-width: 0;
	margin: 0;
	background-color:#339900;
	cell-spacing: 2;	
}

td {
	background-color:#CCCCCC;
}

.noBorder{
	background-color:#CCCCCC;
}


.shortMenu{
	font-weight:800;
	height:11pt;
	margin: 0pt;
}


.alarmText {
	color:#DD1111;
}


input {
	border-top-width: thin;
	border-right-width: thin;
	border-bottom-width: thin;
	border-left-width: thin;

}
td,body {
	margin: 35px;
	font-weight: 800;
}

td.helpTopic {
	color: #C8CFE1;
	font-weight:800;
	font-size:16pt;
}
td.helpItem {
	color: #C8CFE1;
	font-weight:700;
	font-size:13pt;
}
td.helpText {
	font-weight:200;
	font-size:10pt;
}



.help {
	font-weight:600;
	color: #2FB900;
	font-size:10pt;
}

}


body.accadd {
	margin-left: 150px;
	margin-top: 10px;	
	font-weight: 800;
}

body.accaddadmin {
	margin-left: 40px;
	margin-top: 10px;	
	font-weight: 800;


}


input {
	border-width: 1;
}

.error {
	color: #CC3333;
}

input[type="text"] {
	height:17pt;
	padding: 1px;
}

.inputValue {
	font-weight: 700;
	color: #339900;
}



.inputValueList {
	font-weight: 700;
	color: #000000;
}



input[type="submit"] {
	height:17pt;
	font-weight: 800;	
	padding: 0px;
	margin: 0px;
}

input[type="checkbox"],input[type="radio"] {
	height:10pt;
	width:10pt;	
	margin: 0pt;
}


.mainTitle {
	color: #2FB900;
	font-weight:800;
	font-size:18px;
}

.fieldLabel {
	color: #2FB900;
	font-weight:700;
	font-size:14px;
}


.copyright {
	color: #2FB900;
	font-weight:100;
	font-size:10pt;
}


.warningText {
	color: #2FB900;
	font-family: Arial, Helvetica, "sans-serif filter"
	filter: Glow(Color=white, Strength=5)	
}


.infoText { 
	color: #2FB900;
	font-family: Arial, Helvetica, sans-serif;
	font-size: 10px;	
}


.exampleText { 
	color: #2FB900;
	font-family: Arial, Helvetica, sans-serif;
	filter: Glow(Color=white, Strength=5)

}

:focus {
	color:    #44FF11;
}




.setupMainTitle,.messageMainTitle {
	color: #2FB900;
	font-weight:800;
	font-size:15pt;
}

.setupSubTitle,.messageSubTitle,accViewTitleX {
	color: #2FB900;
	font-weight:600;
	font-size:13pt;
}
.editItems {
	color: #E3C6CC;
	font-weight:600;
	font-size:13pt;
}


.setupItems,.messageItems {
	color: #2FB900;
	font-weight:500;
	font-size:12pt;
}

.setupValName,.messageValName {

	color: #2FB900;
	font-weight:700;
	font-size:15px;
}

.setupValue,.messageValue {

	color: #339900;;
	font-weight:700;
}


.accViewValName {
	color: #2FB900;
	font-weight:700;
	font-size:14px;
}

.accViewValStat {
	color: #2FB900;
	font-weight:500;
	font-size:12px;
}

.accViewValueStat {
	height:16px;
	color: #DDDDDD;
	font-weight:500;
	font-size:12px;	
}



.accViewValue {

	color: #DDDDDD;
	font-weight:700;
	font-size:14px;		
}






.highlight {
	color: #FFFFFF;
}

A.choose {
	font-weight:700;
	font-size:13pt;
	text-decoration: none;
	
}

.logMenu,.logDetailItems,.mainmenu,.mainmenulink,.statTips {
	margin: 0px;
	font-weight:700;
	font-size:10pt;
}

.mainmenulink {
	text-decoration: none;
}

.logDetailLabel {
	font-weight:600pt;
	font-size:10pt;
}

.logDetailItems,.statTips {
	padding: 0px 0px 0px 0px;
	margin: 0px  0px 0px 0px;
	spacing: 0px 0px 0px 0px;
	border: 0px 0px 0px 0px;	
	padding-right: 5px;
	border-width: 0px;
	color:#2FB900;	font-weight:200px;
	font-size:10px;
}



.logMenu {
	margin: 5;
}

.logTable {
/*	border-style: solid;*/
/*	border-color: ;*/
/*	padding: 100 100 100 100;*/
/*	cell-padding: 100,0,0,100;*/
/*	border-width: medium;*/
/*	padding-left: 20;*/
/*	border:10pt;*/
	margin:	5 5 5 5;
}




:hover {
	color: 	color:  #44FF11;
}



.axis {
  font-size: 12px;
  font-weight: 800;
}


.infobox {
	margin: 10px 10px 10px 10px;
 font-size: 8pt;
 font-weight: 300;
}
.small {
 margin: 0px 0px 0px 0px;
 font-size: 9pt;
 font-weight: 300;
}


.adminBorder {
	border-color: #2FB900;

}

.menuBorder {
	border-color: #2FB900;
}
#%EOF%#
#%File: ./css/skin_hell.css%#
/*descr="Hell Rise"*/

textarea,select,frameset,.alarmText,.inputValue,.shortMenu,div,A,p,.help,table,body,input {
	background-color:#000000;
	color:#CC5555;
	font-family: Arial, Helvetica, sans-serif; 
	font-size: 10pt;
        border-color: white white white white;	
/*	border-color: #6185BC #A1C5FC #A1C5FC #6185BC;*/
/*	border-color: red red red red;*/
	cursor: default;
	scrollbar-arrow-color: #CC5555;
	scrollbar-face-color: gray;
	scrollbar-shadow-color: gray;
	scrollbar-highlight-color:gray;
	scrollbar-track-color: gray;
	
	
}

frameset,td,table,.noBorder {
	border-width: 0;
	margin: 0;
	background-color:#CC5555;
	cell-spacing: 2;	
}

td {
	background-color:#000000;
}

.noBorder{
	background-color:#000000;
}


.shortMenu{
	font-weight:800;
	height:11pt;
	margin: 0pt;
}


.alarmText {
	color:#DD1111;
}


input {
	border-top-width: thin;
	border-right-width: thin;
	border-bottom-width: thin;
	border-left-width: thin;

}
td,body {
	margin: 35px;
	font-weight: 800;
}

td.helpTopic {
	color: #C8CFE1;
	font-weight:800;
	font-size:16pt;
}
td.helpItem {
	color: #C8CFE1;
	font-weight:700;
	font-size:13pt;
}
td.helpText {
	font-weight:200;
	font-size:10pt;
}



.help {
	font-weight:600;
	color: rgb(180,190,230);
	font-size:10pt;
}

}


body.accadd {
	margin-left: 150px;
	margin-top: 10px;	
	font-weight: 800;
}


body.accaddadmin {
	margin-left: 40px;
	margin-top: 10px;	
	font-weight: 800;


}

input {
	border-width: 1;
}

.error {
	color: rgb(210,50,50);
}

input[type="text"] {
	height:17pt;
	padding: 1px;
}

.inputValue {
	font-weight: 700;
	color: #DDDDDD;
}

.inputValueList {
	font-weight: 700;
	color: #000000;
}



input[type="submit"] {
	height:17pt;
	font-weight: 800;	
	padding: 0px;
	margin: 0px;
}

input[type="checkbox"],input[type="radio"] {
	height:10pt;
	width:10pt;	
	margin: 0pt;
}


.mainTitle {
	color: #C8CFE1;
	font-weight:800;
	font-size:18px;
}

.fieldLabel {
	color: #C8CFE1;
	font-weight:700;
	font-size:14px;
}


.copyright {
	color: #CDD0E2;
	font-weight:100;
	font-size:10pt;
}


.warningText {
	color: #FFB7B9;
	font-family: Arial, Helvetica, "sans-serif filter"
	filter: Glow(Color=white, Strength=5)	
}


.infoText { 
	color: #E3C6CC;
	font-family: Arial, Helvetica, sans-serif;
	font-size: 10px;	
}


.exampleText { 
	color: #E3C6CC;
	font-family: Arial, Helvetica, sans-serif;
	filter: Glow(Color=white, Strength=5)

}

input:focus {
	color: #FFFFFF;
}




.setupMainTitle,.messageMainTitle {
	color: #C8CFE1;
	font-weight:800;
	font-size:15pt;
}

.setupSubTitle,.messageSubTitle,accViewTitleX {
	color: #E3C6CC;
	font-weight:600;
	font-size:13pt;
}
.editItems {
	color: #E3C6CC;
	font-weight:600;
	font-size:13pt;
}


.setupItems,.messageItems {
	color: #C8CFD1;
	font-weight:500;
	font-size:12pt;
}

.setupValName,.messageValName {

	color: #C8CFE1;
	font-weight:700;
	font-size:15px;
}

.setupValue,.messageValue {

	color: #DDDDDD;
	font-weight:700;
}


.accViewValName {
	color: #C8CFE1;
	font-weight:700;
	font-size:14px;
}

.accViewValStat {
	color: #C8CFE1;
	font-weight:500;
	font-size:12px;
}

.accViewValueStat {
	height:16px;
	color: #DDDDDD;
	font-weight:500;
	font-size:12px;	
}



.accViewValue {

	color: #DDDDDD;
	font-weight:700;
	font-size:14px;		
}






.highlight {
	color: rgb(200,200,200);
}

A.choose {
	font-weight:700;
	font-size:13pt;
	text-decoration: none;
	
}

.logMenu,.logDetailItems,.mainmenu,.mainmenulink,.statTips {
	margin: 0px;
	font-weight:700;
	font-size:10pt;
}

.mainmenulink {
	text-decoration: none;
}

.logDetailLabel {
	font-weight:600pt;
	font-size:10pt;
}

.logDetailItems,.statTips {
	padding: 0px 0px 0px 0px;
	margin: 0px  0px 0px 0px;
	spacing: 0px 0px 0px 0px;
	border: 0px 0px 0px 0px;	
	padding-right: 5px;
	border-width: 0px;
	color:#DEE1F3;	font-weight:200px;
	font-size:10px;
}



.logMenu {
	margin: 5;
}

.logTable {
/*	border-style: solid;*/
/*	border-color: ;*/
/*	padding: 100 100 100 100;*/
/*	cell-padding: 100,0,0,100;*/
/*	border-width: medium;*/
/*	padding-left: 20;*/
/*	border:10pt;*/
	margin:	5 5 5 5;
}




A:hover {
	color:  color:#DD5555;

}



.axis {
  font-size: 12px;
  font-weight: 800;
}


.infobox {
	margin: 10px 10px 10px 10px;
 font-size: 8pt;
 font-weight: 300;
}
.small {
 margin: 0px 0px 0px 0px;
 font-size: 9pt;
 font-weight: 300;
}


.adminBorder {
	border-color: red;

}

.menuBorder {
	border-color: #AAD9FB, #AAD9FB, #AAD9FB, #AAD9FB;
}
#%EOF%#
#%File: ./css/skin_laptop.css%#
/*descr="Laptop Colors"*/

textarea,select,frameset,.alarmText,.inputValue,.shortMenu,div,A,p,.help,table,body,input {
	background-color:#FFFFFF;
	color:#000000;
	font-family: Arial, Helvetica, sans-serif; 
	font-size: 10pt;
        border-color: white white white white;	
/*	border-color: #6185BC #A1C5FC #A1C5FC #6185BC;*/
/*	border-color: red red red red;*/
	cursor: default;
/*	scrollbar-arrow-color */
	scrollbar-face-color: gray;
	scrollbar-shadow-color: gray;
	scrollbar-highlight-color:gray;
	scrollbar-track-color: gray;
	
}

frameset,td,table,.noBorder {
	border-width: 0;
	margin: 0;
	background-color:#000000;
	cell-spacing: 2;	
}

td {
	background-color:#FFFFFF;
}

.noBorder{
	background-color:#FFFFFF;
}



.shortMenu{
	font-weight:800;
	height:11pt;
	margin: 0pt;
}


.alarmText {
	color:#DD1111;
}


input {
	border-top-width: thin;
	border-right-width: thin;
	border-bottom-width: thin;
	border-left-width: thin;

}
td,body {
	margin: 35px;
	font-weight: 800;
}

td.helpTopic {
	color: #C8CFE1;
	font-weight:800;
	font-size:16pt;
}
td.helpItem {
	color: #C8CFE1;
	font-weight:700;
	font-size:13pt;
}
td.helpText {
	font-weight:200;
	font-size:10pt;
}



.help {
	font-weight:600;
	color: rgb(180,190,230);
	font-size:10pt;
}

}


body.accadd {
	margin-left: 150px;
	margin-top: 10px;	
	font-weight: 800;
}

body.accaddadmin {
	margin-left: 40px;
	margin-top: 10px;	
	font-weight: 800;


}


input {
	border-width: 1;
}

.error {
	color: rgb(210,50,50);
}

input[type="text"] {
	height:17pt;
	padding: 1px;
}

.inputValue {
	font-weight: 700;
	color: #DDDDDD;
}

.inputValueList {
	font-weight: 700;
	color: #000000;
}



input[type="submit"] {
	height:17pt;
	font-weight: 800;	
	padding: 0px;
	margin: 0px;
}

input[type="checkbox"],input[type="radio"] {
	height:10pt;
	width:10pt;	
	margin: 0pt;
}


.mainTitle {
	color: #C8CFE1;
	font-weight:800;
	font-size:18px;
}

.fieldLabel {
	color: #C8CFE1;
	font-weight:700;
	font-size:14px;
}


.copyright {
	color: #CDD0E2;
	font-weight:100;
	font-size:10pt;
}


.warningText {
	color: #FFB7B9;
	font-family: Arial, Helvetica, "sans-serif filter"
	filter: Glow(Color=white, Strength=5)	
}


.infoText { 
	color: #E3C6CC;
	font-family: Arial, Helvetica, sans-serif;
	font-size: 10px;	
}


.exampleText { 
	color: #E3C6CC;
	font-family: Arial, Helvetica, sans-serif;
	filter: Glow(Color=white, Strength=5)

}

input:focus {
	color: #FFFFFF;
}




.setupMainTitle,.messageMainTitle {
	color: #C8CFE1;
	font-weight:800;
	font-size:15pt;
}

.setupSubTitle,.messageSubTitle,accViewTitleX {
	color: #E3C6CC;
	font-weight:600;
	font-size:13pt;
}

.editItems {
	color: #E3C6CC;
	font-weight:600;
	font-size:13pt;
}

.setupItems,.messageItems {
	color: #C8CFD1;
	font-weight:500;
	font-size:12pt;
}

.setupValName,.messageValName {

	color: #C8CFE1;
	font-weight:700;
	font-size:15px;
}

.setupValue,.messageValue {

	color: #DDDDDD;
	font-weight:700;
}


.accViewValName {
	color: #C8CFE1;
	font-weight:700;
	font-size:14px;
}

.accViewValStat {
	color: #C8CFE1;
	font-weight:500;
	font-size:12px;
}

.accViewValueStat {
	height:16px;
	color: #DDDDDD;
	font-weight:500;
	font-size:12px;	
}



.accViewValue {

	color: #DDDDDD;
	font-weight:700;
	font-size:14px;		
}






.highlight {
	color: rgb(200,200,200);
}

A.choose {
	font-weight:700;
	font-size:13pt;
	text-decoration: none;
	
}

.logMenu,.logDetailItems,.mainmenu,.mainmenulink,.statTips {
	margin: 0px;
	font-weight:700;
	font-size:10pt;
}

.mainmenulink {
	text-decoration: none;
}

.logDetailLabel {
	font-weight:600pt;
	font-size:10pt;
}

.statTips,.logDetailItems {
	padding: 0px 0px 0px 0px;
	margin: 0px  0px 0px 0px;
	spacing: 0px 0px 0px 0px;
	border: 0px 0px 0px 0px;	
	padding-right: 5px;
	border-width: 0px;
	color:#DEE1F3;	font-weight:200px;
	font-size:10px;
}



.logMenu {
	margin: 5;
}

.logTable {
/*	border-style: solid;*/
/*	border-color: ;*/
/*	padding: 100 100 100 100;*/
/*	cell-padding: 100,0,0,100;*/
/*	border-width: medium;*/
/*	padding-left: 20;*/
/*	border:10pt;*/
	margin:	5 5 5 5;
}




A:hover {
	color: black;
}



.axis {
  font-size: 12px;
  font-weight: 800;
}


.infobox {
	margin: 10px 10px 10px 10px;
 font-size: 8pt;
 font-weight: 300;
}
.small {
 margin: 0px 0px 0px 0px;
 font-size: 9pt;
 font-weight: 300;
}


.adminBorder {
	border-color: red;

}

.menuBorder {
	border-color: #AAD9FB, #AAD9FB, #AAD9FB, #AAD9FB;
}
#%EOF%#
#%File: ./css/skin_strike.css%#
/*descr="Strikers xx"*/

textarea,select,frameset,.alarmText,.inputValue,.shortMenu,div,A,p,.help,table,body,input {
	background-color:#81A5DC;
	color:#DEE1F3;
	font-family: Arial, Helvetica, sans-serif; 
	font-size: 10pt;
        border-color: white white white white;	
/*	border-color: #6185BC #A1C5FC #A1C5FC #6185BC;*/
/*	border-color: red red red red;*/
	cursor: default;
/*	scrollbar-arrow-color */
	scrollbar-face-color: gray;
	scrollbar-shadow-color: gray;
	scrollbar-highlight-color:gray;
	scrollbar-track-color: gray;
	
}


frameset,td,table,.noBorder {
	border-width: 0;
	margin: 0;
	background-color:#FFFFFF;
	cell-spacing: 2;	
}

td {
	background-color:#81A5DC;
}

.noBorder{
	background-color:#81A5DC;
}



.shortMenu{
	font-weight:800;
	height:11pt;
	margin: 0pt;
}


.alarmText {
	color:#DD1111;
}


input {
	border-top-width: thin;
	border-right-width: thin;
	border-bottom-width: thin;
	border-left-width: thin;

}
td,body {
	margin: 35px;
	font-weight: 800;
}

td.helpTopic {
	color: #C8CFE1;
	font-weight:800;
	font-size:16pt;
}
td.helpItem {
	color: #C8CFE1;
	font-weight:700;
	font-size:13pt;
}
td.helpText {
	font-weight:200;
	font-size:10pt;
}



.help {
	font-weight:600;
	color: rgb(180,190,230);
	font-size:10pt;
}

}


body.accadd {
	margin-left: 150px;
	margin-top: 10px;	
	font-weight: 800;
}

body.accaddadmin {
	margin-left: 40px;
	margin-top: 10px;	
	font-weight: 800;


}


input {
	border-width: 1;
}

.error {
	color: rgb(210,50,50);
}

input[type="text"] {
	height:17pt;
	padding: 1px;
}

.inputValue {
	font-weight: 700;
	color: #DDDDDD;
}

.inputValueList {
	font-weight: 700;
	color: #000000;
}




input[type="submit"] {
	height:17pt;
	font-weight: 800;	
	padding: 0px;
	margin: 0px;
}

input[type="checkbox"],input[type="radio"] {
	height:10pt;
	width:10pt;	
	margin: 0pt;
}


.mainTitle {
	color: #C8CFE1;
	font-weight:800;
	font-size:18px;
}

.fieldLabel {
	color: #C8CFE1;
	font-weight:700;
	font-size:14px;
}


.copyright {
	color: #CDD0E2;
	font-weight:100;
	font-size:10pt;
}


.warningText {
	color: #FFB7B9;
	font-family: Arial, Helvetica, "sans-serif filter"
	filter: Glow(Color=white, Strength=5)	
}


.infoText { 
	color: #E3C6CC;
	font-family: Arial, Helvetica, sans-serif;
	font-size: 10px;	
}


.exampleText { 
	color: #E3C6CC;
	font-family: Arial, Helvetica, sans-serif;
	filter: Glow(Color=white, Strength=5)

}

input:focus {
	color: #FFFFFF;
}




.setupMainTitle,.messageMainTitle {
	color: #C8CFE1;
	font-weight:800;
	font-size:15pt;
}

.setupSubTitle,.messageSubTitle,accViewTitleX {
	color: #E3C6CC;
	font-weight:600;
	font-size:13pt;
}

.editItems {
	color: #E3C6CC;
	font-weight:600;
	font-size:13pt;
}

.setupItems,.messageItems {
	color: #C8CFD1;
	font-weight:500;
	font-size:12pt;
}

.setupValName,.messageValName {

	color: #C8CFE1;
	font-weight:700;
	font-size:15px;
}

.setupValue,.messageValue {

	color: #DDDDDD;
	font-weight:700;
}


.accViewValName {
	color: #C8CFE1;
	font-weight:700;
	font-size:14px;
}

.accViewValStat {
	color: #C8CFE1;
	font-weight:500;
	font-size:12px;
}

.accViewValueStat {
	height:16px;
	color: #DDDDDD;
	font-weight:500;
	font-size:12px;	
}



.accViewValue {

	color: #DDDDDD;
	font-weight:700;
	font-size:14px;		
}






.highlight {
	color: rgb(200,200,200);
}

A.choose {
	font-weight:700;
	font-size:13pt;
	text-decoration: none;
	
}

.logMenu,.logDetailItems,.mainmenu,.mainmenulink,.statTips {
	margin: 0px;
	font-weight:700;
	font-size:10pt;
}

.mainmenulink {
	text-decoration: none;
}

.logDetailLabel {
	font-weight:600pt;
	font-size:10pt;
}

.logDetailItems,.statTips {
	padding: 0px 0px 0px 0px;
	margin: 0px  0px 0px 0px;
	spacing: 0px 0px 0px 0px;
	border: 0px 0px 0px 0px;	
	padding-right: 5px;
	border-width: 0px;
	color:#DEE1F3;	font-weight:200px;
	font-size:10px;
}



.logMenu {
	margin: 5;
}

.logTable {
/*	border-style: solid;*/
/*	border-color: ;*/
/*	padding: 100 100 100 100;*/
/*	cell-padding: 100,0,0,100;*/
/*	border-width: medium;*/
/*	padding-left: 20;*/
/*	border:10pt;*/
	margin:	5 5 5 5;
}




A:hover {
	text-decoration: underline;
	color: white;
}



.axis {
  font-size: 12px;
  font-weight: 800;
}


.infobox {
	margin: 10px 10px 10px 10px;
 font-size: 8pt;
 font-weight: 300;
}
.small {
 margin: 0px 0px 0px 0px;
 font-size: 9pt;
 font-weight: 300;
}


.adminBorder {
	border-color: red;

}

.menuBorder {
	border-color: #AAD9FB, #AAD9FB, #AAD9FB, #AAD9FB;
}
#%EOF%#
#%Dir: ./data%#
#%File: ./data/config.dat%#
package config;


#%AREASYSTEM_BEGIN%#

$test= "1";
$name= "tBOSS";
$support= "http://www.xxxscripts.net";
$version= "1.86 php rerank test";
$adminLogin = "admin";
$iID = "devel_test_2";
#%AREASYSTEM_END%#

#%AREAUSER_BEGIN%#
$adminPWD= "11B2LEFd5iAoc";
$multiAddGroupID= "GRqEpyQzmNbno";
$lang= "EN";
#SK,EN,GER,....

$interpreter= "/usr/bin/perl";
$cgi_path= ".";
$cronTabPath= "/usr/bin/crontab";
$cronHome= $cgi_path;
$document_root= "/www/html";
$virtual_cgi_path= "http://192.168.10.222/cgi-bin/xtraffic";
$tlurl= $virtual_cgi_path;
$path_url_cgis = $virtual_cgi_path;
$genStatURL = "$virtual_cgi_path/genstat.cgi";
$url_html= "http://192.168.10.222";
$sendmail= "/usr/lib/sendmail";
$admin_path= "$virtual_cgi_path/admin/admin.cgi";
$phpInPath= "/www/html/in.php";
$phpInUrl= "http://192.168.10.222/in.php";
$phpOutPath= "/www/html/out.php";
$phpOutUrl= "http://192.168.10.222/out.php";
#%AREAUSER_END%#

#%AREASYSTEM_BEGIN%#
$cgi_root=$cgi_path;
$cronOut= "$cgi_root/cron/cron.dat";
$cronReset= "$cgi_root/cronreset.cgi";
$cronRerank= "$cgi_root/cronrerank.cgi";
$phpReset= "$cgi_root/reset.cgi";
$phpRerank= "$cgi_root/rerank.cgi";
$cssPath= "$cgi_root/css";
$jsPath= "$cgi_root/jscript";
$phpFragment = "$cgi_root/php/infrag.php";
$phpOutPrototype = "$cgi_root/php/outproto.php";
$jscriptPrototype = "$cgi_root/jscript/antihitbot.js";
$phpCounterPrototype = "$cgi_root/php/counter.php";
$phpPath = "$cgi_root/php";
$autorankData = "$cgi_root/data/data.txt";
$backup= "$cgi_root/backup";
$pack =  "$cgi_root/backup/install.dat";
$def_templ= "defaults";
$htmlBreakPath= "$cgi_root/temps";
$userTemplDir = "$cgi_root/temps";
$varPath = "$cgi_root/data/var.dat";
$configPath = "$cgi_root/data/config.dat";
$timeStampRerank= "$cgi_root/data/ts_rerank.dat";
$timeStampReset= "$cgi_root/data/ts_reset.dat";
$optimizeTS =  "$cgi_root/data/ts_optim.dat";
$counterName = "$cgi_root/data/counter.dat";
$tempDir = "$cgi_root/temp";
$outRankStat  ="$cgi_root/data/stat_out_rank.dat";
$defaultCounterName  ="counter";
$defaultCounter  ="$cgi_root/counter.cgi";
$resetPath= "$cgi_root/reset.cgi";
$rerankPath= "$cgi_root/genlist.cgi";
$special_log_file = "$cgi_root/logs/special.log";
$adminAcc = "$cgi_root/temps/defaults/_admin_acc.html";

$mainFrameset = "$cgi_root/temps/defaults/main_desktop.html";
$mainDesktopMenu = "$cgi_root/temps/defaults/main_desktop_menu.html";

$statViewMenu= "$cgi_root/temps/defaults/main_stat_menu.html";
$backrestViewMenu= "$cgi_root/temps/defaults/main_backrest_menu.html";
$logViewMenu= "$cgi_root/temps/defaults/main_log_menu.html";

$mainStatView = "$cgi_root/temps/defaults/main_stat_view.html";
$mainBackrestView = "$cgi_root/temps/defaults/main_backrest_view.html";
$mainLogView = "$cgi_root/temps/defaults/main_log_view.html";


$mainLogDetail = "$cgi_root/temps/defaults/main_log_detail.html";
$mainBackrestDetail = "$cgi_root/temps/defaults/main_backrest_detail.html";
$mainStatDetail = "$cgi_root/temps/defaults/main_stat_detail.html";





$chosen_words= "$cgi_root/data/black_word.dat";
$restrictedWords= $chosen_words;
$restrictedUrls= "$cgi_root/data/black_url.dat";


$mailAfterDelete= 1;

# statistic {
$statUptime =  "$cgi_root/data/stat_uptime.dat";
$statUptimeCounter = "$cgi_root/data/stat_uptime_counter.dat";
$statReg =  "$cgi_root/data/stat_reg.dat";
$statTotalSum  = "$cgi_root/data/stat_total_sum.dat";
$statTotalSumYear  = "$cgi_root/data/stat_total_sum_year.dat";
$statTotalSumMonth  = "$cgi_root/data/stat_total_sum_month.dat";
$statTotalSumDay  = "$cgi_root/data/stat_total_sum_day.dat";
$statTotalSumHour  = "$cgi_root/data/stat_total_sum_hour.dat";
$stat_database= "$cgi_root/data/stat.dat";
$stat_ref= "$cgi_root/data/stat_ref.dat";
# }

# time stamps {

$statTotalSumTS = "$cgi_root/data/ts_stat_total_sum.dat";

#}


#%AREASYSTEM_END%#

#%AREAUSER_BEGIN%#
# indexes, ... {
# for 1.index    name,  in list, break positions
%index= (1=>["index.html",50,25],2=>["indexBest.html",50,25]);
$defaultBannerURL= "http://";
# }
#%AREAUSER_END%#

#%AREASYSTEM_BEGIN%#
# file for default break
$htmlBreak= "";
$htmlBreakPrefix= "_break";

$setup_cgi= "$virtual_cgi_path/admin/admin.cgi";
$admin_cgi= "$virtual_cgi_path/admin/admin.cgi";
$rmtctrl_cgi= "$virtual_cgi_path/admin/rmtctrl.cgi";
$acc_cgi= "$virtual_cgi_path/acc.cgi";
$in_cgi= "$virtual_cgi_path/in.cgi";
$out_cgi= "$virtual_cgi_path/out.cgi";
$setup_setup_cgi= "$virtual_cgi_path/setup.cgi";


$reportAccDeleteHtml= "$cgi_root/temps/_report_mail_delete.html";
$reportAccDeleteText= "$cgi_root/temps/_report_mail_delete.txt";

$reportAccInactivityHtml= "$cgi_root/temps/_report_mail_inact.html";
$reportAccInactivityText= "$cgi_root/temps/_report_mail_inact.txt";

$reportAccAdminHtml= "$cgi_root/temps/_report_mail_admin.html";
$reportAccAdminText= "$cgi_root/temps/_report_mail_admin.txt";

$reportAccEditAdminHtml = "$cgi_root/temps/_report_mail_edit.html";
$reportAccEditAdminText = "$cgi_root/temps/_report_mail_edit.txt";

$reportAccHeaderHtml= "$cgi_root/temps/_report_mail_header.html";
$reportAccFooterHtml= "$cgi_root/temps/_report_mail_footer.html";
$reportAccHeaderText= "$cgi_root/temps/_report_mail_header.txt";
$reportAccFooterText= "$cgi_root/temps/_report_mail_footer.txt";


#banner 

# error messages -----------

$htmlErrorMsgTmpl= "$cgi_root/temps/defaults/_error_message.html";
$htmlInfoMsgTmpl= "$cgi_root/temps/defaults/_info_message.html";


# store accounts here ...
$last_best_accounts= "$cgi_root/data/bestaccs.dat";
$statAdmin ="$cgi_root/data/stat_admin.dat";

#$logInFilePHP= "$cgi_path/data/in.log";
#$logOutFilePHP= "$cgi_root/data/out.log";
#$accountDatabasePHP = "$cgi_root/data/accounts.dat";

$multiAddSites = "$cgi_root/data/multi_add_sites.dat";
$log_in_file= "$cgi_root/logs/in.log";
$logDir= "$cgi_root/logs";
$dataDir= "$cgi_root/data";
$templDir= "$cgi_root/temps";

$log_error_file= "$cgi_root/logs/error.log";
$log_file= "$cgi_root/logs/log.log";
$logInstall= "$cgi_root/install.log";
$log_out_file= "$cgi_root/logs/out.log";
$log_temp_file= "$cgi_root/logs/temp.log";
$topXFwdCache = "$cgi_root/data/topxcache.dat";
$html_toplist_file= "index";
$html_toplist_ext= "html";
$html_toplist_tmp_ext= "html_tmpl";
$html_toplist= "$document_root/$html_toplist_file.$html_toplist_ext";
$html_toplist_tmp= "$cgi_root/data/toplist.html_tmpl";
$html_toplist_tmp_file= "$cgi_root/data/toplist";
$html_toplist_tmp_dir= "$cgi_root/data";
$counterLog= "$cgi_root/logs/counter.log";
$helpFile= "$cgi_root/data/help.dat";

$html_header= "$cgi_root/temps/_header.html";
$html_footer= "$cgi_root/temps/_footer.html";
$html_data_table= "$cgi_root/temps/_data_table.html";
$htmlIcon = "$cgi_root/temps/html_icon.html";
# --------------- STAT ------------------
$htmlStatTotalDate= "$cgi_root/temps/defaults/_stat_total.html";
# --------------- SETUP ------------------
$html_setup_file= "$cgi_root/temps/defaults/_setup.html";

$htmlAccAddFile= "$cgi_root/temps/_account_form.html";
$htmlMultiAccAddFile = "$cgi_root/temps/defaults/_multi_acc_form.html";

$html_setup_auth_file= "$cgi_root/temps/defaults/_setup_auth.html";
$htmlAskType= $htmlAccAddFile;
$html_setup_tl_acc= "$cgi_root/temps/defaults/_setup_toplist_acc.html";
# --------------- ADMIN ------------------
$html_admin_main= "$cgi_root/temps/defaults/_admin_main.html";
$htmlAccViewMail= "$cgi_root/temps/defaults/_acc_view_mail.html";
$htmlAdminSetup= "$cgi_root/temps/defaults/_setup.html";
$html_admin_acc_view= "$cgi_root/temps/defaults/_acc_view.html";
$htmlAdminEditTempl= "$cgi_root/temps/defaults/_html_edit.html";
$htmlAdminEditBreak= "$cgi_root/temps/defaults/_break_edit.html";
$htmlAdminEditMail= "$cgi_root/temps/defaults/_html_edit_mail.html";
$htmlAdminEditIcon= "$cgi_root/temps/defaults/_html_edit_icon.html";
$htmlAdminAddEdit =  "$cgi_root/temps/defaults/edit_add_form.html";
$htmlAdminEditWords= "$cgi_root/temps/defaults/_html_edit_words.html";
$htmlAdminAuth= "$cgi_root/temps/defaults/_admin_auth.html";
$htmlAdminAuthFailed= "$cgi_root/temps/defaults/_admin_auth_failed.html";
# -----------------------------------------


# --------------- STATISTIC  database------------------
$statistic= "$cgi_root/data/stat_inout";
$powerMeasure= "$cgi_root/data/measure.dat";
# ---------------- Lost Database ---------------
$lostAccs= "$cgi_root/data/lost_account.dat";

$account_database= "$cgi_root/data/accounts.dat";
#%AREASYSTEM_END%#

#%AREAUSER_BEGIN%#
$in_hit_min_limit= 0;

# ADVANCED Webmasters

# genlist.cgi

# -----------------------  

# Report Config {
# 0-plain, 1-html, 2-plain+html  text
$reportAdminType= 1;

# 0-plain, 1-html, 2-plain+html  text
$reportAdminEditType= 1;


# 0-plain, 1-html, 2-plain+html  text
$reportAccType= 1;
$reportDeleteType= 1;
$reportInactivityType= 0;

# }

# After X cycles loop will sleep Y seconds. Files Log_IN,Log_OUT will be
# closed so other CGIs can work with them.
#X=
$config::loop_pause= 5000;
#Y=
$config::loop_sleep= 3;
#%AREAUSER_END%##%EOF%#
#%File: ./data/errors.dat%#
package error_codes;
#-------------------------------------------------------------------------------
# Error codes
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------

#-------------  OK Message --------------
$error{'SK'}{'1111'} = "Vsetko je OK";
$error{'EN'}{'1111'} = "Everithing is OK";
$error{'GER'}{'1111'} = "Eles ist gut";
#-------------   Error 1000 --------------

$error{'SK'}{'1000'} = "Nieco sa deje zle";
$error{'EN'}{'1000'} = "Something is going wrong";
$error{'GER'}{'1000'} = "Es ist nich OK";

#-------------   Error 1001 :method in HASH{GET_REQ_METHOD}------------

$error{'SK'}{'1001'} = "CGI modul vyzaduje spustenie cez WWW browser";
$error{'EN'}{'1001'} = "It's necessery to run this CGI modul from browser";
$error{'GER'}{'1001'} = "Es ist nich OK";

#-------------   Error 1003 :when SWITCHING and there is no match ------------

$error{'SK'}{'1003'} = "Parameter nevyhovuje ziadnej moznosti";
$error{'EN'}{'1003'} = "No match for this parameter";
$error{'GER'}{'1003'} = "Keine vyskyt des parameter";


#-------------   Error 1004 :when SWITCHING and there is no match ------------

$error{'SK'}{'1004'} = "Chyba pri otvarani suboru";
$error{'EN'}{'1004'} = "File open error";
$error{'GER'}{'1004'} = "File kann man open nich!";

#-------------   Error 1005 :when  adding to file account_list------------

$error{'SK'}{'1005'} = "Chyba pri praci s account-list";
$error{'EN'}{'1005'} = "File servicing account_list";
$error{'GER'}{'1005'} = "File account_list error";

#-------------   Error 1010 :when doing hit but has no account ------------

$error{'SK'}{'1010'} = "Nie je member";
$error{'EN'}{'1010'} = "Not a member";
$error{'GER'}{'1010'} = "Nicht part";


#-------------   Error 1006 : Error opening DBM file  ------------

$error{'SK'}{'1006'} = "Chyba pri otvarani DBM suboru, prpadne je server zaneprazdneny. Skuste znovu!";
$error{'EN'}{'1006'} = "Error opening DBM file or server is bussy. Try agait !";
$error{'GER'}{'1006'} = "Das Problem mit DBM file oder ... !";


#-------------   Error 1007 : Error opening file  ------------

$error{'SK'}{'1007'} = "Chyba pri otvarani suboru, pripadne je server zaneprazdneny. Skuste znovu!";
$error{'EN'}{'1007'} = "Error opening file or server is bussy. Try agait !";
$error{'GER'}{'1007'} = "Das Problem mit file";



#-------------   Error 1020 : Accout already exists  ------------

$error{'SK'}{'1020'} = "Konto uz existuje";
$error{'EN'}{'1020'} = "Account already exists";
$error{'GER'}{'1020'} = "Ich bin nich gut in Deutch";


#-------------   Error 1021 : Accout doesn't exist  ------------

$error{'SK'}{'1021'} = "Konto neexistuje";
$error{'EN'}{'1021'} = "Accout doesn't exist";
$error{'GER'}{'1021'} = "Ich bin nich gut in Deutch";

#-------------   Error 1121 : Wrong PWD or ACC ------------

$error{'SK'}{'1121'} = "Chybne heslo alebo login";
$error{'EN'}{'1121'} = "Wrong Login or Password";
$error{'GER'}{'1121'} = "Ich bin nich gut in Deutch";


#-------------   Error 1030 : Not enought params  ------------

$error{'SK'}{'1030'} = "Musite zadat vsetky parametre";
$error{'EN'}{'1030'} = "You have to set all parameters";
$error{'GER'}{'1030'} = "Ich bin nich gut in Deutch";


#-----   Error 1031 : You have to use GET method instand of POST  ---------

$error{'EN'}{'1031'} = "Use GET instand fo POST in FORM";
$error{'SK'}{'1031'} = "Nutne pouzit metody GET namiesto POST  (formular)";
$error{'GER'}{'1031'} = "Machst du mit POST nicht. GET ist besser";


#-------------   Error 1032 : Not valid params  ------------

$error{'SK'}{'1032'} = "Musite zadat spravne paramatre";
$error{'EN'}{'1032'} = "You have to set valid parameters";
$error{'GER'}{'1032'} = "Ich bin nich gut in Deutch";



#-------------   Error 1050 : Invalid word  ------------

$error{'SK'}{'1050'} = "Pouzili ste zakazane slovo, skuste ine";
$error{'EN'}{'1050'} = "The word you have written is restricted";
$error{'GER'}{'1050'} = "Ich bin nich gut in Deutch";


#-------------   Error 1051 : Invalid length of word  ------------

$error{'SK'}{'1051'} = "Slovo obsahuje prilis vela znakov";
$error{'EN'}{'1051'} = "The word is too long, short it!";
$error{'GER'}{'1051'} = "Ich bin nich gut in Deutch";


#-------------   Error 1081 : Invalid length of word  ------------

$error{'SK'}{'1081'} = "Polozka nesmie obsahovat ine nez ciselne udaje";
$error{'EN'}{'1081'} = "Numbers only allowed";
$error{'GER'}{'1081'} = "Ich bin nich gut in Deutch";


#-------------   Error 1052 : Invalid length of word  ------------

$error{'SK'}{'1052'} = "Slovo obsahuje malo znakov";
$error{'EN'}{'1052'} = "The word is too short!";
$error{'GER'}{'1052'} = "Ich bin nich gut in Deutch";


#-------------   Error 1053 : wrong E-MAil address  ------------

$error{'SK'}{'1053'} = "E-mail bol zle zadany";
$error{'EN'}{'1053'} = "Wrong E-mail address";
$error{'GER'}{'1053'} = "Ich bin nich gut in Deutch";


#-------------   Error 1053 : error in chose words file  ------------

$error{'SK'}{'1055'} = "Error reading file chosen_words.dat";
$error{'EN'}{'1055'} = "Error reading file chosen_words.dat";
$error{'GER'}{'1055'} = "Ich bin nich gut in Deutch";
#%EOF%#
#%File: ./data/help.dat%#
# help is composed from TOPICS and ITEMS
topic=accadd label=Account Registration

    item=title label=Field Title
colm Enter text which will be displayed in toplist rank.
You shouldn't write banned words if so you'll be warned!
    enditem
    
    item=descr label=Field Description
Enter text which will be displayed in toplist rank.
You shouldn't write banned words if so you'll be warned!
    enditem
    
    item=bannerurl label=Field Banner URL
Enter URL with HTTP:// where banner you want to show 
in the rank is located
[Example: http://my.domain.com/banners/banner.gif]
    enditem
    
    item=sampleurl label=Field Sample URL
Enter URL with HTTP:// where sample pics you want to 
show in rank is located
[Example: http://my.domain.com/samples/sample.gif]
    enditem

    item=email label=Field Email Address
Enter your e-mail address. It's important to
set proper address because the registration 
process won't complete without it.
The notification will be sent to this address in case
of problems ...
[Example: myname@mydoamin.com]
    enditem


    item=verifaccname label=Field Account Name
Enter account name which you have typed in
form before. It is necessary that this acc. name
will match with ID typed below    
[Example: yourname]
    enditem

    item=verifid label=Field ID
Enter ID that belongs to account name. If
everything goes right you have obtained ID
by e-mail.
[Example: 94665]
    enditem


endtopic

topic=accauth label=Account Authentification
    item=accname label=Field Account Name
Enter account name to modify.
You have to type proper password in
field below to succeed!
    enditem
    
    item=pwd label=Field Password
Enter proper password to account typed above.
    enditem

endtopic


topic=accmodif label=Account Modification
    item=pwd label=Field Password
If you want to change password, enter
and re-enter new password. Else leave as it is.    
    enditem
    

endtopic


topic=admin label=Admin Desktop
    item=display label=Display Function
Allow you to operate with accounts registered to your toplist.
Choose method (click on radio button ):
          <br>
<b>Active:</b>
    Lists all accounts which are set as active. This means
    that they sent you a traffic
	  <BR>
<b>Inactive:</b> 
    Opposite to Active
          <br>
<b>All:</b>      
    Lists all accounts
          <br> 
<b>Member w.:</b>
    There are 5 choices. You can use asterisk [*].Example:
    &nbsp;&nbsp;<b>test*</b> - this will list all account with name 'test'
    &nbsp;&nbsp;folloewd by any add. string [test1, testccc, ...]
    &nbsp;&nbsp;<b>*test</b> - this will list all account with any name 
    &nbsp;&nbsp;followed by 'test'[1test, xxxtest, ...]
    &nbsp;&nbsp;<b>*test*</b> - this will list all account with any name 
    &nbsp;&nbsp;containig string 'test'[1test,1test1,xxxtest,yytestxx, ...]
    &nbsp;&nbsp;<b>test</b> - this will list only account with exact na test
    &nbsp;&nbsp;<b>*</b> - this will list all accounts
    enditem


    item=edit label=Edit Function
Encapsulates all functions related to template creating and editing.
Consists of these functions:
<b>Edit HTML Code [list box with the file names of templ]</b>
    This function allows you to edit all indexes templates.
    The file names in combo box are automatically generated from
    information set in setup [section indexes]
    <br>
<b>Edit Break Code [list box with the file names of templ]</b>
    This function is in function same as above one but dedicated
    for Break Edit
        <br>
<b>Edit Mail Templates</b>
    Use this function to edit all templates for various mail
    [acc add mail, inactivity, ...]
    <br>    
<b>Edit Black List</b>
    Allows you to edit black list files with banned words and urls
    enditem
    <br>

    item=execute label=Execute Function
Consists of some handy functions

<b>Reset/Rerank</b> lets you reset or rerank toplist manually.
    <br>
<b>Set Hit Ratio</b>
  use this function for set hit ratio X:X for accounts from A to B 
  sorted by IN hits
  !!!! Function has no rollback and changed made are 'forever'
  when using this function think before do anything !!!!
    <br>  
<b>Remove inactive ...</b>
  use it to remove users which are inactive for X resets and longer  
  !!!! Function has no rollback and changed made are 'forever'
  when using this function think before do anything !!!!
    enditem
    
    
    
    item=mailto label=Mail To Function
Many ways how to send mail to account

<b>All:</b>
  This choice will send an e-mail to all account in database.
  Subject and Body of e-mail form is also in this menu.
<br>
<b>Auto Inactive:</b>
  Allows you to send mass e-mail to users inactive for X resets.
  The X number is defined in setup.
  Body and subject are defined as template editable in section EDIT
<br>  
<b>Inactive:</b>
  Allows you to send mass e-mail to inactive users [ which
  didn't send any traffic in one reset period].
  Body and subject are defined as template editable in section EDIT  
<br>  
<b>Deleted</b>
 Lets you send an e-mail to deleted users [e-mail addresses of all
 deleted account are archived in special database]
  Subject and Body of e-mail form is also in this menu. 
  <br>
<b>Load list</b>
  This function load list of e-mail addresses of all accounts in 
  database and fills the list box next. There you can select 
  addresses you want to send e-mail to.
  <br>
<b>Selected from List</b>
  Send e-mail to all addresses selected form list of addresses
    enditem
    
endtopic

topic=accview label=Account View
    item=accname label=Account Name
Set the <b>name</b> of the new <b>account</b>. Under this ID user will
be identified in account search functions, e-mail
sending op., input traffic resolving
Example  http://www.xxx.yyy/cgi-bin/in.cgi?acc=xxx
    enditem

    item=ratio label=Hit ratio
Set the <b>hit ratio</b> of the <b>account</b>. Use format
like XX:YY where XX is  multiplier of real IN and
YY multiplies real OUT. These new numbers
are used as IN/OUT for list generation.
Example: 1.5:0.33
    enditem

    item=inout label=Start up IN/OUT
These values represent a bonus IN/OUT given to account
after registration. It's start up bonus.
Example: 100
    enditem

    item=linkurl label=Primary Site URL
Set the <b>URL</b> to which the traffic will be sent. It must 
consist of http:// followed by domain and so on.
<b>!! It's the account's URL !!<b>
<br>
Example  http://www.xxx.yyy/cgi-bin/in.cgi?acc=xxx
    enditem

    item=seclinkurl label=Secondary Site URL
Set the <b>URL</b> to which the traffic will be sent. It must 
consist of http:// followed by domain and so on.
Secondary one is used in <b>anti-loop process</b>.
For details see <b>Setup</b>
<b>!! It's the account's URL !!<b>
<br>
Example  http://www.xxx.yyy/cgi-bin/in.cgi?acc=xxx
    enditem

    
    item=title label=Title
The <b>Title</b> is one of the fields which can be displayed in
the index file of toplist. Usually it's the main text in
the rank record.
    enditem

    item=descr label=Description
The <b>Description</b> is one of fields which can be displayed in
index file of toplist. Usually it's a sub text in
rank record.
    enditem

    item=bannerurl label=Banner
Set the banner's URL. It'll be used in the index file as
the source of image - if you wish.(You can set in the Setup) 
Set WIDTH and HEIGHT or leave empty to use default
sizes
<br>
Example:  http://www.xxx.yyy/banner.jpg
    enditem
    
    item=sampleurl label=Sample
Set the sample's URL. It'll be used in the index file as
the source of image - if you wish. (You can set in the Setup) 
Set WIDTH and HEIGHT or leave empty to use default
sizes
<br>
Example:  http://www.xxx.yyy/sample.jpg
    enditem
    
    item=pwd label=Password
The <b>Password</b> is necessary to access account through
add/modify form by registered accounts.
As the Toplist Admin you can access an account with no need
to set the password
Example: you can use any characters
    enditem

    item=repwd label=Re-Password
The <b>Re-Password</b> is used to avoid mistakes, so fill 
this field with same value as in the <b>Password</b> field
Example: you can use any characters
    enditem


    item=email label=E-Mail
Set <b>E-mail</b> of an account. This e-mail address is used
in all e-mail operations and is one of contact values.
<br>
Use only form like this:
Example: xxx@yyy.zz
    enditem


    item=stat label=Account's Statistic
It?s some statistics that helps you with toplist management. 
The data could be divided into two main groups:
<BR>
<b>Aggregated values</b> represent the sum of data from the point 
of account registration. This information can be used
when analyzing accounts in long back horizont.
There are :
<br>
<b>Real IN:</b> sum of all INs
<b>Prod NB INs:</b> sum of all INs followed by OUT click and
		   are checkek by anti-cheater
<b>Prod INs:</b> sum of all INs followed by OUT click
<b>OUT:</b> sum of all OUTs
<b>Gen. OUT:</b> sum of all OUTs after IN click		   
<br>
Another group of values represents the sum of data in actual
reset period.
There are:
<br>
<b>Prod. IN:</b> sum of all INs followed by OUT click
<b>OUT:</b> sum of all OUTs during reset period
    enditem


    item=susp_lock_free_new label=Freeze/Lock/Suspend/New
Account attributes that can be used for account management.

<b>Suspended:</b> If set, account won't be listed in toplist
<b>Locked</b> If set, account is not accessible. Owner can't
edit it.
<b>Frozen</b> If set, account's IN counter if frozen. 
<b>New</b> If set, account is visible in Account view filtered by NEW
<b>Modified</b> If set, account was modified
    enditem
    
    item=act_inact label=Account Activity
This value shows account's activity. 
If the value is negative (ex. -10) an account have been inactive 
for 10 resets. 
If value is ZERO an account is newly added or in reset before it
was negative.
If the value is positive (ex. 15) an account have been active for 15 resets.
    enditem


    item=buttons label=Account View Buttons
To realize operations on an account, use these buttons.

<b>SAVE:</b> Use this button to save account's content. Before
done, all fields are checked and user is warned if wrong values 
are used.

<b>DELETE:</b> Use this button to delete specified account.

<b>MAIL:</b> Use this button to send an e-mail to specified account.

    enditem
endtopic


topic=htmledit label=HTML Edit
item=htmlheader label=Header data
Use these variables in HTML code. In rerank process they will be
replaced by particular account's information. Use of these variables 
is order and line independent. In one line there can be more then one 
variable.

Use this area to input HTML code for INDEX header.
It's that part of INDEX html document that occurs only at
the beginning. Then it follows block of code for each account in rank.

Toplist software doesn't add any additional html code into index files !!!

[HEADER html]
[ACCOUNT_1 html]
[ACCOUNT_2 html]
.
.
.
[ACCOUNT_n html]
[FOOTER html]
enditem

item=htmlbody label=Body data
Use these variables in HTML code. In rerank process they will be
replaced by particular account's information. Use of these variables 
is order and line independent. In one line there can be more then one 
variable.

Use this area to input HTML code for INDEX header.
It's that part of INDEX html document that represents one record
in INDEX file ~  one account.

Toplist software doesn't add any additional html code into index files !!!

[HEADER html]
[ACCOUNT_1 html]
[ACCOUNT_2 html]
.
.
.
[ACCOUNT_n html]
[FOOTER html]
    enditem
    
item=htmlfooter label=Footer data
Use these variables in HTML code. In rerank process they will be
replaced by particular account's information. Use of these variables 
is order and line independent. In one line there can be more then one 
variable.

Use this area to input HTML code for INDEX header.
It is that part of INDEX html document that occurs only at
the beginning. Then it follows block of code for each account in rank.

Toplist software doesn't add any additional html code into index files !!!

[HEADER html]
[ACCOUNT_1 html]
[ACCOUNT_2 html]
.
.
.
[ACCOUNT_n html]
[FOOTER html]
enditem

endtopic


topic=breakedit label=Break Edit
    item=editfield label=Edit field
Each text area represents one break. So fill it up with code for break.

Warning!!!
Html code for break must be created as a part of Header-Body-Footer 
code. TL doesn't modify template's code in any way except variables.
How TL adds break code?
1. Get Header Code
2. Get Body Code and replace variables with ...
3. Repeat 2. step, until the position with break appears
4. Insert Break Code 
5. Repeat step 2. or 4. 
6. Get Footer Code

Toplist index page with 6 accounts listed and breaks 
on 3.,6. positions :
<b>Header-Body-Body-Break-Body-Body-Body-Break-Body-Footer</b>

Example [fractions]
<b>
&#60;table>				body code
&#60;tr&#62;&#60;td&#62;&#60;/td&#62;&#60;/tr&#62;
!! break code start!!
&#60;/table&#62;			break code
this is break		
&#60;table&#62;
!! break code end!!			
&#60;table>				body code
</b>
enditem

endtopic



topic=mailedit label=Mail Edit

  item=textuserheader label=E-Mail to User Header
Into the subject registration field put the string that will be
display in the e-mail to user after account created.

To the TEXT area put text that represents the header of
the text based e-mail. 
It's followed by body text and then footer text.
  enditem
  
  item=textuserfooter label=E-Mail to User Footer
To the TEXT area put text code that represents the footer of
the text based e-mail. 
  enditem

  item=htmluserheader label=E-Mail to User Header
Into the subject registration field put the string that will be
display in the e-mail to user after account created.

To the HTML area put html code that represents header of
html based e-mail. 
It's followed by body html and then footer html.
  enditem


  item=htmluserfooter label=E-Mail to User Footer
To the HTML area put html code that represents the footer of
the html based e-mail. 
  enditem
  
  item=textuserdelete label=E-Mail to User Delete
Into the subject registration field put the string that will be
display in the e-mail to user after account have been delete.

To the TEXT area put text code that represents text based e-mail. 
  enditem

  item=htmluserdelete label=E-Mail to User Delete
Into the subject registration field put the string that will be
display in the e-mail to user after account have been delete.

To the HTML area put html code that represents html based e-mail. 
  enditem

  item=textuserinact label=E-Mail to User Inact
Into the subject registration field put the string that will be
display in the e-mail to inactive user.

To the TEXT area put text code that represents text based e-mail. 
  enditem


  item=htmluserinact label=E-Mail to User Inact
Into the subject registration field put the string that will be
display in the e-mail to inactive user.

To the HTML area put html code that represents html based e-mail. 
  enditem
 
endtopic





topic=wordsedit label=Edit Banned List
  item=url label=Restricted URLs
Set urls/emails resp.url's /email's fragments that won't be accepted when
adding new account by user.
Each expression must be in a separate line.

example:

www.lolita
www.childp
xxx@xxx

  enditem
  item=word label=Restricted Words
Set words that won't be accepted in a title, description.
Each expression must be in a separate line.

example:

child
porn
xxx


  enditem
endtopic




topic=iconedit label=Icon Edit
    item=newlimit label=New Icon Limit
This value restricts icon visibility form 1. user in rank to
X. user. X is the value you have entered.
  enditem

    item=longlimit label=Long Icon Limit
This value restricts icon visibility form 1. user in rank to
X. user. X is the value you have entered.
  enditem  
  
    item=directionlimit label=Direction Icon Limit
This value restricts icon visibility form 1. user in rank to
X. user. X is the value you have entered.
  enditem  


    item=newmain label=New Icon
Checkbox controls visibility of icons. If enabled, this type
of icon is displayed else not.

'Duration' fills with value that says How Long Will The New Icon Be 
Displayed

Fill up html area with html code that handles icon visualization.
By this piece of code the VARIABLE will be replaced in index templates.
For detail see help in HTML EDIT
enditem  
  
    item=upmain label=Up Icon
Checkbox controls visibility of icons. If enabled, this type
of icon is displayed else not.

Fill up html area with html code that handles icon visualization.
By this piece of code the VARIABLE will be replaced in index templates.
For detail see help in HTML EDIT
enditem  

    item=downmain label=Down Icon
Checkbox controls visibility of icons. If enabled, this type
of icon is displayed else not.

Fill up html area with html code that handles icon visualization.
By this piece of code the VARIABLE will be replaced in index templates.
For detail see help in HTML EDIT
enditem  

    item=stquomain label=Status Quo Icon
Checkbox controls visibility of icons. If enabled, this type
of icon is displayed else not.

Fill up html area with html code that handles icon visualization.
By this piece of code the VARIABLE will be replaced in index templates.
For detail see help in HTML EDIT
enditem  

    item=activity label=Long Activity Icon
Checkbox controls visibility of icons. If enabled, this type
of icon is displayed else not.

'Active for' fills with value that says After How Name Resets the Long
Icon Will Be Displayed

Fill up html area with html code that handles icon visualization.
By this piece of code the VARIABLE will be replaced in index templates.
For detail see help in HTML EDIT
enditem  

endtopic

topic=stat label=Statistic
    item=uptime label=System Load
This graph shows the history of the system load during 24 
hours. The number represents how many processes have been waiting
since hour begins.
Use this information to monitor the system if it's fit.
The <b>value above 1 is bad</b> sign especially if it's for a long time.
In that case contact you server admin.
    enditem

    item=outstat label=Output Statistic
This graph illustrates outputs from positions (1...) in 
the toplist. Use this graph to analyze which positions are 
clicked the most frequently.
    enditem

    item=hour label=Statistic [Sum per Hour]
This graph is aggregated by hours and offers 6 different information.
Let's split it into 2 categories:
<br>
<b>Input</b>: Input information says how many individual
   	      internet surfers visited your toplist at 
	      apropriate time (hour). But this is not enough. 
	      Input data are divided into 4 parts:
<br>	      
	   <b>Total Input</b>: This is the sum of inputs in
			       aprop. hour. It contains of inputs followed 
			       by output + blind inputs + cheated inputs+...
<br>			       
	   <b>Total Productive Input</b>: This is the sum of inputs in
			       aprop. hour. followed by output + cheated 
			       inputs followed by output.
<br>			       
	   <b>Total Not Cheated</b>: This is the sum of inputs in
			       aprop. hour. followed by output + blind inputs.
			       This sum doesn't contain cheated input's.
<br>			       
	   <b>Total Not Cheated Productive</b>: This is the sum of inputs in
			       aprop. hour. followed by output.
			       This sum doesn't contain cheated input's.
			       This is the number which says how quality
			       traffic do you have
<br>			       
<b>Output</b>: Output information says how many individual
   	       internet surfers leave your toplist through
	       any link in the rank at appropriate time (hour). 
	       Output data are divided into 2 parts:
<br>			       
	   <b>Total Output</b>:This is the sum of outputs in
			       aprop. time (hour). It contains
			       also output created by user who
			       arrives directly to page, no
			       through input cgi
<br>			       
	   <b>Total Generated Output</b>: This is the sum of outputs in
			       aprop. time (hour). but it contains
			       only outputs generated by input through
			       input cgi. This is output generated by
			       your registered accounts.
	       
<br>	      
You have  to understand all these graphs and the you can maximized
effects of your job.
    enditem




    item=day label=Statistic [Sum per Day]
This graph is aggregated by days and offers 6 different information.
Let's split it into 2 categories:
<br>
<b>Input</b>: Input information says how many individual
   	      internet surfers visited your toplist at 
	      appropriate time (day). But this is not enough. 
	      Input data are divided into 4 parts:
<br>	      
	   <b>Total Input</b>: This is the sum of inputs in
			       aprop. hour. It contains of inputs followed 
			       by output + blind inputs + cheated inputs+...
<br>			       
	   <b>Total Productive Input</b>: This is the sum of inputs in
			       aprop. day. followed by output + cheated 
			       inputs followed by output.
<br>			       
	   <b>Total Not Cheated</b>: This is the sum of inputs in
			       aprop. day. followed by output + blind inputs.
			       This sum doesn't contain cheated input's.
<br>			       
	   <b>Total Not Cheated Productive</b>: This is the sum of inputs in
			       aprop. day. followed by output.
			       This sum doesn't contain cheated input's.
			       This is the number which says how quality
			       traffic do you have
<br>			       
<b>Output</b>: Output information says how many individual
   	       internet surfers leave your toplist through
	       any link in the rank at appropriate time (day). 
	       Output data are divided into 2 parts:
<br>			       
	   <b>Total Output</b>:This is the sum of outputs in
			       aprop. time (day). It contains
			       also output created by user who
			       arrives directly to page, no
			       through input cgi
<br>			       
	   <b>Total Generated Output</b>: This is the sum of outputs in
			       aprop. time (day). but it contains
			       only outputs generated by input through
			       input cgi. This is output generated by
			       your registered accounts.
	       
<br>	      
You have  to understant all these graphs and the you can maximized
effects of your job.
    enditem






    item=month label=Statistic [Sum per Month]
This graph is aggregated by months and offers 6 different information.
Let's split it into 2 categories:
<br>
<b>Input</b>: Input information says how many individual
   	      internet surfers visited your toplist at 
	      appropriate time (month). But this is not enough. 
	      Input data are divided into 4 parts:
<br>	      
	   <b>Total Input</b>: This is the sum of inputs in
			       aprop. month. It contains of inputs followed 
			       by output + blind inputs + cheated inputs+...
<br>			       
	   <b>Total Productive Input</b>: This is the sum of inputs in
			       aprop. month. followed by output + cheated 
			       inputs followed by output.
<br>			       
	   <b>Total Not Cheated</b>: This is the sum of inputs in
			       aprop. month. followed by output + blind inputs.
			       This sum doesn't contain cheated input's.
<br>			       
	   <b>Total Not Cheated Productive</b>: This is the sum of inputs in
			       aprop. month. followed by output.
			       This sum doesn't contain cheated input's.
			       This is the number which says how quality
			       traffic do you have
<br>			       
<b>Output</b>: Output information says how many individual
   	       internet surfers leave your toplist through
	       any link in the rank at appropriate time (month). 
	       Output data are divided into 2 parts:
<br>			       
	   <b>Total Output</b>:This is the sum of outputs in
			       aprop. time (month). It contains
			       also output created by user who
			       arrives directly to page, no
			       through input cgi
<br>			       
	   <b>Total Generated Output</b>: This is the sum of outputs in
			       aprop. time (month). but it contains
			       only outputs generated by input through
			       input cgi. This is output generated by
			       your registered accounts.
	       
<br>	      
You have  to understand all these graphs and the you can maximized
effects of your job.
    enditem







    item=year label=Statistic [Sum per Year]
This graph is aggregated by years and offers 6 different information.
Let's split it into 2 categories:
<br>
<b>Input</b>: Input information says how many individual
   	      internet surfers visited your toplist at 
	      appropriate time (year). But this is not enough. 
	      Input data are divided into 4 parts:
<br>	      
	   <b>Total Input</b>: This is the sum of inputs in
			       aprop. month. It contains of inputs followed 
			       by output + blind inputs + cheated inputs+...
<br>			       
	   <b>Total Productive Input</b>: This is the sum of inputs in
			       aprop. year. followed by output + cheated 
			       inputs followed by output.
<br>			       
	   <b>Total Not Cheated</b>: This is the sum of inputs in
			       aprop. year. followed by output + blind inputs.
			       This sum doesn't contain cheated input's.
<br>			       
	   <b>Total Not Cheated Productive</b>: This is the sum of inputs in
			       aprop. year. followed by output.
			       This sum doesn't contain cheated input's.
			       This is the number which says how quality
			       traffic do you have
<br>			       
<b>Output</b>: Output information says how many individual
   	       internet surfers leave your toplist through
	       any link in the rank at appropriate time (year). 
	       Output data are divided into 2 parts:
<br>			       
	   <b>Total Output</b>:This is the sum of outputs in
			       aprop. time (year). It contains
			       also output created by user who
			       arrives directly to page, no
			       throught input cgi
<br>			       
	   <b>Total Generated Output</b>: This is the sum of outputs in
			       aprop. time (year). but it contains
			       only outputs generated by input through
			       input cgi. This is output generated by
			       your registered accounts.
	       
<br>	      
You have  to understand all these graphs and the you can maximized
effects of your job.
    enditem
endtopic


topic=mainhelp label=Toplist Help
    item=overview  label=Overview
This short help will provide you through toplist's features and dependences.
If this text can't offer you enough information, visit <a href="http://www.xxxscripts.net" target="_blank">www.xxxscripts.net</a>
    enditem
    item=xxx  label=XXX
      this is xxx
    enditem
    
endtopic


topic=setup label=Admin Setup
    item=email  label=Admin's Email
Enter e-mail where will be routed all automated e-mails from TopList
Example: xxxx@xxx.xx
    enditem

    item=overallsites  label=Overall Sites
This value represents the maximum amount of accounts in the list
If val. is 50 it means that no more then 50 accounts will
be used to create all index-es [list].
Example: 50
    enditem

    item=minimumsites  label=Minimum Sites
This value represents the minimum amount of accounts in the list
If val. is 10 it means that no less then 10 accounts will
be used to create all index-es [list].
If there are not enough accounts that match some 
list criteria several methods are used to reach this lower layer:
LastTopX [uses some accs from previous rerank]
Random   [takes random user - Pmax = 1.-10. rank]
Example: 10
    enditem

    item=indexnames  label=Index Names
Type names of indexes you want to be generated.
Separate names with comma.
Example: index.html,index2.html,index3.html
    enditem

    item=indexaccs  label=Accounts per Index
Type amount of account to be used for particular index.
Separate it with comma.
Example bellow says: Use top 10 accounts in index.html
20 in index2.html and 10 in index3.html
Example: 10,20,10
    enditem

    item=breaklist  label=Break List
Enter positions in rank where the break will be placed.
Use position relative to 1. position. Don't care on hove
the rank is broken into indexes.
Example below says: place break 1 after 1. place in the 
index1.html break 2 after 9. place in the index1.html and 
break3 after 5. place in the index2.html. [see help 'List 
per Indexes' and 'Index Names' to see example of index names ...]
Example: 2,9,15
    enditem

    item=fontsizes  label=Font sizes
By these values you can easily control size of text in 
position intervals. Use the following syntax:
X-Y=-+Z,X-Y=+-Z,...
where X-start position, Y-end position, Z-font size
Example: 1-10=+1,10-15=-1,15-30=-2
    enditem

    item=overallbanners  label=Overall Banners
This value represents the maximum amount of banners shown in the list
If val. is 50 it means that no more then 50 banners will
be shown in all indexes starting from 1st.
Example: 50
    enditem

    item=overallsamples  label=Overall Samples
This value represents the maximum amount of samples shown in the list
If val. is 50 it means that no more then 50 samples will
be shown in all indexes starting from 1st.
Example: 50
    enditem
    
    item=htmlAdminModif  label=Html Mail After Account Modif.
If checked HTML based e-mail will be used to admin after
accounter modifies his account.    
Else TEXT based e-mail will be sent.
    enditem
    item=htmlAdminAdd  label=Html Mail After Account Reg.
If checked HTML based e-mail will be used to admin after
account registration has been done.    
Else TEXT based e-mail will be sent.
    enditem

    item=emailAdminAdd  label=Mail After Registration
If checked e-mail will be sent to admin after new account 
registration is done.
    enditem

    item=emailAdminModif  label=Mail After Modification
If checked e-mail will be sent after account's modification 
is done.
    enditem
    item=htmlAccount  label=Html Mail To Account
If checked HTML based e-mail will be sent to user's e-mail
after new account registration is done.
Else TEXT based e-mail will be sent.
    enditem
    
    item=emailAccAdd  label=Mail After Registration
If checked e-mail will be sent to account after new account 
registration is done.
    enditem
    item=htmlAccDel  label=Html Email To Account
If checked HTML based e-mail will be sent to user's e-mail
after account is deleted.
Else TEXT based one will be sent.
    enditem
    item=emailAccDel  label=Email To Account when Deleted
If checked  e-mail will be sent to user's e-mail
after account is deleted.
    enditem
    
    item=htmlAccInact  label=Html Email To Account
If checked HTML based e-mail will be sent to user's e-mail
when inactive for X resets.
    enditem
    item=emailAccInact  label=Mail After Inactivity
If checked e-mail will be sent to account when inactive
for X resets.
    enditem
    item=inactEdge  label=Edge Value for Inact Email
This value defines edge value for Inactivity Email.
In Email section of admin there is option 'Auto Inactivity'.
When used inactivity e-mail will be sent to all 
accounts which are inactive for X resets.
X represents value of this field.
Example: 3
    enditem
    item=usephp  label=Use PHP
If checked for IN and OUT cgi will be used one in PHP.
Switch to Advanced Setup to modify paths and names
of IN.PHP and OUT.PHP
    enditem
    item=mininhits  label=Minimum In Hits
This is a filter value for accounts to get listed.
If IN value of account is under this border account won't 
be used to generate list. This filter is suppressed if there
is not enough accounts to that match this criteria to
reach Minimum Sites To List.
    enditem
    
    item=forward  label=Auto Forward
AutoForward method is applied when sb will go 'in' toplist    
by in.cgi/php and from account A1 and then tries to
go back to A1's toplist. There are 4 methods.
Choose auto forward method:
<br>
No Forward: No restrictions. Above example will be done.<br>
FW to Default URL: Account will be fw to default 
                   URL [set in setup]
FW to Random URL: Account will be fw to random acc's URL
                  Pmax in top 10 accs.
FW to Secondary URL: Account will be fw to secondary
		  URL if set.		  		   
    enditem

    item=defFWUrl  label=Default FW URL
Set default forward URL for AutoForward purposes.
It must be URL where to forward traffic.
Example: http://www.xxx.xxx/in.php?acc=xxx    
    enditem

    item=defBannerURL  label=Default Banner URL
Set default banner URL.
It's used when account doesn't have specified
the banner url. DefaultBanner is used instead.
Example: http://www.xxx.xxx/banner.gif
    enditem

    item=useCookies  label=Use Cookies
If checked cookies will be used. If cookies are set in
part. browser INs from this browser won't affect
account's IN for X seconds [set in the setup].
It's once from anti cheaters methods.
    enditem

    item=cookieexpir  label=Cookie's Expiration
If cookies are set INs from part. browser won't affect
account's IN for X seconds. X is the value of this field.
    enditem

    item=maxsitetitle  label=Max Site Title Length
This value restricts user when adding new account and
filling up Account's TITLE field. TITLE can't exceed X chars.
Example 10
    enditem

    item=maxsitedescr label=Max Site Description Length
This value restricts user when adding new account and
filling up Account's DESCRIPTION field. DESCRIPTION can't 
exceed X chars.
Example 10
    enditem
    item=usecron  label=Use Cron
If checked cron will be used. Cron is little daemon
which schedules tasks. Tolplist uses cron to schedule
Reset and Rerank operations.
    enditem
    item=usenice label=Use Cron with Nice
If checked cron will execute task by nice. Nice is little piece
of sw which handles situation when too many tasks going to be 
executed. This causes server high load so if you can
use NICE.
    enditem
    item=cronrerank label=Cron Rerank Period
Choose in the list one of the predefined period of Rerank operation.
This value is used when Use Cron is enabled.
    enditem
    item=cronreset label=Cron Reset Period
Choose in the list one of the predefined period of Reset operation.
This value is used when Use Cron is enabled.
    enditem
    item=manreset label=Reset Period
Set Reset Interval in seconds.
Used when cron is disabled.
    enditem
    item=manrerank label=RerankPeriod
Set Rerank Interval in seconds.
Used when cron is disabled.
    enditem
    item=maxBannerH label=Max Banner Height
Set maximum banner height. It restricts user when 
adding new account.
Example: 100
    enditem
    item=maxBannerW label=Max Banner Width
Set maximum banner width. It restricts user when 
adding new account.
Example: 100
    enditem
    item=maxSampleH label=Max Sample Height
Set maximum sample height. It restricts user when 
adding new account.
Example: 100
    enditem
    item=maxSampleW label=Max Sample Width
Set maximum sample width. It restricts user when 
adding new account.
Example: 100
    enditem
    item=implicitIN label=Implicit IN
This values represent a bonus IN given to the account
after registration. It's start up bonus.
Example: 100
    enditem
    item=implicitOUT label=Implicit OUT
This values represent a bonus OUT given to the account
after registration. It's start up bonus.
Example: 100
    enditem
    item=autoSuspendN label=Auto Suspend for NEW
If checked newly added accounts are implicitly suspended.    
    enditem
    item=autoSuspendE label=Auto Suspend for EDITED
If checked edited accounts are implicitly suspended.    
    enditem
    item=defaultRatio label=Default Hit Ratio
Set the default <b>hit ratio</b> of the <b>account</b>. Use 
format like XX:YY where XX is  multiplier of real IN and
YY ultiplicates real OUT. These new numbers are used as IN/OUT 
for list generation. This hit ratio will be set to new accounts.
Example: 1.5:0.33
    enditem
    item=pwd  label=Admin's Password
Enter and then reenter password for Admin Console.
Example: xxxxx
    enditem
endtopic


topic=advsetup label=Advanced Setup

    item=maGrpID  label=MultiAdd Group ID
This code allows you to build many groups of toplists.
With multiadd admin you can add one new account to
all members of the group at the one time.
This code also protects you from registrations from
unknown multiadd admin.
Example: GRP555x55
    enditem

    item=tlid  label=TopList ID
Identification String that must be unique on the web server.
It's necessary when using CRON and also it makes TopList
management easier. [TL name is used in mails after reg., ...]
Example: My New TopLIST
    enditem

    item=sendmail  label=Sendmail Location
!! Don't change if not necessary  !!
Set path included also 'sendmail' to sendmail software.
Example: /usr/lib/sendmail
    enditem

    item=crontab  label=Crontab Location
!! Don't change if not necessary  !!
Set path included also 'crontab' to crontab software.
Example: /usr/bin/crontab
    enditem

    item=htmldir  label=HTML Location
!! Don't change if not necessary  !!
Set path to document root of your domain.
Example: /sites/www.xxx.xxx/public
    enditem

    item=cgidir  label=CGI Location
!! Don't change if not necessary  !!
Set path to CGI dir of your domain.
Example: /sites/www.xxx.xxx/cgi-bin
    enditem
    item=htmlurl  label=HTML URL
!! Don't change if not necessary  !!
Set URL to document root of your domain.
Example: http://www.xxx.xxx
    enditem
    item=cgiurl  label=CGI URL
!! Don't change if not necessary  !!
Set URL to cgi of your domain.
Example: http://www.xxx.xxx/cgi-bin
    enditem
    item=phpin  label=PHP In Location
!! Don't change if not necessary  !!
Set path to php IN.
Example: /sites/www.xxx.xxx/public/in.php
    enditem
    item=phpout  label=PHP Out Location
!! Don't change if not necessary  !!
Set path to php OUT.
Example: /sites/www.xxx.xxx/cgi-bin/out.php
    enditem
    item=phpurlout  label=PHP Out URL
!! Don't change if not necessary  !!
Set URL to php OUT.
Example: http://www.xxx.xxx/out.php
    enditem
    item=phpurlin  label=PHP In URL
!! Don't change if not necessary  !!
Set URL to php IN.
Example: http://www.xxx.xxx/in.php
    enditem
    item=databoptimal  label=Database Optimalization
Set period [in hours] of database optimalization.
DO will keep you database smaller.
Example: 300
    enditem
    item=useCounter  label=Use Counter
If checked the Counter will be used.
It's special anti-hitBot feature so it's
recommended to switch it ON.
    enditem
    item=useAccViewAlarm  label=Use Acc Save Alarm
If checked the Account View Save Alarm is active.<br>
When you have edited account in AccountView and
move to another without saving the one before a
dialog box with Warning will appear.
    enditem

    item=adminAddPreg  label=Account Add New Count
Set the number of empty accounts to be pregenerated
when Account Add is choose in Admin.
Example: 5
    enditem
    item=selskin  label=Select Skin
Select skin from menu. This will apply new
CSS for ToplistAdmin. You can create you own one.
Just make a copy of existing one (./css/????.css)
and modify header info [name,...] and other
values :)
    enditem
    item=useHTAccess  label=Use HTACCESS
When checked HTACCESS will be used.
It's special webserver's security feature. If your web 
server supports this feature, use it!
    enditem
endtopic

topic=logs label=TopList Logs
    item=inout  label=In->Out Log
Choose this function to see complex analyze of current 
traffic of your TopList. This way you can detect
cheating activity or other unfair actions.
    enditem
    item=in  label=In Log
Shows content of in.log file which contains information
about all inputs through in.cgi/php.
    enditem
    item=out  label=Out Log
Shows content of out.log file which contains information
about all outputs through out.cgi/php.
    enditem
    item=counter  label=Counter Log
Shows content of counter.log file which contains information
from Counter anti-cheating mechanism. By ID you can see
if input with part. ID [in IN LOG] is also in [COUNTER LOG].
If so, this input is not cheated.
    enditem
    item=log  label=Log Log
Shows content of log.log file which contains TopList Code
information useful when some kind of errors occurs.
    enditem
    item=error  label=Error Log
Shows content of error.log file which contains TopList Code
information useful when some kind of errors occurs.
    enditem
    item=install  label=Install Log
Shows content of error.log file which contains Installation
process information useful when some kind of errors occurs.
    enditem
    item=showField  label=Show Field
Check those field you want to be visible in the list.
Fields are changing according to your LOG TYPE choice.
Fields:
<b>ID:</b> it's identification used to check if acc done
productive in [not multiple outs, ...]
<b>Time/date:</b> date of logged action
<b>ip from:</b>IP from which input comes
<b>ip ref:</b>host from which was user forwarded to 
          your Toplist
<b>cookie:</b>if cookies are set shows cookies status 
          for part. input
<b>acc in:</b>the name of input account
<b>acc out:</b>the name of output account
<b>rank of acc out:</b>the rank of output account
    enditem
    item=sortBy  label=Sort By
Choose one field by which the list will be sorted.
You can also set FilterValue which filters records
on chosen field. You can use expressions like 'XXX*'
and choose 'acc in' so only records with acc in names
like XXX1, XXXAD, ... will be displayed
    enditem
endtopic

topic=backrest label=Backup/Restore
    item=backup  label=Backup
Choose this function to do backup of your Toplist.
In the right frame there you can do another
choice - you can select what to backup:
<b>Backup Logs:</b> backups all logs from directory './logs'
<b>Backup Data:</b> backups all data from directory './data'
<b>Backup Templates:</b> backups all user defined templates
                    from directory './temps'
All backups are placed into dir ./backup/		    
    enditem
    item=restore  label=Restore
Choose this function to do restore your Toplist.
In the right frame there you can do another
choice - you can select what to restore:
<b>Restore Logs:</b> restores all logs to directory './logs'
<b>Restore Data:</b> restores all data to directory './data'
<b>Restore Templates:</b> restores all user defined templates
                    to directory './temps'
    enditem
    item=migrate  label=Migrate
Packs whole Toplist into on file './backup/install.dat'.
Then you can copy it into new site with 'install.cgi' file.
Then just run from browser install.cgi.
Example: 'http://www.newsite.xxx/cgi-bin/install.cgi'
    enditem    
    item=import  label=Import
Imports data from Autorank or other databases.
!! Not implemented yet. !!
    enditem    
    
endtopic

topic=addedit label=Edit Add Form
    item=templFields  label=Predefined CSS
There are some predefined, easy editable, CSS classes used
also in whole account add form. Modify them and get the
form in the look&feel of you toplist.
<b>Used fields:</b><br>
BG Color [background-color]: specifies the color of background
Syntax: #RRGGBB
Example: #000000 - color will be black

Color [color]: specifies the color of component
Syntax: #RRGGBB
Example: #FF0000 - color will be pure red

Size [font-size]: specifies size of the used font
Syntax: nnn
Example: 10 or 10pt or 10px

Weight [font-weight]: spec. how bold the font is
Syntax: nnn
Example: 900

Font [font-family]: spec. font's family
Example: Arial
    enditem    
    
    item=owncss label=Specify own CSS classes    
You can specify your own CSS classes with no restrictions.
Then you can use them in cover page HTML code.
If you specify class with same name as already exists
in section with predefined CSS, the settings will be
overridden.
Reason: This piece of definition will be placed in
tag Style after predefined CSS.
    enditem        
    
    item=coverpage  label=Cover Page
In this section you can edit first page of Account Add form.
It's displayed when you run .../add.cgi. By this way you
can harmonize look&feel of registration form with
your toplist.
You can use some variables there:
%#ENTER_ADD_ADD#%: is URL to add new account form.
You can just put it into tag Anchor in href property.
<b>href="%#ENTER_ADD_ADD#%" ...</b>

%#ENTER_ADD_MODIF#%: is URL to modify existing account form.
You can just put it into tag Anchor in href property.
<b>href="%#ENTER_ADD_MODIF#%" ...</b>

When user forget his password.
Next code allows you to make a form expecting account name
and after submission a password of specified account
will be sent to that account's email.

You should do it in this way:
form ... action="#%ACC_CGI#%" ...
input type="text"... name="fieldACC" ...
input type="hidden" ... name="pwdForgot" ...
input type="submit" ....
... /form>

When user want to get all his accounts on your toplist.
Next code allows you to make a form expecting e-mail address
and after submission all accounts - passwords with the same
e-mail will be sent to spec. account's e-mail

You should do it in this way:
form ... action="#%ACC_CGI#%" ...
input type="text"... name="fieldEMAIL" ...
input type="hidden" ... name="emailAccs" ...
input type="submit" ....
... /form
    enditem        
    
endtopic

#%EOF%#
#%File: ./data/infos.dat%#
package infos;

require "./data/config.dat";
require "./data/var.dat";


$error_correct{SK}= "Stlacte BACK a pokuste sa zadat korektrne udaje";
$error_correct{EN}= "Press BACK and try to set correct data";
$error_correct{GER}= "...............";

# ------------ info_message texts .........

# ------ vymenit {LANGUAGE} s adlsou polozkout

$info{SK}{'FILE_LOCKED'}{'TITLE'} = "Subor zamknuty !";
$info{SK}{'FILE_LOCKED'}{'BODY'} = "Prosim, cakajte ...";

$info{EN}{'FILE_LOCKED'}{'TITLE'} = "File is LOCKED !";
$info{EN}{'FILE_LOCKED'}{'BODY'} = "Please, wait ...";

$info{GER}{'FILE_LOCKED'}{'TITLE'} = "GER..........";
$info{GER}{'FILE_LOCKED'}{'BODY'} = "Bitte, warten ...";

# ---------------- acc added successfully
#  #%1 -> this will be parsed to 1. param later in procedure


$info{'ACC_ADD'}{'SK'}{'TITLE'} = "Pridanie accountu";
$info{'ACC_ADD'}{'SK'}{'BODY'} = "Account bol uspesne pridany";

$info{'ACC_ADD'}{'EN'}{'TITLE'} = "Account Added";
$info{'ACC_ADD'}{'EN'}{'BODY'} = "Account \"#%1\" was successfully added";
$info{'ACC_ADD'}{'EN'}{'BODY'} .= "<BR> Use ";
$info{'ACC_ADD'}{'EN'}{'BODY'} .= ($var::usePHP)?"$config::phpInUrl?acc=#%1":"$config::in_cgi?acc=#%1";

$info{'ACC_ADD'}{'GER'}{'TITLE'} = "GER..........";
$info{'ACC_ADD'}{'GER'}{'BODY'} = "Bitte, warten ...";


# ---------------- acc modif successfully

$info{'ACC_MOD'}{'SK'}{'TITLE'} = "Uprava accountu";
$info{'ACC_MOD'}{'SK'}{'BODY'} = "Account bol uspesne upraveny";

$info{'ACC_MOD'}{'EN'}{'TITLE'} = "Account Modified";
$info{'ACC_MOD'}{'EN'}{'BODY'} = "Account \"#%1\" was successfully modified";

$info{'ACC_MOD'}{'GER'}{'TITLE'} = "GER..........";
$info{'ACC_MOD'}{'GER'}{'BODY'} = "Bitte, warten ...";

# Operations status {
$status{'EN'}{'saveMailOK'} = "Save Mail operation done successfully";
$status{'SK'}{'saveMailOK'} = "Save Mail prebehol OK";
$status{'GER'}{'saveMailOK'} = "GER ...";

$status{'EN'}{'saveMailNOK'} = "Save Mail operation failed";
$status{'SK'}{'saveMailNOK'} = "Save Mail neprebehol";
$status{'GER'}{'saveMailNOK'} = "GER ...";


$status{'EN'}{'backrestOK'} = "Backup/Restore operation done successfully";
$status{'SK'}{'backrestOK'} = "Backup/Restore prebehol OK";
$status{'GER'}{'backrestOK'} = "GER ...";

$status{'EN'}{'backrestNOK'} = "Backup/Restore operation failed";
$status{'SK'}{'backrestNOK'} = "Backup/Restore neprebehol";
$status{'GER'}{'backrestNOK'} = "GER ...";


$status{'EN'}{'saveSETUPOK'} = "Setup was saved successfully";
$status{'SK'}{'saveSETUPOK'} = "Setup Save prebehol OK";
$status{'GER'}{'saveSETUPOK'} = "GER ...";

$status{'EN'}{'saveSETUPNOK'} = "Setup Save failed";
$status{'SK'}{'saveSETUPNOK'} = "Setup Save neprebehol";
$status{'GER'}{'saveSETUPNOK'} = "GER ...";


$status{'EN'}{'saveWORDSOK'} = "Save Words|Urls done successfully";
$status{'SK'}{'saveWORDSOK'} = "Save Words|Urls prebehol OK";
$status{'GER'}{'saveWORDSOK'} = "GER ...";

$status{'EN'}{'saveWORDSNOK'} = "Save Words|Urls failed";
$status{'SK'}{'saveWORDSNOK'} = "Save Words|Urls neprebehol";
$status{'GER'}{'saveWORDSNOK'} = "GER ...";


$status{'EN'}{'resetOK'} = "Reset operation done successfully";
$status{'SK'}{'resetOK'} = "Reset prebehol OK";
$status{'GER'}{'resetOK'} = "GER ...";

$status{'EN'}{'resetNOK'} = "Reset operation failed";
$status{'SK'}{'resetNOK'} = "Reset neprebehol";
$status{'GER'}{'resetNOK'} = "GER ...";


$status{'EN'}{'retOK'} = "Returned from acc view successfully";
$status{'SK'}{'retOK'} = "Returned from acc view prebehol OK";
$status{'GER'}{'retOK'} = "GER ...";

$status{'EN'}{'retNOK'} = "Returned from acc view failed";
$status{'SK'}{'retNOK'} = "Returned from acc view neprebehol";
$status{'GER'}{'retNOK'} = "GER ...";



$status{'EN'}{'rerankOK'} = "Rerank operation done successfully";
$status{'SK'}{'rerankOK'} = "Rerank prbehol OK";
$status{'GER'}{'rerankOK'} = "GEN ...";

$status{'EN'}{'rerankNOK'} = "Rerank operation failed";
$status{'SK'}{'rerankNOK'} = "Rerank neprebehol";
$status{'GER'}{'rerankNOK'} = "GER .. ";


$status{'EN'}{'setRatioOK'} = "Set Ratio operation done successfully";
$status{'SK'}{'setRatioOK'} = "Set Ration prebehol OK";
$status{'GER'}{'setRatioOK'} = "GER .. ";

$status{'EN'}{'setRatioNOK'} = "Set Ratio operation failed";
$status{'SK'}{'setRatioNOK'} = "Set Ration neprebehol";
$status{'GER'}{'setRatioNOK'} = "GER .. ";


$status{'EN'}{'removeInactiveOK'} = "Remove Inactive operation done successfully";
$status{'SK'}{'removeInactiveOK'} = "Remove Inactive prebehol OK";
$status{'GER'}{'removeInactiveOK'} = "GER .. ";

$status{'EN'}{'removeInactiveNOK'} = "Remove Inactive operation failed";
$status{'SK'}{'removeInactiveNOK'} = "Remove Inactive neprebehol";
$status{'GER'}{'removeInactiveNOK'} = "GER .. ";


$status{'EN'}{'freezeOK'} = "Freeze operation done successfully";
$status{'SK'}{'freezeOK'} = "Freeze prebehol OK";
$status{'GER'}{'freezeOK'} = "GER .. ";

$status{'EN'}{'freezeNOK'} = "Freeze operation failed";
$status{'SK'}{'freezeNOK'} = "Freeze neprebehol";
$status{'GER'}{'freezeNOK'} = "GER .. ";


$status{'EN'}{'suspendOK'} = "Suspend operation done successfully";
$status{'SK'}{'suspendOK'} = "Suspend prebehol OK";
$status{'GER'}{'suspendOK'} = "GER .. ";

$status{'EN'}{'suspendNOK'} = "Suspend operation failed";
$status{'SK'}{'suspendNOK'} = "Suspend neprebehol";
$status{'GER'}{'suspendNOK'} = "GER .. ";


$status{'EN'}{'lockOK'} = "Lock operation done successfully";
$status{'SK'}{'lockOK'} = "Lock prebehol OK";
$status{'GER'}{'lockOK'} = "GER .. ";

$status{'EN'}{'lockNOK'} = "Lock operation failed";
$status{'SK'}{'lockNOK'} = "Lock neprebehol";
$status{'GER'}{'lockNOK'} = "GER .. ";


$status{'EN'}{'saveOK'} = "Save operation done successfully";
$status{'SK'}{'saveOK'} = "Save prebehol OK";
$status{'GER'}{'saveOK'} = "GER .. ";

$status{'EN'}{'saveNOK'} = "Save operation failed";
$status{'SK'}{'saveNOK'} = "Save neprebehol";
$status{'GER'}{'saveNOK'} = "GER .. ";


$status{'EN'}{'deleteOK'} = "Delete operation done successfully";
$status{'SK'}{'deleteOK'} = "Delete prebehol OK";
$status{'GER'}{'deleteOK'} = "GER .. ";

$status{'EN'}{'deleteNOK'} = "Delete operation failed";
$status{'SK'}{'deleteNOK'} = "Delete neprebehol";
$status{'GER'}{'deleteNOK'} = "GER .. ";


$status{'EN'}{'mailOK'} = "Mail operation done successfully";
$status{'SK'}{'mailOK'} = "Mail prebehol OK";
$status{'GER'}{'mailOK'} = "GER .. ";

$status{'EN'}{'mailNOK'} = "Mail operation failed";
$status{'SK'}{'mailNOK'} = "Mail neprebehol";
$status{'GER'}{'mailNOK'} = "GER .. ";


$status{'EN'}{'saveHTMLOK'} = "SaveHTML operation done successfully";
$status{'SK'}{'saveHTMLOK'} = "SaveHTML prebehol OK";
$status{'GER'}{'saveHTMLOK'} = "GER .. ";

$status{'EN'}{'saveHTMLNOK'} = "SaveHTML operation failed";
$status{'SK'}{'saveHTMLNOK'} = "SaveHTML neprebehol";
$status{'GER'}{'saveHTMLNOK'} = "GER .. ";


$status{'EN'}{'saveBreakOK'} = "SaveBreak operation done successfully";
$status{'SK'}{'saveBreakOK'} = "SaveBreak prebehol OK";
$status{'GER'}{'saveBreakOK'} = "GER .. ";

$status{'EN'}{'saveBreakNOK'} = "SaveBreak operation failed";
$status{'SK'}{'saveBreakNOK'} = "SaveBreak neprebehol";
$status{'GER'}{'saveBreakNOK'} = "GER .. ";



$status{'EN'}{'mailSendOK'} = "MailSend operation done successfully";
$status{'SK'}{'mailSendOK'} = "MailSend prebehol OK";
$status{'GER'}{'mailSendOK'} = "GER .. ";

$status{'EN'}{'mailSendNOK'} = "MailSend operation failed";
$status{'SK'}{'mailSendNOK'} = "MailSend neprebehol";
$status{'GER'}{'mailSendNOK'} = "GER .. ";

$status{'EN'}{'accDNExist'} = "Specified account doesn't exist";
$status{'SK'}{'accDNExist'} = "Dane uzivatel neexistuje";
$status{'GER'}{'accDNExist'} = "GER .. ";


# }
#%EOF%#
#%File: ./data/menu.dat%#
package menu;

require "./data/config.dat";



$menu_header = "#%MENU_HEADER%#";
$menu_header_end = "#%MENU_HEADER_END%#";
$menu_footer = "#%MENU_FOOTER%#";
$menu_footer_end = "#%MENU_FOOTER_END%#";

# ------------------------
# SECTION: Webmaster setup
# ------------------------

# globals
$m_temp = "temp";
$m_temp_name = "tmp_name";
$m_temp_name_f = "tmp_filen_n";
$m_name = "name";
$m_wm = "WM";
$menu_end = "#%MENU_END%#";
$temp_end = "#%TEMP_END%#";
$m_temp_param = "param";
$itmes = "it";

#      ---------------
#      ITEM: Main menu
#      ---------------

$m_main = "main";

$m_button_name1 = "Toplist Setup";
$m_button_name2 = "Account Setup";
$m_button_name3 = "Mail List";


$m_action1 = "tl_setup";
$m_action2 = "acc_setup";
$m_action3 = "mail_list";


$m_cgi_name_path = "$config::cgi_root/temps/_setup_config.htmlx";
$m_cgi_name_path_x = "$config::virtual_cgi_path/setup.cgi";

$m_button = "#%WM_BUTTON_PARAM%#";
$m_action = "#%WM_CGI_PARAM%#";
$m_cgi_name = "#%WM_SETUP_CGI%#";

$menu{$m_wm}{$m_main}{$m_temp}{$m_temp_name} = "#%MAIN_MENU_ITEM_TEMPLATE%#";
$menu{$m_wm}{$m_main}{$m_temp}{$m_temp_name_f} = $m_cgi_name_path;

$menu{$m_wm}{$m_main}{$m_temp}{$m_temp_param}[0] = 3;
$menu{$m_wm}{$m_main}{$m_temp}{$m_temp_param}[1] = $m_button;
$menu{$m_wm}{$m_main}{$m_temp}{$m_temp_param}[2] = $m_action;
$menu{$m_wm}{$m_main}{$m_temp}{$m_temp_param}[3]=  $m_cgi_name;
$menu{$m_wm}{$m_main}{$m_name} = "#%MAIN_MENU%#";
# --------------- template repetition

$menu{$m_wm}{$m_main}{$m_temp}{$items}[0] = 3;
$menu{$m_wm}{$m_main}{$m_temp}{$items}[1]{$m_button} = $m_button_name1;
$menu{$m_wm}{$m_main}{$m_temp}{$items}[2]{$m_button} = $m_button_name2;
$menu{$m_wm}{$m_main}{$m_temp}{$items}[3]{$m_button} = $m_button_name3;

$menu{$m_wm}{$m_main}{$m_temp}{$items}[1]{$m_action} = $m_action1;
$menu{$m_wm}{$m_main}{$m_temp}{$items}[2]{$m_action} = $m_action2;
$menu{$m_wm}{$m_main}{$m_temp}{$items}[3]{$m_action} = $m_action3;

$menu{$m_wm}{$m_main}{$m_temp}{$items}[1]{$m_cgi_name} = $m_cgi_name_path_x;
$menu{$m_wm}{$m_main}{$m_temp}{$items}[2]{$m_cgi_name} = $m_cgi_name_path_x;
$menu{$m_wm}{$m_main}{$m_temp}{$items}[3]{$m_cgi_name} = $m_cgi_name_path_x;




#      ------------------------
#      ITEM: Account Setup menu
#      ------------------------

$m_acc_setup = "acc_set";

$m_button_name1 = "Add Account";
$m_button_name2 = "Delete Account";
$m_button_name3 = "List Account";
$m_button_name4 = "Freeze Account";


$m_action1 = "acc_setup_add";
$m_action2 = "acc_setup_del";
$m_action3 = "acc_setup_list";
$m_action4 = "acc_setup_freeze";


$m_cgi_name_path_n = "$config::cgi_root/temps/_setup_config.htmlx";
$m_cgi_name_path_x_n = "$config::virtual_cgi_path/setup.cgi";

$m_button = "#%WM_BUTTON_PARAM%#";
$m_action = "#%WM_CGI_PARAM%#";
$m_cgi_name = "#%WM_SETUP_CGI%#";

$menu{$m_wm}{$m_acc_setup}{$m_temp}{$m_temp_name} = "#%ACCOUNT_MENU_ITEM_TEMPLATE%#";
$menu{$m_wm}{$m_acc_setup}{$m_temp}{$m_temp_name_f} = $m_cgi_name_path_n;

$menu{$m_wm}{$m_acc_setup}{$m_temp}{$m_temp_param}[0] = 3;
$menu{$m_wm}{$m_acc_setup}{$m_temp}{$m_temp_param}[1] = $m_button;
$menu{$m_wm}{$m_acc_setup}{$m_temp}{$m_temp_param}[2] = $m_action;
$menu{$m_wm}{$m_acc_setup}{$m_temp}{$m_temp_param}[3]=  $m_cgi_name;
$menu{$m_wm}{$m_acc_setup}{$m_name} = "#%ACCOUNT_MENU%#";
# --------------- template repetition

$menu{$m_wm}{$m_acc_setup}{$m_temp}{$items}[0] = 4;
$menu{$m_wm}{$m_acc_setup}{$m_temp}{$items}[1]{$m_button} = $m_button_name1;
$menu{$m_wm}{$m_acc_setup}{$m_temp}{$items}[2]{$m_button} = $m_button_name2;
$menu{$m_wm}{$m_acc_setup}{$m_temp}{$items}[3]{$m_button} = $m_button_name3;
$menu{$m_wm}{$m_acc_setup}{$m_temp}{$items}[4]{$m_button} = $m_button_name4;

$menu{$m_wm}{$m_acc_setup}{$m_temp}{$items}[1]{$m_action} = $m_action1;
$menu{$m_wm}{$m_acc_setup}{$m_temp}{$items}[2]{$m_action} = $m_action2;
$menu{$m_wm}{$m_acc_setup}{$m_temp}{$items}[3]{$m_action} = $m_action3;
$menu{$m_wm}{$m_acc_setup}{$m_temp}{$items}[4]{$m_action} = $m_action4;

$menu{$m_wm}{$m_acc_setup}{$m_temp}{$items}[1]{$m_cgi_name} = $m_cgi_name_path_x;
$menu{$m_wm}{$m_acc_setup}{$m_temp}{$items}[2]{$m_cgi_name} = $m_cgi_name_path_x;
$menu{$m_wm}{$m_acc_setup}{$m_temp}{$items}[3]{$m_cgi_name} = $m_cgi_name_path_x;
$menu{$m_wm}{$m_acc_setup}{$m_temp}{$items}[4]{$m_cgi_name} = $m_cgi_name_path_x;



#      -------------------
#      ITEM: Toplist Setup
#      -------------------

$m_tl_setup = "tl_set";

$m_button_name1 = "Account Params Setup";
$m_button_name2 = "Reset & Rerank Timing";
$m_button_name3 = "Statistic Setup";


$m_action1 = "tl_setup_acc_params";
$m_action2 = "tl_setup_rerank_reset";
$m_action3 = "tl_setup_statistic";


$m_cgi_name_path_n = "$config::cgi_root/temps/_setup_config.htmlx";
$m_cgi_name_path_x_n = "$config::virtual_cgi_path/setup.cgi";

$m_button = "#%WM_BUTTON_PARAM%#";
$m_action = "#%WM_CGI_PARAM%#";
$m_cgi_name = "#%WM_SETUP_CGI%#";

$menu{$m_wm}{$m_tl_setup}{$m_temp}{$m_temp_name} = "#%TL_SETUP_MENU_ITEM_TEMPLATE%#";
$menu{$m_wm}{$m_tl_setup}{$m_temp}{$m_temp_name_f} = $m_cgi_name_path_n;

$menu{$m_wm}{$m_tl_setup}{$m_temp}{$m_temp_param}[0] = 3;
$menu{$m_wm}{$m_tl_setup}{$m_temp}{$m_temp_param}[1] = $m_button;
$menu{$m_wm}{$m_tl_setup}{$m_temp}{$m_temp_param}[2] = $m_action;
$menu{$m_wm}{$m_tl_setup}{$m_temp}{$m_temp_param}[3]=  $m_cgi_name;
$menu{$m_wm}{$m_tl_setup}{$m_name} = "#%TL_SETUP_MENU%#";
# --------------- template repetition

$menu{$m_wm}{$m_tl_setup}{$m_temp}{$items}[0] = 3;
$menu{$m_wm}{$m_tl_setup}{$m_temp}{$items}[1]{$m_button} = $m_button_name1;
$menu{$m_wm}{$m_tl_setup}{$m_temp}{$items}[2]{$m_button} = $m_button_name2;
$menu{$m_wm}{$m_tl_setup}{$m_temp}{$items}[3]{$m_button} = $m_button_name3;


$menu{$m_wm}{$m_tl_setup}{$m_temp}{$items}[1]{$m_action} = $m_action1;
$menu{$m_wm}{$m_tl_setup}{$m_temp}{$items}[2]{$m_action} = $m_action2;
$menu{$m_wm}{$m_tl_setup}{$m_temp}{$items}[3]{$m_action} = $m_action3;


$menu{$m_wm}{$m_tl_setup}{$m_temp}{$items}[1]{$m_cgi_name} = $m_cgi_name_path_x;
$menu{$m_wm}{$m_tl_setup}{$m_temp}{$items}[2]{$m_cgi_name} = $m_cgi_name_path_x;
$menu{$m_wm}{$m_tl_setup}{$m_temp}{$items}[3]{$m_cgi_name} = $m_cgi_name_path_x;


#%EOF%#
#%File: ./data/parse.dat%#
package parse;

require "./data/var.dat";

$html_header_end = "#%HTML_HEADER_END%#";
$html_header = "#%HTML_HEADER%#";

$html_footer_end = "#%HTML_FOOTER_END%#";
$html_footer = "#%HTML_FOOTER%#";

$html_submit{3} = "Save";
$html_hidden{3} = "tl_set_save";


$html_setup_cgi  = "#%SETUP_CGI%#";


$max = "max";
$min = "min";
$word = "word";
$check = "check";
$value = "value";
$syntax = "syntax";


# ---------------------- parsed variables from account adding setup

$tl_setup{$var::acc}{$max}{$check} = "chfieldAccMax";
$tl_setup{$var::acc}{$max}{$value} = "tfieldAccMax";
$tl_setup{$var::acc}{$min}{$check} = "chfieldAccMin";
$tl_setup{$var::acc}{$min}{$value} = "tfieldAccMin";
$tl_setup{$var::acc}{$word}{$check} = "chfieldAccWord";

$tl_setup{$var::pwd}{$max}{$check} = "chfieldPWDMax";
$tl_setup{$var::pwd}{$max}{$value} = "tfieldPWDMax";
$tl_setup{$var::pwd}{$min}{$check} = "chfieldPWDMin";
$tl_setup{$var::pwd}{$min}{$value} = "tfieldPWDMin";
$tl_setup{$var::pwd}{$word}{$check} = "chfieldPWDWord";

$tl_setup{$var::title}{$max}{$check} = "chfieldTitleMax";
$tl_setup{$var::title}{$max}{$value} = "tfieldTitleMax";
$tl_setup{$var::title}{$min}{$check} = "chfieldTitleMin";
$tl_setup{$var::title}{$min}{$value} = "tfieldTitleMin";
$tl_setup{$var::title}{$word}{$check} = "chfieldTitleWord";

$tl_setup{$var::descr}{$max}{$check} = "chfieldDescrMax";
$tl_setup{$var::descr}{$max}{$value} = "tfieldDescrMax";
$tl_setup{$var::descr}{$min}{$check} = "chfieldDescrMin";
$tl_setup{$var::descr}{$min}{$value} = "tfieldDescrMin";
$tl_setup{$var::descr}{$word}{$check} = "chfieldDescrWord";


$tl_setup{$var::weblink}{$max}{$check} = "chfieldWeblinkMax";
$tl_setup{$var::weblink}{$max}{$value} = "tfieldWeblinkMax";
$tl_setup{$var::weblink}{$min}{$check} = "chfieldWeblinkMin";
$tl_setup{$var::weblink}{$min}{$value} = "tfieldWeblinkMin";
$tl_setup{$var::weblink}{$word}{$check} = "chfieldWeblinkWord";


$tl_setup{$var::banner}{$max}{$check} = "chfieldBannerMax";
$tl_setup{$var::banner}{$max}{$value} = "tfieldBannerMax";
$tl_setup{$var::banner}{$min}{$check} = "chfieldBannerMin";
$tl_setup{$var::banner}{$min}{$value} = "tfieldBannerMin";
$tl_setup{$var::banner}{$word}{$check} = "chfieldBannerWord";

$tl_setup{$var::mail}{$max}{$check} = "chfieldMailMax";
$tl_setup{$var::mail}{$max}{$value} = "tfieldMailMax";
$tl_setup{$var::mail}{$min}{$check} = "chfieldMailMin";
$tl_setup{$var::mail}{$min}{$value} = "tfieldMailMin";
$tl_setup{$var::mail}{$word}{$check} = "chfieldMailWord";
$tl_setup{$var::mail}{$syntax}{$check} = "chfieldMailSyntax";

#%EOF%#
#%File: ./data/var.dat%#
package var;

require "./data/config.dat";

#%AREAUSER_BEGIN%#


$useAccViewAlarm = 1;

# fields in add acc for admin {
$newAccBoxes = 5;
#}

$cookieVarName = "tBOSS_PWD_X1";

# use NICE {
$useNice = 0;
# }

$rmtDelAcc= "$config::tlurl/admin/rmtctrl.cgi\?action=rmacc\&acc=%#ACC#%";

$selectiveFS = 1;
$fontSizes = "1-10=+2,11-25=+1";

$newDuration = 48;
$longDuration = 30;

$newLimit = 100;
$longLimit = 100;
$directionLimit = 100;

$newEnabled = 1;
$upEnabled = 1;
$downEnabled = 1;
$stquoEnabled = 1;
$longEnabled = 1;

# sel {
$selectedSkin = "blue";
# }

# sel {
$selectedCustom = "reset";
# }

# toplist id {
$topListID= "ada xxx 121";
# }

# cookies {
$cookiesUse= 0;
$cookiesExp= 120;
#}


# .htaccess {
$htAccessUse= 0;
#}

# banners {
$bannerLimit= 10;
#}

# banners {
$sampleLimit= 10;
#}


# banner + sample max {
$maxBannerWidth = 468;
$maxBannerHeight = 60;
$maxSampleWidth = 100;
$maxSampleHeight = 100;
#}

# Anti-HITBOT {
# set  to 1 to enable AHB
# set  to 0 to disable AHB
$antiHitBOTUse= 1;
#}



# traffic forwarder {
$fwdDefaultURL= "http://";
# to switch off forwarder set $fwdType to 0
# 0 - don't fwd
# 1 - defURL
# 2 - random
# 3 - second
$fwdType= 0;
$fwdFrom= 1;
$fwdTo= 10;
$fwdPref= 5;
# }

#%AREAUSER_END%#

# --------- genList - when empty list is going to be made

#%AREASYSTEM_BEGIN%#

$bottomText = "Powered By $config::name &copy;";
$emergencyPWD = "1111";

# cca. two weeks
# in hours
$optimizeDelay = 336;

@filesToBeOptimized =(
	"$config::account_database",
	"$config::stat_database",
	"$config::statTotalSumYear",
	"$config::statTotalSumMonth",
	"$config::statTotalSumHour",
	"$config::lostAccs"
);



# custom item {
%custItems = (
	    "10(Add Accounts)"=> "$config::tlurl/admin.cgi?action=_%23EXECUTE%23_&radiobutton=accadd",
	    "20(New Accounts)"=>"$config::tlurl/admin.cgi?action=_%25DISPLAY%25_&chooseby=new&selby=in&perpage=10",
	    "30(Modified Accounts)"=>"$config::tlurl/admin.cgi?action=_%25DISPLAY%25_&chooseby=modif&selby=in&perpage=10",
	    "40(Active Accounts)"=>"$config::tlurl/admin.cgi?action=_%25DISPLAY%25_&chooseby=active&selby=in&perpage=10",
	    "50(Inactive Accounts)" => "$config::tlurl/admin.cgi?action=_%25DISPLAY%25_&chooseby=inactive&selby=in&perpage=10",
	    "60(All Accounts)" => "$config::tlurl/admin.cgi?action=_%25DISPLAY%25_&chooseby=all&selby=in&perpage=10",
	    "70(Log IN->OUT)"=>"$config::tlurl/genlog.cgi?SHOW=1&SHOW_ID=1&SHOW_COUNTER=2&SHOW_DT=3&SHOW_IPFROM=4&SHOW_IPREF=5&SHOW_COOKIE=6&SHOW_ACCIN=7&SHOW_ACCOUT=8&SHOW_RANK=8&SORT=1",
	    "80(Log IN)"=>"$config::tlurl/genlog.cgi?SHOW=2&SHOW_ID=1&SHOW_DT=3&SHOW_IPFROM=4&SHOW_IPREF=5&SHOW_COOKIE=6&SHOW_ACCIN=7&SORT=1",
	    "90(Log OUT)"=>"$config::tlurl/genlog.cgi?SHOW=3&SHOW_ID=1&SHOW_DT=3&SHOW_ACCIN=7&SHOW_ACCOUT=8&SHOW_RANK=8&SORT=1",
	    "100(Log Counter)"=>"$config::tlurl/genlog.cgi?SHOW=4&SHOW_ID=1&SHOW_ACCIN=7&SORT=1",
	    "110(Backup All)" => "$config::tlurl/admin.cgi?action=_%23BACKUP%23_&SHOW_BACKLOG=1&SHOW_BACKDATA=2&SHOW_BACKTEMPL=3",
	    "120(Out Stat)" => "$config::tlurl/admin.cgi?display2=Statistic&action=_%23STATISTIC%23_&CH_OUT=6&G_RIN=1&G_NBPIN=4&G_GOUT=6",
	    "130(Uptime Stat)"=>"$config::tlurl/admin.cgi?display2=Statistic&action=_%23STATISTIC%23_&CH_UPTIME=5&G_RIN=1&G_NBPIN=4&G_GOUT=6",
	    "140(Hour's INs)" => "$config::tlurl/admin.cgi?display2=Statistic&action=_%23STATISTIC%23_&CH_HOUR=1&G_RIN=1&G_NBRIN=2&G_PIN=3&G_NBPIN=4",
	    "150(Rerank)"=>"$config::tlurl/admin.cgi?action=_%23EXECUTE%23_&radiobutton=rerank",
	    "160(Reset)"=>"$config::tlurl/admin.cgi?action=_%23EXECUTE%23_&radiobutton=reset"
	    
);

# }



# log in log out {
$logIN{'X'} = 0;
$logIN{'ID'} = 1;
$logIN{'ACC_FROM'} = 2;
$logIN{'TIME'} = 3;
$logIN{'FROM'} = 5;

$logOUT{'ID'} = 0;
$logOUT{'ACC_FROM'} = 2;
$logOUT{'ACC_TO'} = 1;
$logOUT{'TIME'} = 3;


#}






$inPerPartes = 10000;

# labels in acc view
%accSelected= (1,"Active",2,"Inactive",3,"All");
%accSortedBy= (10,"In Hits",11,"Out Hits",20,"Total In Hits",21,"Total Out Hits",30,"Day In Hits",31,"Day Out Hits",40,"Week In Hits",41,"Day Out Hits",50,"Month In Hits",51,"Month Out Hits",6,"Join Date",7,"User Name",8,"Inactivity",8,"Mail");

$adminAccViewD{'T'}="_#ACC_SELBY#_";
$adminAccViewD{'I'}= "_#ACC_CHOOSEBY#_";


# cron
$cronTabEndID= "##------>TrafficPro_Section_End____$topListID<--------##";
$cronTabBeginID= "##------>TrafficPro_Section_Begin__$topListID<--------##";

#%AREASYSTEM_END%#

#%AREAUSER_BEGIN%#

# php {
$usePHP= 1;
# }


$autoSuspendModifAcc = 0;
$autoSuspendNewAcc = 0;
$inForNewAcc = 0;
$outForNewAcc = 0;

# mail {
$mailAfterEdit= 1;
$mailAfterRegAcc= 1;
$mailAfterReg= 1;
$mailAfterDelete= 1;
$mailAfterInactivity= 0;
$inactivityEdgeValue= 1;

# }

# cron ...{
$parallelRunResRer= 0;

# }

# store data for last top
$gen_useLast= 1;

# how many accs to store
$gen_storedforLast= 10;

# if not random, first x best from list before
$gen_useRandom= 1;

#how many random or best used if empty list is going to be ...
$gen_startMinInList= 2;


# defaults {
$defaultHitRatio= "1:1";
# }

#%AREAUSER_END%#


#%AREASYSTEM_BEGIN%#
$adminPWD= "fieldPWD";


@backup= ("$config::cgi_root/data","$config::cgi_root/temps","$config::cgi_root/logs");
$backup{$backup[0]}= "backup_data.dat";
$backup{$backup[1]}= "backup_temps.dat";
$backup{$backup[2]}= "backup_log.dat";

@packExclude = ("$config::cgi_root/install.cgi","$config::cgi_root/install.dat","$config::cgi_root/install.log","$config::cgi_root/backup/install.dat");

# --------- loging ...
$log= 1;
$log_limit= 100000;
#%AREASYSTEM_END%#

#%AREAUSER_BEGIN%#
#--------- variable package ....
$useCron= 0;
# sets in seconds
$resetPeriod= 86400;
# sets in seconds
$rerankPeriod= 60;


# set in secs
$resetPeriodCron= "86400";

$rerankPeriodCron= "3600";

$email= "YOUR\@EMAIL.COM";

#%AREAUSER_END%#

#%AREASYSTEM_BEGIN%#
$toplistparams= "%params%";

# -----------mail

$accAddSubj="You was successfully added!\n";
$accAddBody1="The review of added fields!\n";
$accAddBody2="Thankx!\n";

$accNotifSubj="New account added!\n";
$accNotifBody="The review of new added fields!\n";

# Body for List Generator {

$htmlAdminEditMailInactHelp= "#%INACT_HELP%#";
$genMailInact{'rank'}{'val'}= "#%COUNT%#";
$genMailInact{'rank'}{'def'}= "Inactive for X resets";



$htmlAdminEditMailDeleteHelp= "#%DELETE_HELP%#";
$genMailDelete{'rank'}{'val'}= "#%ACC_NAME%#";
$genMailDelete{'rank'}{'def'}= "Account name";



$genFooter{'links'}{'val'}= "#%ENTER_LINKS%#";
$genFooter{'links'}{'def'}= "Links to next list";

$genFooter{'title'}{'val'}= "#%ENTER_RANDOM_TITLE%#";
$genFooter{'title'}{'def'}= "Title of random account";

$genFooter{'banner'}{'val'}= "#%ENTER_RANDOM_BANNER%#";
$genFooter{'banner'}{'def'}= "URL address to random acc's Banner";

$genFooter{'bannerw'}{'val'}= "#%ENTER_RANDOM_BWIDTH%#";
$genFooter{'bannerw'}{'def'}= "Width of random acc's Banner";

$genFooter{'bannerh'}{'val'}= "#%ENTER_RANDOM_BHEIGHT%#";
$genFooter{'bannerh'}{'def'}= "Height of random acc's Banner";

$genFooter{'link'}{'val'}= "#%ENTER_RANDOM_LINK%#";
$genFooter{'link'}{'def'}= "URL to random acc's in";

$genHeader{'links'}{'val'}= "#%ENTER_LINKS%#";
$genHeader{'links'}{'def'}= "Links to next list";

$genHeader{'title'}{'val'}= "#%ENTER_RANDOM_TITLE%#";
$genHeader{'title'}{'def'}= "Title of random account";


$genHeader{'banner'}{'val'}= "#%ENTER_RANDOM_BANNER%#";
$genHeader{'banner'}{'def'}= "URL address to random acc's Banner";

$genHeader{'bannerw'}{'val'}= "#%ENTER_RANDOM_BWIDTH%#";
$genHeader{'bannerw'}{'def'}= "Width of random acc's Banner";

$genHeader{'bannerh'}{'val'}= "#%ENTER_RANDOM_BHEIGHT%#";
$genHeader{'bannerh'}{'def'}= "Height of random acc's Banner";

$genHeader{'link'}{'val'}= "#%ENTER_RANDOM_LINK%#";
$genHeader{'link'}{'def'}= "URL to random acc's in";


$genBody{'rank'}{'val'}= "#%ENTER_DATA_RANK%#";
$genBody{'rank'}{'def'}= "Rank";

$genBody{'title'}{'val'}= "#%ENTER_DATA_TITLE%#";
$genBody{'title'}{'def'}= "Title";

$genBody{'link'}{'val'}= "#%ENTER_DATA_LINK%#";
$genBody{'link'}{'def'}= "Link";

$genBody{'descr'}{'val'}= "#%ENTER_DATA_DESCR%#";
$genBody{'descr'}{'def'}= "Description";

$genBody{'in'}{'val'}= "#%ENTER_DATA_IN%#";
$genBody{'in'}{'def'}= "In Hits";

$genBody{'out'}{'val'}= "#%ENTER_DATA_OUT%#";
$genBody{'out'}{'def'}= "Out Hits";

$genBody{'sample'}{'val'}= "#%ENTER_DATA_SAMPLE%#";
$genBody{'sample'}{'def'}= "Sample Picture link";

$genBody{'wsample'}{'val'}= "#%ENTER_DATA_SWIDTH%#";
$genBody{'wsample'}{'def'}= "Sample Picture Width";

$genBody{'hsample'}{'val'}= "#%ENTER_DATA_SHEIGHT%#";
$genBody{'hsample'}{'def'}= "Sample Picture Height";

$genBody{'banner'}{'val'}= "#%ENTER_DATA_BANNER%#";
$genBody{'banner'}{'def'}= "Banner link";

$genBody{'wbanner'}{'val'}= "#%ENTER_DATA_BWIDTH%#";
$genBody{'wbanner'}{'def'}= "Banner Width";

$genBody{'hbanner'}{'val'}= "#%ENTER_DATA_BHEIGHT%#";
$genBody{'hbanner'}{'def'}= "Banner Height";

$genBody{'timeicon'}{'val'}= "#%ENTER_DATA_TIME_ICON%#";
$genBody{'timeicon'}{'def'}= "Time Icon";

$genBody{'diricon'}{'val'}= "#%ENTER_DATA_DIR_ICON%#";
$genBody{'diricon'}{'def'}= "Direction Icon";

$genBody{'fontb'}{'val'}= "#%ENTER_FONT_BEGIN%#";
$genBody{'fontb'}{'def'}= "Font Begin";

$genBody{'fonte'}{'val'}= "#%ENTER_FONT_END%#";
$genBody{'fonte'}{'def'}= "Font End";


$genAddForm{'add'}{'val'}= "#%ENTER_ADD_ADD%#";
$genAddForm{'add'}{'def'}= "URL to account add form";

$genAddForm{'modif'}{'val'}= "#%ENTER_ADD_MODIF%#";
$genAddForm{'modif'}{'def'}= "URL to account modify form";

$genAddForm{'email_pwd'}{'val'}= "Must be in form: #%ACC_CGI%#?action=\"pwdForgot\"\&fieldACC=\"accout name\"";
$genAddForm{'email_pwd'}{'def'}= "URL to send password to account's email he has forgotten.";

$genAddForm{'email_all'}{'val'}= "Must be in form: #%ACC_CGI%#?action=\"emailAccs\"\&fieldEMAIL=\"e-mail\"";
$genAddForm{'email_all'}{'def'}= "URL to send all accounts with the same email to email specified.";

# }

# Statsu of ACC{
# this is BITMASK,  so if val is 3 
$accModified = 2;
$accNew = 1;
#}


# time in sec. to delay while waiting for file onlock
$delay= 20;


$measure{'rerankTime'}=0;
$measure{'inItems'}=1;
$measure{'outItems'}=2;
# when adding account, just call 
# ..../cgi-bin/admin?action=addac&name=...&passwd=...&web=...
$add_account= "addac";
$list_account= "listacc";
$name= "name";
# ----------- vars for adding or identifing account
$rank="rank";
$acc="acc";
$id="id";
$weblink="weblink";
$web2link="web2link";
$webtitle="webtitle";
$title="title";
$banner="banner";
$mail= "mail";
$descr= "descr";
$sample= "sample";
$samplew= "wsample";
$sampleh= "hsample";
$bannerw="wbanner";
$bannerh="hbanner";
$pwd = "pwd";
$rpwd = "rpwd";
$freeze = "freeze";
$suspend = "suspend";
$lock = "lock";
$new="new";
$modif="modif";
$activity = "activity";
$ratio = "ratio";
$info = "info";
$lastRank = "lastrank";

@valuesInAddForm = (
    $acc,$pwd,$weblink,$title,$banner,$sample,$bannerh,$bannerw,$samplew,$sampleh,$descr,$mail
);

$fName{$acc} = "Account Name";
$fName{$pwd} = "Password";
$fName{$mail} = "E-Mail";
$fName{$weblink} = "Input Primary Link";
$fName{$web2link} = "Input Secondary Link";
$fName{$title} = "Title";
$fName{$descr} = "Description";
$fName{$banner} = "Banner Link";
$fName{$sample} = "Sample Link";
$fName{$sampleh} = "Sample Height";
$fName{$samplew} = "Sample Width";
$fName{$bannerw}= "Banner Width";
$fName{$bannerh}= "Banner Height";

#------- statistic
$stat{'day_in'}= 0;
$stat{'day_out'}= 1;
$stat{'week_in'}= 2;
$stat{'week_out'}= 3;
$stat{'month_in'}= 4;
$stat{'month_out'}= 5;
$stat{'total_in'}= 6;
$stat{'total_out'}= 7;
$stat{'t_in'}= 6;
$stat{'t_out'}= 7;

$stat{'last_reset_in'}= 8;
$stat{'last_reset_out'}= 9;
$stat{'last_rerank_rin'}= 10;
$stat{'last_rerank_rout'} = 11;
$stat{'last_rerank_pin'} = 12;

$stat{'t_rin'}= 13;
$stat{'t_rout'}= 7;
$stat{'t_pin'}= 6;
$stat{'nobotfilter_in'}= 14;
$stat{'gen_out'}= 15;


$stat{'from_reset_out'}= 16;
$stat{'from_reset_in'}= 17;
$stat{'from_reset_pin'}= 18;
$stat{'from_reset_cin'}= 19;

# admin statistic {
$statAdmin{'lastLoginDate'} = 0;
$statAdmin{'lastRerankUptime'} = 1;
$statAdmin{'lastRerankDuration'} = 2;
$statAdmin{'lastResetDate'} = 3;
$statAdmin{'lastRerankDate'} = 4;
$statAdmin{'inactAccs'} =5; 
$statAdmin{'totalAccs'} = 6;
$statAdmin{'nowDate'} = 7;
$statAdmin{'newver'} = 8;
$statAdmin{'newAccs'} = 9;
$statAdmin{'oldAccs'} = 10;
# }



# total statistic {
$statTotal{'out'} = 0;
$statTotal{'gout'} = 5;
$statTotal{'rin'} = 1;
$statTotal{'pin'} = 2;
$statTotal{'cin'} = 3;
$statTotal{'cpin'} = 4;
# }




$day_sec= 60*60*24;
$week_sec= $day_sec * 7;
$month_sec= $day_sec * 30;

#%AREASYSTEM_END%#
#%AREAUSER_BEGIN%#
#------- toplist generat
# upper limit
$listLimit= 100;
$listLowerLimit = 10;
$max_pos_per_page= 8;
$max_pages= 10;
#%AREAUSER_END%#
#%AREASYSTEM_BEGIN%#

$in="in";
$out= "out";

$page_name= "page_name";

$top_list_parameter= "#%params%#";

$checkMin= "chMin";
$checkNMax = "chNMax";
$checkMax= "chMax";
$checkWord= "chWord";
$checkUrl= "chUrl";
$removeHTTP= "remHTTP";
$checkSyntax= "chSynt";
$checkNum= "chNum";


#%AREASYSTEM_END%#
#%AREAUSER_BEGIN%#
# Check only min
$formCheck{$acc}{$checkMin}= 1;
$formCheck{$acc}{$checkMax}= 0;
$formCheck{$acc}{$checkWord}= 0;

$formCheck{$pwd}{$checkMin}= 1;
$formCheck{$pwd}{$checkMax}= 0;
$formCheck{$pwd}{$checkWord}= 0;

$formCheck{$title}{$checkMin}= 0;
$formCheck{$title}{$checkMax}= 1;
$formCheck{$title}{$checkWord}= 1;

$formCheck{$banner}{$checkMin}= 0;
$formCheck{$banner}{$checkMax}= 0;
$formCheck{$banner}{$checkUrl}= 0;
$formCheck{$banner}{$checkSyntax}= 1;
$formCheck{$banner}{$removeHTTP}= 0;

$formCheck{$bannerh}{$checkMin}= 0;
$formCheck{$bannerh}{$checkNMax}= 1;

$formCheck{$bannerw}{$checkMin}= 0;
$formCheck{$bannerw}{$checkNMax}= 1;

$formCheck{$sampleh}{$checkMin}= 0;
$formCheck{$sampleh}{$checkNMax}= 1;

$formCheck{$samplew}{$checkMin}= 0;
$formCheck{$samplew}{$checkNMax}= 1;


$formCheck{$sample}{$checkMin}= 0;
$formCheck{$sample}{$checkMax}= 0;
$formCheck{$sample}{$checkUrl}= 0;
$formCheck{$sample}{$removeHTTP}= 0;
$formCheck{$sample}{$checkSyntax}= 1;

$formCheck{$bannerh}{$checkNum}= 1;
$formCheck{$samplew}{$checkNum}= 1;
$formCheck{$sampleh}{$checkNum}= 1;
$formCheck{$bannerw}{$checkNum}= 1;


$formCheck{$weblink}{$checkMin}= 0;
$formCheck{$weblink}{$checkMax}= 0;
$formCheck{$weblink}{$checkUrl}= 1;
$formCheck{$weblink}{$removeHTTP}= 0;
$formCheck{$weblink}{$checkSyntax}= 1;

$formCheck{$web2link}{$checkMin}= 0;
$formCheck{$web2link}{$checkMax}= 0;
$formCheck{$web2link}{$checkUrl}= 1;
$formCheck{$web2link}{$removeHTTP}= 0;
$formCheck{$web2link}{$checkSyntax}= 1;




$formCheck{$descr}{$checkMin}= 0;
$formCheck{$descr}{$checkMax}= 1;
$formCheck{$descr}{$checkWord}= 1;


$formCheck{$mail}{$checkMin}= 0;
$formCheck{$mail}{$checkMax}= 0;
$formCheck{$mail}{$checkWord}= 1;
$formCheck{$mail}{$checkSyntax}= 1;
#%AREAUSER_END%#

#%AREASYSTEM_BEGIN%#

#info dialog for html parsed pages ...
$dialog{"error_title"}= "Error Message";
$dialog{"warning_title"}= "Warning Message";
$dialog{"info_title"}= "Info Message";

$error_field{'acc'}= "Error in field Account";
$error_field{'pwd'}= "Error in field Password";
$error_field{'title'}= "Error in field Title";
$error_field{'descr'}= "Error in field Description";
$error_field{'weblink'}= "Error in field Primary WebLink";
$error_field{'web2link'}= "Error in field Secondary WebLink";
$error_field{'banner'}= "Error in field Banner";
$error_field{'mail'}= "Error in field Mail";
$error_field{'t_in'}= "Error in field Total IN";
$error_field{'t_out'}= "Error in field Total OUT";
$error_field{'in'}= "Error in field IN";
$error_field{'out'}= "Error in field OUT";
$error_field{'activity'}= "Error in field ACTIVITY";
$error_field{'sample'}= "Error in field SAMPLE";
$error_field{'hsample'}= "Error in field SAMPLE Height";
$error_field{'wsample'}= "Error in field SAMPLE Width";
$error_field{'hbanner'}= "Error in field BANNER Height";
$error_field{'wbanner'}= "Error in field BANNER Width";
#ID's in HASH recs ...

$record{'pwd'}=0;
$record{'weblink'}=1;
$phpIndex = $record{'weblink'};
$phpIndex2 = $record{'web2link'};
$record{'webtext'}=2;
$record{'title'}=2;
$record{'new'}=3;
$record{'modif'}=3;
$record{'in'}=4;
$record{'out'}=5;
$record{'rating'}=6;
$record{'banner'}=7;
$record{'mail'}=8;
$record{'descr'}=9;
$record{'joindate'}=10;
$record{'inactivity'}=11;
$record{'activity'}=11;
$record{'suspend'}=12;
$record{'freeze'}=13;
$record{'lock'}=14;
$record{'sample'}=15;
$record{'wbanner'}=16;
$record{'hbanner'}=17;
$record{'wsample'}=18;
$record{'hsample'}=19;
$record{'ratio'}=20;
$record{'web2link'}=21;
$record{'info'}=22;
$record{$lastRank}=23;
$record{'importSign'}=24;

$record{'ar_mail'}=0;
$record{'ar_weblink'}=1;
$record{'ar_banner'}=2;
$record{'ar_hbanner'}=3;
$record{'ar_wbanner'}=4;
$record{'ar_title'}=6;
$record{'ar_descr'}=7;
$record{'ar_joindate'}=10;
$record{'in'}=4;
$record{'out'}=5;
$record{'ar_ratio'}=11;
$record{'ar_inact'}=22;
$record{'ar_suspend'}=20;
$record{'ar_lock'}=21;

# ----------------- Submits


# ----------------- Admin
$form_acc_view{'title'}= "textTITLE";
$form_acc_view{'descr'}= "textDESCR";
$form_acc_view{'mail'}= "textEMAIL";
$form_acc_view{'banner'}= "textBANNER";


$htmlAdminEditHtmlB="_#BselectHTML#_";
$htmlAdminEditHtmlE="_#EselectHTML#_";
$htmlAdminEditHtmlB="_#BselectHTML#_";
$htmlAdminEditHtmlValue="_#selectHtmlValue#_";
$htmlAdminEditHtmlDisplay="_#selectHtmlDisplay#_";


$htmlAdminMListB="_#BselectMList#_";
$htmlAdminMListE="_#EselectMList#_";
$htmlAdminMListValue="_#selectMListValue#_";
$htmlAdminMListDisplay="_#selectMListDisplay#_";
$MListEmptyMessage= "- Empty -";

$html_admin_display="_%DISPLAY%_";
$html_admin_edit= "_%EDIT%_";
$html_admin_execute= "_#EXECUTE#_";
$html_admin_mailto= "_#MAILTO#_";
$html_admin_cont= "CONTINUE";
$html_admin_acc_view_exe= "_#ACC_VIEW_EXE#_";
$html_admin_acc_view_mail = "_#ACC_VIEW_MAIL#_";
$htmlAdminEditSave= "_%SAVEHTML%_";
$htmlAdminStatus="#%STATUS_VALUE%#";
$htmlAdminBreakSave= "_%SAVEBREAK%_";
$htmlAdminMailSave= "_%SAVEMAILEDIT%_";
$htmlAdminSetupSave= "%#SAVE_SETUP#%";
$htmlAdminWordsSave= "_%SAVEWORDEDIT%_";
$htmlAdminIconsSave= "_%SAVEICONEDIT%_";
$htmlAdminAddSave= "_%SAVEADDEDIT%_";
$htmlAdminRetFromAView= "_RETFROMAV_";
$htmlAdminAccAddsSave = "#%ACCADDSAVE%#";
$htmlAdminStat= "_#STATISTIC#_";
$adminAuth= "_#AUTH#_";
$html_admin_cgi= "_#ADMIN_CGI#_";
$html_admin_backup= "_#BACKUP#_";

$htmlAdminSetupNormal= "_#SETUP#_";
$htmlAdminSetupAdvanced= "_#SETUPADVANCED#_";

$htmlAdminMain= "_#MAIN#_";
$html_admin_display{$html_admin_cgi}= $config::admin_cgi;
$html_rmtctrl_display{$html_admin_cgi}= $config::rmtctrl_cgi;

$html_admin_menu_id= "action";

$html_admin_menu{$htmlAdminMain}= 1;
$html_admin_menu{$html_admin_display}= 2;
$html_admin_menu{$html_admin_edit}= 3;
$html_admin_menu{$html_admin_execute}= 4;
$html_admin_menu{$html_admin_mailto}= 5;
$html_admin_menu{$html_admin_cont}= 2;
$html_admin_menu{$html_admin_backup}= 7;
$html_admin_menu{$htmlAdminSetupNormal}= 101;
$html_admin_menu{$htmlAdminSetupAdvanced}= 102;
$html_admin_menu{$htmlAdminEditSave}= 8;
$html_admin_menu{$htmlAdminBreakSave}= 9;
$html_admin_menu{$htmlAdminMailSave}= 11;
$html_admin_menu{$adminAuth}= 12;
$html_admin_menu{$htmlAdminSetupSave}= 13;
$html_admin_menu{$htmlAdminWordsSave}= 15;
$html_admin_menu{$htmlAdminRetFromAView}= 16;
$html_admin_menu{$html_admin_acc_view_exe}= 6;
$html_admin_menu{$html_admin_acc_view_mail} = 17;
$html_admin_menu{$htmlAdminStat} = 18;
$html_admin_menu{$htmlAdminAccAddsSave} = 103;
$html_admin_menu{$htmlAdminIconsSave} = 104;
$html_admin_menu{$htmlAdminAddSave} = 105;
# execute commands from 

$html_admin_acc_view{'begin'}= "#%ACC_VIEW_BEGIN%#";
$html_admin_acc_view{'end'}= "#%ACC_VIEW_END%#";

$adminAccViewInfo{'interval'}= "#%INFO_INTERVAL%#";
$adminAccViewInfo{'type'}= "#%INFO_TYPE%#";
$adminAccViewInfo{'by'}= "#%INFO_BY%#";
$adminAccViewInfo{'next'}= "#%INFO_LINKNEXT%#";
$adminAccViewInfo{'back'}= "#%INFO_LINKBACK%#";

$h_adm_acc_view{'position'}= "#%VAL_POSITION%#";
$h_adm_acc_view{'pwd'}= "#%VAL_PWD%#";
$h_adm_acc_view{'acc'}= "#%VAL_ACC%#";
$h_adm_acc_view{'weblink'}= "#%VAL_WEBLINK%#";
$h_adm_acc_view{'web2link'}= "#%VAL_WEB2LINK%#";
$h_adm_acc_view{'info'}= "#%VAL_INFO%#";
$h_adm_acc_view{'title'}= "#%VAL_TITLE%#";
$h_adm_acc_view{'banner'}= "#%VAL_BANNER%#";
$h_adm_acc_view{'mail'}= "#%VAL_MAIL%#";
$h_adm_acc_view{'descr'}= "#%VAL_DESCR%#";
$h_adm_acc_view{'total_in'}= "#%VAL_TIN%#";
$h_adm_acc_view{'total_out'}= "#%VAL_TOUT%#";
$h_adm_acc_view{'in'}= "#%VAL_IN%#";
$h_adm_acc_view{'out'}= "#%VAL_OUT%#";
$h_adm_acc_view{'activity'}= "#%VAL_ACTIVITY%#";
$h_adm_acc_view{'suspend'}= "#%VAL_SUSPEND%#";
$h_adm_acc_view{'lock'}= "#%VAL_LOCK%#";
$h_adm_acc_view{'freeze'}= "#%VAL_FREEZE%#";
$h_adm_acc_view{'new'}= "#%VAL_NEW%#";
$h_adm_acc_view{'modif'}= "#%VAL_MODIF%#";
$h_adm_acc_view{'sample'}= "#%VAL_SAMPLE%#";
$h_adm_acc_view{'wbanner'}= "#%VAL_BANNERW%#";
$h_adm_acc_view{'hbanner'}= "#%VAL_BANNERH%#";
$h_adm_acc_view{'wsample'}= "#%VAL_SAMPLEW%#";
$h_adm_acc_view{'hsample'}= "#%VAL_SAMPLEH%#";
$h_adm_acc_view{'ratio'}= "#%VAL_RATIO%#";
$h_adm_acc_view{'ratio_io'}= "#%RATIO_IO%#";
$h_adm_acc_view{'ratio_io_hour'}= "#%RATIO_IO_HOUR%#";
$h_adm_acc_view{'total_in_real'}= "#%REAL_TIN%#";
$h_adm_acc_view{'total_out_real'}= "#%REAL_TOUT%#";
$h_adm_acc_view{'in_real'}= "#%REAL_IN%#";
$h_adm_acc_view{'out_real'}= "#%REAL_OUT%#";
$h_adm_acc_view{'total_real_in'}= "#%REAL_REAL_IN%#";
$h_adm_acc_view{'total_notbot_in'}= "#%REAL_NOTBOT_IN%#";
$h_adm_acc_view{'gen_out'} = "#%REAL_GEN_OUT%#";

# ----------------- Setup
$form{'setup_auth'}{'acc'}= "fieldAcc";
$form{'setup_auth'}{'pwd'}= "fieldPWD";
#%AREASYSTEM_END%#


#%AREAUSER_BEGIN%#
# Restrictions
$inputRestr{'acc_max_chars'}= 10;
$inputRestr{'acc_min_chars'}= 3;

$inputRestr{'title_max_chars'}= 50;
$inputRestr{'title_min_chars'}= 5;

$inputRestr{'weblink_max_chars'}= 100;
$inputRestr{'weblink_min_chars'}= 1;

$inputRestr{'banner_max_chars'}= 100;
$inputRestr{'banner_min_chars'}= 1;

$inputRestr{'wbanner_max_num'}= $maxBannerWidth;
$inputRestr{'wbanner_min_num'}= 1;

$inputRestr{'hbanner_max_num'}= $maxBannerHeight;
$inputRestr{'hbanner_min_num'}= 1;

$inputRestr{'wsample_max_num'}= $maxSampleWidth;
$inputRestr{'wsample_min_num'}= 1;


$inputRestr{'hsample_max_num'}= $maxSampleHeight;
$inputRestr{'hsample_min_num'}= 1;



$inputRestr{'sample_max_chars'}= 100;
$inputRestr{'sample_min_chars'}= 1;


$inputRestr{'pwd_max_chars'}= 10;
$inputRestr{'pwd_min_chars'}= 1;

$inputRestr{'rpwd_max_chars'}= 10;
$inputRestr{'rpwd_min_chars'}= 5;


$inputRestr{'mail_max_chars'}= 40;
$inputRestr{'mail_min_chars'}= 1;


$inputRestr{'descr_max_chars'}= 150;
$inputRestr{'descr_min_chars'}= 1;

#%AREAUSER_END%#

#%AREASYSTEM_BEGIN%#
$form{'setup_form'}{'acc'}= "fieldAcc";
$form{'setup_form'}{'pwd'}= "fieldPWD";
$form{'setup_form'}{'rpwd'}= "fieldRPWD";
$form{'setup_form'}{'mail'}= "fieldMail";
$form{'setup_form'}{'banner'}= "fieldBanner";
$form{'setup_form'}{'weblink'}= "fieldWebLink";
$form{'setup_form'}{$web2link}= "fieldWeb2Link";
$form{'setup_form'}{$info}= "fieldInfo";
$form{'setup_form'}{'descr'}= "fieldDescr";
$form{'setup_form'}{'title'}= "fieldTitle";
$form{'setup_form'}{'t_in'}= "fieldTin";
$form{'setup_form'}{'t_out'}= "fieldTout";
$form{'setup_form'}{'in'}= "fieldIn";
$form{'setup_form'}{'out'}= "fieldOut";
$form{'setup_form'}{'activity'}= "fieldActivity";
$form{'setup_form'}{'suspend'}= "fieldSuspend";
$form{'setup_form'}{'freeze'}= "fieldFreeze";
$form{'setup_form'}{'lock'}= "fieldLock";
$form{'setup_form'}{$new}= "fieldNew";
$form{'setup_form'}{$modif}= "fieldModif";
$form{'setup_form'}{'sample'}= "fieldSample";
$form{'setup_form'}{$sampleh}= "fieldHSample";
$form{'setup_form'}{$samplew}= "fieldWSample";
$form{'setup_form'}{$bannerh}= "fieldHBanner";
$form{'setup_form'}{$bannerw}= "fieldWBanner";
$form{'setup_form'}{'ratio'}= "fieldRatio";
$form{'setup_form'}{'pwd'}= "fieldPWD";
$form{'setup_form'}{'rpwd'}= "fieldRPWD";



# Hidden in html template

$htmlParamName{'nextAction'}= "#%HIDDEN_VALUE%#";
$htmlParamName{'value'}= "#%VALUE%#";
$htmlValue{'validateAdded'}= "validate_added";
$htmlValue{'verify1'}= "verify1";
$htmlValue{'filldetail'}= "filldetail";
$htmlValue{'validate'}= "validate";
$htmlValue{'modif'}= "modif_auth";
$htmlValue{'save'}= "validandsave";
$htmlValue{'validateModified'}= "validate_modified";
$htmlValue{'empty'} = "";

$htmlSubmit{'save'}= "#%SUBMIT_SAVE%#";
$htmlSubmit{'cancel'}= "#%SUBMIT_CANCEL%#";
$htmlSubmit{'chpwd'}= "#%SUBMIT_CHPWD%#";

$htmlSubmitLabel{'save'}= "Save";
$htmlSubmitLabel{'process'}= "Process";
$htmlSubmitLabel{'cancel'}= "Cancel";
$htmlSubmitLabel{'chpwd'}= "Changepwd";


$htmlParamName{'type'}= "#%TYPE%#";
$htmlValueX{'add'}= "Registration";
$htmlValueX{'verify'}= "Verification";
$htmlValueX{'detail'}= "Detail Fill";
$htmlValueX{'modify'}= "Modification";
$htmlValueX{'auth'}= "Authentification";
$htmlValueX{'error'}= "Error";
$htmlValueX{'choose'}= "Choose Operatio";

$html_setup_hidden_acc= "acc";


$html_param_setup_cgi= "#%SETUP_CGI%#";
$html_param_acc_cgi= "#%ACC_CGI%#";
#$html_setup_cgi -> located in CONFIG.CGI




$html_hidden= "#%WM_CGI_PARAM%#";
$html_submit= "#%WM_BUTTON_PARAM%#";




# Vars in template list

$html_TL_data= "#%ENTER_DATA%#";
$html_TL_next= "Next";
$html_TL_home= "Home";

#%AREASYSTEM_END%#

#%AREAUSER_BEGIN%#
# Statistic
$statistic= 1;
#1-statistic enabled, 0-disabled

$acc_total_in_out= 1;
#1-will keep total in/out per account	

# Total In/Out per account statistic
$acc_total_in= 0;
$acc_total_out= 1;

#%AREAUSER_END%#


#%AREASYSTEM_BEGIN%#
#arank {
$arBannedWord = "word.ban";
$arBannedUrl = "email.ban|url.ban";

#}

# Edit Mail {
$htmlAdminEditMailHeader= "_#VAL_HEADER#_";
$htmlAdminEditMailFooter= "_#VAL_FOOTER#_";
$htmlAdminEditMailDelete= "_#VAL_ERASED#_";
$htmlAdminEditMailInact= "_#VAL_INACT#_";
$htmlAdminEditMailWords= "_#VAL_WORDS1#_";
$htmlAdminEditMailUrls= "_#VAL_WORDS2#_";



$htmlAdminEdit{'mailHeader'}= "fieldHEADER";
$htmlAdminEdit{'mailFooter'}= "fieldFOOTER";
$htmlAdminEdit{'mailDelete'}= "fieldDELETE";
$htmlAdminEdit{'mailInact'}= "fieldINACT";

# }


# Edit Breaks {
$htmlAdminEditBreakIndex= "#%INDEX_NAME%#";
$htmlAdminEditBreakBegin= "#%BREAK_VIEW_BEGIN%#";
$htmlAdminEditBreakEnd= "#%BREAK_VIEW_END%#";
$htmlAdminEditBreakLabel= "#%LABEL%#";
$htmlAdminEditBreakField= "#%FIELD_NAME%#";
$htmlAdminEditBreakData= "#%DATA%#";


$htmlAdminEditSave= "_%SAVEHTML%_";
$htmlAdminEditBreakB="_#BselectBREAK#_";
$htmlAdminEditBreakE="_#EselectBREAK#_";
$htmlAdminEditBreakValue="_#selectBreakValue#_";
$htmlAdminEditBreakDisplay="_#selectBreakDisplay#_";
#}


# Edit HTML {
$htmlAdminEditTemplBody= "_#VAL_BODY#_";
$htmlAdminEditTemplHeader= "_#VAL_HEADER#_";
$htmlAdminEditTemplFooter= "_#VAL_FOOTER#_";

$htmlAdminEditTemplFooterHelp= "_#HELP_FOOTER#_";
$htmlAdminEditTemplHeaderHelp= "_#HELP_HEADER#_";
$htmlAdminEditTemplBodyHelp= "_#HELP_BODY#_";

$htmlAdminEdit{'header'}= "fieldHEADER";
$htmlAdminEdit{'footer'}= "fieldFOOTER";
$htmlAdminEdit{'body'}= "fieldBODY";
$htmlAdminEditSave= "_%SAVEHTML%_";
$htmlAdminEditIndex= "_%EDIT_INDEX%_";
# }

# Execute {
$execReset= "reset";
$execRerank= "rerank";
$execSetRatio= "setratio";
$execAccAdd ="accadd";
$execRemove= "remove";
$execSetRatioFrom= "fieldSetRatioFrom";
$execSetRatioTo= "fieldSetRatioTo";
$execSetRatioData= "fieldSetRatio";
$execRemoveData= "fieldRemove";
#}



# info in edit files {
$infoEditFile{'htmlBreak'}= "#%INFO%#";
$infoEditFile{'htmlMailAccHext'}= "#%INFO_HEADER_TEXT%#";
$infoEditFile{'htmlMailAccFText'}= "#%INFO_FOOTER_TEXT%#";
$infoEditFile{'htmlMailAccDelete'}= "#%INFO_DELETE_TEXT%#";
$infoEditFile{'htmlMailAccInact'}= "#%INFO_INACT_TEXT%#";

$infoEditFile{'blackWords'}= "#%INFO_BWORD%#";
$infoEditFile{'blackUrls'}= "#%INFO_BURL%#";
#}




# --------- REPORT
$emailReportSubject{'admin'}= "Account Registration Report";
$emailReportSubject{'editadmin'}= "Account Modification Report";
$emailReportSubject{'acc'}= "Account Registration Report for User";
$emailReportSubject{'deleted'}= "You have been deleted";
$emailReportSubject{'inactive'}= "You are inactive for long period";


#%AREASYSTEM_END%#

# Appears when user doesn't sets type of action when running setup.cgi
# Depredicated               ,,,,,,,,,         not in use
$askForType= <<TYPE;
Content-type: text/html

<HTML>
<HEAD>
<TITLE>TrafficPro    S E T U P   </TITLE>
</HEAD>
<BODY>
Please, select type of operation: <BR>
<A HREF = "./setup.cgi?action=add"> Add new ACCOUNT </A> <BR>
<A HREF = "./setup.cgi?action=modif"> Modify existing ACCOUNT </A> <BR>
</BODY>
</HTML>

TYPE
#%EOF%#
#%Dir: ./doc%#
#%File: ./doc/new_v0.94anticycl%#
Anti Cycle Clicker
Setup:  Use Default URL to forward					DONE
	Use random							DONE
	Use second url spec. by user					NY
        Interval 1-10 pevno urceny					DONE
        Preffered  pevno urc. napr. 5					DONE
	Infinite Cycle protection					DONE
	Check URL - not emply						DONE
	Check ACC_ne <-> Check ACC_old					DONE
	Test(empty, 1,2,10, again ACC_old, empty ACC_new)		DONE
	Autodel emptis in array						DONE
	Empty topx list protection					DONE
	
Generator:
        Curve tuning	(1/((x-preff)^2)/4*x-y + 1)			DONE	
	Action - throught rerank					DONE
	Cache in file $config::topxfwdcache				DONE
	TC * 10 -> count of account records in cache			DONE#%EOF%#
#%File: ./doc/ver.txt%#
new in 0.72a
-> optimalizovat ak je every hour -> nedat po hodine, ale min=0 a hod=*	DONE
-> statistika total IO ma po reranku napicu cisla 			DONE

-> v log.log sa objavuje zaznam like lolitas|?? odkial?			DONE
-> PREPRACOVAT SYSTEM SPRACOVANIA IN/OUT + SYSTEM ROZDAVANIA HITS+ STAT DONE
-> ak je niekto inactive od reset-u ale dostane in, hned po reranku 
   ho dat na 0								DONE
-> Measurement of rerank time, items in, items out			DONE

new in 0.73b
-> nejake upravy kodu, ktore snad odstrania problem s t_in/out

new in 0.74x
-> pozastavenie genlist statistiky a tiez reset statistiky		DONE


v 0.8a
-> fix adminPWD in config.dat do user area				DONE
-> opravit posielanie mailov z admin-u					DONE
-> prepisat example v admin_main.html					DONE
-> implementovat out.php
    - ako parameter ziska ID a ACC where to go				DONE
    - na zaklade acc zisti reciprocal URL				DONE
    - urobi zapis do out.log						DONE
    - v databaze najde acc's reciprocal URL				DONE
    - header("Location ...")						DONE
    - a hotovo								DONE
-> prerobit database z SDBM na GDBM					DONE
-> opravit v location v out.cgi - pridat htttp				DONE


v 0.81fuck
-> pridat moznost editovat subject pre kazdy typ mail-u
-> # Label gjg547gh  libAdmin opravit relat. cesty			DONE
-> cron na absolutne cesty						DONE
-> opravit chyba libList -> generuje cestu pre templates s .		DONE
-> po delete account-u hlasi server chybu - chyba nastala v sekcii	DONE
   libAccount::accDelete -> cast,  v ktorej sa posiela mail user-ovi
   -> error -> gdbm locks db while writing - use opendbm inst. tie
   -> zohnat dokumentaciu k package GDBM_Files.pm			
-> pridat toplist id 	- moznost editovat v setup-e
			- id bude parametrizovane v kazdom TEMPLATE
-> pocet inactive pri starte TL,pocet accs v databaze, uptime po last	DONE
    toplist gen
-> last login /date/							DONE
-> umiestnit hore uved. statistiky do suboru  + pridat funkcie
   - do var.dat %adminStat{'lastLogin'} = 0, ...
-> premenovat account_list na accounts.dat,     ..			DONE
   - opravit to aj v install.cgi					DONE

v 0.82
-> pridat toplist id 	- moznost editovat v setup-e			DONE
			- id bude parametrizovane v kazdom TEMPLATE	DONE
			- aj do e_mail-u pre admina			DONE
-> umiestnit hore uved. statistiky do suboru  + pridat funkcie		DONE
   - do var.dat %adminStat{'lastLogin'} = 0, ...			DONE
-> opravit error save ked sa odobera uz odobrany cron			DONE   
-> pridat moznost editovat subject pre kazdy typ mail-u			DONE
-> ID toplist musi byt uniformny -> pre multi admin 
    / treba to zdoraznit v help-e
-> upravit inactive mail - zdroj subject-u				DONE
-> posielat WARN do suboru						DONE
-> moznost vytahovat WARN cez cgi : error.cgi				DONE
-> pridat site aj do subject-u						DONE

v 0.82CartmanX
-> traps in some main cgi						DONE

v 0.83
-> ak sa zvoli account, kt neexist. - back to admin + message		DONE
-> mail to deleted							DONE
-> mail v acc view							DONE
-> nahadzat error traps do acc.cgi
-> osetrit ak sa vymaze hit ratio a ptom sa to savne			DONE
-> 


v 0.83a
-> ak sa zvoli account, kt neexist. - back to admin + message		DONE
-> mail to deleted							DONE
-> mail v acc view							DONE
-> nahadzat error traps do acc.cgi
-> osetrit ak sa vymaze hit ratio a ptom sa to savne			DONE

v 0.83b
-> pridat do identifikacnych ciar v cron-e ID toplist-u			DONE
   => ak na tom istom servri bezia viacere TL, aby sa crontab zapisy
     navzajom nepremazali
     
-> do error log-u vypisuje bad file descriptor   na 95% vtedy, ked 	DONE
    sa zatvara premenna, ktora neodkazuje ha handle
   - vhodne vypracovat system zaznamenavania kazdej chyby pri
     zapise do suboru /cez err. log/ => moznost centralny vypnut
     
-> opravit v genliste - ak neexist. in.log,out.log otvara subory
    in.log,out.log,temp.log zbytocne
    
    
-> novy model pre pracu so subormi					DONE

     -> ak nejaka funkcia zavola dbmopen, ak uz je otvorena databaza, podhodit 
       otvoreny hash
     -> pouzit TIE inst of DBMOPEN
     -> 

     
v 0.84gdbm
-> gdbm by malo slapat							DONE


v 0.85banner
-> opravit crontab id line -pridat identifikaciu stranky		DONE
   - overit, ci nie je problem s HOME - ak ich je tam viac
-> banner + sample pri generovani TL					DONE
-> vybrat jeden account a najst place na umiestnenie v Headri, Footri	DONE
									DONE
-> checkovat, co zadava v SETUP-e
-> pridat POWERED BY							DONE
-> instalovat picture do html path					DONE

-> odstranit problem: ak banner alebo sample neexistuje			DONE
		      vynechat cely riadok s danou chybou =>
   t.z. prepracovat system tvorby DATA_BODY aj snap-shot
   - organizovat do riadkov informacie, ktore ked sa vynechaju, nedojde k
     dezprganizacii  v html code. Napr. ak dany user nema banner, 
     vynecha sa cely riadok s bannerom => na TL nebude vidno ze je
     nieco nap... /rozpracovat navrh tvorby
     snapshot-u + realizacia vyplnania
     /
     
-> sample PIC - bude platit to iste ako pre banner			DONE
-> odstranit problem -> ajk sa posle v polozke TO sendmail-u nejaka
    blbost, vyhodi chybu - asi do str err


-> logview.cgi -> info o log suboroch					DONE
-> vypnutie strict v admin.cgi - neslo edit mail-u			DONE#%EOF%#
#%Dir: ./jscript%#
#%File: ./jscript/antihitbot.js%#
<IMG SRC="%#HTTP_PATH#%/%#BANNER_NAME#%?%params%" height="1" width="1">#%EOF%#
#%File: ./jscript/main.js%#
//--------------------------------------------------------------
//  ##%TL_NAME%## ##%TL_VER%##				      
//--------------------------------------------------------------
//                    DO NOT EDIT THIS FILE                    
//--------------------------------------------------------------


function showHelp() {
  // arguments 0-topic 1-item
  msg=window.open("$path_url_cgis/help.cgi?topic="+arguments[0]+"&item="+arguments[1],"HelpWindow","toolbar=no,scrollbars=yes,alwaysRaised=yes,width=650,height=600,dependent=yes,resizable=no,titlebar=no,status=no,screenx=10,screeny=10");
}


function scrollData() {
  // arguments 0- 0-> left 1->right
  msg=window.open("$path_url_cgis/help.cgi?topic="+arguments[0]+"&item="+arguments[1],"HelpWindow","toolbar=no,scrollbars=no,alwaysRaised=yes,width=550,height=250,dependent=yes,resizable=no,titlebar=no,status=no,screenx=100,screeny=100");
}

function nextFocus(input) {
  for (var i = 0;i < input.form.elements.length ; i++) {
    if (input.form.elements[i].name == input.name){
      input.form.elements[i+1].focus();
      break;
    }
  }
}

function autoFocus() {
  var win = window.document.forms[0];
  for (var i=0;i < win.elements.length;i++ ) {
    if (( win.elements[i].type!='Read-only' ) && (win.elements[i].type!='hidden'))   {
      win.elements[i].focus();
      break;
    }
}
}



function openBanner(url, name)
{ window.open(url, name, 'scrollbars=0,resizable=no,width=500,height=120,status=0,menubar=0'); }

function getSelectedCustom(input) {
  if (input.selectedIndex != 0) {
   for(var i=0;i< input.length;i++) {
    if (input.options[i].selected == true) {
      return input.options[i].value;
    }
  }
 } 
 else {
  return -1;
  }
}

function autosize() {
  window.innerHeight = document.height + 70;
}

function serviceCustomMenu(input) {
  if ( (result = getSelectedCustom(input) ) != -1) {
    parent.main_detail.location= result;
  }
  return true;
}

function doBullShit() {
  return true;
}

function setFocus(name) {
for(var ii=0;ii<document.forms.length;ii++){
  for(var i=0;i<document.forms[ii].elements.length;i++){
    if (document.forms[ii].elements[i].value == name){
      document.forms[ii].elements[i].click();
      return;
    }
  }
}
}

function cookieDate() {
  var today = new Date();
  // add one year
  var later = new Date( today.valueOf() +1000*60*60*24*365);
  day = new Array('Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday');
  month = new Array('Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Set','Oct','Nov','Dec');
  var year = later.getFullYear()-2000;
  return day[later.getDay()]+','+later.getDate()+'-'+month[later.getMonth()]+'-'+ ((year < 10)?'0'+year:year) +' ' +later.getHours()+':'+later.getMinutes()+':'+later.getSeconds()+' GMT';
}
function saveSetting(field,value) {
// there are some problems so I'll leave it as it's
  var cookDate = cookieDate();
  for(var i=0;i<document.forms.length;i++) {
    for (var ii=0;ii<document.forms[i].elements.length;ii++){
      var type = document.forms[i].elements[ii].type;
          document.cookie = 'test'+i+'x'+ii+'='+type;
          document.cookie += ';xx';	    
      switch (type) {
      case ('radio' ) :
      { ttt = new Array();
        ttt = document.forms[i].elements[ii];
        for (var iii in document.forms[i].elements[ii]) {
	
// problem with accessing elements of radio button set	  
//          if ( (ttt[iii]).checked == "1") {
//            document.cookie =  (document.forms[i].elements[ii])[iii].name+'='+(document.forms[i].elements[ii])[iii].value;
//            document.cookie += ';expires='+cookDate;
//	  }
	}
      break;
      }
      case ('checkbox' ) :
      {
        for (var iii in document.forms[i].elements[ii]) {
          if ( (document.forms[i].elements[ii])[iii].checked == "1") {
            document.cookie =  (document.forms[i].elements[ii])[iii].name+'='+(document.forms[i].elements[ii])[iii].value;
            document.cookie += ';expires='+cookDate;
	  }
	}
      break;
      }
      case ('select-one' ||  'select-multiple'|| 'select' ||'select-single'):
      {
//       document.forms[i].elements[ii].options[ document.forms[i].elements[ii].selectedIndex];
//        if (document.forms[i].elements[ii].checked) {
//          document.cookie =  document.forms[i].elements[ii].name+'='+document.forms[i].elements[ii].value;
//          document.cookie += ';expires='+cookDate;
//	}
      break;
      }
      case ('button' ||  'submit'):      
      {
      break;
      }
      default: {
        document.cookie =  document.forms[i].elements[ii].name+'='+document.forms[i].elements[ii].value;
        document.cookie += ';expires='+cookDate;
	
      }
    }
  }
}
}
//  ------------------------ Admin ACC EDIT checker ------------------------
var errors = new Array();
var lastForm = "";
var xError = 0;
function checkInput_http(input,msg,nonull) {
// if nonull == 1 then input must define real http address not only http://
  re = /^http\:\/\//i;
  if ((input.value == "http://") && nonull) {
    if (msg) {
      alert("Error in value - must define real URL. Syntax: http://...");  
    }
    return 0;
  }
  if (input.value == "") {
    input.value = "http://";
    return 1;
  }
    
  if (! re.test(input.value)) {
    errors[errors.length] = input.name;
    if (msg) {
      alert("Syntax error / wrong data type: "+ input.value +"   Syntax: http://...");  
    }
    return 0;
  }
  else {
  for (i=0;i<errors.length;i++) {
    if (errors[i] == input.name) {
      errors = errors.slice(i,i);
      i--;
    }
  }
  }
  return 1;
}

function checkInput_nr(input,subst_zero,msg) {
  re = /[^0-9]/i;
  if ((subst_zero==5) && (input.value == "0") ) {
    if (msg) {
//      alert("Syntax error / wrong data type: "+input.value+". Must be from <1,2,...)");  
    }
    return 0;
  }
  if ((subst_zero==2) && (input.value == "") ) {
    return 1;
  }
  if ((subst_zero==1) && (input.value == "") ) {
    input.value = 0;
    return 1;
  }
  if (re.test(input.value) || (input.value=="")) {
    errors[errors.length] = input.name;
    if (msg) {
      alert("Syntax error / wrong data type: "+input.value+". Only numbers allowed");  
    }
    return 0;  
  }
  else {
  for (i=0;i<errors.length;i++) {
    if (errors[i] == input.name) {
      errors = errors.slice(i,i);
      i--;      
    }
  }
 }
return 1;  
}
function checkInput_null(input,space,msg) {
  re = /\s/;
  if ((input.value == "") || (space && (re.test(input.value))) )  {
    errors[errors.length] = input.name;
    if (msg) {
      if (space) {
        alert("Spaces not allowed !!");      
      }
      else {
        alert("Not allowed NULL value !!");  
      }
    }  
    return 0;
  }
  else {
  for (i=0;i<errors.length;i++) {
    if (errors[i] == input.name) {
      errors = errors.slice(i,i);
      i--;      
    }
  }
  }
  return 1;
}

function checkInput_ratio(input,msg) {
  var re = /^[0-9\.]+\:[0-9\.]+/;
  if (! re.test(input.value)) {
    errors[errors.length] = input.name;
    if (msg) {
      alert("Syntax error / wrong data type: "+input.value+". Syntax: number:number [number 0 or 0.5 or ]");  
    }
    return 0;
  }
  else {
  for (var i=0;i<errors.length;i++) {
    if (errors[i] == input.name) {
      errors = errors.slice(i,i);
      i--;      
    }
  }
  }
  return 1;
}
function checkInput_email(input,msg) {
  re = /^[A-Za-z0-9_]+\@[A-Za-z0-9_.]+$/;
  if (! re.test(input.value)) {
    errors[errors.length] = input.name;
    if (msg) {
      alert("Syntax error / wrong data type: "+input.value+". Syntax: name@server");  
    }
    return 0;
  }
  else {
  for (i=0;i<errors.length;i++) {
     if (errors[i] == input.name) {
     errors = errors.slice(i,i);
     i--;
    }
  }
  }
    return 1;  
}
function getFieldDescr(name) {

switch (name) {
case 'fieldAcc' : {  return 'Account Name';  break;}  
case 'fieldWebLink' : { return 'Primary URL';  break; }
case 'fieldMail' : {  return 'E-Mail';  break;}
case 'fieldSecWebLink' : {  return 'Secondary URL';  break;}
case 'field2WebLink' : {  return 'Secondary URL';  break;}
case 'fieldPWD' : {  return 'Password';  break;}
case 'fieldRPWD' : {  return 'Re-password';  break;}
case 'fieldBanner' : {  return 'Banner URL';  break;  }
case 'fieldSample' : {  return 'Sample URL';  break;  }
case 'fieldWBanner' : {  return 'Banner Width';  break;  }
case 'fieldHBanner' : {  return 'Banner Height';  break;  }
case 'fieldWSample' : {  return 'Sample Width';  break;  }
case 'fieldHSample' : {  return 'Sample Height';  break;  }
case 'fieldTitle' : {  return 'Site Title';  break;  }
case 'fieldRatio' :{ return 'Hit Ratio';  break;  }
case 'fieldDescr' : {  return 'Site Description';  break;  }
case 'fieldIn' : {  return 'Bonus IN';  break;}
case 'fieldOut' : {  return 'Bonus OUT';  break;  }
case 'var::topListID': {}
case 'config::cronTabPath' : {return 'Crontab Path';}
case 'config::sendmail':{return 'Sendmail Path';}
case 'config::document_root' :{return 'Document Root Path';}
case 'config::cgi_path' :{return 'CGI path';}
case 'config::phpInPath':{return 'PHP in path';}
case 'config::phpOutPath':{return 'PHP out path';}
case 'config::virtual_cgi_path':{return 'URL to CGI Dir';}
case 'config::url_html':{return 'URL to Document Dir';}
case 'config::phpInUrl':{return 'URL to PHP In';}
case 'config::phpOutUrl':{return 'URL to PHP Out';}
case 'var::fwdDefaultURL':{return 'Default forward URL';}
case 'config::defaultBannerURL':{return 'Default Banner URL';}
case 'inputDescrMax' :{return 'Max. Chars - Description';}
case 'inputTitleMax' :{return 'Max. Chars - Title';}
case 'var::cookiesExp' :{return 'Cookies Expiration';}
case 'var::optimizeDelay' :{return 'Database optimalization interval';}
case 'var::newAccBoxes' :{return 'Annount of Add Account fields';}
case 'var::listLimit' :{return 'Total list limit';}
case 'var::gen_storedforLast':{return 'How many in last top X';}
case 'var::inForNewAcc':{return 'Implicit IN for new account';}
case 'var::outForNewAcc':{return 'Implicit OUT for new account';}
case 'var::maxSampleHeight':{return 'Max. Sample Height';}
case 'var::maxSampleWidth':{return 'Max. Sample Width';}
case 'var::maxBannerHeight':{return 'Max. Banner Height';}
case 'var::maxBannerWidth':{return 'Max. Banner Width';}
case 'var::rerankPeriod':{return 'Rerank period';}
case 'var::resetPeriod':{return 'Reset period';}
case 'var::bannerLimit':{return 'Banner limit';}
case 'var::sampleLimit':{return 'Sample limit';}
case 'var::inactivityEdgeValue':{return 'Inactivity E*mail Edge Value';}
case 'config::in_hit_min_limit':{return 'Min. In hits to get listed';} 
case 'var::email':{return 'Admin E-Mail' ;}
case 'var::defaultHitRatio':{return 'Default Hit Ratio';}
case 'indexNames':{return 'Names of indexes';}
case 'indexAccCount':{return 'Accounts per index';}
case 'indexBreaks':{return 'Breaks in list';}
case 'var::fontSizes':{return 'Font sizes';}
case 'var::newLimit':{return 'NEW limit';}
case 'var::longLimit':{return 'LONG limit';}
case 'var::directionLimit':{return 'DIRECTION limit';}
case 'var::newDuration':{return 'NEW Duration';}
case 'var::longDuration':{return 'LONG Duration';}
default: break;
}
return 0;
}
function checkBefore(input,type) {
  var xx = new Array();
  var myResult = new Array();
  var wrong = new Array();
  var validAcc = new Array();
  var re = /^([0-9]*)(field.*)/;
//  Choose only that series in which there is NOT NULL Account name
  for (var i=0;i< input.form.elements.length;i++) {
      var myResult = re.exec(input.form.elements[i].name);
      if (myResult == null) {continue;}
      var name = myResult[2];
      var nr = (myResult[1]==null)?0:myResult[1];
      if ((name == "fieldAcc") && (input.form.elements[i].value != "")) {
        validAcc[nr]=input.form.elements[i].value;
      }
  }
  for (var i=0;i< input.form.elements.length;i++) {
    if (input.form.elements[i].type == 'text') {
      myResult   = re.exec(input.form.elements[i].name);
      if (myResult == null) {continue;}
      var name = myResult[2];
      var nr = (myResult[1]==null)?0:myResult[1];
      if (  validAcc[nr] != null){
        switch (name) {
        case ("fieldAcc") : {  if (! checkInput_null(input.form.elements[i],1,0)){xError++;}break;}
	case ("fieldMail") : {if ((! checkInput_email(input.form.elements[i],0)) && (! type)){xError++;} break;}
        case ("fieldSecWebLink") : {if (! checkInput_http(input.form.elements[i],0)){xError++;}break;}
        case ("field2WebLink") : {if (! checkInput_http(input.form.elements[i],0)){xError++;}break;}
        case ("fieldWebLink") : {if (! checkInput_http(input.form.elements[i],0,1)){xError++;}break;}
        case ("fieldBanner") : {if (! checkInput_http(input.form.elements[i],0)){xError++;}break;}
        case ("fieldSample") : {if (! checkInput_http(input.form.elements[i],0)){xError++;}break;}
        case ("fieldRatio"): {if (! checkInput_ratio(input.form.elements[i],0)){xError++;}break;}
        case ("fieldWBanner") : {if (! checkInput_nr(input.form.elements[i],2,0)){xError++;}break;}
        case ("fieldHBanner") : {if (! checkInput_nr(input.form.elements[i],2,0)){xError++}break;}
        case ("fieldWSample") : {if (! checkInput_nr(input.form.elements[i],2,0)){xError++;}break;}
        case ("fieldHSample") : {if (! checkInput_nr(input.form.elements[i],2,0)){xError++;}break;}
        case ("fieldIn"): {if (! checkInput_nr(input.form.elements[i],1,0)){xError++;}break;}
        case ("fieldOut"): {if (! checkInput_nr(input.form.elements[i],1,0)){xError++;}break;}
      } // end switch

      if (xError) {
	wrong[wrong.length] = getFieldDescr(name)+" in account: "+validAcc[nr];
        xError = 0;
      }
     } //if != NULL
    } // if == text
  } // for

  if (wrong.length) {
    alert("Error in:\n-> "+wrong.join("\n-> "));
  }
  else {
    input.form.buttontype.value = "save";
    input.form.submit();
  }
}

function regIt(input) {
 if ( (lastForm != input.form.fieldAcc.value) && (lastForm != "")) {
   alert("Have you already saved account before [ "+lastForm+" ] ?");  
   lastForm = "";
   return 0;
 }
  lastForm = input.form.fieldAcc.value;
  return 1;
}

function confirmIt(input) {
     if (window.confirm("Are you sure you want to delete account: \""+input.form.fieldAcc.value+"\"")) {
       input.form.buttontype.value = "delete";
       input.form.submit();
     }
}

function justPass(input) {
 input.form.buttontype.value = "mail";
 input.form.submit();
}


function checkAdminExec(input) {
var casee;
var error = new Array();
for (var i=1;i<input.form.elements.length;i++) {
  if (input.form.elements[i].checked) {
    casee = input.form.elements[i].value;
    break;
  }
}

switch (casee) {
case 'accadd' :{break;}
case 'rerank' :{break;}
case 'reset' :{break;}
case 'setratio' :{   
  if (! checkInput_ratio(input.form.fieldSetRatio,0)){   errors[errors.length] = "Error in value: "+input.form.fieldSetRatio.value+" . Syntax: number:number - number example 1.0, 2, 1.4";}
  if (! checkInput_nr(input.form.fieldSetRatioFrom,5,0)     ){ errors[errors.length] = "Error in field \"From\" - must be a number 1,...";}
  if (! checkInput_nr(input.form.fieldSetRatioTo,5,0)     ){ errors[errors.length] = "Error in field \"To\" - must be a number 1,...";}
  break;
}
case 'remove' :{   
  if (! checkInput_nr(input.form.fieldRemove,5,0)     ){        errors[errors.length] ="Error in field \"Inactivity For\" - must be a number 1,...";}
  break;
}
}
if (error.length > 0) {
  alert("Errors :\n"+error.join("\n"));  
}
else {
  input.form.submit();
}
}

function checkSetup(input) {
var name;
var errors = new Array();
  for (var i=0;i< input.form.elements.length;i++) {
    if (input.form.elements[i].type == 'text') {
	name = input.form.elements[i].name;
    switch(name) {
	case ("var::topListID") : {  if (! checkInput_null(input.form.elements[i],0,0)){errors[errors.length] =getFieldDescr(name);}break;}
        case ("config::sendmail") : {  if (! checkInput_null(input.form.elements[i],0,0)){errors[errors.length]=getFieldDescr(name);}break;}
        case ("config::cronTabPath") : {  if (! checkInput_null(input.form.elements[i],0,0)){errors[errors.length]=getFieldDescr(name);}break;}
        case ("config::document_root") : {  if (! checkInput_null(input.form.elements[i],0,0)){errors[errors.length]=getFieldDescr(name);}break;}
        case ("config::cgi_path") : {  if (! checkInput_null(input.form.elements[i],0,0)){errors[errors.length]=getFieldDescr(name);}break;}
        case ("config::virtual_cgi_path") : {if (! checkInput_http(input.form.elements[i],0,0)){errors[errors.length]=getFieldDescr(name);}break;}
        case ("config::url_html") : {if (! checkInput_http(input.form.elements[i],0,0)){errors[errors.length]=getFieldDescr(name);}break;}
        case ("config::phpInPath") : {if (! checkInput_null(input.form.elements[i],0,0)){errors[errors.length]=getFieldDescr(name);}break;}
        case ("config::phpOutPath") : {if (! checkInput_null(input.form.elements[i],0,0)){errors[errors.length]=getFieldDescr(name);}break;}
        case ("config::phpInUrl") : {if (! checkInput_http(input.form.elements[i],0,0)){errors[errors.length]=getFieldDescr(name);}break;}
        case ("config::phpOutUrl") : {if (! checkInput_http(input.form.elements[i],0,0)){errors[errors.length]=getFieldDescr(name);}break;}
        case ("var::optimizeDelay") : {if (! checkInput_nr(input.form.elements[i],5,0)){errors[errors.length]=getFieldDescr(name);}break;}
        case ("var::newAccBoxes") : {if (! checkInput_nr(input.form.elements[i],5,0)){errors[errors.length]=getFieldDescr(name);}break;}
	case ("var::email") : {if ((! checkInput_email(input.form.elements[i],0)) ){errors[errors.length]=getFieldDescr(name);} break;}
        case ("indexNames") : {  if (! checkInput_indexNames(input.form.elements[i],0)){errors[errors.length]=getFieldDescr(name);}break;}
        case ("indexAccCount") : {  if (! checkInput_indexAccCount(input.form.elements[i],0)){errors[errors.length]=getFieldDescr(name);}break;}
        case ("indexBreaks") : {  if (! checkInput_indexBreaks(input.form.elements[i],0)){errors[errors.length]=getFieldDescr(name);}break;}
        case ("var::fontSizes") : {  if (! checkInput_fontSizes(input.form.elements[i],0)){errors[errors.length]=getFieldDescr(name);}break;}
        case ("var::listLimit") : {  if (! checkInput_nr(input.form.elements[i],5,0)){errors[errors.length]=getFieldDescr(name);}break;}
	case ("var::listLowerLimit") : {if (! checkInput_nr(input.form.elements[i],5,0) ){errors[errors.length]=getFieldDescr(name);} break;}
	case ("config::in_hit_min_limit") : {if (! checkInput_nr(input.form.elements[i],0,0) ){errors[errors.length]=getFieldDescr(name);} break;}
	case ("var::bannerLimit") : {if (! checkInput_nr(input.form.elements[i],0,0) ){errors[errors.length]=getFieldDescr(name);} break;}
	case ("var::sampleLimit") : {if (! checkInput_nr(input.form.elements[i],0,0) ){errors[errors.length]=getFieldDescr(name);} break;}
	case ("var::newLimit") : {if (! checkInput_nr(input.form.elements[i],5,0) ){errors[errors.length]=getFieldDescr(name);} break;}
	case ("var::longLimit") : {if (! checkInput_nr(input.form.elements[i],5,0) ){errors[errors.length]=getFieldDescr(name);} break;}
	case ("var::directionLimit") : {if (! checkInput_nr(input.form.elements[i],5,0) ){errors[errors.length]=getFieldDescr(name);} break;}
	case ("var::newDuration") : {if (! checkInput_nr(input.form.elements[i],5,0) ){errors[errors.length]=getFieldDescr(name);} break;}
	case ("var::longDuration") : {if (! checkInput_nr(input.form.elements[i],5,0) ){errors[errors.length]=getFieldDescr(name);} break;}
	case ("var::inactivityEdgeValue") : {if (! checkInput_nr(input.form.elements[i],0,0) ){errors[errors.length]=getFieldDescr(name);} break;}
        case ("var::fwdDefaultURL") : {if (! checkInput_http(input.form.elements[i],0,0)){errors[errors.length]=getFieldDescr(name);}break;}
        case ("config::defaultBannerURL") : {if (! checkInput_http(input.form.elements[i],0,0)){errors[errors.length]=getFieldDescr(name);}break;}
	case ("var::cookiesExp") : {if (! checkInput_nr(input.form.elements[i],5,0) ){errors[errors.length]=getFieldDescr(name);} break;}
	case ("inputTitleMax") : {if (! checkInput_nr(input.form.elements[i],5,0) ){errors[errors.length]=getFieldDescr(name);} break;}
	case ("inputDescrMax") : {if (! checkInput_nr(input.form.elements[i],5,0) ){errors[errors.length]=getFieldDescr(name);} break;}
	case ("var::rerankPeriod") : {if (! checkInput_nr(input.form.elements[i],0,0) ){errors[errors.length]=getFieldDescr(name);} break;}
	case ("var::resetPeriod") : {if (! checkInput_nr(input.form.elements[i],0,0) ){errors[errors.length]=getFieldDescr(name);} break;}
	case ("var::maxBannerHeight") : {if (! checkInput_nr(input.form.elements[i],0,0) ){errors[errors.length]=getFieldDescr(name);} break;}
	case ("var::maxBannerWidth") : {if (! checkInput_nr(input.form.elements[i],0,0) ){errors[errors.length]=getFieldDescr(name);} break;}
	case ("var::maxSampleHeight") : {if (! checkInput_nr(input.form.elements[i],0,0) ){errors[errors.length]=getFieldDescr(name);} break;}
	case ("var::maxSampleWidth") : {if (! checkInput_nr(input.form.elements[i],0,0) ){errors[errors.length]=getFieldDescr(name);} break;}
	case ("var::inForNewAcc") : {if (! checkInput_nr(input.form.elements[i],0,0) ){errors[errors.length]=getFieldDescr(name);} break;}
	case ("var::outForNewAcc") : {if (! checkInput_nr(input.form.elements[i],0,0) ){errors[errors.length]=getFieldDescr(name);} break;}
	case ("var::defaultHitRatio") : {if (! checkInput_ratio(input.form.elements[i],0) ){errors[errors.length]=getFieldDescr(name);} break;}
}
	

    }

  }

 if (! errors.length) {
//   input.type='submit';
   input.form.submit();
   return 1;
 }
 else {
   if (   errors.length == 1 ) {
     alert("One error: \n->"+errors.join(" ->"));
   }
   else {
     alert("Several errors: \n->"+errors.join("\n->"));   
   }
   return 0;
 }
 
}

function checkInput_indexNames(input,msg) {
  var re  = /^([A-Za-z0-9.,_]*[A-Za-z0-9_])$/;
  if (! re.test(input.value)) {
    errors[errors.length] =input.name;
    if (msg) {
      alert("Syntax error / wrong data type: "+input.value+". Syntax: name1,name2,...,nameN");
    }
    return 0;
  }
  else {
    return 1;
  }
}
function checkInput_indexAccCount(input,msg) {
  var re  = /^([0-9.,]*[0-9])$/;
  if (! re.test(input.value)) {
    errors[errors.length] =input.name;
    if (msg) {
      alert("Syntax error / wrong data type: "+input.value+". Syntax: nr1,nr2,...,nrN");  
    }
    return 0;
  }
  else {
    return 1;
  }

}
function checkInput_indexBreaks(input,msg) {
// allow null value - no breaks
  if (input.value == "") {return 1;}
  var re  = /^([0-9.,]*[0-9])$/;
  if (! re.test(input.value)) {
    errors[errors.length] =input.name;
    if (msg) {
      alert("Syntax error / wrong data type: "+input.value+". Syntax: nr1,nr2,...,nrN");  
    }
    return 0;
  }
  else {
    return 1;
  }

}
function checkInput_fontSizes(input,msg) {
  var re  = /^([0-9\=\-\+\,]*[0-9]$)/;
  if (! re.test(input.value)) {
    errors[errors.length] =input.name;
    if (msg) {
      alert("Syntax error / wrong data type: "+input.value+". Syntax: rank1-rankX=fontSize,rankX+1-...");  
    }
    return 0;
  }
  else {
    return 1;
  }
}#%EOF%#
#%Dir: ./logs%#
#%Dir: ./php%#
#%File: ./php/counter.php%#
//--------------------------------------------------------------
//  ##%TL_NAME%## ##%TL_VER%##				      
//--------------------------------------------------------------
//                    DO NOT EDIT THIS FILE                    
//--------------------------------------------------------------
<?php 
exit();
umask(0);
error_reporting(E_ERROR);
$FH = fopen("config::counterLog","a");
if ( preg_match( "/id=([a-zA-Z0-9]*)_([a-zA-Z0-9]*)/","$QUERY_STRING",$matches) ) {
  fputs($FH,$matches[1]."|".$matches[2]."\n");
}
fclose($FH);  
?>
#%EOF%#
#%File: ./php/infrag.php%#
//--------------------------------------------------------------
//  ##%TL_NAME%## ##%TL_VER%##				      
//--------------------------------------------------------------
//                    DO NOT EDIT THIS FILE                    
//--------------------------------------------------------------

%IN_FRAGMENT_B%
<?php
error_reporting(E_ERROR);
$FH = fopen("config::log_in_file","a");
$key = uniqid(rand(),0);
$time  = time();
$line = (($cookieSet)?"X":"")."|$key|$acc|$time|".getenv("REMOTE_HOST")."|".getenv("REMOTE_ADDR")."|".getenv("HTTP_REFERER");
fputs($FH,"$line\n");
fclose($FH);
?>
%IN_FRAGMENT_E%

%PARAMS_FRAGMENT_B%
<?php
echo "id=$key"."_"."$acc";
?>
%PARAMS_FRAGMENT_E%


%TIMEDACTION_FRAGMENT_B%
<?php

$now = time();
umask(0);
if ( file_exists("config::timeStampRerank")  ) {
    $FHrer = fopen("config::timeStampRerank","r+");
}
else {
    $FHrer = fopen("config::timeStampRerank","w+");
    fputs($FHrer,$now);   
    fseek($FHrer,SEEK_SET,0);    
}

if ( file_exists("config::timeStampReset")  ) {
    $FHres = fopen("config::timeStampReset","r+");
}
else {
    $FHres = fopen("config::timeStampReset","w+");
    fputs($FHres,$now);   
    fseek($FHres,SEEK_SET,0);
}


$FHerror = fopen("config::log_file","a");
fputs($FHerror,"PHP: before run rerank or reset\n");
fclose($FHerror);


if  ( $FHrer && $FHres) {
    $rerTS = fgets($FHrer,4096);
    $resTS = fgets($FHres,4096);
    
$FHerror = fopen("config::log_file","a");
fputs($FHerror,"PHP: times for rerank,reset $rerTS,$resTS\n");
fclose($FHerror);
    
    
    $now = time();
    if (($now - $rerTS) >= var::rerankPeriod ) {
    
$FHerror = fopen("config::log_file","a");
fputs($FHerror,"PHP: do rerank\n");
fclose($FHerror);
    
    
	system("config::phpRerank");
	fseek($FHrer,SEEK_SET,0);    	
	fputs($FHrer,"$now");
    }
    
    if (($now - $resTS) >= var::resetPeriod ) {
    
$FHerror = fopen("config::log_file","a");
fputs($FHerror,"PHP: do reset\n");
fclose($FHerror);
    
    
	system("config::phpReset");
	fseek($FHres,SEEK_SET,0);    	
	fputs($FHres,"$now");
    }
    fclose($FHres);
    fclose($FHrer);
}
else {
    $FHerror = fopen("config::log_error_file","a");
    fputs($FHerror,"Error open file: config::timeStampRerank or config::timeStampReset in in.php at $now");
    fclose($FHerror);
}    

?>
%TIMEDACTION_FRAGMENT_E%
#%EOF%#
#%File: ./php/outproto.php%#
//--------------------------------------------------------------
//  ##%TL_NAME%## ##%TL_VER%##				      
//--------------------------------------------------------------
//                    DO NOT EDIT THIS FILE                    
//--------------------------------------------------------------

%MAIN_FRAGMENT_B%
<?php
// account name is in $acc
// id is in $id
error_reporting(E_ERROR);
umask(0);
$FH = fopen("config::log_out_file","a");
$time  = time();

$idAcc = preg_split("/\_/",$id);
$line = "$idAcc[0]|$acc|$idAcc[1]|$time|$rank";
fputs($FH,"$line\n");
fclose($FH);

if ( (($link = getUrl($acc,$id)) == "") || ($link == "http://") ) {
  $dbm = dba_open("config::account_database","r","gdbm");
  $data = dba_fetch($acc,$dbm);
  dba_close($dbm);
  $dataX = preg_split("/\|/",$data);
  $link = $dataX[var::phpIndex];
  
$FHerror = fopen("config::log_file","a");
fputs($FHerror,"PHP: used url correction to: $link\n");
fclose($FHerror);
  
}

$FHerror = fopen("config::log_file","a");
fputs($FHerror,"PHP: going to url $link\n");
fclose($FHerror);


 // out rank stat section BEGIN
 $line="";
 if ($FH = fopen("config::outRankStat","r")) {
   $line = fgets($FH,100000);
   fclose($FH);
 
 }
   $data= preg_split("/\|/",$line);
   $data[$rank-1]++;

//$FH = fopen("config::outRankStat","w");
 if ($FH = fopen("config::outRankStat","w")) {
   fputs($FH,join("|",$data));
   fclose($FH);
 }  
 // out rank stat section END

header("Location: $link");
exit;
?>
%MAIN_FRAGMENT_E%

%ANTILOOP_0_FRAGMENT_B%
<?php
function getUrl($acc,$id) {
umask(0);
  $dbm = dba_open("config::account_database","r","gdbm");
  $data = dba_fetch($acc,$dbm);
  dba_close($dbm);
  $dataX = preg_split("/\|/",$data);
  $linkX = $dataX[var::phpIndex];

    $FHerror = fopen("config::log_file","a");
    fputs($FHerror,"PHP: Used fragment 3\n");
    fclose($FHerror);

  
  return $linkX;
}
?>
%ANTILOOP_0_FRAGMENT_E%



%ANTILOOP_1_FRAGMENT_B%
<?php
function getUrl($acc,$id) {
umask(0);
  if ( preg_match( "/$acc/","$id" )  &&  ($acc != "") ) { 
    $FHerror = fopen("config::log_file","a");
    fputs($FHerror,"PHP: Used fragment 1 & def. url\n");
    fclose($FHerror);

    return "var::fwdDefaultURL";
  }
  else {
    $dbm = dba_open("config::account_database","r","gdbm");
    $data = dba_fetch($acc,$dbm);
    dba_close($dbm);
    $dataX = preg_split("/\|/",$data);
    $linkX = $dataX[var::phpIndex];
    
    $FHerror = fopen("config::log_file","a");
    fputs($FHerror,"PHP: Used fragment 1 & normal url ->acc:$acc ->id:$id\n");
    fclose($FHerror);
    
    
    return $linkX;
  }
}

?>
%ANTILOOP_1_FRAGMENT_E%


%ANTILOOP_2_FRAGMENT_B%
<?php
function getUrl($acc,$id) {
umask(0);
  if ( preg_match( "/$acc/","$id" )  &&  ($acc != "")) {

    $FHerror = fopen("config::log_file","a");
    fputs($FHerror,"PHP: Used frag. 2  $acc..$id\n");
    fclose($FHerror);

    $FHcache = fopen("config::topXFwdCache","r");
    
    if ($FHcache) {

    $FHerror = fopen("config::log_file","a");
    fputs($FHerror,"PHP: Cache exists\n");
    fclose($FHerror);
    
    
      $counter = 0;
      while (! feof($FHcache)) {
        $cache[$counter++] = fgets($FHcache,4096);
      }
      $protection = $counter * 100;
      
      while ( ($xacc = $cache[rand(0,$counter - 1)]) == $acc) {
	if (! $protection--)  {break;}
      }
      if ($xacc == "") {$xacc = $acc;   }
      
    $FHerror = fopen("config::log_file","a");
    fputs($FHerror,"PHP: Orig acc:$acc new:$xacc\n");
    fclose($FHerror);


  }
  else {
  
      $FHerror = fopen("config::log_file","a");
    fputs($FHerror,"PHP: Cache error\n");
    fclose($FHerror);

  
  
    $xacc = $acc;
  }
}
else {

    $FHerror = fopen("config::log_file","a");
    fputs($FHerror,"PHP: frag 2 . normal\n");
    fclose($FHerror);


    $xacc = $acc;
}
//  preg_replace("/\W/","\\",$xacc,-1);
  $accc = array();
  if (preg_match( "/\w*/","$xacc",$accc)) {
    $xacc = $accc[0];
  }
  
  $dbm = dba_open("config::account_database","r","gdbm");
  $data = dba_fetch($xacc,$dbm);
  dba_close($dbm);
  
    $FHerror = fopen("config::log_file","a");
    fputs($FHerror,"PHP: acc: >$xacc< data: >$data< \n");
    fclose($FHerror);
  
  
  $dataX = preg_split("/\|/",$data);
  $linkX = $dataX[var::phpIndex];
  return $linkX;
}

?>
%ANTILOOP_2_FRAGMENT_E%


%ANTILOOP_3_FRAGMENT_B%
<?php
function getUrl($acc,$id) {
umask(0);
  $dbm = dba_open("config::account_database","r","gdbm");
  $data = dba_fetch($acc,$dbm);
  dba_close($dbm);
  $dataX = preg_split("/\|/",$data);
  $linkX = $dataX[var::phpIndex2];

    $FHerror = fopen("config::log_file","a");
    fputs($FHerror,"PHP: Used fragment 3\n");
    fclose($FHerror);

  
  return $linkX;
}
?>
%ANTILOOP_3_FRAGMENT_E%
#%EOF%#
#%Dir: ./temp%#
#%Dir: ./temps%#
#%Dir: ./temps/defaults%#
#%File: ./temps/defaults/_acc_view.html%#
<html>
<head>
<title>Account View (#%toplistID%#)</title>
<link rel="stylesheet" href="%#TL_URL#%/main.css""" type="text/css">  
<script src="%#TL_URL#%/main.js"""></script>
</head>

<body onLoad="autoFocus();" leftmargin="0" topmargin="0" marginwidth="0" marginheight="0">
<table width="100%" border="0" cellpadding="0" cellspacing="0">
<tr  class="mainTitle">
<td> 
<center>
Display #%INFO_INTERVAL%# of #%INFO_TYPE%# members by #%INFO_BY%#  (#%toplistID%#) 
</center>
</td>
</tr>
<tr  class="infoText"> 
<td  > <a href="#%INFO_LINKNEXT%#"></a> 
<table  border="0" align="center" width="80%" cellpadding="0" cellspacing="0">
<tr class="infoText"> 
<td>
Numbers in <font color="#990000">red</font> are real IN/OUT<br>
Numbers in Textfields are multiplied by Hit Ratio ( IN/OUT ) <br>

Hit ratio 2:6 multiply IN hits 2x and OUT hits 6x<br>

You Can use numbers such as 1.5 : 2.6 
</td>
<td width="30%">
<table width="100%" border="0" cellspacing="0" cellpadding="0" align="center">
<tr> 
<td width="51%"> 
<div align="center"><a href="#%INFO_LINKBACK%#">Back To Admin</a></div>
</td>
</tr>
<tr>
<td width="51%">&nbsp;</td>
</tr>
<tr> 
<td width="51%"> 
<div align="center"><a href="#%INFO_LINKNEXT%#">Next Page</a></div>
</td>
</tr>
</table>
</td>
<td>If account is suspended it will not be listed !<br>
If account is Locked user cannot log in !<br>
If account is frozen hits IN/OUT are not changing (frozen)!<br>
Active / Inactive is number of resets account is 
Inactive or Active</td>
</tr>
</table>
</td>
</tr>
</table>


#%ACC_VIEW_BEGIN%# 

<table width="100%" border="0"  cellpadding="5" >
<form method="post" action="_#ADMIN_CGI#_" name ="%#FORM_NAME#%">

<tr><td colspan="5">

  <table border="0" cellspacing="0">
  <tr><td class="accViewTitleX">#%VAL_POSITION%#&nbsp;-&nbsp;</td>
  <td class="accViewTitleX">#%VAL_ACC%#</td></tr>
  </table>
</tr>
    <tr align="left" valign="top" >
      <input type="hidden" name="fieldAcc" value="#%VAL_ACC%#">
<input type="hidden" name="action" value="_#ACC_VIEW_EXE#_">

#%INPUT_VARIABLES%#

      <td  class="accViewValName" height="96" width="29%">
        <table border = "0" width ="100%"  cellspacing="0" cellpadding="0"   >
          <tr>
            <td class="accViewValName"> Site Title </td>
            <td align ="right"> <A class="help" onClick="javascript:showHelp('accview','title')">[Help]</A></td>
          </tr>
          <tr>
            <td class="accViewValName" colspan="2">
              <INPUT class="inputValue" type="text" name="fieldTitle" value="#%VAL_TITLE%#" size="50" onChange="regIt(this)" tabindex="1">
            </td>
          </tr>
          <tr>
            <td class="accViewValName">Site description </td>
            <td class="accViewValName" align="right"><a class="help" onClick="showHelp('accview','descr')">[Help]</a></td>
          </tr>
          <tr>
            <td class="accViewValName" colspan="2" height="18">
              <INPUT class="inputValue"  type="text" name="fieldDescr" size="50" value="#%VAL_DESCR%#" onChange="regIt(this)" tabindex="2">
            </td>
          </tr>
        </table>
      </td>
      <td class="accViewValName" height="96" width="48%" > 
        <table border="0" cellpadding="0" cellspacing="0" width="100%">
          <tr> 
            <td><a class="accViewValName" href="mailto:#%VAL_MAIL%#">Email</a></td>
            <td align="right"><a class="help" onClick="showHelp('accview','email')">[Help]</a></td>
          </tr>
          <tr> 
            <td colspan="2"> 
              <INPUT class="inputValue"  type="text" name="fieldMail" value = "#%VAL_MAIL%#" size="36"  onChange="javascript:checkInput_email(this,1);regIt(this);" tabindex="11">
            </td>
          </tr>
          <tr> 
            <td class="accViewValName">Password</td>
            <td align="right"><a class="help" onClick="showHelp('accview','pwd')">[Help]</a></td>
          </tr>
          <tr> 
            <td colspan="2"> 
              <INPUT class="inputValue"  type="text" name="fieldPWD" size="36" value="#%VAL_PWD%#" onChange="regIt(this)" tabindex="12">
            </td>
          </tr>
        </table>
      </td>
      <td class="accViewValName" height="96" width="23%" > 
        <table width="100%" cellspacing="0" cellpadding="0" ding>
          <tr> 
            <td class="accViewValName" width="54%"> 
              <INPUT class="inputValue"  type="checkbox" name="fieldSuspend" value="1" #%VAL_SUSPEND%# onChange="regIt(this)" tabindex="16">
              &nbsp;&nbsp;Suspended </td>
            <td align="right" width="46%"> <a class="help" onClick="showHelp('accview','susp_lock_free_new')">[Help]</a> 
            </td>
          </tr>
          <tr> 
            <td class="accViewValName" colspan="2"> 
              <INPUT class="inputValue" type="checkbox" name="fieldLock" value="1" #%VAL_LOCK%# onChange="regIt(this)" tabindex="17"> 
              &nbsp;&nbsp;Locked </td>
          </tr>
          <tr> 
            <td class="accViewValName" colspan="2" height="21"> 
              <INPUT class="accViewValue" type="checkbox" name="fieldFreeze" value="1" #%VAL_FREEZE%# onChange="regIt(this)" tabindex="18">
              &nbsp;&nbsp;Frozen </td>
          </tr>
          <tr>
            <td class="accViewValName" width="54%">
              <INPUT class="inputValue" type="checkbox" name="fieldNew" value="1" #%VAL_NEW%# onChange="regIt(this)" tabindex="19"> 
              &nbsp;&nbsp;New </td>
            <td class="accViewValName" width="46%">
              <INPUT class="accViewValue" type="checkbox" name="fieldModif" value="2" #%VAL_MODIF%# onChange="regIt(this)" tabindex="20">
              &nbsp;&nbsp;Modified</td>
          </tr>
        </table>
      </td>
</tr>

    <tr align="left" valign="top"> 
      <td class="accViewValName" width="29%" > 
        <table border = "0" width ="100%"  cellspacing="0" cellpadding="0"   ><tr>
            <td class="accViewValName"> <a class="accViewValName" href="#%VAL_WEBLINK%#" target="_blank">Primary 
URL</a> </td>
            <td align ="right">
<A class="help" onClick="showHelp('accview','linkurl')">[Help]</A>
	    </td></tr>
	</table>
        <INPUT class="inputValue"  type="text" name="fieldWebLink" value="#%VAL_WEBLINK%#" size="50" onChange="checkInput_http(this,1,1);regIt(this)" tabindex="3">
        <table border = "0" width ="100%"  cellspacing="0" cellpadding="0">
          <tr>
            <td class="accViewValName"> <a class="accViewValName"   href="#%VAL_WEB2LINK%#" target="_blank">Secondary 
URL</a> </td>
            <td align ="right"> <a class="help" onClick="showHelp('accview','linkurl')">[Help]</a> 
            </td>
          </tr>
        </table>
        <INPUT class="inputValue"  type="text" name="fieldWeb2Link" value="#%VAL_WEB2LINK%#" size="50" onChange="checkInput_http(this,1);regIt(this)" tabindex="4">
        <table border="0" cellspacing="0" cellpadding="0" width="100%">
          <tr > 
            <td class="accViewValName"> <A class="accViewValName"  HREF = "javascript:openBanner('#%VAL_BANNER%#');">Banner 
URL</A></td>
            <td class="accViewValName" align="right"><a class="help" onClick="showHelp('accview','banner')">[Help]</a></td>
            <td class="accViewValName">Height</td>
            <td class="accViewValName">Width</td>
          </tr>
          <tr> 
            <td colspan="2" > 
              <INPUT class="inputValue"  type="text" name="fieldBanner" value="#%VAL_BANNER%#" size="36" onChange="checkInput_http(this,1);regIt(this)" tabindex="5">
            </td>
            <td> 
              <INPUT class="inputValue" type="text" name="fieldHBanner" value="#%VAL_BANNERH%#" size="2" onChange="checkInput_nr(this,0,1);regIt(this)" tabindex="6"> 
            </td>
            <td> 
              <INPUT class="inputValue"  type="text" name="fieldWBanner" value="#%VAL_BANNERW%#" size="2" onChange="checkInput_nr(this,0,1);regIt(this)" tabindex="7"> 
            </td>
          </tr>
          <tr> 
            <td class="accViewValName"> <A class="accViewValName"  HREF = "javascript:openBanner('#%VAL_SAMPLE%#');">Sample URL</A></td>
            <td class="accViewValName" align="right"><a class="help" onClick="showHelp('accview','sample')">[Help]</a></td>
            <td class="accViewValName">Height</td>
            <td class="accViewValName">Width</td>
          </tr>
          <tr> 
	    <td colspan="2"> 
              <INPUT class="inputValue"  type="text" name="fieldSample" value="#%VAL_SAMPLE%#" size="36" onChange="checkInput_http(this,1);regIt(this)" tabindex="8">  
            </td>
            <td> 
              <INPUT class="inputValue" type="text" name="fieldHSample" size="2"  value="#%VAL_SAMPLEH%#" onChange="checkInput_nr(this,0,1);regIt(this)" tabindex="9"> 
            </td>
            <td> 
              <INPUT class="inputValue" type="text" name="fieldWSample" size="2"  value="#%VAL_SAMPLEW%#" onChange="checkInput_nr(this,0,1);regIt(this)" tabindex="10">
            </td>
          </tr>
        </table>
</td>
      <td  class="accViewValStat" > 
        <table border="0" width ="100%" cellspacing="0" cellpadding="0">
          <tr> 
	    <td class="accViewValStat" valign="top" > 
              <table border="0" cellpadding="0" cellspacing="0">
                <tr > 
                  <td class="accViewValStat" colspan="2" ><b>Reset Related Data</b></td>
	        </tr>
                <tr> 
                  <td class="accViewValStat" colspan="2">IN/OUT Ratio:&nbsp;&nbsp;<b>#%RATIO_IO%#</b></td>
                </tr>
                <tr> 
                  <td class="accViewValStat">Prod. IN <b>[#%REAL_IN%#]</b>:</td>
                  <td class="accViewValStat"> 
                    <INPUT class="accViewValueStat" type="text" name="fieldIn" value="#%VAL_IN%#" size="3"  onChange="checkInput_nr(this,1,1);regIt(this)" tabindex="13">
                  </td>
                </tr>
                <tr> 
                  <td class="accViewValStat">OUT <b>[#%REAL_OUT%#]</b>:</td>
                  <td class="accViewValStat"> 
                  <INPUT  class="accViewValueStat" type="text" name="fieldOut" value="#%VAL_OUT%#"  size="3" onChange="checkInput_nr(this,1,1);regIt(this)" tabindex="14">
                  </td>
                </tr>
                <tr> 
                  <td class="accViewValStat" colspan="2" ><br>
                  <a class="help" onClick="showHelp('accview','stat')">[Help]</a>
                  </td>
                </tr>
              </table>
            </td>
            <td class="accViewValStat" valign="top" width="2%">&nbsp;</td>
            <td class="accViewValStat" valign="top" width="61%"> 
              <table border="0" cellpadding="0" cellspacing="0">
                <tr> 
                  <td colspan="2" class="accViewValStat"> <b>Total Sum Data</b>	
                  </td>
                </tr>
                <tr> 
                  <td class="accViewValStat">Real IN:&nbsp;</td>
                  <td class="accViewValStat"><b>[#%REAL_REAL_IN%#]</b></td>
                </tr>
                <tr> 
                  <td class="accViewValStat"> Prod. NB IN:&nbsp;</td>
                  <td class="accViewValStat"><b>[#%REAL_NOTBOT_IN%#]</b></td>
                </tr>
                <tr> 
                  <td class="accViewValStat"> Prod. IN:&nbsp;</td>
                  <td class="accViewValStat"><b>[#%REAL_TIN%#]</b></td>
                </tr>
                <!-- <input class="accViewValue" type="text" name="fieldTin" value="#%VAL_TIN%#"  size="5" maxlength="5">-->
                <tr> 
                  <td class="accViewValStat">Out:&nbsp;</td>
                  <td class="accViewValStat"><b>[#%REAL_TOUT%#]</b></td>
                </tr>
                <!--<input class="accViewValue"  type="text" name="fieldTout" value="#%VAL_TOUT%#"  size="5" maxlength="5">-->
                <tr> 
                  <td class="accViewValStat"> Gen. OUT:&nbsp;</td>
                  <td class="accViewValStat"><b>[#%REAL_GEN_OUT%#]</b></td>
                </tr>
              </table>
          </td>
          </tr>
	  <tr><td colspan="3">
              Hit Ratio: <INPUT  class="accViewValueStat" type="text" name="fieldRatio"  value="#%VAL_RATIO%#"  size="2" onChange="checkInput_ratio(this,1);regIt(this)" tabindex="15"><br>
              Join Date: #%VAL_REGDATE%#
        </td></tr>
        </table>

      </td>

      <td  class="accViewValName" > 

        <table width="100%" border="0"  cellpadding="0" cellspacing="0">

          <tr> 

            <td class="accViewValName" width="79%" align="left" valign="top"> 

              <!--<input   type="radio" name="radiobutton" value="save">Save&nbsp;changes<br>

		<input type="radio" name="radiobutton" value="delete">Delete&nbsp;Account<br>

		<input type="radio" name="radiobutton" value="mail">Send&nbsp;E-MAIL<br><br>

		<input type="submit" name="submit" value="Execute"> -->

              +/- activity for 

              <INPUT  class="accViewValue" type="text" name="fieldActivity" value = "#%VAL_ACTIVITY%#"size="1" onChange="checkInput_nr(this,1,1);regIt(this)" tabindex="21">

              Resets </td>

            <td class="accViewValName" align="right" valign="top" width="21%" ><a class="help" onClick="showHelp('accview','act_inact')">[Help]</a></td>

          </tr>

          <tr> 

            <td class="accViewValName" colspan="2" height="124"> <br>

              Extra info [ICQ , Phone, ...] 

              <TEXTAREA class="inputValue" name="fieldInfo" rows="4" cols="45" onChange="regIt(this)" tabindex="22">#%VAL_INFO%#</textarea>

            </td>

          </tr>

          <tr> 

            <td class="accViewValName" colspan="2" ></td>

          </tr>

          <tr> 

            <td  valign="bottom" colspan="2"> 

              <table border ="0" cellspacing="0" width="100%" height="100%">

                <tr valign="bottom"> 

                  <td height="12"> 

		    <input  class="inputValue"  type="hidden" name="buttontype" value="">

                    <input  class="inputValue"  type="button" name="radiobutton" value="save" onClick="if (regIt(this)) {checkBefore(this);}" tabindex="23">

                  </td>

                  <td height="12"> 

                    <input   class="inputValue"  type="button" name="radiobutton" value="mail"  onClick="justPass(this)"   tabindex="24">

                  </td>

                  <td height="12">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>

                  <td height="12">
                    <input  class="inputValue"  type="button" name="radiobutton" value="delete" tabindex="25" onClick="confirmIt(this)">

                  </td>

                  <td align="right" valign="top" height="12" > <a class="help" onClick="showHelp('accview','buttons')">[Help]</a>
                  </td>

                </tr>

              </table>

            </td>

          </tr>

        </table>

      </td>

</tr>

</form>

</table>

#%ACC_VIEW_END%# 

<table width="100%" border="0" cellspacing="0" cellpadding="0">

<tr> 

<td width="50%"><div align="left"> <a href="#%INFO_LINKBACK%#">&nbsp;&nbsp;Back To Admin</a></div></td>

<td width="50%"><div align="right"><a href="#%INFO_LINKNEXT%#">Next</a></div></td>

</tr>

</table>





</body>

</html>

#%EOF%#
#%File: ./temps/defaults/_acc_view_mail.html%#
<html>
<head>
<title>Account View Mail (#%toplistID%#)</title>
<link rel="stylesheet" href="%#TL_URL#%/main.css""" type="text/css">

<script src="%#TL_URL#%/main.js"""></script>
</head>
<body onLoad="autoFocus();" leftmargin="0" topmargin="0" marginwidth="0" marginheight="0">
<form method="get" action="_#ADMIN_CGI#_">
<table width="800" border="0" cellspacing="1" cellpadding="5" align="center">
<tr > 
<td  class="mainTitle">  
<center>
Account View Mailer (#%toplistID%#)
</center>
</td>
</tr>

<tr>
<td class="accViewValName"> 
To: #%MAIL_TO%#<BR><BR>
Subject<BR>
<input  class="accViewValue"  type="text" name="fieldSubject" value="" size="100">
<BR>
<textarea  class="accViewValue"  name="fieldBody" cols="100" rows="20"></textarea>
</td>
</tr>

<tr>
<td class="accViewValName"> 
<input type="hidden" name="account" value="#%VAL_ACC%#">
#%ACC_VIEW_VARS%#
<input type="hidden" name="action" value="_#ACC_VIEW_MAIL#_">
<input type="hidden" name="acc" value="#%ACCOUNT_NAME%#">
<input type="submit" name="sendmail" value="Send e-Mail">

</td>
</tr>
</table>
</form>
</body>
</html>#%EOF%#
#%File: ./temps/defaults/_account_form.html%#
<html>
<head>
<title>EDIT YOUR SITE INFO</title>

<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<script src="%#TL_URL#%/main.js"">
</script>
<!--
<link rel="stylesheet" href="%#TL_URL#%/main.css"" type="text/css">
-->
<style type="text/css">
/* !!! DON'T REMOVE THESE COMMENTS !!!*/
/* !!! ONE CLASS, ONE ROW !!!*/
/* #CUSTOM_STYLE# */
.subTitle { font-family: Arial;font-size: 14pt;color: #DDDDFF;font-weight: 700; }
body { background-color: #AAAAEE; }
.inputValue { font-weight: 900;font-family: Arial;color: #555555;background-color: #AAAAEE;font-size: 15pt; }
.choose { font-weight: 900;font-size: 16pt;font-family: Arial;color: #DDDDFF; }
.infoText { font-family: Arial;font-size: 12pt;color: #FFDDFF;font-weight: 900; }
.fieldLabel { font-size: 14pt;color: #DDDDFF;font-weight: 900;font-family: Arial; }
.mainTitle { color: #DDDDFF;font-size: 16pt;font-weight: 900;font-family: Arial; }
.help { font-size: 14pt;font-weight: 900;font-family: Arial;color: #DDDDFF; }
.error { color: #BB0000;font-weight: 900;font-family: Arial;font-size: 14pt; }
/* #END# */
/* #HARD_ADDED_STYLE# */
.button {color: #000000; text-decoration: none;}
.myClass {color: #ff0000; }
/* #END# */
</style>
</head>
<body class="accadd" onLoad="autoFocus();">
<form method="GET" action="#%ACC_CGI%#" >
<!-- ENDINTROPART -->
<table border ="0" cellspacing="4" cellpadding="4"   width="50%">
<tr><td colspan="2">
<div class="mainTitle">Account #%TYPE%# Form </div>
</td>
</tr>
<!-- ENDALLPART -->


<!-- BEGINAUTH -->

    <tr> 
      <td class="fieldLabel" >Account Name<div class="infoText">(Enter account name to edit)</div></td>
      <td ><input  class="inputValue" type="text" name="fieldAcc" size="20"></td>
      <td><A class="help" onClick="showHelp('accauth','accname')">[Help]</A> </td>
    </tr>
    <tr> 
      <td class="fieldLabel">Password <div class="infoText">(Enter password)</div>    </td>
      <td ><input class="inputValue" type="text" name="fieldPWD" size="20"></td>
      <td><A class="help" onClick="showHelp('accauth','pwd')">[Help]</A> </td>      
      </tr>
<!-- ENDAUTH -->

<!-- BEGINCHOOSE -->
<table border ="0" cellspacing="4" cellpadding="4"   width="50%">
<tr><td colspan="2">
<div class="mainTitle">Account Choose Form </div>
<div class="myClass">You can edit this cover page in Toplist Admin and also specify own CSS classes like this one</div>
</td>
</tr>

    <tr>
    <td colspan="2" class="fieldLabel" > </td>
    </tr>
    <tr>
    <td colspan="2" class="fieldLabel" >Choose Operation<br></td>
    </tr>
    <tr>
    <td colspan="2" class="fieldLabel" ><A class="choose" HREF = "#%ENTER_ADD_ADD%#">Add New Account</a></td>
    </tr>
    <tr>
    <td colspan="2" class="fieldLabel" ><A class="choose" HREF = "#%ENTER_ADD_MODIF%#">Modify Account</a></td>
    </tr>
    <tr>
      <td colspan="2" class="fieldLabel" >
      <form method="GET" action = "#%ACC_CGI%#">
      <table border="0" class="noBorder">
      <tr>
      <td colspan="3" class="fieldLabel">
        Forgot password? Fill up this form -> passowrd will be sent to your e-mail
      </td>
      </tr>      
      <tr>
        <td class="fieldLabel">Enter account name</td>
	<td>
	<input type="text" name="fieldACC" class="inputValue" tabindex="10"></td>
	<input type="hidden" name="action" value="pwdForgot">	
	<td><input type="submit"  class="inputValue" name="pwdForgot" value="Send" tabindex="15"></td>
      </tr>
      <tr><td>  </td>     </tr>
      </form>      
      <tr>
      <td colspan="3" class="fieldLabel" >
      <form method="GET" action = "#%ACC_CGI%#">
        Send me all accounts + passwords linked to e-mail:
      </td>
      </tr>      
      <tr>
        <td class="fieldLabel">Enter e-mail name</td>
	<td><input type="text"  name="fieldEMAIL" class="inputValue"  tabindex="20"></td>
	<input type="hidden" name="action" value="emailAccs">
	<td><input type="submit"  class="inputValue" name="emailAccs" value="Send" tabindex="25"></td>
      </tr>
      </table>
      </form>      
      </td>
    </tr>
<!-- ENDCHOOSE -->

<!-- BEGINERROR -->
<tr> <td> 
<div class="fieldLabel">Some errors occured ! <BR>
Error list: <BR>
<div class="error">
%#ERRORWHERE#%
</div>
<BR>
<BR>
Press BACK and correct data !
</div>
</td>
</tr>
<!-- ENDERROR -->

<!-- BEGINVERIFY -->
<tr> <td> 
<div class="fieldLabel">Account Name </div>
<div class="infoText">(Enter the account name)</div>
<input class="inputValue" type="text" name="fieldAcc" value="#%VALUE%#" size="20">
</td>
<td>
<A class="help" onClick="showHelp('accadd','verifaccname')">[Help]</A>
</td>
</tr>
<tr> <td> 
<div class="fieldLabel">ID </div>
<div class="infoText">(Enter id obtained by e-mail)</div>
<input class="inputValue" type="text" name="fieldID" value="#%VALUE%#"  size="20">
</td>
<td>
<A class="help" onClick="showHelp('accadd','verifid')">[Help]</A>
</td>
</tr>
<!-- ENDVERIFY -->

<!-- BEGINVERMAIL -->
<tr> <td> 
<div class="fieldLabel">Account Name </div>
<div class="infoText">(Enter the account name)</div>
<input class="inputValue" type="text" name="fieldAcc" value="#%VALUE%#" size="20">
</td>
<td>
<A class="help" onClick="showHelp('accadd','accname')">[Help]</A>
</td>
</tr>
<tr> <td> 
<div class="fieldLabel">Password </div>
<div class="infoText">(Enter and remember password)</div>
<input class="inputValue" type="text" name="fieldPWD" value="#%VALUE%#"  size="20">
</td>
<td>
<A class="help" onClick="javascript:showHelp('accadd','pwd')">[Help]</A>
</td>
</tr>

<tr> <td> 
<div class="fieldLabel">RePassword </div>
<div class="infoText">(Enter and remember password)</div>
<input class="inputValue"  type="text" name="fieldRPWD" value="#%VALUE%#"  size="20">
</td>
<td>
<A class="help" onClick="javascript:showHelp('accadd','pwd')">[Help]</A>
</td>
</tr>

<tr> <td> 
<div class="fieldLabel">Email Adress </div>
<div class="infoText">(Enter your e-mail address)</div>
<input class="inputValue"  type="text" name="fieldMail" value="#%VALUE%#" size="20">
</td>
<td>
<A class="help" onClick="javascript:showHelp('accadd','email')">[Help]</A>
</td>
</tr>
<!-- ENDVERMAIL -->

<!-- BEGINDETAILSECTION -->
<tr> <td> 
<div class="fieldLabel">Account Name </div>
<div class="infoText">(Enter the account name)</div>
<input class="inputValue" type="text" name="fieldAcc" value="#%VALUE%#" size="20" onFocus="nextFocus(this);">
</td>
<td>
<A class="help" onClick="showHelp('accadd','accname')">[Help]</A>
</td>
</tr>

<tr> <td>
<div class="fieldLabel">Site Title</div>
<div class="infoText">(Enter the string which will be displayed in TL rank)</div>
<input class="inputValue" type="text" name="fieldTitle" value="#%VALUE%#" size="20">
</td>
<td>
<A class="help" onClick="showHelp('accadd','title')">[Help]</A>
</td>
</tr>

<tr> <td> 
<div class="fieldLabel">Site Description</div>
<div class="infoText">(Enter the string which will be displayed in TL rank)</div>
<input class="inputValue" type="text" name="fieldDescr" value="#%VALUE%#" size="20">
</td>
<td>
<A class="help" onClick="showHelp('accadd','descr')">[Help]</A>
</td>
</tr>

<tr> <td> 
<div class="fieldLabel">Primary URL</div>
<div class="infoText">(Enter the URL where the traffic will be forwarded)</div>
<input class="inputValue" type="text" name="fieldWebLink" value="#%VALUE%#"  size="20">
</td>
<td>
<A class="help" onClick="showHelp('accadd','linkurl')">[Help]</A>
</td>
</tr>

<tr> <td> 
<div class="fieldLabel">Secondary URL</div>
<div class="infoText">(Enter the alternative URL where the traffic will be forwarded)</div>
<input class="inputValue" type="text" name="fieldWeb2Link" value="#%VALUE%#"  size="20">
</td>
<td>
<A class="help" onClick="showHelp('accadd','seclinkurl')">[Help]</A>
</td>
</tr>

<tr> <td> 
<div class="fieldLabel">Banner URL</div>
<div class="infoText">(Enter the banner's URL)</div>
<input class="inputValue"  type="text" name="fieldBanner"  value="#%VALUE%#"  size="20">
</td>
<td>
<A class="help" onClick="showHelp('accadd','bannerurl')">[Help]</A>
</td>
</tr>

<tr> <td> 
<div class="fieldLabel">Banner Width/Height </div>
<div class="infoText">(Enter the banner's width/height)</div>
<input class="inputValue"  type="text" name="fieldWBanner"  value="#%VALUE%#"  size="3">
<input  class="inputValue" type="text" name="fieldHBanner"  value="#%VALUE%#"  size="3">
</td>
<td>
<A class="help" onClick="showHelp('accadd','bannerWH')">[Help]</A>
</td>
</tr>

<tr> <td> 
<div  class="fieldLabel">Sample URL</div>
<div class="infoText">(Enter the sample's URL)</div>
<input  class="inputValue" type="text" name="fieldSample"  value="#%VALUE%#"  size="20">
</td>
<td>
<A class="help" onClick="showHelp('accadd','sampleurl')">[Help]</A>
</td>
</tr>

<tr> <td> 
<div class="fieldLabel">Sample Width/Height</div>
<div class="infoText">(Enter the sample's width/height)</div>
<input  class="inputValue" type="text" name="fieldWSample"  value="#%VALUE%#"  size="3">
<input  class="inputValue" type="text" name="fieldHSample"  value="#%VALUE%#"  size="3">
</td>
<td>
<A class="help" onClick="showHelp('accadd','sampleWH')">[Help]</A>
</td>
</tr>

<tr> <td> 
<div  class="fieldLabel">Info [phone, ICQ, ...]</div>
<div class="infoText">(Enter some additional info)</div>
<textarea  class="inputValue"  name="fieldInfo" rows="4" cols="45">#%VALUE%#</textarea>
</td>
<td>
<A class="help" onClick="showHelp('accadd','info')">[Help]</A>
</td>
</tr>

<!-- ENDDETAILSECTION -->

<!-- BEGINPWDCHANGE -->
<tr> <td> 
<div class="fieldLabel">Password </div>
<div class="infoText">(Enter and remember password)</div>
<input class="inputValue" type="password" name="fieldPWD" value="#%VALUE%#"  size="20">
</td>
<td>
<A class="help" onClick="showHelp('accmodif','pwd')">[Help]</A>
</td>
</tr>


<tr> <td> 
<div class="fieldLabel">RePassword </div>
<div class="infoText">(Enter and remember password)</div>
<input class="inputValue"  type="password" name="fieldRPWD" value="#%VALUE%#"  size="20">
</td>
<td>
<A class="help" onClick="showHelp('accmodif','pwd')">[Help]</A>
</td>
</tr>
<!-- ENDPWDCHANGE -->

<!-- BEGINALLPART -->
<tr> <td colspan="2"> 
<input type="hidden" name="action" value="#%HIDDEN_VALUE%#">
<input type="submit" name="save" value="#%SUBMIT_SAVE%#">
<!-- <input type="submit" name=#%SUBMIT_CHPWD%# value="Change Password"> -->
</td>
</tr>
</table>
</form>
</body>
</html>#%EOF%#
#%File: ./temps/defaults/_admin_acc.html%#
<html>
<head>
<title>Add Accounts</title>

<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<script src="%#TL_URL#%/main.js"""></script>
<link rel="stylesheet" href="%#TL_URL#%/main.css""" type="text/css">

</head>
<body class="accaddadmin" onLoad="autoFocus();">

<center>
Fill In All Necessary Fields and Click the Button to Save
<form method="POST" action="#%ACCADD_CGI%#">

<table border ="0" cellspacing="2" cellpadding="1" class="noBorder"  >
<tr>
<td colspan ="8">
<input type="hidden" name="action" value="#%ACCADDSAVE%#" >
<input type="hidden" name="buttontype" value="" >
<input class="inputValue"  type="button" name="save" onClick="checkBefore(this)"  value="SaveAll Accounts">
<!-- <input type="submit" name=#%SUBMIT_CHPWD%# value="Change Password"> -->
<a name="top"></a></td>
</tr>
<!-- BEGINDETAILSECTION -->
<tr>
<td> <span class="fieldLabel">Account Name</span></td>
<td>
  <input class="inputValue" type="text" name="fieldAcc" value="" size="20" onChange="checkInput_null(this,1,1)" tabindex="1">
</td><td>  <A class="help" onClick="javascript:showHelp('accview','accname')">[?]</A></td>



<td> <span class="fieldLabel">Primary URL</span></td>
<td>
<input class="inputValue" type="text" name="fieldWebLink" value="http://"  size="20" onChange="checkInput_http(this,1,1)" tabindex="7">
</td><td><A class="help" onClick="javascript:showHelp('accview','linkurl')">[?]</A></td>



<td>
<input type="checkbox" class="inputValue"  name="fieldSuspend" value="1" #%VAL_FREEZE%# tabindex="16">
<span class="fieldLabel">&nbsp;&nbsp;Suspend</span></td>

<td>
<A class="help" onClick="javascript:showHelp('accview','susp_lock_free_new')">[?]</A>
</td>
</tr>

<tr>

<td> <span class="fieldLabel">Email Adress</span></td>
<td>
  <input class="inputValue"  type="text" name="fieldMail" value="@" size="20" onChange="checkInput_email(this,1)" tabindex="2">
</td><td>  <A class="help" onClick="javascript:showHelp('accview','email')">[?]</A></td>


<td> <span class="fieldLabel">Secondary URL</span></td>
<td>
<input class="inputValue" type="text" name="fieldSecWebLink" value="http://"  size="20" onChange="checkInput_http(this,1)" tabindex="8">
</td><td><A class="help" onClick="javascript:showHelp('accview','seclinkurl')">[?]</A></td>


<td>
<input type="checkbox" class="inputValue"  name="fieldLock" value="1" #%VAL_FREEZE%# tabindex="17">
<span class="fieldLabel">&nbsp;&nbsp;Lock</span></td>

<td>
<A class="help" onClick="javascript:showHelp('accview','susp_lock_free_new')">[?]</A>
</td>

</tr>





<tr> 
<td> <span class="fieldLabel">Password</span></td>
<td>
<input class="inputValue" type="text" name="fieldPWD" value=""  size="20" onChange="checkInput_null(this,0,1)" tabindex="3">
</td><td><A class="help" onClick="javascript:showHelp('accview','pwd')">[?]</A></td>

<td> <span class="fieldLabel">Banner URL</span></td>
<td>
<input class="inputValue"  type="text" name="fieldBanner"  value="http://"  size="20" onChange="checkInput_http(this,1)" tabindex="9">
</td><td><A class="help" onClick="javascript:showHelp('accview','bannerurl')">[?]</A></td>


<td>
<input type="checkbox" class="inputValue"  name="fieldFreeze" value="1" #%VAL_FREEZE%# tabindex="18">
<span class="fieldLabel">&nbsp;&nbsp;Frozen</span></td>


<td>
<A class="help" onClick="javascript:showHelp('accview','susp_lock_free_new')">[?]</A>
</td>
</tr>

<tr> 

<td> <span class="fieldLabel">RePassword</span></td>
<td>
<input class="inputValue"  type="text" name="fieldRPWD" value=""  size="20" onChange="checkInput_null(this,0,1)" tabindex="4">
</td><td><A class="help" onClick="javascript:showHelp('accview','repwd')">[?]</A></td>

<td> <span class="fieldLabel">Banner Width/Height</span></td>
<td>

<input class="inputValue"  type="text" name="fieldWBanner"  value=""  size="3" tabindex="10" onChange="checkInput_nr(this,2,1)">
<input  class="inputValue" type="text" name="fieldHBanner"  value=""  size="3" tabindex="11" onChange="checkInput_nr(this,2,1)">

</td><td></td>


<td>
<input type="checkbox"  class="inputValue"  name="fieldNew" value="1" #%VAL_NEW%# tabindex="19">
<span  class="fieldLabel">&nbsp;&nbsp;New</span></td>
<td>
<A class="help" onClick="javascript:showHelp('accview','susp_lock_free_new')">[?]</A>

</td>
</tr>
<tr> 
<td> <span class="fieldLabel">Site Title</span></td>
<td>
<input class="inputValue" type="text" name="fieldTitle" value="" size="20" tabindex="5">
</td><td><A class="help" onClick="javascript:showHelp('accview','title')">[?]</A></td>

<td> <span class="fieldLabel">Sample URL</span></td>
<td>

<input  class="inputValue" type="text" name="fieldSample"  value="http://"  size="20" onChange="checkInput_http(this,1)" tabindex="12">
</td><td><A class="help" onClick="javascript:showHelp('accview','sampleurl')">[?]</A></td>

<td>
<input class="inputValue" type="text" name="fieldRatio" value="var::defaultHitRatio" size="2" onChange="checkInput_ratio(this,1)" tabindex="20">
<span  class="fieldLabel">Hit Ratio</span></td>

<td>
<A class="help" onClick="javascript:showHelp('accview','ratio')">[?]</A>
</td>


</tr>



<tr> 
<td> <span class="fieldLabel">Site Description</span></td>
<td>
<input class="inputValue" type="text" name="fieldDescr" value="" size="20" tabindex="6">
</td><td><A class="help" onClick="javascript:showHelp('accview','descr')">[?]</A></td>

<td> <span class="fieldLabel">Sample Width/Height</span></td>
<td>
<input  class="inputValue" type="text" name="fieldWSample"  value=""  size="3" tabindex="13" onChange="checkInput_nr(this,2,1)">
<input  class="inputValue" type="text" name="fieldHSample"  value=""  size="3"tabindex="14" onChange="checkInput_nr(this,2,1)">
</td><td></td>


<td>
<input class="inputValue" type="text" name="fieldIn" value="var::inForNewAcc" size="2" onBlur="checkInput_nr(this,1,1)" tabindex="21" >
<span  class="fieldLabel">In</span>
<input class="inputValue" type="text" name="fieldOut" value="var::outForNewAcc"  size="2"  onBlur="checkInput_nr(this,1,1)" tabindex="22">
<span  class="fieldLabel">Out</span></td>

<td>
<A class="help" onClick="javascript:showHelp('accview','inout')">[?]</A>
</td>


</tr>

<tr>
<td colspan ="8"> 
<hr align="center">
</td>
</tr>
<!-- ENDDETAILSECTION -->



<!-- BEGINALLPART -->
<tr> 
<td colspan ="8"><a href="#top">BACK TO TOP</a></td>
</tr>
</table>
</form>
</center>
</body>

</html>
#%EOF%#
#%File: ./temps/defaults/_admin_auth.html%#
<html>
<head>
<title>Admin Authentification (#%toplistID%#)</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<script src="%#TL_URL#%/main.js"""></script>
<link rel="stylesheet" href="%#TL_URL#%/main.css""" type="text/css">

</head>

<body onLoad="window.document.forms[0].elements[0].focus();">
<table width="600" border="0" cellspacing="2" cellpadding="4"  align="center">
<tr > 
    
<td colspan="2"> 
<center>
<div class="mainTitle">Admin Authentification (#%toplistID%#)</div> 
</center>
    </td>
  </tr>

  <form method="post" action="_#ADMIN_CGI#_">
  <tr >
      
<td width="80" class="fieldLabel">Password 
<input class="inputValue"  type="password" name="fieldPWD" value="">
<input class="inputValue"  type="submit" name="display2" value="Login">
<input type="hidden" name="action" value="_#AUTH#_">
</td>
      
  </tr>
  
  </form>



</table>
</body>
</html>


#%EOF%#
#%File: ./temps/defaults/_admin_auth_failed.html%#
<html>
<head>
<title>Authentification Failed (#%toplistID%#)</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
</head>

<body bgcolor="#FFFFFF">
<table width="800" border="0" cellspacing="1" cellpadding="4" bgcolor="#330066" align="center">
  <tr bgcolor="#330066"> 
    <td colspan="2"> 
      <center>
        <b><font color="#FFFFFF">Authentification Failed (#%toplistID%#)</font></b> 
      </center>
    </td>
  </tr>

</table>
</body>
</html>


#%EOF%#
#%File: ./temps/defaults/_admin_main.html%#
<html>
<head>
<title>ADMIN AREA (#%toplistID%#)</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link rel="stylesheet" href="%#TL_URL#%/main.css""" type="text/css">
<script src="%#TL_URL#%/main.js"""></script>
</head>

<body onLoad="autoFocus();">
<table width="100%"  class="mainBorder" cellspacing="0" cellpadding="0"  align="center" >
<tr > 
<td > 
<table width="100%" class="mainBorder"  cellpadding="5" align="center"  >

<tr > 
<td valign="top" colspan="3"><table  cellspacing="0" cellpadding="0"><tr><td class="mainmenulink">Last action:&nbsp; </td><td class="mainmenulink">#%STATUS_VALUE%#</td></tr></table></td>
</tr>

<form method="get" action="_#ADMIN_CGI#_">
<tr> 
<td valign="top" > 
<input tabindex="1" class="inputValue"  onClick= "javascript:saveSetting()" type="submit" name="display" value="Display  " width = "80">
&nbsp; 
<input type="hidden" name="action" value="_%DISPLAY%_">
</td>
<td width="100%"> 
<input tabindex="2"  type="radio" name="chooseby" value="active" checked>
Active 
<input type="radio" name="chooseby" value="new" >
New 
<input type="radio" name="chooseby" value="modif" >
Modified 
<input type="radio" name="chooseby" value="inactive">
Inactive  
<input type="radio" name="chooseby" value="all">
All&nbsp;&nbsp; &nbsp;&nbsp;Members by 
<select tabindex="20" name="selby" class="inputValue">
<option value="in" selected>Hits In</option>
<option value="out">Hits Out</option>
<option value="tin">Total Hits In</option>
<option value="tout">Total Hits Out</option>
<option value="din">Hits In/Day</option>
<option value="win">Hits In/Week</option>
<option value="min">Hits In/Month</option>
<option value="dout">Hits Out/Day</option>
<option value="wout">Hits Out/Week</option>
<option value="mout">Hits Out/Month</option>
<option value="join">Date Joined</option>
<option value="user">Username</option>
<option value="inact">Inactivity</option>
<option value="mail">Mail Address</option>
<option value="mail">Cheat Ratio</option>
</select>
&nbsp;Per Page 
<select tabindex="30" name="perpage" class="inputValue">
<option value="all">All</option>
<option value="10" selected>10</option>
<option value="20">20</option>
<option value="40">40</option>
<option value="80">80</option>
<option value="100">100</option>
</select>
<br>
<input type="radio" name="chooseby" value="username">
Member with Username 
<input tabindex="40"  class="inputValue" onFocus="setFocus('username')" type="text" name="textuname" size="10" maxlength="20" >
(user ID)<span class="small">&nbsp;[Example xxx* or *xxx or *xxx* or xxx]</span>
</td>
<td>
<A class="help" onClick="showHelp('admin','display')">[Help]</A>
</td>
</tr>
</form>
<form method="get" action="_#ADMIN_CGI#_">
<tr class="mainmenu"> 
<td valign="top">
<input tabindex="50"  class="inputValue"  type="submit" name="edit" value="Edit       " width = "80">
<input type="hidden" name="action" value="_%EDIT%_">
</td>
<td width="100%">  
              <table width="37%"  cellpadding="0" cellspacing="0">
                <tr> 
                  <td width="66%"> 
                    <input tabindex="60"  type="radio" name="radiobuttonEdit" value="editHtml" checked>
                     HTML code for 
		  </td>
                  <td width="34%"><select tabindex="70"  onFocus="setFocus('editHtml')"  name="selectHtml" class="inputValue">
                    _#BselectHTML#_<option value=_#selectHtmlValue#_>_#selectHtmlDisplay#_</option>_#EselectHTML#_
                    </select>
		  </td>      
                </tr>
                <tr> 
                  <td width="66%"> 
                    <input type="radio" tabindex="80"  name="radiobuttonEdit" value="editBreaks">List breaks for
		  </td>
                  <td width="34%"><select  tabindex="90"  onFocus="setFocus('editBreaks')" class="inputValue" name="selectBreak">
		     _#BselectBREAK#_<option value=_#selectBreakValue#_>_#selectBreakDisplay#_</option>_#EselectBREAK#_
                    </select>
                  </td>
                </tr>
              </table>
	      
<input type="radio" name="radiobuttonEdit" value="editMails">
Edit Mail Templates<br>
<input type="radio" name="radiobuttonEdit" value="editWords">
Edit BlackList
<input type="radio" name="radiobuttonEdit" value="editIcons">
Edit Icons
<input type="radio" name="radiobuttonEdit" value="editAddForm">
Edit Add Form
</td>
<td>
<A class="help" onClick="showHelp('admin','edit')">[Help]</A>
</td>

</tr>
</form>
<form method="get" action="_#ADMIN_CGI#_">
<tr class="mainmenu" > 
<td  valign="top">
<input tabindex="100" class="inputValue" type="button" name="set2" value="Execute " width ="80" onClick="checkAdminExec(this)">
<input type="hidden" name="action" value="_#EXECUTE#_">
</td>
<td width="100%">
<input tabindex="110" type="radio" name="radiobutton" value="accadd" checked>
Add Account
<input type="radio" name="radiobutton" value="rerank" >
Rerank the List&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
<input type="radio" name="radiobutton" value="reset">
Reset the List<br>



<input type="radio" name="radiobutton" value="setratio" >
Set Hit Ratio 
<input tabindex="120" type="text"  onFocus="setFocus('setratio')"   name="fieldSetRatio" size="2" class="inputValue"  value="1:1" >
from 
<input tabindex="130" type="text" onFocus="setFocus('setratio')"  name="fieldSetRatioFrom" size="2" class="inputValue"   value="" >
to 
<input tabindex="140" type="text" onFocus="setFocus('setratio')"  name="fieldSetRatioTo" size="2" class="inputValue"  value="" >
Members<br>
<input type="radio" name="radiobutton" value="remove">
Remove Inactive Members for 
<input type="text" tabindex="141"  onFocus="setFocus('remove')"  name="fieldRemove" size="2" class="inputValue"  value="" >
or More Resets </td>
<td>
<A class="help" onClick="showHelp('admin','execute')">[Help]</A>
</td>

</tr>
</form>


<form method="post" action="_#ADMIN_CGI#_">
<tr class="mainmenu"> 
<td  valign="top">
<input tabindex="145"  class="inputValue"  type="submit" name="display2" value="Mail to   " width = 80>
<input type="hidden" name="action" value="_#MAILTO#_">
</td>
<td width="100%"> 
<table  cellspacing="0" cellpadding="0"  width="100%">

<tr class="mainmenu"> 
<td width="25%"> 
<table  cellspacing="0" cellpadding="0"  width="100%" >
<tr><td><input tabindex="146"  type="radio" name="rbMail" value="all">All</td></tr>
<tr><td><input type="radio" name="rbMail" value="inactiveAuto">Auto Inactive</td></tr>
<tr><td><input type="radio" name="rbMail" value="inactive">Deleted</td></tr>
<tr><td><input type="radio" name="rbMail" value="deleted">Inactive</td></tr>
<tr><td><input type="radio" name="rbMail" value="loadlist">Load list (hit mail to)</td></tr>
<tr><td><input type="radio" name="rbMail" value="list">Selected from the List</td></tr>
</table>
</td>
<td width="40%">
Subject&nbsp;<input tabindex="150"  class="inputValue" type="text" name="fieldSubject" size="29"><br>
<textarea tabindex="151"  class="inputValue" name="fieldBody" cols="40" rows="6"></textarea>
</td>


<td width="55%">
<select tabindex="155"  onFocus="setFocus('list')"  class="small" name="selectMailList" size="8" multiple>
	      _#BselectMList#_<option value=_#selectMListValue#_>_#selectMListDisplay#_</option>_#EselectMList#_
              </select>
</td>


</tr>
</table>
</td>
<td>
<A class="help" onClick="showHelp('admin','mailto')">[Help]</A>
</td>

</tr>
</form>

<!--
<form method="post" action="_#ADMIN_CGI#_">
<tr bgcolor="#FFCC99"> 
<td bgcolor="#FFCC99" valign="top"><b><font size="1"><i> 
<input type="submit" name="display2" value="Process" width = 80>
<input type="hidden" name="action" value="_#BACKUP#_">
</i></font></b></td>
<td bgcolor="#FFCC99" width="100%"> <b><font size="1"> 
<input type="radio" name="rbBackup" value="backup" checked>
Backup Toplist Data 
<input type="radio" name="rbBackup" value="restoreDatab" >
Restore Databases
<input type="radio" name="rbBackup" value="restoreTempl" >
Restore Templates
<input type="radio" name="rbBackup" value="pack" >
Pack TopList 
<input type="radio" name="rbBackup" value="import" >
Import Members from Autorank </font></b></td>
</tr>
</form>
-->

<!--
<form method="get" action="_#ADMIN_CGI#_">
<tr bgcolor="#FFCC99"> 
<td bgcolor="#FFCC99" valign="top"><b><font size="1"><i> 
<input type="submit" name="display2" value="Statistic" width = 80>
<input type="hidden" name="action" value="_#STATISTIC#_">
</i></font></b></td>

<td width="100%"> 
<table border="0" cellspacing="0" cellpadding="0" bgcolor="#330066" width="100%">
<tr bgcolor="#FFCC99"> 
<td bgcolor="#FFCC99"> <font size="1"> <b> 
No fully implemented yet. Now only Total Sum Date Statistic !!!
</td>
</tr>
</table>
</td>
</tr>
</form>






<form method="post" action="_#ADMIN_CGI#_">
<tr bgcolor="#FFCC99"> 
<td bgcolor="#FFCC99" valign="top" colspan="2"> 
<input type="submit" name="display2" value="Setup" width = 80>
<input type="hidden" name="action" value="_#SETUP#_">
</td>
</tr>
<tr> 


</td>
</tr>


</form>
-->


</table>



<TR>
<td class="infobox"  valign="top" colspan="2"   > 

<!-- STATUS -->
<table cellpadding="6"   width="100%" height="100">
        <tr>
          <td > 
<p class="infobox">
You are running&nbsp;#%STBAR_NAME%#&nbsp;#%STBAR_VERSION%# Latest avail. version:&nbsp;#%STBAR_NEWVER%# &nbsp;<a href="http://www.xxxscripts.net">!!! Donwload latest version here !!!</a><BR>

INs:&nbsp;#%STBAR_INCOUNT%#&nbsp;&nbsp;
NB INs:&nbsp;#%STBAR_CINCOUNT%#&nbsp;&nbsp;
Prod INs:&nbsp;#%STBAR_PINCOUNT%#&nbsp;&nbsp;
NB Prod INs:&nbsp;#%STBAR_CPINCOUNT%#&nbsp;&nbsp;
OUTs:&nbsp;#%STBAR_OUTCOUNT%#
Gener OUTs:&nbsp;#%STBAR_GOUTCOUNT%#
<BR>In system as user:&nbsp;#%STBAR_USR%#&nbsp;&nbsp;group:&nbsp;#%STBAR_GRP%#, Exec. by perl: #%STBAR_PERLVER%#<BR>
Logged in admin as:&nbsp;#%STBAR_ADMLOGIN%#&nbsp;&nbsp;Last login at:&nbsp;#%STBAR_LASTLOG%#<BR>
<BR>Last rerank:&nbsp;#%STBAR_LRERDATE%#&nbsp;&nbsp;
duration(sec):&nbsp;#%STBAR_RERTIME%#&nbsp;&nbsp;
<BR>Last reset:&nbsp;&nbsp;&nbsp;#%STBAR_LRESDATE%#&nbsp;&nbsp;
<BR>Server Time:&nbsp;#%STBAR_TIME%#
<BR>Last rerank uptime:&nbsp;#%STBAR_UPTIME%#<BR>
<!--Total/Inactive users in database:&nbsp;#%STBAR_TUSERS%#/#%STBAR_IUSERS%#<BR>-->
Last reset/rerank offset [hour:min:sec] #%STBAR_RESTIME_USERS%# / #%STBAR_RERTIME_USERS%# <BR>
New Users: #%STBAR_NUSERS%#<BR>
Old Users: #%STBAR_OUSERS%#<BR>
Total Users: #%STBAR_TUSERS%#<BR>
Inactive Users: #%STBAR_IUSERS%#<BR>
</p>
</td></tr>
</table>
</td>
</tr>
</table>
<div align="right"></div>
</body>
</html>#%EOF%#
#%File: ./temps/defaults/_break_edit.html%#
<html>
<head>
<title>Edit Breaks in #%INDEX_NAME%#  (#%toplistID%#)</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link rel="stylesheet" href="%#TL_URL#%/main.css""" type="text/css">

<script src="%#TL_URL#%/main.js"""></script>
</head>
<body onLoad="autoFocus();">

<table width="800" border="0"  align="center">
<tr > 
<td colspan="2" class="mainTitle"> 
<center>
Edit Breaks in #%INDEX_NAME%#   (#%toplistID%#)
</center>
</td>
</tr>
<form method="post" action="_#ADMIN_CGI#_">
#%BREAK_VIEW_BEGIN%# 
<tr><td class="editItems" width="82%">
  <table width="100%" border="0" cellspacing="0" cellpadding="5">
  <tr><td colspan= "2">
  <span class="editItems">#%LABEL%#</span><a class="help" onClick="javascript:showHelp('breakedit','editfield')">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[Help]</a><BR>
  </td></tr>
<tr>

    <td class ="fieldLabel" valign="top" colspan="2"> 
      #%INFO%#
      <textarea class ="inputValue"  name="#%FIELD_NAME%#" cols="100" rows="8">#%DATA%#</textarea>
    </td>
  
</tr>    
  </table>
</td></tr>

<!--
<tr > 
<td class ="fieldLabel"> <div  class="editItems">#%LABEL%#</div> #%INFO%#
<textarea class="inputValue" name="#%FIELD_NAME%#" cols="100" rows="10">#%DATA%#</textarea>
</TD>
<td valign="top"> <A class="help" onClick="javascript:showHelp('breakedit','editfield')">[Help]</A></td>
</tr>
-->
#%BREAK_VIEW_END%# 
<tr> 
<td colspan="2"><b> 
<input class="inputValue"   type="submit" name="display" value="Save HTML">
<input type="hidden" name="action" value="_%SAVEBREAK%_">
<input type="hidden" name="index" value="_%EDIT_INDEX%_">
</b></td>
</tr>
</form>
</table>
</body>
</html>
#%EOF%#
#%File: ./temps/defaults/_data_table.html%#
<TR>
<TD WIDTH = 10%>#%ENTER_DATA_RANK%#</TD><TD WIDTH = 70%><A HREF="#%ENTER_DATA_LINK%#"> 
#%ENTER_DATA_TITLE%#
#%ENTER_DATA_BANNER%#
#%ENTER_DATA_SAMPLE%#
#%ENTER_DATA_DESCR%#
</A>
</TD><TD WIDTH = 10%>#%ENTER_DATA_IN%#</TD>
<TD WIDTH = 10%>#%ENTER_DATA_OUT%#</TD>
</TR>#%EOF%#
#%File: ./temps/defaults/_error_message.html%#
<html>
<head>
<title>#%WINDOW_TEXT%#  (#%toplistID%#)</title>
</head>
<body bgcolor="#FFFFFF" >
<div align="center">
<BR><BR><BR>
<table border="0" cellpadding="0" cellspacing="2" width="600">
<tr> 
<td align="center">
<table width="600" border="0" cellspacing="2" cellpadding="10" align="center" bgcolor="#330066">
<tr> 
<td width="600" height="30"> 
<div align="center"><font face="Arial, Helvetica, sans-serif"><b><font size="3" color="#FFFFFF">#%TITLE_TEXT%#</font></b></font></div>
</td>
</tr>
<tr> 
<td height="47" width="600" bgcolor="#FFCC99"> 
<p align="center"><font color="#CCFFFF" face="Verdana, Arial, Helvetica, sans-serif"><font size="2" color="#777777"><b><font color="#990000">#%BODY_TEXT%#</font> 
</b></font></font></p>
</td>
</tr>
</table>
</td>
</tr></table>
</div></body>
</html>#%EOF%#
#%File: ./temps/defaults/_footer.html%#
</TABLE>

<BR>

#%ENTER_LINKS%#



<A HREF="#%ENTER_RANDOM_LINK%#"><IMG SRC ="#%ENTER_RANDOM_BANNER%#"></A>

</BODY>

</HTML>#%EOF%#
#%File: ./temps/defaults/_header.html%#
<HTML>
<HEAD>
<TITLE>Default Templted TL</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
</HEAD>

<BODY bgcolor="#DDDDFF">

<A HREF="#%ENTER_RANDOM_LINK%#"><IMG SRC ="#%ENTER_RANDOM_BANNER%#"></A>

<H1 align="center"><FONT color="#FF3333">Header of TopList</FONT></H1>
<TABLE width="75%" border="0" cellspacing="0" cellpadding="0" align="center">
<TR>

<TD>
<H1 align="center"><FONT color="#663333">Rank</FONT></H1>
</TD>
<TD>
<H1 align="center"><FONT color="#663333">Title</FONT></H1>
</TD>
<TD>
<H1 align="center"><FONT color="#663333">In</FONT></H1>
</TD>
<TD>
<H1 align="center"><FONT color="#663333">Out</FONT></H1>
</TD>

</TR>#%EOF%#
#%File: ./temps/defaults/_html_edit.html%#
<html>
<head>
<title>Edit HTML Templates  (#%toplistID%#)</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link rel="stylesheet" href="%#TL_URL#%/main.css""" type="text/css">

<script src="%#TL_URL#%/main.js"""></script>
</head>
<body onLoad="autoFocus();">

<table width="98%" border="0" align="center">
<tr > 
<td  class="mainTitle"> 
<center>
Edit HTML Templates (#%toplistID%#)
</center>
</td>
</tr>
<form method="post" action     ="_#ADMIN_CGI#_">

<tr><td> Strings like #%something%# are variables replaced by values in ListGeneration process
</td></tr>

<tr><td class="editItems" width="82%">
  <table width="100%" border="0" cellspacing="0" cellpadding="5">
  <tr><td colspan= "2">
  <span class="editItems">Header</span><a class="help" onClick="javascript:showHelp('htmledit','htmlheader')">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[Help]</a><BR>
  </td></tr>
<tr>

    <td class ="fieldLabel" valign="top"> 
      _#HELP_PATH_HEADER#_
      <textarea class ="inputValue"  name="fieldHEADER" cols="100" rows="20">_#VAL_HEADER#_</textarea>
    </td>
  
    <td valign="top"  class ="small" width="100%"><br>_#HELP_HEADER#_</td>
</tr>    
  </table>
</td></tr>

<tr><td class="editItems" width="82%">
  <table width="100%" border="0" cellspacing="0" cellpadding="5">
  <tr><td colspan= "2">
<span class="editItems">Body</span><a class="help" onClick="javascript:showHelp('htmledit','htmlbody')">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[Help]</a><BR>
</td></tr>
<tr>

    <td valign="top"  class ="fieldLabel"> 
      _#HELP_PATH_BODY#_
      <textarea class ="inputValue"  name="fieldBODY" cols="100" rows="20">_#VAL_BODY#_</textarea>
    </td>
  
    <td valign="top"  class ="small" width="100%"><br>_#HELP_BODY#_</td>
</tr>    
  </table>
</td></tr>


<tr><td class="editItems" width="82%">
  <table width="100%" border="0" cellspacing="0" cellpadding="5">
  <tr><td colspan= "2">
<span class="editItems">Footer</span><a class="help" onClick="javascript:showHelp('htmledit','htmlfooter')">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[Help]</a><BR>    
  </td></tr>

<tr>

    <td valign="top"  class ="fieldLabel">
      _#HELP_PATH_FOOTER#_
      <textarea class ="inputValue"  name="fieldFOOTER" cols="100" rows="20">_#VAL_FOOTER#_</textarea>
    </td>
  
    <td valign="top"  class ="small" width="100%"><br>_#HELP_FOOTER#_</td>
</tr>    
  </table>
</td></tr>





<!--
<tr> 
<td   class ="fieldLabel" width="82%"> 
<div  class="editItems"><br>
Body&nbsp;&nbsp;&nbsp;&nbsp;<a class="help" onClick="javascript:showHelp('htmledit','htmlbody')">[Help]</a></div>
<table width="100%" border="0" cellspacing="0" cellpadding="5">
<tr> 
<td class ="fieldLabel"> 
<textarea class ="inputValue"  name="fieldBODY" cols="100" rows="15">_#VAL_BODY#_</textarea>
</td>
<td width="100%"><font size="1" face="Arial">_#HELP_BODY#_</font></td>
</tr>
</table>
</td>
</tr>
<tr> 
<td  class ="fieldLabel" width="82%" > 
<div  class="editItems"><br>
Footer&nbsp;&nbsp;&nbsp;&nbsp;<a class="help" onClick="javascript:showHelp('htmledit','htmlfooter')">[Help]</a></div>
<table width="100%" border="0">
<tr> 
<td> 
<textarea  class ="inputValue"  name="fieldFOOTER" cols="100" rows="20">_#VAL_FOOTER#_</textarea>
</td>
<td width="100%"><font size="1" face="Arial">_#HELP_FOOTER#_</font></td>
</tr>
</table>
</td>
</tr>
-->
<tr> 
<td> 
<input type="submit" name="display" value="Save HTML">
<input type="hidden" name="action" value="_%SAVEHTML%_">
<input type="hidden" name="index" value="_%EDIT_INDEX%_">
</td>
</tr>
</form>
</table>
</body>
</html>


#%EOF%#
#%File: ./temps/defaults/_html_edit_icon.html%#
<html>
<head>
  <title>Edit Icons  (#%toplistID%#)</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <link rel="stylesheet" href="%#TL_URL#%/main.css""" type="text/css">

  <script src="%#TL_URL#%/main.js"""></script>
</head>
<body onLoad="autoFocus();" >
<form method="post" action     ="_#ADMIN_CGI#_">
<table width="90%" align="center" class="mainBorder" cellpadding="5">
<tr > 
<td colspan ="2" class="mainTitle"> 
<center>
Edit Icons (#%toplistID%#) 
</center>
</td>
</tr>
<tr> 
<td colspan ="2"> 

    <table class="noBorder" cellspacing="0" cellpadding="0">
    <tr> 
	<td class="setupValName" width="40%"> Position Limit for Icon NEW &nbsp;</td>
	<td width="43"> 
	<input onChange="checkInput_nr(this,5,1)"   class="inputValue"  type="text" name="var::newLimit" value="var::newLimit" size="2" tabindex="1">
	</td>
	<td  valign="top" ><A class="help" tabindex="50"  onClick="javascript:showHelp('iconedit','newlimit')">[Help]</A></td>
    </tr>
    
    <tr> 
	<td class="setupValName" width="40%"> Position Limit for Icon LONG &nbsp;</td>
	<td width="43"> 
	<input onChange="checkInput_nr(this,5,1)"   class="inputValue"  type="text" name="var::longLimit" value="var::longLimit" size="2" tabindex="10">
	</td>
	<td  valign="top" ><A class="help" tabindex="50"  onClick="javascript:showHelp('iconedit','longlimit')">[Help]</A></td>
    </tr>
    
    <tr> 
	<td class="setupValName" width="40%"> Position Limit for Icon DIRECTION &nbsp;</td>
	<td width="43"> 
	<input onChange="checkInput_nr(this,5,1)"  class="inputValue"  type="text" name="var::directionLimit" value="var::directionLimit" size="2" tabindex="20">
	</td>
	<td  valign="top"><A class="help" tabindex="50"  onClick="javascript:showHelp('iconedit','directionlimit')">[Help]</A></td>
    </tr>
    
    </table>
    
</td>
</tr>

<tr > 
<td class ="fieldLabel"> 
    <table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr> 
	<td width="20%" class="editItems">Icon NEW</td>
	<td width="26%"> 
	<div class="setupValName">Enabled &nbsp; 
	<input class="inputValue"  type="checkbox" tabindex="30"  name="var::newEnabled" value="1" var::newEnabled>
	</div>
	</td>
	
	<td width="41%"> 
	<div class="setupValName">Duration [minutes] &nbsp; 
	<input onChange="checkInput_nr(this,5,1)"   class="inputValue"  type="text" tabindex="40"   name="var::newDuration" value="var::newDuration" size="2">
	</div>
	</td>
    </tr>
    </table>
    <textarea class="inputValue" tabindex="41" name="fieldICONNEW" cols="100" rows="6">%#VAL_ICON_NEW#%</textarea>

</td>

<td valign="top">
    <a class="help" tabindex="50"  onClick="javascript:showHelp('iconedit','newmain')">[Help]</a>
</td>

</tr>

<tr> 
<td class ="fieldLabel"> 
    <table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr> 
    <td width="20%" class="editItems">Icon UP</td>
    <td width="26%"> 
    <div class="setupValName">Enabled&nbsp;&nbsp; 
    <input class="inputValue"  tabindex="60"  type="checkbox" name="var::upEnabled" value="1" var::upEnabled>
    </div>
    </td>
    <td width="41%"> 
    <div class="setupValName"></div>
    </td>
</tr>
</table>
<textarea   class="inputValue" tabindex="70"   name="fieldICONUP" cols="100" rows="6">%#VAL_ICON_UP#%</textarea>
</td>
<td valign="top">
<A class="help" tabindex="80"  onClick="javascript:showHelp('iconedit','upmain')">[Help]</A>
</td>


</tr>
<tr > 
<td class ="fieldLabel"> 
    <table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr> 
    <td width="20%" class="editItems">Icon DOWN</td>
    <td width="26%"> 
    <div class="setupValName">Enabled&nbsp;&nbsp; 
    <input class="inputValue" tabindex="80"  type="checkbox" name="var::downEnabled" value="1" var::downEnabled>
    </div>
    </td>
    <td width="41%"> 
    <div class="setupValName"></div>
    </td>
    </tr>
    </table>
    <textarea   class="inputValue"  tabindex="90"  name="fieldICONDOWN" cols="100" rows="10">%#VAL_ICON_DOWN#%</textarea>
</td>
<td valign="top">
<A class="help" tabindex="100"  onClick="javascript:showHelp('iconedit','downmain')">[Help]</A>
</td>
</tr>

<tr> 
<td class ="fieldLabel"> 
    <table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr> 
    <td width="20%" class="editItems">Icon STATUS</td>
    <td width="26%"> 
    <div class="setupValName">Enabled&nbsp;&nbsp; 
    <input class="inputValue" tabindex="110"  type="checkbox" name="var::stquoEnabled" value="1" var::stquoEnabled>
    </div>
    </td>
    <td width="41%"> 
    <div class="setupValName"></div>
    </td>
    </tr>
    </table>
    <textarea   class="inputValue"   name="fieldICONSTQUO" tabindex="120"  cols="100" rows="10">%#VAL_ICON_STQUO#%</textarea>
</td>
<td valign="top">
<A class="help" tabindex="130"  onClick="javascript:showHelp('iconedit','stquomain')">[Help]</A>
</td>
</tr>

<tr> 
<td class ="fieldLabel"> 
    <table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr> 
    <td width="20%" class="editItems">Icon LONG</td>
    <td width="26%"> 
    <div class="setupValName">Enabled &nbsp; 
    <input tabindex="140"  class="inputValue"  type="checkbox" name="var::longEnabled" value="1" var::longEnabled>
    </div>
    </td>
    <td width="41%"> 
    <div class="setupValName">Active for [resets] &nbsp; 
    <input onChange="checkInput_nr(this,5,1)"  class="inputValue" tabindex="150"  type="text" name="var::longDuration" value="var::longDuration" size="2">
    </div>
    </div>
    </td>
    </tr>
    </table>

</div>
<textarea   class="inputValue"  tabindex="160"  name="fieldICONLONG" cols="100" rows="10">%#VAL_ICON_LONG#%</textarea>
</td>
<td valign="top">
<A class="help" tabindex="170"   onClick="javascript:showHelp('iconedit','activity')">[Help]</A>
</td>
</tr>
<tr> 
<td colspan="2"> 
<input   class="inputValue"  tabindex="171"   type="button" name="display" value="Save" onClick="checkSetup(this)">
<input type="hidden" name="action" value="_%SAVEICONEDIT%_">
</td>
</tr>
</table>

  </form>

</body>
</html>#%EOF%#
#%File: ./temps/defaults/_html_edit_mail.html%#
<html>
<head>
<title>Edit Mail  (#%toplistID%#)</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link rel="stylesheet" href="%#TL_URL#%/main.css""" type="text/css">

<script src="%#TL_URL#%/main.js"""></script>
</head>
<body onLoad="autoFocus();">

<table width="90%" border="0"  align="center" cellpadding="5">
<tr> 
<td colspan="2" class="mainTitle"> 
<center>
Edit Templates for Html Based Emails (#%toplistID%#) 
</center>
</td>
</tr>
<form method="post" action     ="_#ADMIN_CGI#_">
<tr> 
<td colspan="2" >Strings like #%something%# are variables replaced by values in ListGeneration process</td>
</tr>

<!-- Mail to Acc TEXT -->
<tr> 
<td class ="fieldLabel"> 
<div  class="editItems">
Registration Subject:
<input class ="inputValue"  type="text" name="fieldSubjAdd" size="65" value="#%SUBJ_ADD%#" maxlength="65">
<br>
Mail to user Text - Header(text version)</div><br>
#%INFO_HEADER_TEXT%#
<textarea class ="inputValue"   name="fieldHEADERTEXT" cols="100" rows="8">_#VAL_TEXT_HEADER#_</textarea>
</td>
<td  valign="top"><A class="help" onClick="javascript:showHelp('mailedit','textuserheader')">[Help]</A></td>
</tr>
<tr > 
<td  class ="fieldLabel">
<div  class="editItems">Mail to user Text - Footer(text version)</div><br>
#%INFO_FOOTER_TEXT%#
<textarea class ="inputValue"   name="fieldFOOTERTEXT" cols="100" rows="8">_#VAL_TEXT_FOOTER#_</textarea>
</td>
<td  valign="top"><A class="help" onClick="javascript:showHelp('mailedit','textuserfooter')">[Help]</A></td>
</tr>



<!-- Mail to Acc HTML -->

<tr > 
<td class ="fieldLabel">
<div  class="editItems"> Mail to user - Header(HTML version)</div><br>
#%INFO_HEADER_HTML%#
<textarea class ="inputValue"   name="fieldHEADERHTML" cols="100" rows="10">_#VAL_HTML_HEADER#_</textarea>
</td>
      <td  valign="top"><A class="help" onClick="javascript:showHelp('mailedit','htmluserheader')">[Help]</A></td>
</tr>
<tr > 
<td  class ="fieldLabel">
<div  class="editItems">Mail to user - Footer(HTML version) </div><br>
#%INFO_FOOTER_HTML%# 
<textarea class ="inputValue"   name="fieldFOOTERHTML" cols="100" rows="10">_#VAL_HTML_FOOTER#_</textarea>
</td>
<td  valign="top"><A class="help" onClick="javascript:showHelp('mailedit','htmluserfooter')">[Help]</A></td>
</tr>




<!-- Mail Delete -->

<tr > 
<td class ="fieldLabel"> 
<div  class="editItems">
Delete Subject:
<input class ="inputValue"   type="text" name="fieldSubjDel" size="65" value="#%SUBJ_DEL%#" maxlength="65">
<BR>Mail after account deleted(text version) <BR>
Help (variables)</div>
#%DELETE_HELP%#<BR>
#%INFO_DELETE_TEXT%# 
<textarea class ="inputValue"  name="fieldDELETETEXT" cols="100" rows="8">_#VAL_TEXT_DELETE#_</textarea>
</td>
      <td  valign="top"><A class="help" onClick="javascript:showHelp('mailedit','textuserdelete')">[Help]</A></td>
</tr>


<tr> 
<td class ="fieldLabel">
<div  class="editItems">Mail after account deleted
(HTML version)<BR>
<BR>
Help (variables) </div>
#%DELETE_HELP%# <BR>
#%INFO_DELETE_HTML%# 
<textarea class ="inputValue"   name="fieldDELETEHTML" cols="100" rows="8">_#VAL_HTML_DELETE#_</textarea>
</td>
      <td  valign="top"><A class="help" onClick="javascript:showHelp('mailedit','htmluserdelete')">[Help]</A></td>
</tr>



<!-- Mail Inactivity -->


<tr > 
<td  class ="fieldLabel">
<div  class="editItems">
Inactivity Subject:
<input class ="inputValue"   type="text" name="fieldSubjInact" size="65" value="#%SUBJ_INACT%#" maxlength="65">
<BR>Mail after inactivity
(text version)<BR>
<BR>
Help (variables) </div>
#%INACT_HELP%# <BR>
#%INFO_INACTIVITY_TEXT%# 
<textarea class ="inputValue"   name="fieldINACTIVITYTEXT" cols="100" rows="8">_#VAL_TEXT_INACTIVITY#_</textarea>
</td>
      <td  valign="top"><A class="help" onClick="javascript:showHelp('mailedit','textuserinact')">[Help]</A></td>
</tr>


<tr > 
<td  class ="fieldLabel">
<div  class="editItems">Mail after inactivity
(HTML version)<BR>
<BR>
Help (variables) </div>
#%INACT_HELP%# <BR>
#%INFO_INACTIVITY_HTML%# 
<textarea class ="inputValue"   name="fieldINACTIVITYHTML" cols="100" rows="10">_#VAL_HTML_INACTIVITY#_</textarea>
</td>
      <td  valign="top"><A class="help" onClick="javascript:showHelp('mailedit','htmluserinact')">[Help]</A></td>
</tr>







<tr> 
<td  class ="fieldLabel" colspan="2">
<input    class="inputValue"   type="submit" name="display" value="Save">
<input type="hidden" name="action" value="_%SAVEMAILEDIT%_">
</td>
</tr>
</form>
</table>
</body>
</html>


#%EOF%#
#%File: ./temps/defaults/_html_edit_words.html%#
<html>
<head>
<title>Edit Blacklist  (#%toplistID%#)</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link rel="stylesheet" href="%#TL_URL#%/main.css""" type="text/css">

<script src="%#TL_URL#%/main.js"""></script>

</head>

<body onLoad="autoFocus();">

<table width="90%" border="0"  cellpadding="5"  align="center">
  <tr >
    <td colspan="2" class="mainTitle">
      <center>Edit Blacklist  (#%toplistID%#)</center>
    </td>
  </tr>
  <form method="post" action     ="_#ADMIN_CGI#_">
    <tr >
      <td colspan="2" >Type one word [string] per line.</td>
     </tr> 
    <tr >
<td class ="fieldLabel"><div  class="editItems">Banned words for Title and Description</div><br>
#%INFO_BWORD%#
        <textarea   class="inputValue"   name="fieldWORDS1" cols="100" rows="10">_#VAL_WORDS1#_</textarea>
      </td>
            <td  valign="top"><A class="help" onClick="javascript:showHelp('wordsedit','word')">[Help]</A></td>
     </tr> 
    <tr >
<td class ="fieldLabel"><div  class="editItems">Banned URL`s and Email Adresses</div><br>
#%INFO_BURL%#
        <textarea   class="inputValue"   name="fieldWORDS2" cols="100" rows="10">_#VAL_WORDS2#_</textarea>
      </td>
            <td  valign="top"><A class="help" onClick="javascript:showHelp('wordsedit','url')">[Help]</A></td>
     </tr> 
    <tr >     
      <td colspan="2" width="80">        
       <input   class="inputValue"   type="submit" name="display" value="Save">
        <input type="hidden" name="action" value="_%SAVEWORDEDIT%_">
        </td>
    </tr>
  </form>
</table>
</body>
</html>#%EOF%#
#%File: ./temps/defaults/_html_mail.html%#
<html>
<body bgcolor="#FFFFFF">
<table width="" border="0" cellspacing="1" cellpadding="4" bgcolor="#330066" align="center">
<tr bgcolor="#330066"> 
<td colspan="2"> 
<center>
<b><font color="#FFFFFF">Registration Report</font></b> 
</center>
</td>
</tr>
<tr bgcolor="#FFCC99"> 
<td width=""><b><font size="-1" face="Arial">Accout Name</font> </b></td>
<td colspan="2"> 
<input type="text" name="textAcc" size="10" maxlength="8">
</td>
</tr>
<tr bgcolor="#FFCC99"> 
<td width=""><b><font size="-1" face="Arial">Password</font> </b></td>
<td colspan="2"> 
<input type="text" name="textAcc" size="10" maxlength="8">
</td>
</tr>
<tr bgcolor="#FFCC99"> 
<td width=""><b><font size="-1" face="Arial">Title</font> </b></td>
<td colspan="2"> 
<input type="text" name="textAcc" size="10" maxlength="8">
</td>
</tr>
<tr bgcolor="#FFCC99"> 
<td width=""><b><font size="-1" face="Arial">Description</font> </b></td>
<td colspan="2"> 
<input type="text" name="textAcc" size="10" maxlength="8">
</td>
</tr>
<tr bgcolor="#FFCC99"> 
<td width=""><b><font size="-1" face="Arial">Link</font> </b></td>
<td colspan="2"> 
<input type="text" name="textAcc" size="10" maxlength="8">
</td>
</tr>
<tr bgcolor="#FFCC99"> 
<td width="" bgcolor="#FFCC99"><b><font size="-1" face="Arial">Banner</font> </b></td>
<td colspan="2"> 
<input type="text" name="textAcc" size="10" maxlength="8">
</td>
</tr>
<tr bgcolor="#FFCC99"> 
<td width=""><b><font size="-1" face="Arial">Sample</font> </b></td>
<td colspan="2"> 
<input type="text" name="textAcc" size="10" maxlength="8">
</td>
</tr>
<tr bgcolor="#FFCC99"> 
<td width=""><b><font size="-1" face="Arial">Mail</font> </b></td>
<td colspan="2"> 
<input type="text" name="textAcc" size="10" maxlength="8">
</td>
</tr>
</table>
</body>
</html>


#%EOF%#
#%File: ./temps/defaults/_info_message.html%#
<html>
<head>
<title>#%WINDOW_TEXT%#</title>
<link rel="stylesheet" href="%#TL_URL#%/main.css""" type="text/css">
</head>

<body>


<div align="center">
<BR><BR><BR>
<table border="0" cellpadding="0" cellspacing="0" width="600">
<tr>
<td align="center">



<table width="602" border="0" cellspacing="1" cellpadding="2" align="center" height="57">
  
<tr> 
<td width="600"> 
<div align="center" class="messageMainTitle">#%TITLE_TEXT%#</div>
    </td>
  </tr>
  
<tr > 
<td width="600" height="47"> 
#%BODY_TEXT%#
      </td>
  </tr>
</table>
</td></tr></table>
</div></body>
</html>
#%EOF%#
#%File: ./temps/defaults/_report_mail_admin.html%#
<html>
<body bgcolor="#330066">
<table align = "center" width="600" border="0" cellspacing="1" cellpadding="5" bgcolor="#330066">
  <tr bgcolor="#330066"> 
    <td colspan="2"> 
      <table width="100%" border="0" cellspacing="0" cellpadding="0">
        <tr>
          <td><font size="-1" face="Arial"><b><font color="#FFFFFF">An Account 
            Has been added to your TOPLIST (#%toplistID%#)</font></b></font></td>
          <td>
            <div align="right"><a href="#%F_DEL%#" target="_blank"><b><font color="#FFFF33" size="2" face="Arial">DELETE 
              THIS ACCOUNT</font></b></a></div>
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
  <tr bgcolor="#FFCC99"> 
    <td ></td>
  </tr>
  <tr bgcolor="#FFCC99"> 
    <td ><font color="#330066"><b><font size="-1" face="Arial" color="#000000">Account 
      Name:</font><font size="-1" face="Arial"> #%fieldAcc%# </font></b></font></td>
  </tr>
  <tr bgcolor="#FFCC99"> 
    <td ><font color="#330066"><b><font size="-1" face="Arial" color="#000000">Title:</font><font size="-1" face="Arial"> 
      #%fieldTitle%# </font></b></font></td>
  </tr>
  <tr bgcolor="#FFCC99"> 
    <td ><font color="#330066"><b><font size="-1" face="Arial" color="#000000">Description:</font><font size="-1" face="Arial"> 
      #%fieldDescr%# </font></b></font></td>
  </tr>
  <tr bgcolor="#FFCC99"> 
    <td ><b><font size="-1" face="Arial"><a href="#%fieldWebLink%#" target="_blank"><font color="#990000">Link</font></a></font></b><font color="#330066"><b><font size="-1" face="Arial" color="#000000"><font color="#990000">:</font></font><font size="-1" face="Arial"> 
      &nbsp;#%fieldWebLink%# </font></b></font></td>
  </tr>
  <tr bgcolor="#FFCC99"> 
    <td ><b><font size="-1" face="Arial"><a href="mailto:#%fieldMail%#"><font color="#990000">Mail</font></a></font></b><font color="#330066"><b><font size="-1" face="Arial" color="#000000">:</font><font size="-1" face="Arial"> 
      #%fieldMail%# </font></b></font></td>
  </tr>
  <tr bgcolor="#FFCC99"> 
    <td height="63" ><font color="#330066"><b><font size="-1" face="Arial" color="#000000">Banner:</font> 
      #%fieldBanner%#</b></font><font color="#330066"><b><br>
      <font size="-1" face="Arial"><IMG SRC="#%fieldBanner%#"> </font></b></font></td>
  </tr>
  <tr bgcolor="#FFCC99"> 
    <td ><font color="#330066"><b><font size="-1" face="Arial" color="#000000">Sample:</font> 
      #%fieldSample%# </b></font><font color="#330066"><br>
      <font size="-1" face="Arial"><IMG SRC="#%fieldSample%#"> </font></font></td>
  </tr>
</table>
</html>#%EOF%#
#%File: ./temps/defaults/_report_mail_admin.txt%#
Account registration report.
TopList name: #%toplistID%#

Account Name: 	#%fieldAcc%#
Title: 		#%fieldTitle%#
Description: 	#%fieldDescr%#
Link: 		#%fieldWebLink%#
Mail: 		#%fieldMail%#
Banner: 	#%fieldBanner%#
Sample: 	#%fieldSample%#


Delete Account '#%fieldAcc%#': #%F_DEL%##%EOF%#
#%File: ./temps/defaults/_report_mail_delete.html%#
<html>
<body bgcolor="#5555AA">
<font color="white">
Your account <b>#%ACC_NAME%#</b> has been <b>deleted</b> from our TopList !! 
</font>
</body>
</html>
#%EOF%#
#%File: ./temps/defaults/_report_mail_delete.txt%#
!!  Your account #%ACC_NAME%# has been  deleted from our TopList  !!#%EOF%#
#%File: ./temps/defaults/_report_mail_edit.html%#
<html>
<body bgcolor="#99CC99">
<table align = "center" width="600" border="0" cellspacing="2" cellpadding="5" bgcolor="#99CC99">
  <tr bgcolor="#330066"> 
    <td colspan="2"> <font size="-1" face="Arial"><b><font color="#FFFFFF"> An 
      account:#%fieldAcc%# has been <font color="#FFFF00">EDITED</font> in TOPLIST 
      (#%toplistID%#)</font></b></font></td>
</tr>
<tr bgcolor="#FFCC99"> 
<td ></td>
</tr>
<tr bgcolor="#FFCC99"> 
<td ><font color="#330066"><b><font size="-1" face="Arial" color="#000000">Account 
Name:</font><font size="-1" face="Arial"> #%fieldAcc%# </font></b></font></td>
</tr>
<tr bgcolor="#FFCC99"> 
<td ><font color="#330066"><b><font size="-1" face="Arial" color="#000000">Title:</font><font size="-1" face="Arial"> 
#%fieldTitle%# </font></b></font></td>
</tr>
<tr bgcolor="#FFCC99"> 
<td ><font color="#330066"><b><font size="-1" face="Arial" color="#000000">Description:</font><font size="-1" face="Arial"> 
#%fieldDescr%# </font></b></font></td>
</tr>
<tr bgcolor="#FFCC99"> 
    <td ><b><font size="-1" face="Arial"><a href="#%fieldWebLink%#" target="_blank"><font color="#990000">Link</font></a></font></b><font color="#330066"><b><font size="-1" face="Arial" color="#000000"><font color="#990000">:</font></font><font size="-1" face="Arial"> 
      &nbsp;#%fieldWebLink%# </font></b></font></td>
</tr>
<tr bgcolor="#FFCC99"> 
<td ><b><font size="-1" face="Arial"><a href="mailto:#%fieldMail%#"><font color="#990000">Mail</font></a></font></b><font color="#330066"><b><font size="-1" face="Arial" color="#000000">:</font><font size="-1" face="Arial"> 
#%fieldMail%# </font></b></font></td>
</tr>
<tr bgcolor="#FFCC99"> 
<td rowspan="2" ><font color="#330066"><b><font size="-1" face="Arial">Banner: 
#%fieldBanner%# </font></b></font><font color="#330066"><b><br>
<font size="-1" face="Arial"><IMG SRC="#%fieldBanner%#"> </font></b></font></td>
</tr>
<tr bgcolor="#FFCC99"> </tr>
<tr bgcolor="#FFCC99"> 
<td rowspan="2" ><font color="#330066"><b><font size="-1" face="Arial" color="#000000">Sample:</font> 
<font size="-1" face="Arial"> #%fieldSample%#<br>
</font></b></font><font color="#330066"><b><font size="-1" face="Arial"><IMG SRC="#%fieldSample%#"> 
</font></b></font></td>
</tr>
<tr bgcolor="#FFCC99"> </tr>
</table>
</html>


#%EOF%#
#%File: ./temps/defaults/_report_mail_edit.txt%#
Account Modification Report.
TopList name: #%toplistID%#

Title: 		#%fieldTitle%#
Description: 	#%fieldDescr%#
Link: 		#%fieldWebLink%#
Mail: 		#%fieldMail%#
Banner: 	#%fieldBanner%#
Sample: 	#%fieldSample%#
#%EOF%#
#%File: ./temps/defaults/_report_mail_footer.html%#
      </td>
    </font>        
     </tr> 



</table>
</html>
#%EOF%#
#%File: ./temps/defaults/_report_mail_footer.txt%#
#%EOF%#
#%File: ./temps/defaults/_report_mail_header.html%#
<html>
<body bgcolor="#FFFFFF">
<table align = "left" width="800" border="0" cellspacing="1" cellpadding="4" bgcolor="#330066" align="center">
  <tr bgcolor="#330066">
    <td colspan="2">
        <b><font color="#FFFFFF">Account registration report</font></b>
    </td>
  </tr>
  
  <tr bgcolor="#FFCC99">
    <td ><font size="-1" face="Arial">
      <b>
	You have been added. <br><br>
	<b> 
      </td>
     </tr> 
  
    <tr bgcolor="#FFCC99">
    <td ><font size="-1" face="Arial">
#%EOF%#
#%File: ./temps/defaults/_report_mail_header.txt%#
Account registration form

You have been added.


#%EOF%#
#%File: ./temps/defaults/_report_mail_inact.html%#
You are inactive for too long period#%EOF%#
#%File: ./temps/defaults/_report_mail_inact.txt%#
You are inactive for too long period#%EOF%#
#%File: ./temps/defaults/_setup.html%#
<!-- BOTH -------------------------------------------------------------------------------->
<html>
<head>
  <title>Setup Traffic Pro  (#%toplistID%#)</title>
<link rel="stylesheet" href="%#TL_URL#%/main.css""" type="text/css">  
<script src="%#TL_URL#%/main.js"""></script>
  </head>
<body onLoad="autoFocus();">
<div align="center">

<form method="POST" action="_#ADMIN_CGI#_">
<table  width="80%" cellspacing="0" cellpadding="0" border="0" >
<tr >
<td align="center"> 
<table  cellpadding="4" border="0" width="100%">
<tr > 
<td align="center" colspan="2" class="setupMainTitle"> Traffic 
Pro Setup  (#%toplistID%#)</td>
</tr>

<!-- ADVANCED Section dislayed in Advanced Setup starts-------->

<tr>
<td width ="20%" valign="top" class="setupSubTitle"> Directory Setup
</td>
<td >
<!-- HTML DIRECTORY -->
<div class="setupValName">TopList ID:</div>
<input onChange="checkInput_null(this,0,1)"  class="setupValue" type="text" name="var::topListID" value="var::topListID" size="70" tabindex="1">
<A class="help" onClick="showHelp('advsetup','tlid')">[Help]</A>
<br>
<div class="infoText">
String which will identify your toplist.<br>
Example: TopTraffic 111
</div>
<br><br>

<!-- SENDMAIL OR SMTP -->
<div class="setupValName">Sendmail Location:</div>
<input onChange="checkInput_null(this,0,1)"  class="setupValue"  type="text" name="config::sendmail" value="config::sendmail" size="70" tabindex="15">
<A class="help" onClick="showHelp('advsetup','sendmail')">[Help]</A><br>
<div class="infoText">
On Unix: The full path to sendmail.<br>
Example: /usr/sbin/sendmail<br>
</div> <br>

<div class="setupValName">Crontab Location:</div>
<input onChange=" checkInput_null(this,0,1)"   class="setupValue"  type="text" name="config::cronTabPath" value="config::cronTabPath" size="70" tabindex="240">
<A class="help" onClick="showHelp('advsetup','crontab')">[Help]</A><br>
<div class="infoText">
On Unix: The full path to crontab.<br>
Example: /usr/bin/crontab<br>
</div><br>

<div class="setupValName">HTML Directory:</div>
<input onChange="checkInput_null(this,0,1)"  class="setupValue"  type="text" name="config::document_root" value="config::document_root" size="70" tabindex="2">
<A class="help" onClick="showHelp('advsetup','htmldir')">[Help]</A>
<br>
<div class="infoText">The full path to the location where the main HTML pages will reside.<br>
Example: /web/home/username/docs/traffic
</div>
<br><br>

<div class="setupValName">CGI Directory:</div>
<input  onChange="checkInput_null(this,0,1)"  class="setupValue"  type="text" name="config::cgi_path" value="config::cgi_path" size="70" tabindex="3">
<A class="help" onClick="showHelp('advsetup','cgidir')">[Help]</A>
<br>
<div class="infoText">
The full path to the location where the CGI will reside.<br>
Example: /web/home/username/cgi-bin/mytoplist
</div>
</td>
</tr>

<tr>
<td  valign="top" class="setupSubTitle"> URL Setup
</td>
<td >
<!-- CGI URL -->
<div class="setupValName">CGI URL:</div>
<input onChange="checkInput_http(this,0,1)"  class="setupValue"  type="text" name="config::virtual_cgi_path" value="config::virtual_cgi_path" size="70" tabindex="4">
<A class="help" onClick="showHelp('advsetup','cgiurl')">[Help]</A><br>
<div class="infoText">
The full URL to the location where the CGI scripts reside.<br>
Example: http://www.domain.com/cgi-bin/traffic
</div>
<br><br>

<!-- HTML URL -->
<div class="setupValName">HTML URL:</div>
<input onChange="checkInput_http(this,0,1)"  class="setupValue"  type="text" name="config::url_html" value="config::url_html" size="70" tabindex="5">
<A class="help" onClick="showHelp('advsetup','htmlurl')">[Help]</A><br>
<div class="infoText">
The full URL to where the ranking pages will be located.<br>
Example: http://www.domain.com/traffic
</div>
</td>
</tr>

<tr>
<td valign="top" class="setupSubTitle">PHP Setup</td>
<td>
<div class="setupValName">PHP IN file /path/:</div>
<input onChange="checkInput_null(this,0,1)"   class="setupValue"  type="text" name="config::phpInPath" value="config::phpInPath" size="70" tabindex="6">
<A class="help" onClick="showHelp('advsetup','phpin')">[Help]</A><br>
<div class="infoText">
The full path to the location where the PHP IN file will reside.<br>
Example: /web/home/username/docs/traffic/in.php3
</div>
<br><br>

<div class="setupValName">PHP OUT file /path/:</div>
<input onChange="checkInput_null(this,0,1)"  class="setupValue"  type="text" name="config::phpOutPath" value="config::phpOutPath" size="70" tabindex="7">
<A class="help" onClick="showHelp('advsetup','phpout')">[Help]</A><br>
<div class="infoText">
The full path to the location where the PHP Out file will reside.<br>
Example: /web/home/username/docs/traffic/out.php3
</div>
<br><br>

<!-- PHP URL -->
<div class="setupValName">PHP IN URL:</div>
<input onChange="checkInput_http(this,0,1)"  class="setupValue"  type="text" name="config::phpInUrl" value="config::phpInUrl" size="70" tabindex="8">
<A class="help" onClick="showHelp('advsetup','phpurlin')">[Help]</A><br>
<div class="infoText">
The full URL to the location where the PHP IN file reside.<br>
Example: http://www.domain.com/cgi-bin/traffic/in.php3
</div>
<br><br>

<!--
<div class="setupValName">Custom item:</div>

<select name="var::selectedCustom" class="inputValueList">
<!-- selectCustom
<option value="%#NAME#%" var::selectedCustom>%#VALUE#%</option>
</select>

<A class="help" onClick="showHelp('accauth','accname')">[Help]</A><br>
<div class="infoText">
The full URL to the location where the PHP IN file reside.<br>
Example: http://www.domain.com/cgi-bin/traffic/in.php3
</div>
<br><br>

-->
<div class="setupValName">PHP OUT URL:</div>
<input onChange="checkInput_http(this,0,1)"  class="setupValue" type="text" name="config::phpOutUrl" value="config::phpOutUrl" size="70" tabindex="9">
<A class="help" onClick="showHelp('advsetup','phpurlout')">[Help]</A><br>
<div class="infoText">
The full URL to the location where the PHP OUT file reside.<br>
Example: http://www.domain.com/cgi-bin/traffic/out.php3
</div>
</td>
</tr>

<tr>
<td valign="top" class="setupSubTitle"> Misc. Setup</td>
<td>

<div class="setupValName">Database optimalization delay:</div>
<input onChange = "checkInput_nr(this,5,1)" class="setupValue" type="text" name="var::optimizeDelay" value="var::optimizeDelay" size="20" tabindex="10">
<A class="help" onClick="showHelp('advsetup','databoptimal')">[Help]</A><br>
<div class="infoText">
Set interval (in hours) of database optimalization.<br>
Example: any number [0, 1, 10, ...]
</div>

<!-- HTML DIRECTORY -->
<div class="setupValName">Use Counter</div>
<input type="checkbox" name="var::antiHitBOTUse" value="1" tabindex="11"  var::antiHitBOTUse>
<A class="help" onClick="showHelp('advsetup','useCounter')">[Help]</A>
<br>
<div class="infoText">Use counter in index<br>
</div>
<br><br>

<!-- HTML DIRECTORY -->
<div class="setupValName">Use Account View save alarm</div>
<input type="checkbox" name="var::useAccViewAlarm" value="1" tabindex="12"  var::useAccViewAlarm>
<A class="help" onClick="showHelp('advsetup','useAccViewAlarm')">[Help]</A>
<br>
<div class="infoText">
You have edited account X. You didn't save it and now<br>
you trie to edit another one => alarm message<br>
</div>
<br><br>


<div class="setupValName">MultiAdd Group ID</div>
<input class="setupValue"  type="text" name="grpID" value="" size="6" tabindex="13">
<A class="help" onClick="showHelp('advsetup','maGrpID')">[Help]</A>
<br>
<div class="infoText">Toplist group ID.<br>
Example: GRP35x5
<br>
</div>
<br><br>


<div class="setupValName">How many accounts pregenerated</div>
<input class="setupValue"  onChange = "checkInput_nr(this,5,1)"  type="text" name="var::newAccBoxes" value="var::newAccBoxes" size="2" tabindex="13">
<A class="help" onClick="showHelp('advsetup','adminAddPreg')">[Help]</A>
<br>
<div class="infoText">
How many account's templates pregenerated<br>
</div>
<br><br>

<div class="setupValName">Select skin:</div>

<select name="var::selectedSkin" class="inputValue">
<!-- selectSkin -->
<option value="%#NAME#%" var::selectedSkin>%#VALUE#%</option>
</select>

<A class="help" onClick="showHelp('advsetup','selskin')">[Help]</A><br>
<div class="infoText">
The full URL to the location where the PHP IN file reside.<br>
Example: http://www.domain.com/cgi-bin/traffic/in.php3
</div>
<br><br>



<!-- HTML DIRECTORY -->
<div class="setupValName">Use .htaccess</div>
<input type="checkbox" name="var::htAccessUse" value="1" tabindex="14"  var::htAccessUse>
<A class="help" onClick="showHelp('advsetup','useHTAccess')">[Help]</A>
<br>
<div class="infoText">
Use .htaccess file to protect (authorise) access to admin<br>
</div>
<br><br>
</td></tr>

<!-- END Section dislayed in Advanced Setup ends ---------------------->

<tr>
<td  valign="top" class="setupSubTitle"> E-Mail Setup
</td>
<td >
<div class="setupValName">Your E-mail Address:</div>
<input  onChange="checkInput_email(this,1)"  class="setupValue"  type="text" name="var::email" value="var::email" size="70" tabindex="16">
<A class="help" onClick="showHelp('setup','email')">[Help]</A><br>
<div class="infoText">
The email address you want to use in association with the list.<br>
Example: webmaster@yourdomain.com
</div>
</td>
</tr>

<tr>
<td  valign="top" class="setupSubTitle"> Overall Ranks
</td>
<td > 
<div class="setupValName">Index names:</div>
<input onChange="checkInput_indexNames(this,1)"  class="setupValue"  type="text" name="indexNames" value="indexNames" size="70" tabindex="18">
<A class="help" onClick="showHelp('setup','indexnames')">[Help]</A>
<br>
<div class="infoText"> Example: index.html,index2.html,index3.html </div> 
<br>

<div class="setupValName">Lists per indexes:</div>
<input onChange="checkInput_indexAccCount(this,1)"  class="setupValue"  type="text" name="indexAccCount" value="indexAccCount" size="70" tabindex="19">
<A class="help" onClick="showHelp('setup','indexaccs')">[Help]</A>
<br>
<div class="infoText"> Example: 10,20,10,6 </div>
<br>
<div class="setupValName">Break List At:</div>
<input  onChange="checkInput_indexBreaks(this,1)"  class="setupValue"  type="text" name="indexBreaks" value="indexBreaks" size="70" tabindex="20">
<A class="help" onClick="showHelp('setup','breaklist')">[Help]</A>
<br>
<div class="infoText"> Where to insert breaks in the list; for banner 
ads, etc. (leave blank if none)<br>
Example: 5,30,70&nbsp;&nbsp; <b>(NO SPACES!)</b><br>
Breaks occur after the rank indicated. </div><br>

<!--
<div class="setupValName">Use Selective Font Sizes:</div> 
<input class="setupValue"  type="checkbox" name="XXX::selectiveFS" size="50" value="1"  tabindex="21" value ="1" XXX::selectiveFS>
<A class="help" onClick="showHelp('accauth','accname')">[Help]</A>
<br>
<div class="infoText">Special marks in HTML will be used</div> 
<br><br>
-->

<div class="setupValName">Font Sizes:</div>
<input onChange="checkInput_fontSizes(this,1)" class="setupValue"  type="text" name="var::fontSizes" size="70" value="var::fontSizes"  tabindex="21">
<A class="help" onClick="showHelp('setup','fontsizes')">[Help]</A>
<br>
<div class="infoText"> List of font sizes and corresponding ranks.<br>
Example: 1-5=>4,6-25=>3,26-50=>2<br>This setup will use a font size of:<br>
4 for ranks 1-5<br>
3 for ranks 6-25<br>
2 for ranks 26-50<br>
Note that you must start at a low rank and work your way to a higher rank. </div>
<br>
<br>


<div class="setupValName">Overall Sites To List:</div>
<input  onChange = "checkInput_nr(this,5,1)"   class="setupValue"  type="text" name="var::listLimit" value="var::listLimit" size="5" tabindex="17">
<A class="help" onClick="showHelp('setup','overallsites')">[Help]</A><br>
<div class="infoText">The number of sites to be listed in all indexes<br>
Example: 100 </div><br>

<div class="setupValName">Minimum Sites To List:</div>
<input  onChange = "checkInput_nr(this,5,1)" class="setupValue"  type="text" name="var::listLowerLimit" value="var::listLowerLimit" size="5" tabindex="17">
<A class="help" onClick="showHelp('setup','minimumsites')">[Help]</A><br>
<div class="infoText">The minimum number of sites to be listed in all cases<br>
Example: 10 </div><br>

<div class="setupValName">Minimum Hits:</div>
<input onChange="checkInput_nr(this,0,1)"  class="setupValue"  type="text" name="config::in_hit_min_limit" value = "config::in_hit_min_limit" size="10" tabindex="130">
<A class="help" onClick="showHelp('setup','mininhits')">[Help]</A><br>
<div class="infoText">
The minimum number of hits needed to get listed.<br>
Example: 1
</div><br>



<div class="setupValName">Overall Banners To Show:</div>
<input onChange="checkInput_nr(this,0,1)"  class="setupValue"  type="text" name="var::bannerLimit" value="var::bannerLimit" size="10" tabindex="36">
<A class="help" onClick="showHelp('setup','overallbanners')">[Help]</A>
<br>
<div class="infoText"> The number of banners to show on the overall ranking pages.
Example: 5 </div>
<br>

<div class="setupValName">Overall Samples To Show:</div>
<input onChange="checkInput_nr(this,0,1)"  class="setupValue"  type="text" name="var::sampleLimit" value="var::sampleLimit" size="10" tabindex="38">
<A class="help" onClick="showHelp('setup','overallsamples')">[Help]</A>
<br>
<div class="infoText"> The number of samples to show on the overall ranking pages.
Example: 5 </div>



<!--

<div class="setupValName">Use Last Top X:</div>
<input type="checkbox" name="var::gen_useLast" value="1"  tabindex="105"  var::gen_useLast>
<A class="help" onClick="showHelp('accauth','accname')">[Help]</A>
<div class="infoText"> In case of too few accs to be listed, use from 
last topx </div><br>


<div class="setupValName">How many accs to store for Last Top X:</div>
<input onChange="checkInput_nr(this,5,1)"  class="setupValue"  type="text" name="XXX::gen_storedforLast" value = "XXX::gen_storedforLast" size="10" tabindex="110">
<A class="help" onClick="showHelp('accauth','accname')">[Help]</A>
<br>
<div class="infoText">
Number of accs to store for Last Top X.<br>
Example: 5
</div><br>




<div class="setupValName">Use Random:</div>
<input type="checkbox" name="var::gen_useRandom" value="1" tabindex="120"  var::gen_useRandom>
<A class="help" onClick="showHelp('accauth','accname')">[Help]</A><br>
<div class="infoText">
In case of too few accs to be listed, use random from all accs
</div><br>

-->


<div class="setupValName">Use PHP:</div>
<input type="checkbox" name="var::usePHP" value="1"  tabindex="100"  var::usePHP> 
<A class="help" onClick="showHelp('setup','usephp')">[Help]</A>
<div class="infoText"> This will allow you to use in.php to handle ins</div>

</td>
</tr>

<tr>
<td valign="top" class="setupSubTitle"> Icon Options</td>
<td>
<div class="setupValName">NEW Icon Position Limit:</div>
<input onChange="checkInput_nr(this,5,1)"   class="inputValue"  type="text" name="var::newLimit" value="var::newLimit" size="2" tabindex="24">
<A class="help" onClick="showHelp('accauth','accname')">[Help]</A>
<br>
<div class="infoText"> To which position shows icon NEW.<br>
Example: 5 </div>
<br>

<div class="setupValName">LONG Icon Position Limit:</div>
<input onChange="checkInput_nr(this,5,1)"   class="inputValue"  type="text" name="var::longLimit" value="var::longLimit" size="2" tabindex="26">
<A class="help" onClick="showHelp('accauth','accname')">[Help]</A>
<br>
<div class="infoText"> To which position shows icon LONG.<br>
Example: 5 </div>
<br>

<div class="setupValName">DIRECTION Icon Position Limit</div>
<input onChange="checkInput_nr(this,5,1)"  class="inputValue"  type="text" name="var::directionLimit" value="var::directionLimit" size="2" tabindex="28">
<A class="help" onClick="showHelp('accauth','accname')">[Help]</A>
<br>
<div class="infoText"> To which position shows DIRECTION icon (up, down, status quo).<br>
Example: 5 </div>
<br>

<div class="setupValName">NEW Icon Duration:</div>
<input onChange="checkInput_nr(this,5,1)"   class="inputValue"  type="text" tabindex="30"   name="var::newDuration" value="var::newDuration" size="2">
<A class="help" onClick="showHelp('accauth','accname')">[Help]</A>
<br>
<div class="infoText"> The amount of hours from account registration the icon will be displayed.<br>
Example: 5 </div>
<br>

<div class="setupValName">LONG Icon Start Threshold:</div>
<input onChange="checkInput_nr(this,5,1)"  class="inputValue" tabindex="35"  type="text" name="var::longDuration" value="var::longDuration" size="2">
<A class="help" onClick="showHelp('accauth','accname')">[Help]</A>
<br>
<div class="infoText"> The amount of resets after which the icon will be displayed.<br>
Example: 5 </div>
<br>

</td>
</tr>
<!-- MAIL OPTIONS -->

<tr>
<td valign="top" class="setupSubTitle"> Mail Options
</td>

<td >
<div class="setupValName">Send mail to ADMIN when acc registered?</div>
<input type="checkbox" name="var::mailAfterReg" value="1"  tabindex="50"   var::mailAfterReg>
<A class="help" onClick="showHelp('setup','emailAdminAdd')">[Help]</A>
<br>

<div class="setupValName">Use HTML based mail for ADMIN when acc registered:</div>
<input type="checkbox" name="config::reportAdminType" value="1" tabindex="45"  config::reportAdminType>
<A class="help" onClick="showHelp('setup','htmlAdminAdd')">[Help]</A>
<br>
<div class="setupValName"> Send mail to ADMIN when acc modified?</div>
<input type="checkbox" name="var::mailAfterEdit" value="1"  tabindex="55"  var::mailAfterEdit>
<A class="help" onClick="showHelp('setup','emailAdminModif')">[Help]</A>
<br>

<div class="setupValName">Use HTML based mail for ADMIN when acc modified:</div>
<input type="checkbox" name="config::reportAdminEditType" value="1" tabindex="40"  config::reportAdminEditType>
<A class="help" onClick="showHelp('setup','htmlAdminModif')">[Help]</A>
<br>

<hr size="1">

<div class="setupValName"> Send mail to ACCOUNT after registration?</div>
<input type="checkbox" name="var::mailAfterRegAcc" value="1"  tabindex="65"  var::mailAfterRegAcc>
<A class="help" onClick="showHelp('setup','emailAccAdd')">[Help]</A>
<br>

<div class="setupValName">Use HTML based mail for ACCOUNT after registration</div>
<input type="checkbox" name="config::reportAccType" value="1"  tabindex="60"  config::reportAccType>
<A class="help" onClick="showHelp('setup','htmlAccount')">[Help]</A>
<br>
<div class="setupValName">Send mail to ACCOUNT after deletion? </div>
<input type="checkbox" name="var::mailAfterDelete" value="1" tabindex="75"  var::mailAfterDelete>
<A class="help" onClick="showHelp('setup','emailAccDel')">[Help]</A>

<div class="setupValName">Use HTML based mail for ACCOUNT after deletion</div>
<input type="checkbox" name="config::reportDeleteType" value="1"  tabindex="70"  config::reportDeleteType>
<A class="help" onClick="showHelp('setup','htmlAccDel')">[Help]</A>
<br>
<hr>
<div class="setupValName">Send mail to ACCOUNT when inactive for X resets?</div>
<input type="checkbox" name="var::mailAfterInactivity" value="1"  tabindex="85"  var::mailAfterInactivity>
<A class="help" onClick="showHelp('setup','emailAccInact')">[Help]</A><br>
<div class="infoText"> Send mail to account when inactive for X resets.</div>
<br>
<div class="setupValName">Use HTML based mail when inactive: </div>
<input type="checkbox" name="config::reportInactivityType" value="1"  tabindex="80"  config::reportInactivityType>
<A class="help" onClick="showHelp('setup','htmlAccInact')">[Help]</A>
<br>
<div class="setupValName">Edge value for send "Inactivity mail" :</div>
<input onChange="checkInput_nr(this,0,1)"  class="setupValue" type="text" name="var::inactivityEdgeValue" value = "var::inactivityEdgeValue" size="10" tabindex="90">
<A class="help" onClick="showHelp('setup','inactEdge')">[Help]</A>
<br><div class="infoText"> Edge value for send "Inactivity mail"<br>
Example 5 /means 5 resets/ </div>
</td>
</tr>

<!-- OTHER OPTIONS -->

<tr>
<td valign="top" class="setupSubTitle">Other Options
</td>
<td>

<!-- ANTI CYCLER -->
<div class="setupValName"> 
<input type="radio" name="var::fwdType" value="0" tabindex="140"  var::fwdType>
No forward
<A class="help" onClick="showHelp('setup','forward')">[Help]</A><br>
<input type="radio" name="var::fwdType" value="1"  tabindex="150"  var::fwdType>
Forward to Default URL<br>
<input type="radio" name="var::fwdType" value="2"  tabindex="155"  var::fwdType>
Forward to Random URL<br>
<input type="radio" name="var::fwdType" value="3"  tabindex="160"  var::fwdType>
Forward to Second URL<br>
Enter default URL<br>
<input onChange="checkInput_http(this,0,1)"   class="setupValue"  type="text" name="var::fwdDefaultURL" value="var::fwdDefaultURL" size="70" tabindex="170">
<A class="help" onClick="showHelp('setup','defFWUrl')">[Help]</A><br>

</div><br>
<div class="setupValName">Default Banner URL:</div>
<input onChange="checkInput_http(this,0,1)"  class="setupValue"  type="text" name="config::defaultBannerURL" value="config::defaultBannerURL" size="70" tabindex="172">
<A class="help" onClick="showHelp('setup','defBannerURL')">[Help]</A><br>
<div class="infoText">
If you want to use a banner from your server for 
all accounts that do not<br>
fill in banner information, complete the three fields below.
</div>
<br>

<!-- COOKIES -->
<div class="setupValName">Use Cookies</div>
<input type="checkbox" name="var::cookiesUse" value="1" tabindex="180"  var::cookiesUse>
<A class="help" onClick="showHelp('setup','useCookies')">[Help]</A><br>
<div class="infoText"> Use cookies</div><br>
<div class="setupValName">Cookie's Expiration (sec.)</div>
<input onChange="checkInput_nr(this,5,1)"   class="setupValue"  type="text" name="var::cookiesExp" value="var::cookiesExp" size="15" tabindex="190">
<A class="help" onClick="showHelp('setup','cookieexpir')">[Help]</A><br>
<div class="infoText"> Enter time of Expiration (in seconds)</div>
<br>

<div class="setupValName">Site Title Max Length:</div>
<input onChange="checkInput_nr(this,5,1)"  class="setupValue"  type="text" name="inputTitleMax" value = "inputTitleMax" size="15" tabindex="200">
<A class="help" onClick="showHelp('setup','maxsitetitle')">[Help]</A><br>
<div class="infoText">
The maximum number of characters allowed for member site titles.<br>
Example: 60
</div><br>
<div class="setupValName">Site Description Max Length:</div>
<input  onChange="checkInput_nr(this,5,1)"  class="setupValue"  type="text" name="inputDescrMax" value = "inputDescrMax" size="15" tabindex="210">
<A class="help" onClick="showHelp('setup','maxsitedescr')">[Help]</A><br>
<div class="infoText">
The maximum number of characters allowed for member site descriptions.<br>
Example: 255
</div><br>

<hr size="1">
<!-- UPDATING THE LIST -->
<div class="setupValName">Use CRON<div>
<input type="checkbox" name="var::useCron" value="1"  tabindex="220"  var::useCron>
<A class="help" onClick="showHelp('setup','usecron')">[Help]</A><br>
<div class="infoText">Check this box if you are using cron to update the list.
</div><br>

<div class="setupValName">Use NICE<div>
<input type="checkbox" name="var::useNice" value="1" tabindex="230"  var::useNice>
<A class="help" onClick="showHelp('setup','usenice')">[Help]</A><br>
<div class="infoText">Check this box if you want to run cron tasks with NICE</div><br>
<!-- CRON -->

<div class="setupValName">Rerank Time: (cron)</div>
<select name="var::rerankPeriodCron" class="inputValue">
<option value="1" var::rerankPeriodCron>Every Min</option>
<option value="5" var::rerankPeriodCron>Every 5. Min</option>
<option value="10" var::rerankPeriodCron>Every 10. Min</option>
<option value="15" var::rerankPeriodCron>Every 15. Min</option>
<option value="20" var::rerankPeriodCron>Every 20. Min</option>
<option value="25" var::rerankPeriodCron>Every 25. Min</option>
<option value="30" var::rerankPeriodCron>Every 30. Min</option>
<option value="60" var::rerankPeriodCron>Every Hour</option>
<option value="120" var::rerankPeriodCron>Every 2. Hour</option>
<option value="180" var::rerankPeriodCron>Every 3. Hour</option>
<option value="240" var::rerankPeriodCron>Every 4. Hour</option>
<option value="360" var::rerankPeriodCron>Every 6. Hour</option>
<option value="720" var::rerankPeriodCron>Every 12. Hour</option>
</select>

<A class="help" onClick="showHelp('setup','cronrerank')">[Help]</A>
<div class="infoText">
Spec. the period of reranks<br>
*,*,*,*,*<br>
min,hour,day of month,month of year,day of week<br>
* means "occures on every min/hour/..."<br>
Example: 3600
</div><br>

<div class="setupValName">Reset Time: (cron)</div>
<select name="var::resetPeriodCron" class="inputValue">
<option value="60" var::resetPeriodCron>Every Hour</option>
<option value="120" var::resetPeriodCron>Every 2. Hour</option>
<option value="180" var::resetPeriodCron>Every 3. Hour</option>
<option value="240" var::resetPeriodCron>Every 4. Hour</option>
<option value="360" var::resetPeriodCron>Every 6. Hour</option>
<option value="720" var::resetPeriodCron>Every 12. Hour</option>
<option value="1440" var::resetPeriodCron>Every Day</option>
<option value="2880" var::resetPeriodCron>Every 2. Day</option>
<option value="4320" var::resetPeriodCron>Every 3. Day</option>
<option value="7200" var::resetPeriodCron>Every 5. Day</option>
<option value="14400" var::resetPeriodCron>Every 10. Day</option>
<option value="21600" var::resetPeriodCron>Every 15. Day</option>
<option value="43200" var::resetPeriodCron>Every Month</option>
</select>

<A class="help" onClick="showHelp('setup','cronreset')">[Help]</A>
<div class="infoText">
Spec. the period of resets<br>
*,*,*,*,*<br>
min,hour,day of month,month of year,day of week<br>
* means "occures on every min/hour/..."<br>
Example: 3600
</div><br>

<div class="setupValName">Rerank Time:</div>
<input onChange=" checkInput_nr(this,0,1)"  class="setupValue"  type="text" name="var::rerankPeriod" value="var::rerankPeriod" size="12" tabindex="250">
<A class="help" onClick="showHelp('setup','manrerank')">[Help]</A><br>
<div class="infoText">
The minimum number of seconds between list re-ranks<br>
Example: 3600
</div><br>
<div class="setupValName">Reset Time:</div>
<input onChange=" checkInput_nr(this,0,1)"  class="setupValue"  type="text" name="var::resetPeriod" value="var::resetPeriod" size="12" tabindex="260">
<A class="help" onClick="showHelp('setup','manreset')">[Help]</A><br>
<div class="infoText">
The minimum number of seconds between list resets<br>
Example: 86400
</div>
<hr size="1">
<div class="setupValName">Maximum Banner Height:</div>
<input onChange= "checkInput_nr(this,0,1)"   class="setupValue"  type="text" name="var::maxBannerHeight" value="var::maxBannerHeight" size="10" tabindex="290">
<A class="help" onClick="showHelp('setup','maxBannerH')">[Help]</A><br>
<div class="infoText">
The maximum height value members can use for their banners.<br>
Example: 60
</div><br>
<div class="setupValName">Maximum Banner Width:</div>
<input onChange= "checkInput_nr(this,0,1)"  class="setupValue"  type="text" name="var::maxBannerWidth" value="var::maxBannerWidth" size="10" tabindex="300">
<A class="help" onClick="showHelp('setup','maxBannerW')">[Help]</A><br>
<div class="infoText">
The maximum width value members can use for their banners.<br>
Example: 468 </div>
<hr size="1">
<div class="setupValName">Maximum Sample Height:</div>
<input onChange= "checkInput_nr(this,0,1)"   class="setupValue"  type="text" name="var::maxSampleHeight" value="var::maxSampleHeight" size="10" tabindex="320">
<A class="help" onClick="showHelp('setup','maxSampleH')">[Help]</A>
<br>
<div class="infoText">The maximum height value members can use for their 
samples.<br>
Example: 60 </div><br>

<div class="setupValName">Maximum Sample Width:</div>
<input onChange= "checkInput_nr(this,0,1)"  class="setupValue"  type="text" name="var::maxSampleWidth" value="var::maxSampleWidth" size="10" tabindex="330">
<A class="help" onClick="showHelp('setup','maxSampleW')">[Help]</A>
<br>
<div class="infoText">
The maximum width value members can use for their 
samples.<br>
Example: 468 </div><br>

<div class="setupValName">Implicit IN for new account</div>
<input onChange= "checkInput_nr(this,0,1)"   class="setupValue"  type="text" name="var::inForNewAcc" value="var::inForNewAcc" size="10" tabindex="340">
<A class="help" onClick="showHelp('setup','implicitIN')">[Help]</A>
<br>
<div class="infoText">
IN value set to new account as bonus<br>
Example: 100 </div><br>


<div class="setupValName">Implicit OUT for new account</div>
<input onChange= "checkInput_nr(this,0,1)"  class="setupValue"  type="text" name="var::outForNewAcc" value="var::outForNewAcc" size="10" tabindex="350">
<A class="help" onClick="showHelp('setup','implicitOUT')">[Help]</A>
<br>
<div class="infoText">OUT value set to new account as bonus<br>
Example: 100 </div><br>

<div class="setupValName">Auto-suspend for new account</div>
<input type="checkbox" name="var::autoSuspendNewAcc" value="1" tabindex="365"  var::autoSuspendNewAcc>
<A class="help" onClick="showHelp('setup','autoSuspendN')">[Help]</A>
<br>
<div class="infoText">
New added account will be automaticly suspended<br>
</div><br>

<div class="setupValName">Auto-suspend for edited account</div>
<input type="checkbox" name="var::autoSuspendModifAcc" value="1" tabindex="376"  var::autoSuspendModifAcc>
<A class="help" onClick="showHelp('setup','autoSuspendE')">[Help]</A>
<br>
<div class="infoText">Edited account (by user, not by webmaster) will be automaticly suspended<br>
</div><br>

<!-- ------------------------------------------------------------------------      -->

<div class="setupValName">Default hit ratio:</div>
<input onChange= "checkInput_ratio(this,1)"  class="setupValue"  type="text" name="var::defaultHitRatio" value="var::defaultHitRatio" size="10" tabindex="380">
<A class="help" onClick="showHelp('setup','defaultRatio')">[Help]</A>
<br>
<div class="infoText"> Default hit ratio for new members.<br>
Example: 1:2 //1(in),2(out)
</div></div></div></td>
</tr>

<tr>
<td  align="right" ></td><td>
<table border="0" width="100%" cellspacing="0" cellpadding="0">
<tr>
  <td width="30%" align="left" class="setupValName">Enter new password</td>
  <td><input  class="setupValue"  type="text" name="pwd1" size="30" tabindex="390"><A class="help" onClick="showHelp('setup','pwd')">[Help]</A><td>
</tr>
<tr>
  <td width="30%" align="left" class="setupValName">Reenter new password</td>
  <td><input class="setupValue"  type="text" name="pwd2" size="30" tabindex="400"></td>
</tr>  
</table>
</td>
</tr>

<!-- BOTH -------------------------------------------------------------------------------->

</table>
</td>
</tr>
<tr><td>
<input class="setupValue"  type="button" name="button" value="Save Setup" onClick="checkSetup(this)" tabindex="410">
<input type="hidden" name="action" value="%#SAVE_SETUP#%">
</td></tr>
</table>
</form>
</div>
</body>
</html>#%EOF%#
#%File: ./temps/defaults/_stat_total.html%#
<html>
<head>
  <title>Statistic Traffic PRO  (#%toplistID%#)</title>
<link rel="stylesheet" href="%#TL_URL#%/main.css""" type="text/css">
<script src="%#TL_URL#%/main.js"""></script>
</head>
<body >

<div align="center">

<form method="POST" action="_#ADMIN_CGI#_">
    <table border="0" cellpadding="0" cellspacing="0" >
      <tr bgcolor="#000000">
        <td align="center"> 
          <table  cellpadding="4" border="0" >

<!-- CH_UPTIME -->
<tr>
              <td  colspan="2" align="left" valign="top" >Uptime&nbsp;Stat</td> </tr>
<tr>              <td  > 
                <table border="0"  cellspacing="0" cellpadding="0">
		
                  <tr> 
                    <td><img src="config::genStatURL?date=uptimestat"></td>
                    <td>
		         <table border="0" cellspacing="0" cellpadding="0"  height = "100%">
			   <tr><td  valign="top" class="axis" height = "25%">%#VAL_1#%</td></tr>
                           <tr><td valign="top"  class="axis" height = "25%">%#VAL_2#%</td></tr>
                           <tr><td valign="top"  class="axis" height = "25%">%#VAL_3#%</td></tr>
                           <tr><td valign="top"  class="axis" height = "25%">%#VAL_4#%</td></tr>
		         </table>
		    </td>
                  </tr>
		  
                  <tr> 
		    <td>
		       <table border="0" cellspacing="0" cellpadding="0" width="100%">
		       <tr class="axis">
                        <td >%#NR_1#%</td>
                	<td >%#NR_2#%</td>
                	<td >%#NR_3#%</td>
                	<td >%#NR_4#%</td>
                	<td >%#NR_5#%</td>
                	<td >%#NR_6#%</td>
                	<td >%#NR_7#%</td>
                	<td >%#NR_8#%</td>
                	<td >%#NR_9#%</td>
                	<td >%#NR_10#%</td>
                	<td >%#NR_11#%</td>
                	<td >%#NR_12#%</td>
                	<td >%#NR_13#%</td>
                	<td >%#NR_14#%</td>
                	<td >%#NR_15#%</td>
                	<td >%#NR_16#%</td>
                	<td>%#NR_17#%</td>
                	<td>%#NR_18#%</td>
                	<td>%#NR_19#%</td>
                	<td>%#NR_20#%</td>
                	<td>%#NR_21#%</td>
                	<td>%#NR_22#%</td>
                	<td>%#NR_23#%</td>
                	<td>%#NR_24#%</td>
		      </tr>
		  </table>		    
		  </td>
		  <td>hour</td>
                  </tr>
                </table>
		<td valign="bottom">
		  <table cellspacing="0" >
		      <tr>
		        <td valign="bottom" colspan="1"><A class="help" onClick="javascript:showHelp('stat','uptime')">[Help]</A></td>
		      </tr>
		      
		  </table>
		</td>
              </td>
</tr>
<!-- END -->

<!-- CH_OUT -->
<tr>
              <td colspan="2" align="left"  valign="top" >Click&nbsp;Stat</td></tr>
<tr>              <td  > 
                <table border="0" height="100%"  cellspacing="0" cellpadding="0">
		
                  <tr> 
                    <td><img src="config::genStatURL?date=outrankstat"></td>
                    <td>
		         <table border="0" cellspacing="0" cellpadding="0"  height = "100%">
			   <tr><td valign="top"  class="axis" height = "25%">%#VAL_1#%</td></tr>
                           <tr><td valign="top"  class="axis" height = "25%">%#VAL_2#%</td></tr>
                           <tr><td valign="top"  class="axis" height = "25%">%#VAL_3#%</td></tr>
                           <tr><td valign="top"  class="axis" height = "25%">%#VAL_4#%</td></tr>
		         </table>
		    </td>
                  </tr>
		  
                  <tr> 
		    <td>
		       <table border="0" cellspacing="0" cellpadding="0" width="100%">
		       <tr class="axis">
                        <td>%#NR_1#%</td>
                	<td>%#NR_2#%</td>
                	<td>%#NR_3#%</td>
                	<td>%#NR_4#%</td>
                	<td>%#NR_5#%</td>
                	<td>%#NR_6#%</td>
                	<td>%#NR_7#%</td>
                	<td>%#NR_8#%</td>
                	<td>%#NR_9#%</td>
                	<td>%#NR_10#%</td>
                	<td>%#NR_11#%</td>
                	<td>%#NR_12#%</td>
                	<td>%#NR_13#%</td>
                	<td>%#NR_14#%</td>
                	<td>%#NR_15#%</td>
                	<td>%#NR_16#%</td>
                	<td>%#NR_17#%</td>
                	<td>%#NR_18#%</td>
                	<td>%#NR_19#%</td>
                	<td>%#NR_20#%</td>
                	<td>%#NR_21#%</td>
                	<td>%#NR_22#%</td>
                	<td>%#NR_23#%</td>
                	<td>%#NR_24#%</td>
		      </tr>
		  </table>		    
		  </td>
		  <td>rank</td>
                  </tr>
                </table>
		<td valign="bottom">
		  <table cellspacing="0" >
		      <tr>
		        <td valign="bottom" colspan="1"><A class="help" onClick="javascript:showHelp('stat','outstat')">[Help]</A></td>
		      </tr>
		      
		  </table>
		
		</td>
              </td>
</tr>

<!-- END -->


<!-- CH_REG-->
<tr>
              <td colspan="2" align="left" valign="top" >Account&nbsp;Registrations&nbsp;Per&nbsp;Day</td></tr>
<tr>              <td > 
                <table border="0" height="100%"  cellspacing="0" cellpadding="0">
		
                  <tr> 
                    <td><img src="config::genStatURL?date=reg#%LINES%#"></td>
                    <td>
		         <table border="0" cellspacing="0" cellpadding="0"  height = "100%">
			   <tr><td valign="top"  class="axis"  height = "25%">%#VAL_1#%</td></tr>
                           <tr><td valign="top"  class="axis"  height = "25%">%#VAL_2#%</td></tr>
                           <tr><td valign="top"  class="axis"  height = "25%">%#VAL_3#%</td></tr>
                           <tr><td valign="top"  class="axis"  height = "25%">%#VAL_4#%</td></tr>
		         </table>
		    </td>
                  </tr>
		  
                  <tr> 
		    <td>
		       <table border="0" cellspacing="0" cellpadding="0" width="100%">
		       <tr class="axis">
                        <td>%#NR_1#%</td>
                	<td>%#NR_2#%</td>
                	<td>%#NR_3#%</td>
                	<td>%#NR_4#%</td>
                	<td>%#NR_5#%</td>
                	<td>%#NR_6#%</td>
                	<td>%#NR_7#%</td>
                	<td>%#NR_8#%</td>
                	<td>%#NR_9#%</td>
                	<td>%#NR_10#%</td>
                	<td>%#NR_11#%</td>
                	<td>%#NR_12#%</td>
                	<td>%#NR_13#%</td>
                	<td>%#NR_14#%</td>
                	<td>%#NR_15#%</td>
                	<td>%#NR_16#%</td>
                	<td>%#NR_17#%</td>
                	<td>%#NR_18#%</td>
                	<td>%#NR_19#%</td>
                	<td>%#NR_20#%</td>
                	<td>%#NR_21#%</td>
                	<td>%#NR_22#%</td>
                	<td>%#NR_23#%</td>
                	<td>%#NR_24#%</td>
                	<td>%#NR_25#%</td>
                	<td>%#NR_26#%</td>
                	<td>%#NR_27#%</td>
                	<td>%#NR_28#%</td>
                	<td>%#NR_29#%</td>
                	<td>%#NR_30#%</td>
                	<td>%#NR_31#%</td>
		      </tr>
		  </table>		    
		  </td>
		  <td>day</td>
                  </tr>
                </table>
		<td>
				  <table cellspacing="0" >
		      <tr>
		        <td colspan="2"><A class="help" onClick="javascript:showHelp('stat','reg')">[Help]</A></td>
		      </tr>
		      
		  </table>

		</td>
              </td>
</tr>
<!-- END -->







<!-- CH_HOUR -->
<tr>
              <td colspan="2" align="left" valign="top" >Per&nbsp;Hour&nbsp;Statistic</td></tr>
<tr>              <td  > 
                <table border="0" height="100%"  cellspacing="0" cellpadding="0">
		
                  <tr> 
                    <td><img src="config::genStatURL?date=hour#%LINES%#"></td>
                    <td>
		         <table border="0" cellspacing="0" cellpadding="0"  height = "100%">
			   <tr><td valign="top"  class="axis"  height = "25%">%#VAL_1#%</td></tr>
                           <tr><td valign="top"  class="axis"  height = "25%">%#VAL_2#%</td></tr>
                           <tr><td valign="top"  class="axis"   height = "25%">%#VAL_3#%</td></tr>
                           <tr><td valign="top"  class="axis"  height = "25%">%#VAL_4#%</td></tr>
		         </table>
		    </td>
                  </tr>
		  
                  <tr> 
		    <td>
		       <table border="0" cellspacing="0" cellpadding="0" width="100%">
		       <tr class="axis">
                        <td>%#NR_1#%</td>
                	<td>%#NR_2#%</td>
                	<td>%#NR_3#%</td>
                	<td>%#NR_4#%</td>
                	<td>%#NR_5#%</td>
                	<td>%#NR_6#%</td>
                	<td>%#NR_7#%</td>
                	<td>%#NR_8#%</td>
                	<td>%#NR_9#%</td>
                	<td>%#NR_10#%</td>
                	<td>%#NR_11#%</td>
                	<td>%#NR_12#%</td>
                	<td>%#NR_13#%</td>
                	<td>%#NR_14#%</td>
                	<td>%#NR_15#%</td>
                	<td>%#NR_16#%</td>
                	<td>%#NR_17#%</td>
                	<td>%#NR_18#%</td>
                	<td>%#NR_19#%</td>
                	<td>%#NR_20#%</td>
                	<td>%#NR_21#%</td>
                	<td>%#NR_22#%</td>
                	<td>%#NR_23#%</td>
                	<td>%#NR_24#%</td>
		      </tr>

		  </table>		    
		  </td>
		  <td valign="top">hour</td>
                  </tr>
               </table>
       		<td> 
				  <table cellspacing="0" >
		      <tr>
		        <td ><img src="config::genStatURL?date=cin"></td><td class="statTips">Raw IN [hitbot free]</td>
		      </tr>
		      <tr>
		        <td><img src="config::genStatURL?date=cpin"></td><td class="statTips">Unique IN [hitbot free]</td>
		      </tr>
		      <tr>
		        <td><img src="config::genStatURL?date=rin"></td><td class="statTips">Raw IN</td>
		      </tr>
		      <tr>
		        <td><img src="config::genStatURL?date=pin"></td><td class="statTips">Unique IN</td>
		      </tr>
		      <tr>
		        <td><img src="config::genStatURL?date=out"></td><td class="statTips">Raw OUT</td>
		      </tr>
		      <tr>
		        <td><img src="config::genStatURL?date=gout"></td><td class="statTips">Unique OUT</td>
		      </tr>
		      <tr>
		        <td colspan="2"><A class="help" onClick="javascript:showHelp('stat','hour')">[Help]</A></td>
		      </tr>
		      
		  </table>

		</td>
              </td>
</tr>


<!-- END -->

<!-- CH_DAY-->
<tr>
              <td colspan="2" align="left" valign="top" >Per&nbsp;Day&nbsp;Statistic</td></tr>
<tr>              <td > 
                <table border="0" height="100%"  cellspacing="0" cellpadding="0">
		
                  <tr> 
                    <td><img src="config::genStatURL?date=day#%LINES%#"></td>
                    <td>
		         <table border="0" cellspacing="0" cellpadding="0"  height = "100%">
			   <tr><td valign="top"  class="axis"  height = "25%">%#VAL_1#%</td></tr>
                           <tr><td valign="top"  class="axis"  height = "25%">%#VAL_2#%</td></tr>
                           <tr><td valign="top"  class="axis"  height = "25%">%#VAL_3#%</td></tr>
                           <tr><td valign="top"  class="axis"  height = "25%">%#VAL_4#%</td></tr>
		         </table>
		    </td>
                  </tr>
		  
                  <tr> 
		    <td>
		       <table border="0" cellspacing="0" cellpadding="0" width="100%">
		       <tr class="axis">
                        <td>%#NR_1#%</td>
                	<td>%#NR_2#%</td>
                	<td>%#NR_3#%</td>
                	<td>%#NR_4#%</td>
                	<td>%#NR_5#%</td>
                	<td>%#NR_6#%</td>
                	<td>%#NR_7#%</td>
                	<td>%#NR_8#%</td>
                	<td>%#NR_9#%</td>
                	<td>%#NR_10#%</td>
                	<td>%#NR_11#%</td>
                	<td>%#NR_12#%</td>
                	<td>%#NR_13#%</td>
                	<td>%#NR_14#%</td>
                	<td>%#NR_15#%</td>
                	<td>%#NR_16#%</td>
                	<td>%#NR_17#%</td>
                	<td>%#NR_18#%</td>
                	<td>%#NR_19#%</td>
                	<td>%#NR_20#%</td>
                	<td>%#NR_21#%</td>
                	<td>%#NR_22#%</td>
                	<td>%#NR_23#%</td>
                	<td>%#NR_24#%</td>
                	<td>%#NR_25#%</td>
                	<td>%#NR_26#%</td>
                	<td>%#NR_27#%</td>
                	<td>%#NR_28#%</td>
                	<td>%#NR_29#%</td>
                	<td>%#NR_30#%</td>
                	<td>%#NR_31#%</td>
		      </tr>
		  </table>		    
		  </td>
		  <td>day</td>
                  </tr>
                </table>
		<td>
				  <table cellspacing="0" >
		      <tr>
		        <td ><img src="config::genStatURL?date=cin"></td><td class="statTips">Raw IN [hitbot free]</td>
		      </tr>
		      <tr>
		        <td><img src="config::genStatURL?date=cpin"></td><td class="statTips">Unique IN [hitbot free]</td>
		      </tr>
		      <tr>
		        <td><img src="config::genStatURL?date=rin"></td><td class="statTips">Raw IN</td>
		      </tr>
		      <tr>
		        <td><img src="config::genStatURL?date=pin"></td><td class="statTips">Unique IN</td>
		      </tr>
		      <tr>
		        <td><img src="config::genStatURL?date=out"></td><td class="statTips">Raw OUT</td>
		      </tr>
		      <tr>
		        <td><img src="config::genStatURL?date=gout"></td><td class="statTips">Unique OUT</td>
		      </tr>
		      <tr>
		        <td colspan="2"><A class="help" onClick="javascript:showHelp('stat','day')">[Help]</A></td>
		      </tr>
		      
		  </table>

		</td>
              </td>
</tr>
<!-- END -->

<!-- CH_MONTH-->
<tr>
              <td colspan="2" align="left" valign="top" >Per&nbsp;Month&nbsp;Statistic</td></tr>
<tr>              <td > 
                <table border="0" height="100%"  cellspacing="0" cellpadding="0">
		
                  <tr> 
                    <td><img src="config::genStatURL?date=month#%LINES%#"></td>
                    <td>
		         <table border="0" cellspacing="0" cellpadding="0"  height = "100%">
			   <tr><td valign="top"  class="axis" height = "25%">%#VAL_1#%</td></tr>
                           <tr><td valign="top"  class="axis" height = "25%">%#VAL_2#%</td></tr>
                           <tr><td valign="top"  class="axis" height = "25%">%#VAL_3#%</td></tr>
                           <tr><td valign="top"  class="axis" height = "25%">%#VAL_4#%</td></tr>
		         </table>
		    </td>
                  </tr>
		  
                  <tr> 
		    <td>
		       <table border="0" cellspacing="0" cellpadding="0" width="100%">
		       <tr class="axis">
                        <td>%#NR_1#%</td>
                	<td>%#NR_2#%</td>
                	<td>%#NR_3#%</td>
                	<td>%#NR_4#%</td>
                	<td>%#NR_5#%</td>
                	<td>%#NR_6#%</td>
                	<td>%#NR_7#%</td>
                	<td>%#NR_8#%</td>
                	<td>%#NR_9#%</td>
                	<td>%#NR_10#%</td>
                	<td>%#NR_11#%</td>
                	<td>%#NR_12#%</td>
		      </tr>
		  </table>		    
		  </td>
		  <td>month</td>
                  </tr>
                </table>
		<td>
				  <table cellspacing="0" >
		      <tr>
		        <td ><img src="config::genStatURL?date=cin"></td><td class="statTips">Raw IN [hitbot free]</td>
		      </tr>
		      <tr>
		        <td><img src="config::genStatURL?date=cpin"></td><td class="statTips">Unique IN [hitbot free]</td>
		      </tr>
		      <tr>
		        <td><img src="config::genStatURL?date=rin"></td><td class="statTips">Raw IN</td>
		      </tr>
		      <tr>
		        <td><img src="config::genStatURL?date=pin"></td><td class="statTips">Unique IN</td>
		      </tr>
		      <tr>
		        <td><img src="config::genStatURL?date=out"></td><td class="statTips">Raw OUT</td>
		      </tr>
		      <tr>
		        <td><img src="config::genStatURL?date=gout"></td><td class="statTips">Unique OUT</td>
		      </tr>
		      <tr>
		        <td colspan="2"><A class="help" onClick="javascript:showHelp('stat','month')">[Help]</A></td>
		      </tr>
		      
		  </table>

		 </td>
              </td>
</tr>

<!-- END -->

<!-- CH_YEAR-->

<tr>
              <td colspan="2" align="left" valign="top" >Per&nbsp;Year&nbsp;Statistic</td></tr>
<tr>              <td > 
                <table border="0" height="100%"  cellspacing="0" cellpadding="0">
		
                  <tr> 
                    <td><img src="config::genStatURL?date=year#%LINES%#"></td>
                    <td>
		         <table border="0" cellspacing="0" cellpadding="0"  height = "100%">
			   <tr><td valign="top"  class="axis" height = "25%">%#VAL_1#%</td></tr>
                           <tr><td valign="top"  class="axis" height = "25%">%#VAL_2#%</td></tr>
                           <tr><td valign="top"  class="axis" height = "25%">%#VAL_3#%</td></tr>
                           <tr><td valign="top"  class="axis" height = "25%">%#VAL_4#%</td></tr>
		         </table>
		    </td>
                  </tr>
		  
                  <tr> 
		    <td>
		       <table border="0" cellspacing="0" cellpadding="0" width="100%">
		       <tr class="axis">
                        <td>%#NR_1#%</td>
                	<td>%#NR_2#%</td>
                	<td>%#NR_3#%</td>
                	<td>%#NR_4#%</td>
                	<td>%#NR_5#%</td>
                	<td>%#NR_6#%</td>
                	<td>%#NR_7#%</td>
                	<td>%#NR_8#%</td>
                	<td>%#NR_9#%</td>
                	<td>%#NR_10#%</td>
                	<td>%#NR_11#%</td>
                	<td>%#NR_12#%</td>
		      </tr>
		  </table>		    
		  </td>
		  <td>year</td>
                  </tr>
                </table>
		<td>
		  <table cellspacing="0" >
		      <tr>
		        <td ><img src="config::genStatURL?date=cin"></td><td class="statTips">Raw IN [hitbot free]</td>
		      </tr>
		      <tr>
		        <td><img src="config::genStatURL?date=cpin"></td><td class="statTips">Unique IN [hitbot free]</td>
		      </tr>
		      <tr>
		        <td><img src="config::genStatURL?date=rin"></td><td class="statTips">Raw IN</td>
		      </tr>
		      <tr>
		        <td><img src="config::genStatURL?date=pin"></td><td class="statTips">Unique IN</td>
		      </tr>
		      <tr>
		        <td><img src="config::genStatURL?date=out"></td><td class="statTips">Raw OUT</td>
		      </tr>
		      <tr>
		        <td><img src="config::genStatURL?date=gout"></td><td class="statTips">Unique OUT</td>
		      </tr>
		      <tr>
		        <td colspan="2"><A class="help" onClick="javascript:showHelp('stat','year')">[Help]</A></td>
		      </tr>
		      
		  </table>
		
		</td>
              </td>
</tr>
<!-- END -->


</table>
</td>
</tr>
</table>

</form>

</div>
</body>
</html>

#%EOF%#
#%File: ./temps/defaults/edit_add_form.html%#
<html>
<head>
  <title>Edit Add Form  (#%toplistID%#)</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <link rel="stylesheet" href="%#TL_URL#%/main.css"" type="text/css">
  <script src="%#TL_URL#%/main.js""></script>
</head>
<body onLoad="autoFocus();">
  <form method="post" action     ="_#ADMIN_CGI#_">
<table width="90%" align="center" class="mainBorder" cellpadding="5">
  <tr >
    <td colspan="2" class="mainTitle">
      <center>Edit Add Form  (#%toplistID%#)</center>
    </td>
  </tr>
    <tr>
      <td colspan="2" >Strings like #%something%# are variables replaced by values in ListGeneration process</td>
    </tr> 
    <tr> 
    <td colspan="2" >
    <table class="noBorder" cellspacing="0" cellpadding="0">
    <tr >
      <td class="setupValName">
        <div class="editItems">CSS Style definitions</div>
      </td>
      <td class="setupValName">BG Color</td>      
      <td class="setupValName">Color</td>
      <td class="setupValName">Size</td>
      <td class="setupValName">Weight</td>
      <td class="setupValName">Font</td>
      <td  valign="top"><A class="help" tabindex="50"  onClick="javascript:showHelp('addedit','templFields')">[Help]</A></td>            
      </tr>
    
    <tr >
      <td class="setupValName">MainTitle [class=mainTitle]&nbsp;</td>
      <td><input class="inputValue" type="text" name="css.mainTitle_background-color" value="css.mainTitle_background-color" size="5" tabindex="1">   </td>
      <td><input class="inputValue" type="text" name="css.mainTitle_color" value="css.mainTitle_color" size="5" tabindex="1">   </td>
      <td><input class="inputValue" type="text" name="css.mainTitle_font-size" value="css.mainTitle_font-size" size="5" tabindex="1">     </td>    
      <td><input class="inputValue" type="text" name="css.mainTitle_font-weight" value="css.mainTitle_font-weight" size="5" tabindex="1"> </td>
      <td><input class="inputValue" type="text" name="css.mainTitle_font-family" value="css.mainTitle_font-family" size="5" tabindex="1">     </td>       
      
<td></td>
      </tr>
      
      <tr>
      <td class="setupValName">SubTitle [class=subTitle]&nbsp;</td>
      <td><input class="inputValue" type="text" name="css.subTitle_background-color" value="css.subTitle_background-color" size="5" tabindex="1">   </td>
      <td><input class="inputValue" type="text" name="css.subTitle_color" value="css.subTitle_color" size="5" tabindex="1">   </td>
      <td><input class="inputValue" type="text" name="css.subTitle_font-size" value="css.subTitle_font-size" size="5" tabindex="1">     </td>    
      <td><input class="inputValue" type="text" name="css.subTitle_font-weight" value="css.subTitle_font-weight" size="5" tabindex="1"> </td>
      <td><input class="inputValue" type="text" name="css.subTitle_font-family" value="css.subTitle_font-family" size="5" tabindex="1">     </td>       
	
      </td>
<td></td>
      </tr>
      <tr>
      <td class="setupValName">Body bgcolor [class=addacc]&nbsp;</td>
      <td><input class="inputValue" type="text" name="cssbody_background-color" value="cssbody_background-color" size="5" tabindex="1">   </td>
	      <td></td><td></td>	<td></td>	<td></td>
      </td>
<td></td>
    </tr>
      <tr>
        <td class="setupValName">Field Value [class=inputValue]&nbsp;</td>
        <td><input class="inputValue" type="text" name="css.inputValue_background-color" value="css.inputValue_background-color" size="5" tabindex="1">   </td>
        <td><input class="inputValue" type="text" name="css.inputValue_color" value="css.inputValue_color" size="5" tabindex="1">   </td>
        <td><input class="inputValue" type="text" name="css.inputValue_font-size" value="css.inputValue_font-size" size="5" tabindex="1">     </td>    
        <td><input class="inputValue" type="text" name="css.inputValue_font-weight" value="css.inputValue_font-weight" size="5" tabindex="1"> </td>
        <td><input class="inputValue" type="text" name="css.inputValue_font-family" value="css.inputValue_font-family" size="5" tabindex="1">     </td>       
      </td>
<td></td>
      </tr>
    
    
      <tr>
        <td class="setupValName">Field Label [class=fieldLabel]&nbsp;</td>
        <td><input class="inputValue" type="text" name="css.fieldLabel_background-color" value="css.fieldLabel_background-color" size="5" tabindex="1">   </td>      
        <td><input class="inputValue" type="text" name="css.fieldLabel_color" value="css.fieldLabel_color" size="5" tabindex="1">   </td>
        <td><input class="inputValue" type="text" name="css.fieldLabel_font-size" value="css.fieldLabel_font-size" size="5" tabindex="1">     </td>    
        <td><input class="inputValue" type="text" name="css.fieldLabel_font-weight" value="css.fieldLabel_font-weight" size="5" tabindex="1"> </td>
        <td><input class="inputValue" type="text" name="css.fieldLabel_font-family" value="css.fieldLabel_font-family" size="5" tabindex="1">     </td>       
      
<td></td>
      </tr>

      <tr>
        <td class="setupValName">Information Text [class=infoText]&nbsp;</td>
        <td><input class="inputValue" type="text" name="css.infoText_background-color" value="css.infoText_background-color" size="5" tabindex="1">   </td>	
        <td><input class="inputValue" type="text" name="css.infoText_color" value="css.infoText_color" size="5" tabindex="1">   </td>
        <td><input class="inputValue" type="text" name="css.infoText_font-size" value="css.infoText_font-size" size="5" tabindex="1">     </td>    
        <td><input class="inputValue" type="text" name="css.infoText_font-weight" value="css.infoText_font-weight" size="5" tabindex="1"> </td>
        <td><input class="inputValue" type="text" name="css.infoText_font-family" value="css.infoText_font-family" size="5" tabindex="1">     </td>       
      
<td></td>
      </tr>


      <tr>
        <td class="setupValName">Help Link [class=help]&nbsp;</td>
        <td><input class="inputValue" type="text" name="css.help_background-color" value="css.help_background-color" size="5" tabindex="1">   </td>	
        <td><input class="inputValue" type="text" name="css.help_color" value="css.help_color" size="5" tabindex="1">   </td>
        <td><input class="inputValue" type="text" name="css.help_font-size" value="css.help_font-size" size="5" tabindex="1">     </td>    
        <td><input class="inputValue" type="text" name="css.help_font-weight" value="css.help_font-weight" size="5" tabindex="1"> </td>
        <td><input class="inputValue" type="text" name="css.help_font-family" value="css.help_font-family" size="5" tabindex="1">     </td>       
      
<td></td>
      </tr>

      <tr>
        <td class="setupValName">Error text [class=error]&nbsp;</td>
        <td><input class="inputValue" type="text" name="css.error_background-color" value="css.error_background-color" size="5" tabindex="1">   </td>	
        <td><input class="inputValue" type="text" name="css.error_color" value="css.error_color" size="5" tabindex="1">   </td>
        <td><input class="inputValue" type="text" name="css.error_font-size" value="css.error_font-size" size="5" tabindex="1">     </td>    
        <td><input class="inputValue" type="text" name="css.error_font-weight" value="css.error_font-weight" size="5" tabindex="1"> </td>
        <td><input class="inputValue" type="text" name="css.error_font-family" value="css.error_font-family" size="5" tabindex="1">     </td>       
      
<td></td>
      </tr>
      <tr>
        <td class="setupValName">Reference Link [class=choose]&nbsp;</td>
        <td><input class="inputValue" type="text" name="css.choose_background-color" value="css.choose_background-color" size="5" tabindex="1">   </td>	
        <td><input class="inputValue" type="text" name="css.choose_color" value="css.choose_color" size="5" tabindex="1">   </td>
        <td><input class="inputValue" type="text" name="css.choose_font-size" value="css.choose_font-size" size="5" tabindex="1">     </td>    
        <td><input class="inputValue" type="text" name="css.choose_font-weight" value="css.choose_font-weight" size="5" tabindex="1"> </td>
        <td><input class="inputValue" type="text" name="css.choose_font-family" value="css.choose_font-family" size="5" tabindex="1">     </td>       
      
<td></td>
      </tr>

    </table>
</td>
    </tr>
    <tr>

      <td colspan="2" class ="fieldLabel"><div  class="editItems"><br>Insert Own CSS definitions
      <A class="help" tabindex="50"  onClick="javascript:showHelp('addedit','owncss')">[Help]</A></div></td>
    
    </td>
    </tr>
    <tr >
      <td colspan="2"  class ="fieldLabel">
      <textarea   class="inputValue" tabindex="70"   name="fieldOWNCSS" cols="100" rows="10">%#OWN_CSS#%</textarea>
      </td>

    </tr> 
    
    <tr >
      <td colspan="2"  class ="fieldLabel"><div  class="editItems"><br>Account Add Cover Page
      <A class="help" tabindex="50"  onClick="javascript:showHelp('addedit','coverpage')">[Help]</A></div></td>            
    </tr> 
    <tr >
      <td class ="fieldLabel"><div class="small"><br>%#VAR_INFO#%</div>
      </td>

    </tr> 
    
    <tr >
      <td class ="fieldLabel" colspan="2">
      <textarea   class="inputValue" tabindex="70"   name="fieldCoverPage" cols="140" rows="50">%#VAL_ICON_UP#%</textarea>
      </td>

    </tr> 
    <tr>     
      <td colspan="2" width="80">        
       <input   class="inputValue"  tabindex="171"   type="submit" name="display" value="Save">
        <input type="hidden" name="action" value="_%SAVEADDEDIT%_">
        </td>
    </tr>
</table>
  </form>
</body>
</html>#%EOF%#
#%File: ./temps/defaults/html_icon.html%#
<!-- %#ICON_SECTION_NEW#% -->
<img src="http://localhost/new.png">
<!-- %#END_NEW#% -->
<!-- %#ICON_SECTION_UP#% -->
<img src="http://localhost/up.png">
<!-- %#END_UP#% -->
<!-- %#ICON_SECTION_DOWN#% -->
<img src="http://localhost/down.png">
<!-- %#END_DOWN#% -->
<!-- %#ICON_SECTION_STQUO#% -->
<img src="http://localhost/stquo.png">
<!-- %#END_STQUO#% -->
<!-- %#ICON_SECTION_LONG#% -->
<img src="http://localhost/long.png">
<!-- %#END_LONG#% -->#%EOF%#
#%File: ./temps/defaults/main_backrest_menu.html%#
<!-- BOTH_B -->
<html>
<head>
<title>
</title>
<link rel="stylesheet" href="%#TL_URL#%/main.css"" type="text/css">
<script src="%#TL_URL#%/main.js""></script>
<SCRIPT>
function test() {

    var retval= "";
    var ii = 1;

    for(var i=0;i < document.XCHOICE.elements.length;i++) {
      if ((document.XCHOICE.elements[i].checked)   ) {
        retval += "&"+document.XCHOICE.elements[i].name+"="+document.XCHOICE.elements[i].value;
      }
    }  
    parent.parent.backrest_detail.document.write('<html><head><link rel="stylesheet" href="%#TL_URL#%/main.css"" type="text/css"></head><body>');
    parent.parent.backrest_detail.document.write('Please wait ...');
    parent.parent.backrest_detail.document.write('</body></html>');    
    parent.parent.backrest_detail.location="#%config::tlurl%#/admin.cgi?action=_%23BACKUP%23_"+retval;
    
}

function showMenu(loc) {
    parent.main_backrest_menu_2.document.write('<html><head><link rel="stylesheet" href="%#TL_URL#%/main.css"" type="text/css"></head><body>');
    parent.main_backrest_menu_2.document.write('Please wait ...');
    parent.main_backrest_menu_2.document.write('</body></html>');    

    parent.main_backrest_menu_2.location=loc;

}
</SCRIPT>

</head>
<!-- BOTH_E -->
<!-- FRAME_B -->
<frameset cols="23%,*" border="1">
<frame scrolling = "no" frameborder="0" noresize  name="main_backrest_menu_1" src= "#%config::tlurl%#/genmenu.cgi?type=backrestmenu_1">
<frame scrolling = "no" frameborder="0" noresize  name="main_backrest_menu_2" src= "#%config::tlurl%#/genmenu.cgi?type=backrestmenu_2">
</frameset>
<noframes>
<b>!!! use browser with FRAME support !!!<b>
</noframes>
<!-- FRAG_END -->
<!-- SUBMENU1_B -->
<BODY class="logMenu" onLoad="document.forms[0].elements[0].click();">

<TABLE class="mainmenu" border="0" cellspacing="0" cellpadding="1" width = "100%">
<FORM name="CHOICE">
<TR >
<TD colspan="2" class="mainmenu">Choose Operation</TD></TR>
<TR>
<TD class="mainmenu" valign="top">
<INPUT TYPE="radio" NAME="SHOW" onClick="showMenu('#%config::tlurl%#/genmenu.cgi?type=backrestmenu_2&subtype=backup');" VALUE = "1" checked> Backup<BR>
<INPUT TYPE="radio" NAME="SHOW" onClick="showMenu('#%config::tlurl%#/genmenu.cgi?type=backrestmenu_2&subtype=restore');"  VALUE = "2" > Restore<BR>	
<INPUT TYPE="radio" NAME="SHOW" onClick="showMenu('#%config::tlurl%#/genmenu.cgi?type=backrestmenu_2&subtype=migrate');"  VALUE = "3"> Migrate<BR>
<INPUT TYPE="radio" NAME="SHOW" onClick="showMenu('#%config::tlurl%#/genmenu.cgi?type=backrestmenu_2&subtype=import');"  VALUE = "4"> Import<BR>
</TD>
<td>
<table class="noBorder">
<tr><td><a class="help" onClick="showHelp('backrest','backup')">[?]</a></tr></td>
<tr><td><a class="help" onClick="showHelp('backrest','restore')">[?]</a></tr></td>
<tr><td><a class="help" onClick="showHelp('backrest','migrate')">[?]</a></tr></td>
<tr><td><a class="help" onClick="showHelp('backrest','import')">[?]</a></tr></td>
</table>
</td>
</TR>

</form >


</table>
<!-- <td  class = "mainmenulink"><A onClick = "parent.main_detail.location='#%config::tlurl%#/admin.cgi?display2=Main&action=_%23MAIN%23_'" class="mainmenu">admin</A></td>   -->


</body>
<!-- FRAG_END -->
<!-- SUBMENU2_B -->
<BODY class="logMenu">
<FORM name="XCHOICE">
<TABLE class="mainmenu" border="0" cellspacing="0" cellpadding="1" >
<TR ><TD class="mainmenu">Choose Operation</TD><TR>
<TD halign="top" class="mainmenu">
<INPUT TYPE="checkbox" NAME="SHOW_BACKLOG" VALUE = "1" checked> Backup Logs <BR>
<INPUT TYPE="checkbox" NAME="SHOW_BACKDATA" VALUE = "2" checked> Backup Data <BR>
<INPUT TYPE="checkbox" NAME="SHOW_BACKTEMPL" VALUE = "3" checked> Backup Templates <BR>
<INPUT TYPE="checkbox" NAME="SHOW_RESTLOG" VALUE = "4" checked> Restore Logs <BR>
<INPUT TYPE="checkbox" NAME="SHOW_RESTDATA" VALUE = "5" checked> Restore Data <BR>
<INPUT TYPE="checkbox" NAME="SHOW_RESTTEMPL" VALUE = "6" checked> Restore Templates <BR>
<INPUT TYPE="checkbox" NAME="SHOW_IMPORTAR" VALUE = "7" checked> Import from Autorank <BR><div class=error>[Expects, that you'll place 'data.txt' into './data']</div>
<INPUT TYPE="checkbox" NAME="SHOW_PACK" VALUE = "8" checked> Pack Toplist<BR>
</TD>
</TR>
<TR><TD colspan="5">
<INPUT  class="mainmenu"  TYPE="button" NAME="Apply" VALUE = "Process"  onClick="test()" >
</TD></TR>

</TABLE>

</FORM>
</body>
<!-- FRAG_END -->

<!-- BOTH_B -->
</html>
<!-- BOTH_E -->#%EOF%#
#%File: ./temps/defaults/main_backrest_view.html%#
<html>
<head>
<title>

</title>
</head>

<frameset rows="180,*" border="1">
<frame scrolling = "no" frameborder="0" noresize  name="backrest_menu" src="#%config::tlurl%#/genmenu.cgi?type=backrestmenu" >
<frame scrolling = "auto" frameborder="0" noresize name="backrest_detail" src= "#%config::tlurl%#/genmenu.cgi?type=empty" >
</frameset>
<noframes>
<b>!!! use browser with FRAME support !!!<b>
</noframes>
</html>
#%EOF%#
#%File: ./temps/defaults/main_desktop.html%#
<html>
<head>
<title>
MAIN DESKTOP (#%toplistID%#)
</title>
</head>

<frameset rows="30,*"  border="1" >
<frame   scrolling = "no" frameborder="0" noresize  name="main_menu" src= "#%config::tlurl%#/genmenu.cgi?type=main" >
<frame   scrolling = "auto" frameborder="0" noresize name="main_detail" src= "#%config::tlurl%#/admin.cgi?display2=Main&action=_%23MAIN%23_&firsttime="1"">
</frameset>
<noframes>
<b>!!! use browser with FRAME support !!!<b>
</noframes>
</html>
#%EOF%#
#%File: ./temps/defaults/main_desktop_menu.html%#
<html>
<head>
<title>
</title>
<link rel="stylesheet" href="%#TL_URL#%/main.css"" type="text/css">
<script src="%#TL_URL#%/main.js""></script>
</head>
<BODY class="mainmenu">
<center>
<form name="selectCustom">
<TABLE class="mainmenu" border="0" cellspacing="0" cellpadding="4">
  <TR ><TD  width="70%">
  <center>
  <TABLE class="mainmenu" border="0" cellspacing="0" cellpadding="4">
    <TR>
      <td   valign="top" class = "mainmenulink"><A href="#%config::tlurl%#/admin.cgi?display2=Main&action=_%23MAIN%23_"  target="main_detail"  class="mainmenu" >admin</A></td>
<!--      <td   valign="top" class = "mainmenulink"><A href  target="parent.main_detail"  onMouseOver="this.color = red;return true;" onClick = "parent.main_detail.location='#%config::tlurl%#/admin.cgi?display2=Main&action=_%23MAIN%23_'" class="mainmenu" >admin</A></td>-->
      <td   valign="top"  class = "mainmenulink"><A href="#%config::tlurl%#/admin.cgi?display2=Setup&action=_%23SETUP%23_" target="main_detail"  class="mainmenu" >setup</A></td>
      <td   valign="top"  class = "mainmenulink"><A href="#%config::tlurl%#/admin.cgi?display2=Setup&action=_%23SETUPADVANCED%23_" target="main_detail"  class="mainmenu" >advanced setup</A></td>
      <td   valign="top"  class = "mainmenulink"><A href="#%config::tlurl%#/genmenu.cgi?type=statview" target="main_detail"  class="mainmenu" >statistic</A></td>
      <td   valign="top"  class = "mainmenulink"><A href="#%config::tlurl%#/genlog.cgi?type=main" target="main_detail"  class="mainmenu" >log viewer</A></td>
      <td   valign="top"  class = "mainmenulink"><A href="#%config::tlurl%#/genmenu.cgi?type=backrestview" target="main_detail"  class="mainmenu" >backup/restore</A></td>
      <td   valign="top"  class = "shortMenu"><select width="10" name="selectCustomType" onChange="serviceCustomMenu(this);blur();parent.main_detail.focus();"  onBlur="document.selectCustom.selectCustomType.selectedIndex = 0" class="shortMenu">%#selectCustom#%</select></td>
      <td   valign="top"  class = "shortMenu"><A class="help" onClick="javascript:showHelp('mainhelp','overview')">[Help]</A></td>      
<!--      <td   valign="top"  class = "shortMenu"><select width="10" name="selectCustomType" onFocus="document.selectCustom.selectCustomType.onmousedown=doBullShit" onBlur="document.selectCustom.selectCustomType.onmousedown=doBullShit" onMouseUp=" document.selectCustom.selectCustomType.onmousedown = serviceCustomMenu"  class="shortMenu">%#selectCustom#%</select></td> -->
<!--      <td   valign="top"  class = "shortMenu"><SELECT width="10" name="selectCustomType" onChange="parent.main_detail.location=getSelectedCustom();blur();" onClick="parent.main_detail.location=getSelectedCustom();blur();" class="shortMenu">%#selectCustom#%</select></td>      -->
    </TR>
<!--    #parent.main_detail.location='#%config::tlurl%#/admin.cgi?display2=Setup&action=_%23SETUP%23_' -->
  </table>
  </center>
  </TD>

  <TD width="30%" align="right"  valign="top" >
    <TABLE class="mainmenu" border="0" cellspacing="0" cellpadding="4">
      <TR>
        <td class = "mainmenu" width = "100%" align="right"> Toplist ID: #%toplistID%# </td>
      </TR>
    </table>
  </TD>
  </TR>

</table>
</form>

</center>
</body>
</html>#%EOF%#
#%File: ./temps/defaults/main_log_detail.html%#
<html>
<head>
<title>
</title>
<link rel="stylesheet" href="%#TL_URL#%/main.css"" type="text/css">
</head>
<BODY class="mainmenu">

<!-- #%DATA_BEGIN%# -->
<TABLE  border="0" class="noBorder">
<TR class="logDetailLabel">
<TD id=ID>Unique IN ID &nbsp; &nbsp; &nbsp; &nbsp;</TD>
<TD id=ACCIN>IN Account &nbsp; &nbsp; &nbsp; &nbsp;</TD>
<TD id=ACCOUT>OUT Account &nbsp; &nbsp; &nbsp; &nbsp;</TD>
<TD id=DT>Date &nbsp; &nbsp; &nbsp; &nbsp;</TD>
<TD id=IPFROM>IP From &nbsp; &nbsp; &nbsp; &nbsp;</TD>
<TD id=IPREF>IP Ref &nbsp; &nbsp; &nbsp; &nbsp;</TD>
<TD id=HOST>Host Name&nbsp; &nbsp; &nbsp; &nbsp;</TD>
<TD id=COOKIE>Cooked &nbsp; &nbsp; &nbsp; &nbsp;</TD>
<TD id=COUNTER>Counted &nbsp; &nbsp; &nbsp; &nbsp; </TD>
<TD id=RANK>OUT Acc's Rank &nbsp; &nbsp; &nbsp; &nbsp; </TD>
</TR>
<TR><TD></TD></TR>
#%INSERT_DATA%#
</table>
<!-- #%DATA_END%# -->
<!-- <td  class = "mainmenulink"><A onClick = "parent.main_detail.location='#%config::tlurl%#/admin.cgi?display2=Main&action=_%23MAIN%23_'" class="mainmenu">admin</A></td>   -->


</body>
</html>#%EOF%#
#%File: ./temps/defaults/main_log_menu.html%#
<!-- BOTH_B -->
<html>
<head>
<title>
</title>
<link rel="stylesheet" href="%#TL_URL#%/main.css"" type="text/css">
<script src="%#TL_URL#%/main.js""></script>
<SCRIPT>
function test() {

    var retval= "";
    var ii = 1;

    for(var i=0;i < parent.main_log_menu_1.document.CHOICE.elements.length;i++) {
      if (parent.main_log_menu_1.document.CHOICE.elements[i].checked) {
        retval += "SHOW="+parent.main_log_menu_1.document.CHOICE.elements[i].value;
      }
    }

    for(var i=0;i < document.XCHOICE.elements.length;i++) {
      if ((document.XCHOICE.elements[i].checked)  ||  (document.XCHOICE.elements[i].name == "FILTER") ) {
        retval += "&"+document.XCHOICE.elements[i].name+"="+document.XCHOICE.elements[i].value;
      }
    }  


    parent.parent.log_detail.document.write('<html><head><link rel="stylesheet" href="%#TL_URL#%/main.css"" type="text/css"></head><body>');
    parent.parent.log_detail.document.write('Please wait ...');
    parent.parent.log_detail.document.write('</body></html>');    

    
    parent.parent.log_detail.location= "#%config::tlurl%#/genlog.cgi\?"+retval;

}

function showMenu(loc) {
    parent.main_log_menu_2.document.write('<html><head><link rel="stylesheet" href="%#TL_URL#%/main.css"" type="text/css"></head><body>');
    parent.main_log_menu_2.document.write('Please wait ...');
    parent.main_log_menu_2.document.write('</body></html>');    

    parent.main_log_menu_2.location=loc;

}


</SCRIPT>

</head>
<!-- BOTH_E -->
<!-- FRAME_B -->
<frameset cols="23%,*" border="1" >
<frame scrolling = "no" frameborder="0" noresize  name="main_log_menu_1" src= "#%config::tlurl%#/genmenu.cgi?type=logmenu_1">
<frame scrolling = "no" frameborder="0" noresize  name="main_log_menu_2" src= "#%config::tlurl%#/genmenu.cgi?type=logmenu_2">
</frameset>
<noframes>
<b>!!! use browser with FRAME support !!!<b>
</noframes>
<!-- FRAG_END -->
<!-- SUBMENU1_B -->
<BODY class="logMenu" onLoad="document.forms[0].elements[1].click();">

<TABLE class="mainmenu" border="0" cellspacing="0" cellpadding="1" width = "100%">
<FORM name="CHOICE">
<TR >
<TD class="mainmenu" width="5%">Choose LOG</TD><td width="3%"></td></TR>
<TR>
<TD class="mainmenu">
<INPUT TYPE="radio" NAME="SHOW" onClick="showMenu('#%config::tlurl%#/genmenu.cgi?type=logmenu_2&subtype=inout');" VALUE = "1"> IN -> OUT Log<BR>
<INPUT TYPE="radio" NAME="SHOW" onClick="showMenu('#%config::tlurl%#/genmenu.cgi?type=logmenu_2&subtype=in');"  VALUE = "2" checked> IN Log<BR>	
<INPUT TYPE="radio" NAME="SHOW" onClick="showMenu('#%config::tlurl%#/genmenu.cgi?type=logmenu_2&subtype=out');"  VALUE = "3"> OUT Log<BR>
<INPUT TYPE="radio" NAME="SHOW" onClick="showMenu('#%config::tlurl%#/genmenu.cgi?type=logmenu_2&subtype=counter');"  VALUE = "4"> Counter Log<BR>
<INPUT TYPE="radio" NAME="SHOW" onClick="showMenu('#%config::tlurl%#/genmenu.cgi?type=logmenu_2&subtype=log');"  VALUE = "5"> LOG Log<BR>
<INPUT TYPE="radio" NAME="SHOW" onClick="showMenu('#%config::tlurl%#/genmenu.cgi?type=logmenu_2&subtype=error');"  VALUE = "6"> Error Log<BR>
<INPUT TYPE="radio" NAME="SHOW" onClick="showMenu('#%config::tlurl%#/genmenu.cgi?type=logmenu_2&subtype=install');"  VALUE = "7"> Install Log
</TD>
<TD>
<table class="noBorder">
<tr><td><a class="help" onClick="showHelp('logs','inout')">[?]</a></tr></td>
<tr><td><a class="help" onClick="showHelp('logs','in')">[?]</a></tr></td>
<tr><td><a class="help" onClick="showHelp('logs','out')">[?]</a></tr></td>
<tr><td><a class="help" onClick="showHelp('logs','counter')">[?]</a></tr></td>
<tr><td><a class="help" onClick="showHelp('logs','log')">[?]</a></tr></td>
<tr><td><a class="help" onClick="showHelp('logs','error')">[?]</a></tr></td>
<tr><td><a class="help" onClick="showHelp('logs','install')">[?]</a></tr></td>
</table>
</TD>
</TR>
</form >


</table>
<!-- <td  class = "mainmenulink"><A onClick = "parent.main_detail.location='#%config::tlurl%#/admin.cgi?display2=Main&action=_%23MAIN%23_'" class="mainmenu">admin</A></td>   -->


</body>
<!-- FRAG_END -->
<!-- SUBMENU2_B -->
<BODY class="logMenu">


<DIV class="mainmenu">Show Field&nbsp;<a class="help" onClick="showHelp('logs','showField')">[?]</a></DIV>
<FORM name="XCHOICE">
<TABLE class="mainmenu" border="0" cellspacing="0" cellpadding="4" >
<TR class="mainmenu">
<TD><INPUT TYPE="checkbox" NAME="SHOW_ID" VALUE = "1" checked> ID</TD>
<TD><INPUT TYPE="checkbox" NAME="SHOW_COUNTER" VALUE = "2" checked> Counter</TD>
<TD><INPUT TYPE="checkbox" NAME="SHOW_DT" VALUE = "3" checked> time/date</TD>
<TD><INPUT TYPE="checkbox" NAME="SHOW_IPFROM" VALUE = "4" checked> ip from</TD>
<TD><INPUT TYPE="checkbox" NAME="SHOW_IPREF" VALUE = "5" checked> ip ref</TD>
<TD><INPUT TYPE="checkbox" NAME="SHOW_COOKIE" VALUE = "6" checked> cookie</TD>
<TD><INPUT TYPE="checkbox" NAME="SHOW_ACCIN" VALUE = "7" checked> acc in</TD>
<TD><INPUT TYPE="checkbox" NAME="SHOW_ACCOUT" VALUE = "8" checked> acc out</TD>
<TD><INPUT TYPE="checkbox" NAME="SHOW_RANK" VALUE = "8" checked> rank of acc out</TD>
</TR>
</TABLE>
<BR><DIV class="mainmenu">Sort by&nbsp;<a class="help" onClick="showHelp('logs','sortBy')">[?]</a></DIV>
<TABLE class="mainmenu" border="0" cellspacing="0" cellpadding="3" >
<TR class="mainmenu">
<TD><INPUT TYPE="radio" NAME="SORT" VALUE = "1" checked> ID</TD>
<TD><INPUT TYPE="radio" NAME="SORT" VALUE = "2"> time/date</TD>
<TD><INPUT TYPE="radio" NAME="SORT" VALUE = "3"> acc in</TD>
<TD><INPUT TYPE="radio" NAME="SORT" VALUE = "4"> acc out</TD>
<TD><INPUT TYPE="text" NAME="FILTER" VALUE = ""> Enter filter value</TD>
</TR>
<TR><TD colspan="5">
<INPUT  class="mainmenu"  TYPE="button" NAME="Apply" VALUE = "Apply / Refresh"  onClick="test()" >
</TD></TR>
</table>
</FORM>
</body>
<!-- FRAG_END -->

<!-- BOTH_B -->
</html>
<!-- BOTH_E -->#%EOF%#
#%File: ./temps/defaults/main_log_view.html%#
<html>
<head>
<title>

</title>
</head>

<frameset rows="180,*" border="1" >
<frame scrolling = "no" frameborder="0" noresize  name="log_menu" src="#%config::tlurl%#/genmenu.cgi?type=logmenu" >
<frame scrolling = "auto" frameborder="0" noresize name="log_detail" src= "#%config::tlurl%#/genlog.cgi?type=start" >
</frameset>
<noframes>
<b>!!! use browser with FRAME support !!!<b>
</noframes>
</html>
#%EOF%#
#%File: ./temps/defaults/main_stat_menu.html%#
<!-- BOTH_B -->
<html>
<head>
<title>
</title>
<link rel="stylesheet" href="%#TL_URL#%/main.css"" type="text/css">
<script src="%#TL_URL#%/main.js""></script>
<SCRIPT>
function test() {

    var retval= "";
    var ii = 1;

    for(var i=0;i < document.CHOICE.elements.length;i++) {
      if ((document.CHOICE.elements[i].checked)   ) {
        retval += "&"+document.CHOICE.elements[i].name+"="+document.CHOICE.elements[i].value;
      }
    }  
    parent.parent.stat_detail.location="#%config::tlurl%#/admin.cgi?display2=Statistic&action=_%23STATISTIC%23_"+retval;
    
}

</SCRIPT>

</head>
<!-- BOTH_E -->
<!-- FRAME_B -->
<frameset cols="100%,*" border="1">
<frame scrolling = "no" frameborder="0" noresize  name="main_stat_menu_1" src= "#%config::tlurl%#/genmenu.cgi?type=statmenu_1">
</frameset>
<noframes>
<b>!!! use browser with FRAME support !!!<b>
</noframes>
<!-- FRAG_END -->
<!-- SUBMENU1_B -->
<BODY class="logMenu" >

<TABLE class="mainmenu" border="0" cellspacing="0" cellpadding="0" width = "100%">
<FORM name="CHOICE">
<TR>
<TD   class="mainmenu" width="7%">Choose&nbsp;Statistic</TD><td width="10%"></td><TD class="mainmenu" width="10">Choose&nbsp;Data</TD></TR>
<TR >
<TD class="mainmenu" >
<INPUT TYPE="checkbox" NAME="CH_HOUR"  VALUE = "1" checked>&nbsp;Hour&nbsp;Stat<BR>
<INPUT TYPE="checkbox" NAME="CH_DAY"  VALUE = "2" checked>&nbsp;Day&nbsp;Stat<BR>	
<INPUT TYPE="checkbox" NAME="CH_MONTH"  VALUE = "3" checked>&nbsp;Month&nbsp;Stat<BR>	
<INPUT TYPE="checkbox" NAME="CH_YEAR"  VALUE = "4" checked>&nbsp;Year&nbsp;Stat<BR>
<INPUT TYPE="checkbox" NAME="CH_UPTIME"  VALUE = "5" checked>&nbsp;Uptime&nbsp;Stat<BR>
<INPUT TYPE="checkbox" NAME="CH_OUT"  VALUE = "6" checked>&nbsp;Click&nbsp;Stat<BR>
<INPUT TYPE="checkbox" NAME="CH_REG"  VALUE = "7" checked>&nbsp;Reg&nbsp;Stat<BR>
</TD>
<td class="mainmenu" valign="top" height="100%">
<table class="noBorder"><tr><td>
<a class="help" onClick="showHelp('stat','hour')">[?]</a></tr></td>
<tr><td>
<a class="help" onClick="showHelp('stat','day')">[?]</a></tr></td>
<tr><td>
<a class="help" onClick="showHelp('stat','month')">[?]</a></tr></td>
<tr><td>
<a class="help" onClick="showHelp('stat','year')">[?]</a></tr></td>
<tr><td>
<a class="help" onClick="showHelp('stat','uptime')">[?]</a></tr></td>
<tr><td>
<a class="help" onClick="showHelp('stat','outstat')">[?]</a></tr></td>
<tr><td>
<a class="help" onClick="showHelp('stat','buttons')">[?]</a></tr></td>
</tr></table>
</td>
<TD class="mainmenu" width="10" valign="top">
<INPUT TYPE="checkbox" NAME="G_RIN"  VALUE = "1" checked>&nbsp;Raw IN<BR>
<INPUT TYPE="checkbox" NAME="G_NBRIN"  VALUE = "2">&nbsp;Raw IN [hitbot free]<BR>	
<INPUT TYPE="checkbox" NAME="G_PIN"  VALUE = "3">&nbsp;Unique IN<BR>	
<INPUT TYPE="checkbox" NAME="G_NBPIN"  VALUE = "4" checked>&nbsp;Unique IN [hitbot free]<BR>
<INPUT TYPE="checkbox" NAME="G_GOUT"  VALUE = "6" checked>&nbsp;Unique Out<BR>
<INPUT TYPE="checkbox" NAME="G_OUT"  VALUE = "5">&nbsp;Raw Out<BR>
<INPUT  class="mainmenu"  TYPE="button" NAME="Apply" VALUE = "Process"  onClick="test()" >
</TD></TR>
<!--
<TR >
<TD>&nbsp;</TD>
<TD class="mainmenu" width="10">
<INPUT  class="mainmenu"  TYPE="button" NAME="Apply" VALUE = "Process"  onClick="test()" >
</TD>

</TR>
-->


</form >


</table>
<!-- <td  class = "mainmenulink"><A onClick = "parent.main_detail.location='#%config::tlurl%#/admin.cgi?display2=Main&action=_%23MAIN%23_'" class="mainmenu">admin</A></td>   -->


</body>
<!-- FRAG_END -->
<!-- SUBMENU2_B -->
<BODY class="logMenu">


<DIV class="mainmenu">Choose Operation</DIV>
<FORM name="XCHOICE">
<TABLE class="mainmenu" border="0" cellspacing="0" cellpadding="4" >
<TR class="mainmenu">
<TD>
<INPUT TYPE="checkbox" NAME="SHOW_BACKLOG" VALUE = "1" checked> Backup Logs <BR>
<INPUT TYPE="checkbox" NAME="SHOW_BACKDATA" VALUE = "2" checked> Backup Data <BR>
<INPUT TYPE="checkbox" NAME="SHOW_BACKTEMPL" VALUE = "3" checked> Backup Templates <BR>
<INPUT TYPE="checkbox" NAME="SHOW_RESTLOG" VALUE = "4" checked> Restore Logs <BR>
<INPUT TYPE="checkbox" NAME="SHOW_RESTDATA" VALUE = "5" checked> Restore Data <BR>
<INPUT TYPE="checkbox" NAME="SHOW_RESTTEMPL" VALUE = "6" checked> Restore Templates <BR>
<INPUT TYPE="checkbox" NAME="SHOW_IMPORTAR" VALUE = "7" checked> Import from Autorank <BR>
<INPUT TYPE="checkbox" NAME="SHOW_PACK" VALUE = "8" checked> Pack Toplist<BR>
</TD>
</TR>
<TR><TD colspan="5">
<INPUT  class="mainmenu"  TYPE="button" NAME="Apply" VALUE = "Process"  onClick="test()" >
</TD></TR>

</TABLE>

</FORM>
</body>
<!-- FRAG_END -->

<!-- BOTH_B -->
</html>
<!-- BOTH_E -->#%EOF%#
#%File: ./temps/defaults/main_stat_view.html%#
<html>
<head>
<title>

</title>
</head>

<frameset rows="180,*" border="1">
<frame scrolling = "no" frameborder="0" noresize  name="stat_menu" src="#%config::tlurl%#/genmenu.cgi?type=statmenu" >
<frame scrolling = "auto" frameborder="0" noresize name="stat_detail" src= "#%config::tlurl%#/genmenu.cgi?type=empty" >
</frameset>
<noframes>
<b>!!! use browser with FRAME support !!!<b>
</noframes>
</html>
#%EOF%#
checksum:654182-49677535