<?php session_start(); include('./cj_config.php'); f_27(); mysql_connect(DB_HOST,DB_LOGIN,DB_PASS) or die('Cannot connect to DB'); mysql_select_db(DB_DEVICE) or die('Cannot select DB'); switch ($_GET['cmd']) { case 'register': if (NEW_TRADER == 'yes') { f_53(); }else { f_52(); } break; case 'login': if (trim($_POST['passwd'])) { f_51(); }else {f_54();} break; case 'logout': f_logout(); break; default: f_54(); } mysql_close(); f_28(); function f_50($v_36) { $v_23="select t.tid, t._domain, t._status, s._huin, s._hrin, s._hout, s._hclk, (s._hclk*100)/(if(s._huin=0,1,s._huin)) as hour_tr_prd, (s._hclk*100)/(if(s._hout=0,1,s._hout)) as hour_tr_kpd, (s._hout*100)/(if(s._huin=0,1,s._huin)) as hour_rtn, tmp._uin+s._huin as period_uin, tmp._rin+s._hrin as period_rin, tmp._out+s._hout as period_out, tmp._clk+s._hclk as period_clk, ((tmp._clk+s._hclk)*100)/(if(tmp._uin+s._huin=0,1,tmp._uin+s._huin)) as period_tr_prd, ((tmp._clk+s._hclk)*100)/(if(tmp._out+s._hout=0,1,tmp._out+s._hout)) as period_tr_kpd, ((tmp._out+s._hout)*100)/(if(tmp._uin+s._huin=0,1,tmp._uin+s._huin)) as period_rtn, (s._clk*100)/(if(s._out=0,1,s._out)) as all_tr_kpd, (s._clk*100)/(if(s._uin=0,1,s._uin)) as all_tr_prd, (s._out*100)/(if(s._uin=0,1,s._uin)) as all_rtn, s._uin,s._rin,s._out,s._clk from tm_cj_traders t, tm_cj_stats s, tm_cj_tmpst tmp where t.tid=s.tid and tmp.tid = t.tid and t.tid = ".$v_36; $v_21=mysql_query($v_23); $v_30=mysql_fetch_array($v_21); ?> <table width="600" border="0" cellspacing="1" cellpadding="1" align="center" style="border: 1px solid #4B0082;"> <tr><td colspan="1" align="center" class="tblRTitle"><?php print $v_30['_domain']?> stats</td></tr> <tr> <td> <table width="100%" border="0" cellspacing="1" cellpadding="1" style="border: 1px solid Black;"> <tr class="tblRStat"> <td width="180">HOUR</td> <td width="100" align="center">Uniq. IN</td> <td width="100" align="center">Raw IN</td> <td width="100" align="center">Click</td> <td width="100" align="center">Uniq. OUT</td> </tr> <tr class="tblRStat"> <td width="180">Current</td> <td width="100" align="center"><?php print $v_30['_huin']?></td> <td width="100" align="center"><?php print $v_30['_hrin']?></td> <td width="100" align="center"><?php print $v_30['_hclk']?></td> <td width="100" align="center"><?php print $v_30['_hout']?></td> </tr> <tr class="tblRStat"> <td width="180">Last <?php print HOUR_STAT?></td> <td width="100" align="center"><?php print $v_30['period_uin']?></td> <td width="100" align="center"><?php print $v_30['period_rin']?></td> <td width="100" align="center"><?php print $v_30['period_clk']?></td> <td width="100" align="center"><?php print $v_30['period_out']?></td> </tr> <tr class="tblRStat"> <td width="180">All</td> <td width="100" align="center"><?php print $v_30['_uin']?></td> <td width="100" align="center"><?php print $v_30['_rin']?></td> <td width="100" align="center"><?php print $v_30['_clk']?></td> <td width="100" align="center"><?php print $v_30['_out']?></td> </tr> </table> <br> <table border="0" cellspacing="1" cellpadding="1" style="border: 1px solid Black;"> <tr class="tblRStat"> <td width="180">HOUR</td> <td width="100" align="center">Tr. Prod %</td> <td width="100" align="center">Tr. Kpd %</td> <td width="100" align="center">Return %</td> </tr> <tr class="tblRStat"> <td width="180">Current</td> <td width="100" align="center"><?php print intval($v_30['hour_tr_prd'])?></td> <td width="100" align="center"><?php print intval($v_30['hour_tr_kpd'])?></td> <td width="100" align="center"><?php print intval($v_30['hour_rtn'])?></td> </tr> <tr class="tblRStat"> <td width="180">Last <?php print HOUR_STAT?></td> <td width="100" align="center"><?php print intval($v_30['period_tr_prd'])?></td> <td width="100" align="center"><?php print intval($v_30['period_tr_kpd'])?></td> <td width="100" align="center"><?php print intval($v_30['period_rtn'])?></td> </tr> <tr class="tblRStat"> <td width="180">All</td> <td width="100" align="center"><?php print intval($v_30['all_tr_prd'])?></td> <td width="100" align="center"><?php print intval($v_30['all_tr_kpd'])?></td> <td width="100" align="center"><?php print intval($v_30['all_rtn'])?></td> </tr> </table> </td> </tr> </table> <br> <?php } function f_51(){ $v_21=mysql_query("select tid from tm_cj_traders where _pass='".md5(trim($_POST['passwd']))."' and _domain='".trim($_POST['_domain'])."'"); if (mysql_num_rows($v_21) == 1) { f_50(mysql_result($v_21,0,'tid')); return true; }else { f_19('Login failed.','warning'); return false; } } function f_52() { include('./faces/tpl.register.closed.html'); } function f_53() { if ($_POST['_url'] || $_POST['_passwd']) { $v_43=false; $v_39=parse_url($_POST['_url']); $_POST['_domain']=str_replace('www.','',$v_39['host']); if (@strlen($_POST['_domain']) < 6) { $v_43=true; f_19('Domain name incorrect <i>'.$_POST['_domain'].'</i>.','warning'); } $v_21=mysql_query("select tid from tm_cj_traders where _domain='".$_POST['_domain']."'"); if (mysql_num_rows($v_21) > 0) { $v_43=true; f_19('Domain <i>'.$_POST['_domain'].'</i> already exist.','warning'); } $v_21=mysql_query("select domain from tm_cj_banned where domain='".$_POST['_domain']."'"); if (mysql_num_rows($v_21) > 0) { $v_43=true; f_19('Domain <i>'.$_POST['_domain'].'</i> banned.','warning'); } if ($v_43 !=true) { $v_33="001000000000000000"; while (list($v_9,$v_10)=@each($_POST['_cat'])) { $v_33[$v_10]=1; }$v_33=bindec($v_33); $v_23="insert into tm_cj_traders set _status='on', _egid='".$v_33."', _domain='".$_POST['_domain']."', _face='default', _url='".$_POST['_url']."', _mail='".$_POST['_mail']."', _icq='".$_POST['_icq']."', _back='".BACK_PRD."', _pass='".md5($_POST['_passwd'])."'"; mysql_query($v_23) or die(mysql_error()); $v_36=mysql_insert_id(); for ($v_16=0;$v_16<24;$v_16++){ mysql_query("insert into tm_cj_force(tid,_hour,_force) values('".$v_36."','".$v_16."','0')"); } mysql_query("INSERT INTO tm_cj_stats (tid, _uin, _rin, _out, _clk, _huin, _hrin, _hout, _hclk) VALUES (".$v_36.", 0, 0, 0, 0, 0, 0, 0, 0)"); mysql_query("INSERT INTO tm_cj_tmpst (tid, _uin, _rin, _out, _clk, _force) VALUES (".$v_36.", 0, 0, 0, 0, 0)"); $trader_domain=$_POST['_domain']; include('./faces/tpl.register.ok.html'); } }else { include('./faces/tpl.register.main.html'); ?> <table width="400" border="0" cellspacing="1" cellpadding="1" align="center" style="border: 1px solid #4B0082;"> <form action="?cmd=register" method="post" name="form1"> <tr><td colspan="2" align="center" class="tblRTitle">New Trader</td></tr> <tr class="tblRNormal"> <td width="150">&nbsp;URL: </td> <td width="250"><input type="text" name="_url" value="<?php print $v_30['_url']?>" style="width: 97%;"></td> </tr> <tr class="tblRNormal"> <td>&nbsp;E-mail: </td> <td><input type="text" name="_mail" value="<?php print $v_30['_mail']?>" style="width: 97%;"></td> </tr> <tr class="tblRNormal"> <td>&nbsp;ICQ: </td> <td><input type="text" name="_icq" value="<?php print $v_30['_icq']?>" style="width: 97%;"></td> </tr> <tr class="tblRNormal"> <td>&nbsp;Password: </td> <td><input type="password" name="_passwd" value="<?php print $v_30['_passwd']?>" style="width: 97%;"></td> </tr> <?php $v_35=mysql_query("select * from tm_cj_group where _desc !=''"); if (mysql_num_rows($v_35) > 0) { ?> <tr class="tblRNormal"> <td valign="top">&nbsp;Group: </td> <td> <select name="_cat[]" size="8" multiple style="width: 97%;"> <?php while($v_22=mysql_fetch_array($v_35)) { ?> <option value="<?php print $v_22['gid']+2?>" <?php if ($v_34[$v_22['gid']+2] == 1) {print 'SELECTED';}?>><?php print $v_22['_desc']?></option> <?php } ?> </select> </td> </tr> <?php } ?> <tr class="tblRNormal"><td colspan="2" align="center"><input type="submit" name="register" value="register" class="submit"></td></tr> </table> <?php } } function f_54() { ?> <br><br><br> <table width="230" border="0" cellspacing="1" cellpadding="1" align="center" style="border: 1px solid #4B0082;"> <form action="cj_wbm.php?cmd=login" method="post"> <tr><td colspan="2" align="center" class="tblRTitle">Welcome to Avrora CJ !</td></tr> <tr class="tblRNormal"> <td width="80">&nbsp;Domain: </td> <td width="150"><input type="text" name="_domain" value="<?php print $_POST['_domain']?>" style="width: 97%;"></td> </tr> <tr class="tblRNormal"> <td width="80">&nbsp;Password: </td> <td width="150"><input type="password" name="passwd" value="<?php print $_POST['passwd']?>" style="width: 97%;"></td> </tr> <tr class="tblRNormal"><td colspan="2" align="center"><input type="submit" name="Go" value="join" class="submit"></td></tr> </form> </table> <p align="center">New traders, <a href="cj_wbm.php?cmd=register"><font color="#FF0000">register here</font></a>.</p> <?php } function f_19($v_44,$v_45) { print '<br><br><br><center><font class="'.$v_45.'">'.$v_44.'</font></center>'; print '<script language="JavaScript">setTimeout("window.location=\'cj_wbm.php\'",3000);</script>'; } function f_27() { ?> <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"> <html> <head> <title>Traffic Manager -> Webmaster Area.</title> <style type="text/css"> INPUT{ background-color : #D2B48C; font-size : 12px; font-family : Verdana, Geneva, Arial, Helvetica, sans-serif; font-weight : bold; color : Black; } .submit{ background-color : #99ccff; font-size : 12px; font-family : Verdana, Geneva, Arial, Helvetica, sans-serif; font-weight : bold; color : Black; border : 0px solid #708090; cursor : hand; } .tblRTitle{ background-color : #6A5ACD; color : Yellow; font-family : Verdana, Geneva, Arial, Helvetica, sans-serif; font-weight : bold; font-size : 12px; } .tblRStat{ background-color : #99ccff; color : #000000; font-family : Verdana, Geneva, Arial, Helvetica, sans-serif; font-weight : bold; font-size : 11px; } .tblRNormal{ background-color : #99ccff; color : #000000; font-family : Verdana, Geneva, Arial, Helvetica, sans-serif; font-weight : bold; font-size : 12px; } P { color : Black; font-size : 11px; font-family : Verdana, Geneva, Arial, Helvetica, sans-serif; text-decoration : none; } A { color : Black; font-size : 11px; font-family : Verdana, Geneva, Arial, Helvetica, sans-serif; text-decoration : none; } A:HOVER { color : Black; font-size : 11px; font-family : Verdana, Geneva, Arial, Helvetica, sans-serif; text-decoration : underline; } .ok { font-family : Verdana; font-size : 12px; font-weight : bold; background-color : #556B2F; color : White; } .warning { font-family : Verdana; font-size : 12px; font-weight : bold; background-color : #B22222; color : #FFEFD5; } </style> </head> <body bgcolor="#ffffff"> <?php } function f_28() { ?> <br> <hr width="60%" size="1"> <p align="center"> <a href="http://soft.phpdevs.com/" target="_blank">Avrora CJ</a> <font color="#804040">v.<?php print SYS_VERSION?></font> Copyright 2001-2003 <a href="http://www.phpdevs.com/">PHP Devs</a>. </p> </body> </html> <?php } ?>